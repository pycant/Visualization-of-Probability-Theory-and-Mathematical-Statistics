## 现状与问题定位
- 位置：抽卡板块 `#sec-1-3` 的第二块内容卡片（`templates/chapter1.html:344-689`）。实验模式仪表盘为小卡片网格（`templates/chapter1.html:525-547`），体验模式按钮与日志同在此卡片。
- 体验模式逻辑：
  - 单抽/十连绑定在按钮（`templates/chapter1.html:487-524`），事件在 `static/js/chapter1.js:1820-1824`。
  - 十连按钮目前触发 `runBatch(10)`，实际调用的是“按批次的会话”逻辑，而不是连续10次抽卡（`static/js/chapter1.js:1821-1823`）。
  - `appendLogEntry()`只记录一次抽卡事件（单次），但在会话逻辑中仍被调用，导致实验模式污染体验模式的日志与保底计数（`static/js/chapter1.js:1495-1565`）。
- 实验模式逻辑：
  - 每次会话模拟“连续抽 N 次”，返回是否≥1次命中（`simulateTrialGenshin`，`static/js/chapter1.js:987-1006`）。
  - 会话累计频率 `conv` 作为观察命中率；首次命中抽数分布 `histTrials` 记录首命中位置（`static/js/chapter1.js:1410-1455`、`static/js/chapter1.js:1456-1493`）。
- 设计不合理点：
  - 十连绑定批次会话，语义不符；应为连续10抽（体验模式）。
  - 实验模式调用 `appendLogEntry` 修改体验态（抽卡日志、保底计数），应相互隔离。
  - 理论命中 `theoryProb(n,p5,p4)`未考虑保底调度，只做常量近似，建议在实验模式引入时序理论值（`1-∏(1-p_t)`）。

## 修复与重构计划
- 事件绑定修复：
  - 将“十连”改为连续调用10次单抽：`tenBtn → for i in 10: appendDraw()`，完全独立于实验模式。
  - 新增 `appendDraw()`（体验模式单次抽卡），替代当前 `appendLogEntry()`的名称或语义，保持现有外观与计数更新。
- 会话逻辑隔离：
  - `runOneSession()`取消对日志与保底状态的写入，仅更新实验数据：`totalRuns、conv、histTrials、仪表盘统计`。
  - `runBatch(m)`只在实验模式下启用；体验模式调用改为单抽循环。
- 理论值修正（实验模式）：
  - 新增 `theoryProbSchedule(n, p5, p4, k5, k4)`：基于时序概率 `p_t` 计算 `1 - ∏_{t=1..n}(1 - p_t)`。
  - 在仪表盘显示“理论（时序）”与“观察命中率”，提高教学一致性。
- 状态分离：
  - 将体验态的 `gCount、pity4/5、starCounts、日志表` 与实验态的 `totalRuns、conv、histTrials` 明确区分，并在 `switchMode()` 中保证切换不互相影响（`static/js/chapter1.js:947-966`）。

## 仪表盘设计（实验模式）
- 统计卡片（保留并增强）：
  - `理论命中 P(≥1)`：使用时序理论值。
  - `观察命中率`：会话累计频率。
  - `样本量`：批次数（session 数）。
  - `每批成本`与“累计成本/抽数”（提供切换，默认显示每批）。
- 可视化：
  - 首次命中抽数分布：柱状图，x 轴为抽数，y 为频次，支持上限动态裁剪。
  - 命中率收敛：折线图，显示观察值随批次增长逼近理论时序值；仅在实验模式显示。
  - 可选：理论 PMF 覆盖线（用 `P(first=k)=p_k·∏_{t<k}(1-p_t)`）叠加在柱状图上，帮助理解。
- 交互：
  - “批量100次/1000次”按钮保留；新增“清空实验数据”仅清理实验态，不影响体验态日志。
  - 允许切换“每批成本/累计成本”显示。

## 美化与易用性（不改主题风格）
- 卡片视觉：统一使用主题色边框增强，标题下细线动画（参考其他章节样式：`templates/chapter8.html:107-115`）。
- Chart.js 配置：
  - 统一字体与刻度颜色；添加圆角柱、柔和阴影背景；图例与 tooltip 采用主题色。
  - 观察曲线颜色 `neon-blue`，理论曲线使用虚线 `neon-purple`。
- 可读性：
  - 数值统一四位小数或两位百分比；超过阈值以徽标颜色提示（如观察值与理论差距>5%标黄）。

## 代码改动点（拟）
- HTML：仅在实验模式区域添加可选“累计/每批”切换；收敛图只在实验模式显示（已有 `mode-experiment-only` 类）。位置：`templates/chapter1.html:525-547`。
- JS：
  - 重构按钮事件：`static/js/chapter1.js:1820-1824` 十连改为 10 次单抽；新增 `appendDraw()` 封装单次体验抽卡。
  - 隔离会话：`runOneSession` 去除日志调用（`static/js/chapter1.js:1462-1482`附近），只更新实验态。
  - 理论值函数：新增 `theoryProbSchedule` 并在仪表盘使用。
  - `switchMode` 后确保各自状态与图表独立更新（`static/js/chapter1.js:947-966`）。
  - 图表美化：统一 Chart.js 选项与颜色。

## 验证方案
- 手动：
  - 体验模式：单抽与十连只增长抽卡日志与保底计数，不改变实验统计；保底进度与日志一致。
  - 实验模式：批量100/1000次改变样本量与命中率，不产生任何日志或保底变化；收敛曲线随批次稳定逼近理论时序值。
- 统计一致性：
  - 在固定 `p5/p4/k5/k4` 下，观察值与时序理论误差收敛；首次命中分布形状合理。
  - 切换模式后状态保持独立，重置各自数据不互扰。

## 交付顺序
1. 修复十连与抽卡日志污染问题（事件绑定与状态隔离）。
2. 引入时序理论值并在实验仪表盘展示。
3. 图表与卡片美化，统一主题。
4. 验证与微调边界行为（极端参数与小样本）。

请确认以上方案；确认后我将按上述步骤实现、联调并在本地预览验证。