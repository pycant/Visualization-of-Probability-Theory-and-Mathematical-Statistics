<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>第1章 随机事件与概率</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- KaTeX 样式与脚本（用于 LaTeX 公式渲染） -->
    <link rel="stylesheet" href="../static/libs/katex/css/katex.min.css" />
    <script src="../static/libs/katex/js/katex.min.js"></script>
    <script src="../static/libs/katex/js/auto-render.min.js"></script>
    <script src="../static/libs/chart/chart.umd.min.js"></script>
    <link rel="icon" href="../static/images/favicon.ico" />
    <link rel="stylesheet" href="../static/css/chapter1.css" />
    <style type="text/tailwindcss">
      .gap-8 {
        gap: 1rem;
      }
    </style>
    <script>
      // 为导航注入页面级锚点链接（在导航脚本加载前定义）
      window.NAV_CONFIG = {
        active: "chapter1",
        sectionLinks: [
          { href: "#sec-1-1", label: "1.1 随机事件及其运算" },
          { href: "#sec-1-2", label: "1.2 概率的定义与确定方法" },
          { href: "#sec-1-3", label: "1.3 概率的性质" },
          { href: "#sec-1-4", label: "1.4 条件概率" },
        ],
      };
    </script>
  </head>
  <body class="bg-dark-bg text-white">
    <canvas id="bg-noise" aria-hidden="true"></canvas>
    <!-- 通过脚本动态注入统一导航栏 -->
    <script src="../static/js/include-navbar.js"></script>

    <div
      class="min-h-screen bg-gradient-to-b from-dark-bg to-dark-card/50 pt-20 bg-overlay"
    >
      <section
        class="relative z-10 mx-auto max-w-6xl px-6 sm:px-8 text-center py-24 clip-path-slant"
      >
        <div class="absolute inset-0 bg-grid opacity-10"></div>
        <h1 class="title-gradient hero-title font-extrabold leading-tight">
          第1章 随机事件与概率
        </h1>
        <p class="subtitle hero-subtitle mt-3 sm:mt-4">
          概率论的基础概念与运算规则，直观理解事件与独立性。
        </p>
        <div class="mt-5 flex flex-wrap justify-center gap-2">
          <span
            class="px-3 py-1 rounded-full border border-white/15 bg-white/5 text-gray-200 flex items-center gap-2"
          >
            <i class="fa-solid fa-dice"></i> 随机事件
          </span>
          <span
            class="px-3 py-1 rounded-full border border-white/15 bg-white/5 text-gray-200 flex items-center gap-2"
          >
            <i class="fa-solid fa-code-branch"></i> 条件概率
          </span>
          <span
            class="px-3 py-1 rounded-full border border-white/15 bg-white/5 text-gray-200 flex items-center gap-2"
          >
            <i class="fa-solid fa-link"></i> 独立性
          </span>
        </div>
        <div class="mt-6 flex justify-center">
          <div class="glass-card fx-holo rounded-xl px-4 py-3">
            <div class="text-sm text-gray-300 mb-2">关键公式</div>
            <div>$$P(A\mid B)=\frac{P(A\cap B)}{P(B)}$$</div>
            <div class="mt-2">$$P(A\cup B)=P(A)+P(B)-P(A\cap B)$$</div>
          </div>
        </div>
        <div
          class="mt-6 sm:mt-8 flex flex-wrap gap-3 justify-center"
          id="hero-links"
        ></div>
      </section>
      <section
        id="sec-1-1"
        class="relative z-10 mx-auto max-w-6xl px-6 sm:px-8 mt-16"
      >
        <div class="glass-card fx-holo rounded-2xl p-6 sm:p-8">
          <div class="flex flex-col lg:flex-row gap-8">
            <div class="flex-1">
              <canvas
                id="venn-canvas"
                width="560"
                height="360"
                class="w-full rounded-xl bg-dark-card/60"
              ></canvas>
              <div class="mt-4 grid grid-cols-2 sm:grid-cols-4 gap-3 text-sm">
                <div class="rounded-lg border border-white/10 bg-white/5 p-3">
                  <div>P(A∪B)</div>
                  <div id="v-union" class="text-neon-blue text-lg">0.00</div>
                </div>
                <div class="rounded-lg border border-white/10 bg-white/5 p-3">
                  <div>P(A∩B)</div>
                  <div id="v-intersection" class="text-neon-purple text-lg">
                    0.00
                  </div>
                </div>
                <div class="rounded-lg border border-white/10 bg-white/5 p-3">
                  <div>P(A̅)</div>
                  <div id="v-complement-a" class="text-neon-green text-lg">
                    0.00
                  </div>
                </div>
                <div class="rounded-lg border border-white/10 bg-white/5 p-3">
                  <div>P(B̅)</div>
                  <div id="v-complement-b" class="text-neon-green text-lg">
                    0.00
                  </div>
                </div>
              </div>
            </div>
            <div class="w-full lg:w-72">
              <div class="space-y-5">
                <div>
                  <div class="mb-2 text-sm">P(A)</div>
                  <input
                    id="venn-pa"
                    type="range"
                    min="0"
                    max="100"
                    value="40"
                    class="w-full accent-neon-purple"
                  />
                </div>
                <div>
                  <div class="mb-2 text-sm">P(B)</div>
                  <input
                    id="venn-pb"
                    type="range"
                    min="0"
                    max="100"
                    value="50"
                    class="w-full accent-neon-blue"
                  />
                </div>
                <div>
                  <div class="mb-2 text-sm">交集强度</div>
                  <input
                    id="venn-overlap"
                    type="range"
                    min="0"
                    max="100"
                    value="30"
                    class="w-full accent-neon-green"
                  />
                  <div class="mt-1 text-xs text-gray-300">自由模式下生效</div>
                </div>
                <div class="flex items-center gap-2">
                  <input id="venn-independent" type="checkbox" />
                  <label for="venn-independent" class="text-sm">独立模式</label>
                </div>
                <div>
                  <div class="mb-2 text-sm">事件标签</div>
                  <div class="flex flex-wrap gap-2">
                    <button
                      class="px-3 py-1 rounded-md border border-white/15 bg-white/5"
                      data-theme="default"
                    >
                      事件A/事件B
                    </button>
                    <button
                      class="px-3 py-1 rounded-md border border-white/15 bg-white/5"
                      data-theme="social"
                    >
                      吃瓜/发弹幕
                    </button>
                    <button
                      class="px-3 py-1 rounded-md border border-white/15 bg-white/5"
                      data-theme="interaction"
                    >
                      点赞/收藏
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="mt-8 glass-card fx-holo rounded-2xl p-6 sm:p-8">
          <h3 class="text-xl font-semibold mb-3">历史介绍</h3>
          <ul class="list-disc pl-6 space-y-2 text-gray-200">
            <li>
              韦恩图由约翰·韦恩（John Venn, 1880）提出，用于集合关系可视化。
            </li>
            <li>
              概率的集合化与公理化在 20 世纪由科尔莫哥洛夫（Kolmogorov,
              1933）系统化，基于集合与测度的形式化定义。
            </li>
          </ul>
        </div>
      </section>
      <section
        id="sec-1-2"
        class="relative z-10 mx-auto max-w-6xl px-6 sm:px-8 mt-16"
      >
        <div class="glass-card fx-holo rounded-2xl p-6 sm:p-8">
          <div class="flex flex-col lg:flex-row gap-8">
            <div class="flex-1">
              <div class="mb-3 text-lg font-semibold">
                概率的定义及其确定方法｜骰子到暴击
              </div>
              <canvas
                id="crit-bar"
                width="560"
                height="240"
                class="w-full rounded-xl bg-dark-card/60"
              ></canvas>
              <canvas
                id="crit-line"
                width="560"
                height="160"
                class="w-full rounded-xl bg-dark-card/60 mt-4"
              ></canvas>
            </div>
            <div class="w-full lg:w-80">
              <div class="space-y-5">
                <div>
                  <div class="mb-2 text-sm">暴击率 p</div>
                  <input
                    id="crit-p"
                    type="range"
                    min="0"
                    max="100"
                    value="30"
                    class="w-full accent-neon-green"
                  />
                </div>
                <div>
                  <div class="mb-2 text-sm">攻击次数 n</div>
                  <input
                    id="crit-n"
                    type="range"
                    min="1"
                    max="50"
                    value="10"
                    class="w-full accent-neon-blue"
                  />
                </div>
                <div class="grid grid-cols-2 gap-3 text-sm">
                  <div class="rounded-lg border border-white/10 bg-white/5 p-3">
                    <div>理论值 P(≥1)</div>
                    <div id="crit-theory" class="text-neon-blue text-lg">
                      0.00
                    </div>
                  </div>
                  <div class="rounded-lg border border-white/10 bg-white/5 p-3">
                    <div>频率估计</div>
                    <div id="crit-freq" class="text-neon-purple text-lg">
                      0.00
                    </div>
                  </div>
                  <div class="rounded-lg border border-white/10 bg-white/5 p-3">
                    <div>误差 |Δ|</div>
                    <div id="crit-error" class="text-neon-green text-lg">
                      0.00
                    </div>
                  </div>
                  <div class="rounded-lg border border-white/10 bg-white/5 p-3">
                    <div>试验次数</div>
                    <div id="crit-trials" class="text-lg">0</div>
                  </div>
                </div>
                <div class="flex flex-wrap gap-2">
                  <button
                    id="crit-once"
                    class="px-3 py-2 rounded-md border border-white/15 bg-white/5"
                  >
                    试验一次
                  </button>
                  <button
                    id="crit-100"
                    class="px-3 py-2 rounded-md border border-white/15 bg-white/5"
                  >
                    试验100次
                  </button>
                  <button
                    id="crit-1000"
                    class="px-3 py-2 rounded-md border border-white/15 bg-white/5"
                  >
                    试验1000次
                  </button>
                  <button
                    id="crit-reset"
                    class="px-3 py-2 rounded-md border border-white/15 bg-white/5"
                  >
                    清空
                  </button>
                </div>
                <div class="text-xs text-gray-300">
                  前提：独立同分布（i.i.d.）。若存在依赖，频率法与理论值可能不一致。
                </div>
                <div
                  class="rounded-lg border border-white/10 bg-white/5 p-3 text-sm text-gray-200"
                >
                  <div class="font-medium mb-2">样本空间：古典法 vs 频率法</div>
                  <div>
                    等可能样本空间（如骰子）用于经典概率的定义；Bernoulli
                    独立试验用于频率法收敛观察。
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="mt-8 glass-card fx-holo rounded-2xl p-6 sm:p-8">
          <h3 class="text-xl font-semibold mb-3">历史介绍</h3>
          <ul class="list-disc pl-6 space-y-2 text-gray-200">
            <li>
              古典概率由拉普拉斯（Laplace, 1812）系统阐述，基于等可能样本空间。
            </li>
            <li>
              频率法由伯努利（Jakob Bernoulli,
              1713）的大数定律奠基，说明频率向理论概率收敛。
            </li>
          </ul>
        </div>
      </section>

      <section
        id="sec-1-3"
        class="relative z-10 mx-auto max-w-6xl px-6 sm:px-8 mt-16"
      >
        <div class="glass-card fx-holo rounded-2xl p-3 sm:p-4 mb-4">
          <div class="flex items-center gap-2">
            <button id="gacha-tab-experience" class="mode-tab active">
              抽卡体验
            </button>
            <button id="gacha-tab-experiment" class="mode-tab">批量实验</button>
            <button id="gacha-tab-theory" class="mode-tab">理论讲解</button>
          </div>
        </div>
        <div class="glass-card fx-holo rounded-2xl p-6 sm:p-8">
          <div class="flex flex-col lg:flex-row gap-8">
            <div class="w-full lg:w-72 mode-hide-in-theory">
              <div class="space-y-5">
                <div class="text-lg font-semibold">抽卡/盲盒概率实验台</div>
                <div
                  id="gacha-param-header"
                  class="tool-header bg-dark-bg rounded-lg p-4 border border-gray-700 hover:border-neon-blue transition-all duration-300 cursor-pointer flex items-center justify-between"
                >
                  <div class="font-medium">参数调节面板</div>
                  <i
                    class="fa fa-chevron-down text-gray-400 transition-transform duration-300"
                    id="gacha-param-chevron"
                  ></i>
                </div>
                <div
                  id="gacha-param-content"
                  class="tool-content mt-2 p-4 bg-dark-bg rounded-lg border border-gray-700"
                >
                  <div class="mb-3 text-sm text-gray-300">
                    点击标题可收起/展开；点击“保存”则收起并在下方显示参数汇总。
                  </div>
                  <div>
                    <div class="mb-2 text-sm flex items-center justify-between">
                      <span>5★基础概率 p5 (%)</span
                      ><span id="gacha-p5-val" class="param-val">0.6%</span>
                    </div>
                    <input
                      id="gacha-p5"
                      type="range"
                      min="0"
                      max="5"
                      step="0.1"
                      value="0.6"
                      class="w-full accent-neon-purple"
                    />
                  </div>
                  <div>
                    <div class="mb-2 text-sm flex items-center justify-between">
                      <span>4★基础概率 p4 (%)</span
                      ><span id="gacha-p4-val" class="param-val">5.1%</span>
                    </div>
                    <input
                      id="gacha-p4"
                      type="range"
                      min="0"
                      max="20"
                      step="0.1"
                      value="5.1"
                      class="w-full accent-neon-green"
                    />
                  </div>
                  <div>
                    <div class="mb-2 text-sm flex items-center justify-between">
                      <span>5★保底阈值</span
                      ><span id="gacha-pity5-val" class="param-val">90</span>
                    </div>
                    <input
                      id="gacha-pity5"
                      type="range"
                      min="1"
                      max="200"
                      value="90"
                      class="w-full accent-neon-blue"
                    />
                  </div>
                  <div>
                    <div class="mb-2 text-sm flex items-center justify-between">
                      <span>4★保底阈值</span
                      ><span id="gacha-pity4-val" class="param-val">10</span>
                    </div>
                    <input
                      id="gacha-pity4"
                      type="range"
                      min="1"
                      max="50"
                      value="10"
                      class="w-full accent-neon-blue"
                    />
                  </div>
                  <div>
                    <div class="mb-2 text-sm flex items-center justify-between">
                      <span>限定概率（50/50） (%)</span
                      ><span id="gacha-featured-val" class="param-val"
                        >50%</span
                      >
                    </div>
                    <input
                      id="gacha-featured"
                      type="range"
                      min="0"
                      max="100"
                      value="50"
                      class="w-full accent-neon-purple"
                    />
                  </div>
                  <div>
                    <div class="mb-2 text-sm flex items-center justify-between">
                      <span>连续抽 N 次</span
                      ><span id="gacha-n-val" class="param-val">90</span>
                    </div>
                    <input
                      id="gacha-n"
                      type="range"
                      min="1"
                      max="200"
                      value="90"
                      class="w-full accent-neon-blue"
                    />
                  </div>
                  <div>
                    <div class="mb-2 text-sm flex items-center justify-between">
                      <span>单抽价格 (¥)</span
                      ><span id="gacha-cost-val" class="param-val">¥16</span>
                    </div>
                    <input
                      id="gacha-cost"
                      type="range"
                      min="1"
                      max="100"
                      value="16"
                      class="w-full accent-neon-purple"
                    />
                  </div>
                  <div class="mt-3 flex justify-end">
                    <button
                      id="gacha-param-save"
                      class="px-3 py-2 rounded-md border border-white/15 bg-white/5"
                    >
                      保存
                    </button>
                  </div>
                </div>
                <div
                  id="gacha-param-summary"
                  class="hidden mt-2 p-4 bg-dark-bg rounded-lg border border-gray-700"
                >
                  <div class="text-sm text-gray-300 mb-2">参数汇总</div>
                  <div
                    class="flex flex-wrap gap-2"
                    id="gacha-param-summary-items"
                  ></div>
                </div>
                <div id="gacha-ops" class="flex flex-wrap gap-2">
                  <button
                    id="gacha-run-1"
                    class="px-3 py-2 rounded-md border border-white/15 bg-white/5"
                  >
                    运行一次
                  </button>
                  <button
                    id="gacha-single"
                    class="px-3 py-2 rounded-md border border-white/15 bg-white/5"
                  >
                    单抽
                  </button>
                  <button
                    id="gacha-ten"
                    class="px-3 py-2 rounded-md border border-white/15 bg-white/5"
                  >
                    十连
                  </button>
                  <button
                    id="gacha-run-100"
                    class="px-3 py-2 rounded-md border border-white/15 bg-white/5"
                  >
                    批量100次
                  </button>
                  <button
                    id="gacha-run-1000"
                    class="px-3 py-2 rounded-md border border-white/15 bg-white/5"
                  >
                    批量1000次
                  </button>
                  <button
                    id="gacha-reset"
                    class="px-3 py-2 rounded-md border border-white/15 bg-white/5"
                  >
                    清空
                  </button>
                </div>
                <!-- 基础统计仪表盘 - 紧凑版 -->
                <div class="mode-experiment-only hidden mb-4">
                  <div class="text-sm text-gray-300 mb-2 font-medium">
                    基础统计
                  </div>
                  <div class="grid grid-cols-2 gap-2 text-sm">
                    <div
                      class="rounded-lg border border-gray-800 bg-dark-bg/50 p-3 hover:border-neon-green transition-all duration-300"
                    >
                      <div class="text-xs text-gray-400">理论命中 P(≥1)</div>
                      <div
                        id="gacha-theory"
                        class="text-neon-blue text-base font-semibold"
                      >
                        0.00
                      </div>
                    </div>
                    <div
                      class="rounded-lg border border-gray-800 bg-dark-bg/50 p-3 hover:border-neon-green transition-all duration-300"
                    >
                      <div class="text-xs text-gray-400">频率估计</div>
                      <div
                        id="gacha-freq"
                        class="text-neon-purple text-base font-semibold"
                      >
                        0.00
                      </div>
                    </div>
                    <div
                      class="rounded-lg border border-gray-800 bg-dark-bg/50 p-3 hover:border-neon-green transition-all duration-300"
                    >
                      <div class="text-xs text-gray-400">期望抽数</div>
                      <div id="gacha-exp" class="text-base font-semibold">
                        0
                      </div>
                    </div>
                    <div
                      class="rounded-lg border border-gray-800 bg-dark-bg/50 p-3 hover:border-neon-green transition-all duration-300"
                    >
                      <div class="text-xs text-gray-400">成本估计</div>
                      <div id="gacha-cost-view" class="text-base font-semibold">
                        ¥0
                      </div>
                    </div>
                  </div>
                </div>

                <div
                  class="rounded-lg border border-white/10 bg-white/5 p-3 text-sm mt-3 mode-experience-only"
                >
                  <div class="flex flex-wrap gap-2 items-center">
                    <span class="param-val"
                      >抽奖次数 <span id="gacha-count">0</span></span
                    >
                    <span class="param-val"
                      >4★保底 <span id="gacha-pity4">0</span></span
                    >
                    <span class="param-val"
                      >5★保底 <span id="gacha-pity5">0</span></span
                    >
                    <span class="param-val"
                      >距大保底 <span id="gacha-da">90</span></span
                    >
                  </div>
                </div>
                <div
                  class="rounded-lg border border-white/10 bg-white/5 p-3 text-sm mode-experience-only"
                >
                  <div>幸运度</div>
                  <div id="gacha-luck" class="mt-1 text-neon-green">—</div>
                </div>
                <div class="text-xs text-gray-300">
                  前提：独立同分布或条件独立（按策略
                  p_t）。递增保底为随抽次变动的概率；截断几何为第 k 抽保证命中。
                </div>
              </div>
            </div>
            <div class="flex-1 mode-hide-in-theory">
              <div class="flex items-center gap-2 mb-2 mode-hide-in-theory">
                <span class="text-xs text-gray-300">图像视图</span>
                <button
                  id="gacha-view-4plus"
                  class="px-2 py-1 rounded-md border border-white/15 bg-white/5"
                >
                  ≥4★
                </button>
                <button
                  id="gacha-view-5"
                  class="px-2 py-1 rounded-md border border-white/15 bg-white/5"
                >
                  只看5★
                </button>
              </div>
              <!-- 主要图表显示区域 -->
              <div
                class="grid grid-cols-1 md:grid-cols-2 gap-4 mode-hide-in-theory"
              >
                <div class="mode-experience-only">
                  <div class="text-sm text-gray-300 mb-2">
                    星级统计（次数/概率）
                  </div>
                  <div
                    class="h-64 w-full rounded-xl bg-dark-card/60 p-3 overflow-auto mt-2"
                  >
                    <table
                      class="w-full text-sm border border-white/10 rounded-xl overflow-hidden stats-table"
                    >
                      <thead>
                        <tr>
                          <th class="p-2">星级</th>
                          <th class="p-2">次数</th>
                          <th class="p-2">概率</th>
                          <th class="p-2">理论概率</th>
                        </tr>
                      </thead>
                      <tbody id="gacha-stars-table"></tbody>
                    </table>
                  </div>
                </div>
                <div class="mode-experiment-only hidden">
                  <div class="text-sm text-gray-300 mb-2">
                    实验结果记录（按批次）
                  </div>
                  <div class="h-64 w-full rounded-xl bg-dark-card/60">
                    <canvas id="gacha-sessions"></canvas>
                  </div>
                </div>
                <div class="mode-experience-only">
                  <div class="text-sm text-gray-300 mb-2">保底进度时间轴</div>
                  <div class="h-64 w-full rounded-xl bg-dark-card/60">
                    <canvas id="gacha-pity"></canvas>
                  </div>
                </div>
                <div class="mode-experiment-only hidden">
                  <div class="text-sm text-gray-300 mb-2">
                    命中率收敛（观察 vs 时序理论）
                  </div>
                  <div class="h-64 w-full rounded-xl bg-dark-card/60">
                    <canvas id="gacha-conv"></canvas>
                  </div>
                </div>
                <div>
                  <div class="text-sm text-gray-300 mb-2">首次命中抽数分布</div>
                  <div class="h-64 w-full rounded-xl bg-dark-card/60">
                    <canvas id="gacha-hist"></canvas>
                  </div>
                </div>
                <div>
                  <div class="text-sm text-gray-300 mb-2">概率调度曲线</div>
                  <div class="h-64 w-full rounded-xl bg-dark-card/60">
                    <canvas id="gacha-prob"></canvas>
                  </div>
                </div>
              </div>
              <!-- 实验模式仪表盘区域 -->
              <div class="mode-experiment-only hidden mb-6">
                <!-- 五星角色花费统计仪表盘 -->
                <div class="mb-6">
                  <div class="text-sm text-gray-300 mb-3 font-medium">
                    五星角色获取统计
                  </div>
                  <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 text-sm">
                    <div
                      class="rounded-xl border border-amber-800/50 bg-amber-900/20 p-4 hover:border-amber-600 transition-all duration-300"
                    >
                      <div class="text-amber-200">平均5★花费 (实验)</div>
                      <div
                        id="gacha-avg-cost-5star-exp"
                        class="text-amber-400 text-lg font-bold"
                      >
                        ¥0
                      </div>
                      <div class="text-xs text-amber-300 mt-1">
                        基于实验数据
                      </div>
                    </div>
                    <div
                      class="rounded-xl border border-amber-800/50 bg-amber-900/20 p-4 hover:border-amber-600 transition-all duration-300"
                    >
                      <div class="text-amber-200">平均5★花费 (理论)</div>
                      <div
                        id="gacha-avg-cost-5star-theory"
                        class="text-amber-400 text-lg font-bold"
                      >
                        ¥0
                      </div>
                      <div class="text-xs text-amber-300 mt-1">理论期望值</div>
                    </div>
                    <div
                      class="rounded-xl border border-purple-800/50 bg-purple-900/20 p-4 hover:border-purple-600 transition-all duration-300"
                    >
                      <div class="text-purple-200">限定5★花费 (实验)</div>
                      <div
                        id="gacha-avg-cost-featured-exp"
                        class="text-purple-400 text-lg font-bold"
                      >
                        ¥0
                      </div>
                      <div class="text-xs text-purple-300 mt-1">
                        考虑50/50机制
                      </div>
                    </div>
                    <div
                      class="rounded-xl border border-purple-800/50 bg-purple-900/20 p-4 hover:border-purple-600 transition-all duration-300"
                    >
                      <div class="text-purple-200">限定5★花费 (理论)</div>
                      <div
                        id="gacha-avg-cost-featured-theory"
                        class="text-purple-400 text-lg font-bold"
                      >
                        ¥0
                      </div>
                      <div class="text-xs text-purple-300 mt-1">理论期望值</div>
                    </div>
                  </div>
                </div>

                <!-- 实验统计仪表盘 -->
                <div class="mb-6">
                  <div class="text-sm text-gray-300 mb-3 font-medium">
                    实验统计概览
                  </div>
                  <div class="grid grid-cols-2 lg:grid-cols-6 gap-3 text-sm">
                    <div
                      class="rounded-xl border border-blue-800/50 bg-blue-900/20 p-4 hover:border-blue-600 transition-all duration-300"
                    >
                      <div class="text-blue-200">总实验次数</div>
                      <div
                        id="gacha-total-experiments"
                        class="text-blue-400 text-lg font-bold"
                      >
                        0
                      </div>
                    </div>
                    <div
                      class="rounded-xl border border-green-800/50 bg-green-900/20 p-4 hover:border-green-600 transition-all duration-300"
                    >
                      <div class="text-green-200">成功率</div>
                      <div
                        id="gacha-success-rate"
                        class="text-green-400 text-lg font-bold"
                      >
                        0%
                      </div>
                    </div>
                    <div
                      class="rounded-xl border border-red-800/50 bg-red-900/20 p-4 hover:border-red-600 transition-all duration-300"
                    >
                      <div class="text-red-200">最大花费</div>
                      <div
                        id="gacha-max-cost"
                        class="text-red-400 text-lg font-bold"
                      >
                        ¥0
                      </div>
                    </div>
                    <div
                      class="rounded-xl border border-cyan-800/50 bg-cyan-900/20 p-4 hover:border-cyan-600 transition-all duration-300"
                    >
                      <div class="text-cyan-200">最小花费</div>
                      <div
                        id="gacha-min-cost"
                        class="text-cyan-400 text-lg font-bold"
                      >
                        ¥0
                      </div>
                    </div>
                    <div
                      class="rounded-xl border border-yellow-800/50 bg-yellow-900/20 p-4 hover:border-yellow-600 transition-all duration-300"
                    >
                      <div class="text-yellow-200">标准差</div>
                      <div
                        id="gacha-cost-std"
                        class="text-yellow-400 text-lg font-bold"
                      >
                        ¥0
                      </div>
                    </div>
                    <div
                      class="rounded-xl border border-indigo-800/50 bg-indigo-900/20 p-4 hover:border-indigo-600 transition-all duration-300"
                    >
                      <div class="text-indigo-200">中位数花费</div>
                      <div
                        id="gacha-median-cost"
                        class="text-indigo-400 text-lg font-bold"
                      >
                        ¥0
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 保底机制统计 -->
                <div class="mb-6">
                  <div class="text-sm text-gray-300 mb-3 font-medium">
                    保底机制统计
                  </div>
                  <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 text-sm">
                    <div
                      class="rounded-xl border border-orange-800/50 bg-orange-900/20 p-4 hover:border-orange-600 transition-all duration-300"
                    >
                      <div class="text-orange-200">软保底触发率</div>
                      <div
                        id="gacha-soft-pity-rate"
                        class="text-orange-400 text-lg font-bold"
                      >
                        0%
                      </div>
                      <div class="text-xs text-orange-300 mt-1">75抽后触发</div>
                    </div>
                    <div
                      class="rounded-xl border border-red-800/50 bg-red-900/20 p-4 hover:border-red-600 transition-all duration-300"
                    >
                      <div class="text-red-200">硬保底触发率</div>
                      <div
                        id="gacha-hard-pity-rate"
                        class="text-red-400 text-lg font-bold"
                      >
                        0%
                      </div>
                      <div class="text-xs text-red-300 mt-1">90抽必出</div>
                    </div>
                    <div
                      class="rounded-xl border border-pink-800/50 bg-pink-900/20 p-4 hover:border-pink-600 transition-all duration-300"
                    >
                      <div class="text-pink-200">平均保底抽数</div>
                      <div
                        id="gacha-avg-pity-count"
                        class="text-pink-400 text-lg font-bold"
                      >
                        0
                      </div>
                      <div class="text-xs text-pink-300 mt-1">
                        获得5★时的抽数
                      </div>
                    </div>
                    <div
                      class="rounded-xl border border-teal-800/50 bg-teal-900/20 p-4 hover:border-teal-600 transition-all duration-300"
                    >
                      <div class="text-teal-200">歪率统计</div>
                      <div
                        id="gacha-miss-rate"
                        class="text-teal-400 text-lg font-bold"
                      >
                        0%
                      </div>
                      <div class="text-xs text-teal-300 mt-1">非限定5★比例</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="gacha-log mt-3 mode-experience-only">
                <div class="text-sm text-gray-300 mb-2">抽卡日志</div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-3">
                  <div>
                    <table
                      class="w-full text-sm border border-white/10 rounded-xl overflow-hidden table-sum4"
                    >
                      <thead>
                        <tr>
                          <th colspan="3" class="p-2">4★汇总</th>
                        </tr>
                        <tr>
                          <th class="p-2">次数</th>
                          <th class="p-2">星级</th>
                          <th class="p-2">结果</th>
                        </tr>
                      </thead>
                      <tbody id="gacha-sum4"></tbody>
                    </table>
                  </div>
                  <div>
                    <table
                      class="w-full text-sm border border-white/10 rounded-xl overflow-hidden"
                    >
                      <thead>
                        <tr>
                          <th class="p-2">次数</th>
                          <th class="p-2">星级</th>
                          <th class="p-2">是否命中</th>
                          <th class="p-2">随机数</th>
                        </tr>
                      </thead>
                      <tbody id="gacha-log-table"></tbody>
                    </table>
                  </div>
                  <div>
                    <table
                      class="w-full text-sm border border-white/10 rounded-xl overflow-hidden table-sum5"
                    >
                      <thead>
                        <tr>
                          <th colspan="3" class="p-2">5★汇总</th>
                        </tr>
                        <tr>
                          <th class="p-2">次数</th>
                          <th class="p-2">星级</th>
                          <th class="p-2">是否限定</th>
                        </tr>
                      </thead>
                      <tbody id="gacha-sum5"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <!-- 理论讲解模式专用布局 -->
            <div class="mode-theory-only hidden">
              <div
                class="flex flex-col lg:flex-row gap-4 lg:gap-6 max-h-[80vh] min-h-[500px]"
              >
                <!-- 左中侧：视频讲解区域 -->
                <div
                  id="theory-video-panel"
                  class="flex-1 lg:basis-2/3 lg:flex-none min-h-0 min-w-0"
                >
                  <div
                    class="glass-card fx-holo rounded-2xl p-3 lg:p-4 h-full flex flex-col"
                  >
                    <div
                      class="text-base font-semibold mb-2 text-center flex-shrink-0"
                    >
                      视频讲解
                    </div>

                    <!-- 视频加载控制 -->
                    <div class="mb-2 flex-shrink-0">
                      <div class="flex items-center gap-2 mb-1">
                        <input
                          id="gacha-video-url"
                          type="text"
                          placeholder="粘贴视频地址"
                          class="flex-1 bg-gray-800 text-white py-1 px-2 rounded border border-gray-700 focus:outline-none focus:ring-1 focus:ring-neon-blue text-xs"
                        />
                        <button
                          id="gacha-video-load"
                          class="px-2 py-1 rounded border border-white/15 bg-white/5 hover:bg-white/10 transition-colors text-xs"
                        >
                          加载
                        </button>
                      </div>
                      <div class="flex flex-wrap gap-1">
                        <button
                          class="px-1.5 py-0.5 rounded border border-white/15 bg-white/5 hover:bg-white/10 transition-colors text-xs"
                          data-video-type="intro"
                        >
                          概率基础
                        </button>
                        <button
                          class="px-1.5 py-0.5 rounded border border-white/15 bg-white/5 hover:bg-white/10 transition-colors text-xs"
                          data-video-type="gacha"
                        >
                          抽卡机制
                        </button>
                        <button
                          class="px-1.5 py-0.5 rounded border border-white/15 bg-white/5 hover:bg-white/10 transition-colors text-xs"
                          data-video-type="pity"
                        >
                          保底系统
                        </button>
                        <button
                          class="px-1.5 py-0.5 rounded border border-white/15 bg-white/5 hover:bg-white/10 transition-colors text-xs"
                          data-video-type="probability"
                        >
                          概率计算
                        </button>
                      </div>
                    </div>

                    <!-- 视频播放区域 -->
                    <div class="flex-1 min-h-0">
                      <div
                        id="gacha-video-slot"
                        class="rounded-xl overflow-hidden bg-black/30 border border-white/10 h-full w-full"
                      >
                        <div
                          class="flex items-center justify-center h-full text-gray-400"
                        >
                          <div class="text-center">
                            <i
                              class="fa-solid fa-play-circle text-2xl mb-1"
                            ></i>
                            <div class="text-xs">请加载视频开始学习</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 右侧：讲解面板 -->
                <div
                  id="theory-explain-panel"
                  class="flex-1 lg:basis-1/3 lg:flex-none min-h-0 min-w-0"
                >
                  <div
                    class="glass-card fx-holo rounded-2xl p-2 lg:p-3 h-full flex flex-col"
                  >
                    <div class="text-base font-semibold mb-2 flex-shrink-0">
                      讲解面板
                    </div>
                    <div class="flex-1 min-h-0 flex flex-col gap-2 pr-1">
                      <!-- 公式展示区域 -->
                      <div class="flex-1 min-h-0">
                        <div class="text-xs text-gray-300 mb-1 font-medium">
                          相关公式
                        </div>
                        <div
                          id="gacha-formula"
                          class="rounded border border-white/10 bg-white/5 p-2 h-full overflow-auto"
                        >
                          <div class="text-xs font-medium mb-2">
                            核心概率公式
                          </div>
                          <div class="space-y-1 text-xs">
                            <div>
                              \\(P(A \\cup B) = P(A) + P(B) - P(A \\cap B)\\)
                            </div>
                            <div>\\(P(A|B) = \\frac{P(A \\cap B)}{P(B)}\\)</div>
                            <div>\\(P(\\text{至少一次}) = 1 - (1-p)^n\\)</div>
                            <div class="text-xs text-gray-400 mt-1">
                              抽卡概率核心公式
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- 教材参考 -->
                      <div class="flex-shrink-0">
                        <div class="text-xs text-gray-300 mb-1 font-medium">
                          参考教材
                        </div>
                        <div
                          class="rounded border border-white/10 bg-white/5 p-1.5"
                        >
                          <a
                            href="../docs/概率导论 (Dimitri Bertsekas) (Z-Library).pdf"
                            class="text-neon-blue underline hover:text-neon-purple transition-colors text-xs"
                            target="_blank"
                          >
                            概率导论（Bertsekas）
                          </a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="mt-8 glass-card fx-holo rounded-2xl p-6 sm:p-8">
          <h3 class="text-xl font-semibold mb-3">历史介绍</h3>
          <ul class="list-disc pl-6 space-y-2 text-gray-200">
            <li>
              “扭蛋/抽卡”源于日本的胶囊玩具文化，现代手游引入“保底”以缓解极端不幸体验。
            </li>
            <li>
              概率中的补事件与加法公式是基础性质，帮助用“至少一次命中”解释直觉问题。
            </li>
          </ul>
        </div>
      </section>

      <section
        id="sec-1-4"
        class="relative z-10 mx-auto max-w-6xl px-6 sm:px-8 mt-16"
      >
        <!-- 1.4.1 Among Us Evidence Analyzer -->
        <div class="glass-card fx-holo rounded-2xl p-6 sm:p-8 mb-8">
          <div class="mb-6">
            <h2 class="text-2xl font-bold text-neon-blue mb-2">
              <i class="fa-solid fa-magnifying-glass mr-2"></i>Among Us
              证据分析器
            </h2>
            <p class="text-gray-300">
              通过太空狼人杀场景，直观理解 $P(A|B)$ 与 $P(B|A)$ 的区别。
            </p>
          </div>
          <div class="flex flex-col lg:flex-row gap-8">
            <div class="flex-1">
              <div
                id="among-us-viz"
                class="h-64 rounded-xl bg-dark-card/60 relative flex items-center justify-center"
              >
                <!-- Visualization will be injected here -->
                <div class="text-center">
                  <i
                    class="fa-solid fa-user-astronaut text-6xl text-gray-600 mb-4 block"
                  ></i>
                  <span class="text-gray-400">等待配置参数...</span>
                </div>
              </div>
              <div class="mt-4 h-40 w-full rounded-xl bg-dark-card/60 p-2">
                <canvas id="au-trend-chart"></canvas>
              </div>
              <div
                id="among-us-formula"
                class="mt-4 p-4 rounded-xl bg-white/5 border border-white/10"
                style="margin: 1.1rem"
              >
                <!-- Formula display -->
              </div>
            </div>
            <div class="w-full lg:w-80 space-y-5">
              <div>
                <div class="mb-2 text-sm flex justify-between">
                  <span>内鬼比例 (先验概率)</span>
                  <span id="au-prior-val" class="text-neon-purple">20%</span>
                </div>
                <input
                  id="au-prior"
                  type="range"
                  min="1"
                  max="50"
                  value="20"
                  class="w-full accent-neon-purple"
                />
              </div>
              <div>
                <div class="mb-2 text-sm flex justify-between">
                  <span>证据准确度 (似然性)</span>
                  <span id="au-accuracy-val" class="text-neon-blue">80%</span>
                </div>
                <input
                  id="au-accuracy"
                  type="range"
                  min="50"
                  max="99"
                  value="80"
                  class="w-full accent-neon-blue"
                />
              </div>
              <div>
                <div class="mb-2 text-sm">发现证据</div>
                <div class="flex flex-wrap gap-2" id="au-evidence-controls">
                  <!-- Evidence buttons will be injected here -->
                </div>
              </div>
              <div
                class="p-4 rounded-xl bg-indigo-900/20 border border-indigo-500/30"
              >
                <div class="text-sm text-gray-300 mb-1">
                  后验概率 P(内鬼|证据)
                </div>
                <div id="au-result" class="text-3xl font-bold text-neon-green">
                  0.0%
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 1.4.2 Bayesian Identification Lab -->
        <div class="glass-card fx-holo rounded-2xl p-6 sm:p-8 mb-8">
          <div class="mb-6">
            <h2 class="text-2xl font-bold text-neon-purple mb-2">
              <i class="fa-solid fa-flask mr-2"></i>贝叶斯鉴定实验室
            </h2>
            <p class="text-gray-300">
              探索假阳性陷阱，理解为什么高准确率检测可能导致低置信度结果。
            </p>
          </div>
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1 space-y-5">
              <div>
                <label class="block text-sm mb-2">场景选择</label>
                <select
                  id="bayes-scenario"
                  class="w-full bg-dark-bg border border-white/20 rounded-lg p-2 text-white focus:border-neon-purple outline-none"
                >
                  <option value="medical">罕见病检测</option>
                  <option value="security">机场安检</option>
                  <option value="cheat">反作弊系统</option>
                  <option value="custom">自定义场景</option>
                </select>
              </div>
              <div>
                <div class="mb-2 text-sm flex justify-between">
                  <span>基础概率 (Base Rate)</span>
                  <span id="bayes-base-val" class="text-gray-300">1%</span>
                </div>
                <input
                  id="bayes-base"
                  type="range"
                  min="0.1"
                  max="50"
                  step="0.1"
                  value="1"
                  class="w-full accent-white"
                />
              </div>
              <div>
                <div class="mb-2 text-sm flex justify-between">
                  <span>真阳性率 (Sensitivity)</span>
                  <span id="bayes-sens-val" class="text-neon-green">99%</span>
                </div>
                <input
                  id="bayes-sens"
                  type="range"
                  min="50"
                  max="99.9"
                  step="0.1"
                  value="99"
                  class="w-full accent-neon-green"
                />
              </div>
              <div>
                <div class="mb-2 text-sm flex justify-between">
                  <span>真阴性率 (Specificity)</span>
                  <span id="bayes-spec-val" class="text-neon-blue">95%</span>
                </div>
                <input
                  id="bayes-spec"
                  type="range"
                  min="50"
                  max="99.9"
                  step="0.1"
                  value="95"
                  class="w-full accent-neon-blue"
                />
              </div>
              <div class="p-4 rounded-xl bg-white/5 border border-white/10">
                <div class="text-sm text-gray-400 mb-2">参考图例</div>
                <div
                  id="bayes-legend"
                  class="space-y-2 text-sm text-gray-200"
                ></div>
              </div>
            </div>
            <div class="lg:col-span-2">
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="p-4 rounded-xl bg-white/5 border border-white/10">
                  <div class="text-sm text-gray-400">检测为阳性的概率</div>
                  <div
                    id="bayes-pos-rate"
                    class="text-xl font-mono text-gray-200"
                  >
                    --%
                  </div>
                </div>
                <div
                  class="p-4 rounded-xl bg-neon-purple/10 border border-neon-purple/30"
                >
                  <div class="text-sm text-neon-purple">阳性预测值 (PPV)</div>
                  <div id="bayes-ppv" class="text-2xl font-bold text-white">
                    --%
                  </div>
                </div>
              </div>
              <div
                class="p-4 rounded-xl bg-white/5 border border-white/10 mb-4"
              >
                <div class="text-sm text-gray-400 mb-2">推导公式</div>
                <div id="bayes-derivation" class="text-sm text-gray-200"></div>
              </div>
              <div
                id="bayes-viz"
                class="h-64 rounded-xl bg-dark-card/60 relative"
              ></div>
            </div>
          </div>
        </div>

        <!-- 1.4.3 Monty Hall Strategy Simulator -->
        <div class="glass-card fx-holo rounded-2xl p-6 sm:p-8 mb-8">
          <div class="mb-6">
            <h2 class="text-2xl font-bold text-neon-green mb-2">
              <i class="fa-solid fa-door-open mr-2"></i>三门问题模拟器
            </h2>
            <p class="text-gray-300">
              经典的蒙提霍尔问题：换门还是不换？用数据告诉你答案。
            </p>
          </div>
          <div class="flex flex-col lg:flex-row gap-8">
            <div class="flex-1 space-y-6">
              <div id="monty-doors" class="flex justify-center gap-4 h-48">
                <!-- Doors will be injected here -->
              </div>
              <div class="flex justify-center gap-4">
                <button
                  id="monty-keep"
                  class="px-6 py-2 rounded-lg border border-white/20 hover:bg-white/10 transition-colors disabled:opacity-50"
                >
                  坚持原选
                </button>
                <button
                  id="monty-switch"
                  class="px-6 py-2 rounded-lg border border-neon-green/30 bg-neon-green/10 hover:bg-neon-green/20 text-neon-green transition-colors disabled:opacity-50"
                >
                  换门
                </button>
              </div>
              <div
                id="monty-message"
                class="text-center text-lg min-h-[1.75rem]"
              >
                请选择一扇门开始游戏...
              </div>
            </div>
            <div class="w-full lg:w-80">
              <div
                class="bg-dark-bg/50 rounded-xl p-4 border border-white/10 mb-4"
              >
                <h3 class="font-bold mb-3 text-sm">
                  策略胜率对比 (模拟 <span id="monty-total-runs">0</span> 次)
                </h3>
                <div class="space-y-4">
                  <div>
                    <div class="flex justify-between text-xs mb-1">
                      <span>坚持原选</span>
                      <span id="monty-keep-rate">0%</span>
                    </div>
                    <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                      <div
                        id="monty-keep-bar"
                        class="h-full bg-gray-500 transition-all duration-500"
                        style="width: 0%"
                      ></div>
                    </div>
                    <div class="text-right text-[10px] text-gray-500 mt-0.5">
                      理论值: 33.3%
                    </div>
                  </div>
                  <div>
                    <div class="flex justify-between text-xs mb-1">
                      <span>换门</span>
                      <span id="monty-switch-rate" class="text-neon-green"
                        >0%</span
                      >
                    </div>
                    <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                      <div
                        id="monty-switch-bar"
                        class="h-full bg-neon-green transition-all duration-500"
                        style="width: 0%"
                      ></div>
                    </div>
                    <div class="text-right text-[10px] text-gray-500 mt-0.5">
                      理论值: 66.7%
                    </div>
                  </div>
                </div>
              </div>

              <div class="grid grid-cols-2 gap-2">
                <button
                  id="monty-sim-10"
                  class="py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 text-sm"
                >
                  模拟 10 次
                </button>
                <button
                  id="monty-sim-100"
                  class="py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 text-sm"
                >
                  模拟 100 次
                </button>
                <button
                  id="monty-reset"
                  class="py-2 col-span-2 rounded-lg border border-red-500/20 hover:bg-red-500/10 text-red-400 text-sm"
                >
                  重置数据
                </button>
              </div>
            </div>
          </div>
              <div
                id="monty-derivation"
                class="bg-dark-bg/50 rounded-xl p-4 border border-white/10 mb-4 hidden"
              ></div>
        </div>

        <!-- Historical Context -->
        <div class="mt-8 glass-card fx-holo rounded-2xl p-6 sm:p-8">
          <h3 class="text-xl font-semibold mb-3">历史介绍</h3>
          <ul class="list-disc pl-6 space-y-2 text-gray-200">
            <li>
              条件概率概念由托马斯·贝叶斯（Thomas Bayes,
              1763）在其著名论文中首次系统阐述。
            </li>
            <li>
              蒙提霍尔问题源于美国电视游戏节目，1990年由玛丽莲·沃斯·萨凡特（Marilyn
              vos Savant）的专栏文章引发广泛讨论。
            </li>
          </ul>
        </div>
      </section>

      <!-- 页脚占位容器，将由 partial 注入 -->
      <div id="site-footer" class="mt-24"></div>
    </div>

    <!-- 页面交互脚本（抽取为独立文件，便于复用） -->
    <script src="../static/js/chapter1.js"></script>

    <!-- 工具脚本接入：URL点击处理、工具箱、页脚注入 -->
    <script src="../static/js/url-click-handler.js"></script>
    <script src="../static/js/toolbox.js"></script>
    <script src="../static/js/include-footer.js"></script>
    <!-- 启动 KaTeX 自动渲染（参考 hypothesis_testing 页面） -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        try {
          renderMathInElement(document.body, {
            delimiters: [
              { left: "$$", right: "$$", display: true },
              { left: "\\(", right: "\\)", display: false },
              { left: "$", right: "$", display: false },
            ],
            throwOnError: false,
          });
        } catch (e) {
          console.warn("KaTeX render init failed:", e);
        }
      });
    </script>
  </body>
</html>
