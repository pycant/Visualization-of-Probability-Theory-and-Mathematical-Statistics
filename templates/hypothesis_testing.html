<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>假设检验 | 概率维度</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="../static/libs/fontawesome/font-awesome.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script src="../static/libs/chart/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.11.4/dist/gsap.min.js"></script>

    <!-- Markdown和LaTeX渲染库 -->
    <script src="../static/libs/marked/marked.min.js"></script>
    <script src="../static/libs/katex/js/katex.min.js"></script>
    <link
      rel="stylesheet"
      href="../static/libs/katex/css/katex.min.css"
    />
    <script src="../static/libs/katex/js/auto-render.min.js"></script>

    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "neon-blue": "#00f3ff",
              "neon-purple": "#bf00ff",
              "neon-green": "#00ff66",
              "neon-orange": "#ff8c00",
              "dark-bg": "#050a1a",
              "dark-card": "#0f1730",
            },
            fontFamily: {
              future: ["Orbitron", "sans-serif"],
              data: ["Rajdhani", "sans-serif"],
            },
            animation: {
              "pulse-slow": "pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite",
              glow: "glow 2s ease-in-out infinite alternate",
              "magic-pulse": "magic-pulse 3s ease-in-out infinite",
              "detective-scan": "detective-scan 2s ease-in-out infinite",
            },
            keyframes: {
              glow: {
                "0%": {
                  textShadow:
                    "0 0 5px #fff, 0 0 10px #00f3ff, 0 0 15px #00f3ff",
                },
                "100%": {
                  textShadow:
                    "0 0 10px #fff, 0 0 20px #00f3ff, 0 0 30px #00f3ff, 0 0 40px #00f3ff",
                },
              },
              "magic-pulse": {
                "0%, 100%": {
                  transform: "scale(1)",
                  boxShadow: "0 0 20px rgba(191, 0, 255, 0.5)",
                },
                "50%": {
                  transform: "scale(1.05)",
                  boxShadow: "0 0 40px rgba(191, 0, 255, 0.8)",
                },
              },
              "detective-scan": {
                "0%, 100%": {
                  transform: "translateX(-100%)",
                  opacity: 0,
                },
                "50%": {
                  transform: "translateX(100%)",
                  opacity: 1,
                },
              },
            },
          },
        },
      };
    </script>

    <style type="text/tailwindcss">
      :root {
        --neon-blue: #00f3ff;
        --neon-purple: #bf00ff;
        --neon-green: #00ff66;
        --neon-orange: #ff8c00;
        --dark-bg: #050a1a;
        --dark-card: #0f1730;
      }
      
      @layer utilities {
        .text-shadow-neon {
          text-shadow: 0 0 10px rgba(0, 243, 255, 0.7),
            0 0 20px rgba(0, 243, 255, 0.5);
        }
        .text-shadow-purple {
          text-shadow: 0 0 10px rgba(191, 0, 255, 0.7),
            0 0 20px rgba(191, 0, 255, 0.5);
        }
        .border-glow {
          box-shadow: 0 0 5px theme("colors.neon-blue"),
            0 0 10px theme("colors.neon-blue/30");
        }
        .theory-step {
          background: rgba(30, 41, 59, 0.8);
          border: 1px solid rgba(0, 243, 255, 0.3);
          border-radius: 10px;
          padding: 20px;
          margin: 20px 0;
          transition: all 0.3s ease;
        }

        .theory-step:hover {
          border-color: var(--neon-blue);
          box-shadow: 0 0 20px rgba(0, 243, 255, 0.2);
        }

        .theory-step.locked {
          position: relative;
        }

        .theory-step.locked .message-content {
          pointer-events: none;
        }

        .theory-step.unlocked {
          animation: unlock-glow 0.5s ease-in-out;
        }

        @keyframes unlock-glow {
          0% {
            box-shadow: 0 0 0 rgba(0, 243, 255, 0.5);
          }
          50% {
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.8);
          }
          100% {
            box-shadow: 0 0 0 rgba(0, 243, 255, 0.5);
          }
        }

        .understanding-buttons {
          display: flex;
          gap: 10px;
          margin-top: 15px;
        }

        .understanding-btn {
          padding: 8px 16px;
          border: 1px solid rgba(255, 255, 255, 0.3);
          background: transparent;
          color: white;
          border-radius: 20px;
          cursor: pointer;
          transition: all 0.3s ease;
        }

        .understanding-btn:hover {
          background: var(--neon-blue);
          color: var(--dark-bg);
        }

        .understanding-btn.selected {
          background: var(--neon-blue);
          color: var(--dark-bg);
          border-color: var(--neon-blue);
        }

        .ai-help-btn {
          background: linear-gradient(45deg, #6366f1, #8b5cf6);
          color: white;
          border: none;
          padding: 8px 16px;
          border-radius: 8px;
          font-size: 14px;
          cursor: pointer;
          transition: all 0.3s ease;
        }

        .ai-help-btn:hover {
          background: linear-gradient(45deg, #4f46e5, #7c3aed);
          transform: translateY(-2px);
        }

        .understanding-radar {
          background: rgba(30, 41, 59, 0.8);
          border: 1px solid var(--neon-green);
          border-radius: 15px;
          padding: 20px;
          margin-top: 20px;
        }

        .theory-section {
          display: block;
        }

        .theory-section.hidden {
          display: none;
        }

        .theory-nav-btn {
          transition: all 0.3s ease;
        }

        .theory-nav-btn:hover {
          transform: translateY(-2px);
        }

        .message-content {
          line-height: 1.6;
        }

        .message-content h1,
        .message-content h2,
        .message-content h3,
        .message-content h4,
        .message-content h5,
        .message-content h6 {
          margin-top: 1.5rem;
          margin-bottom: 0.5rem;
          font-weight: 600;
          color: var(--neon-blue);
        }

        .message-content p {
          margin-bottom: 1rem;
        }

        .message-content ul,
        .message-content ol {
          margin-bottom: 1rem;
          padding-left: 1.5rem;
        }

        .message-content li {
          margin-bottom: 0.25rem;
        }

        .message-content .katex {
          color: #e5e7eb !important;
        }

        .message-content .katex-display {
          margin: 1rem 0;
        }
        .border-glow-purple {
          box-shadow: 0 0 5px theme("colors.neon-purple"),
            0 0 10px theme("colors.neon-purple/30");
        }
        .bg-grid {
          background-image: linear-gradient(
              rgba(0, 243, 255, 0.1) 1px,
              transparent 1px
            ),
            linear-gradient(90deg, rgba(0, 243, 255, 0.1) 1px, transparent 1px);
          background-size: 20px 20px;
        }
        .glass-effect {
          backdrop-filter: blur(10px);
          background-color: rgba(15, 23, 48, 0.6);
        }
        .magic-bottle {
          background: linear-gradient(
            135deg,
            #1a1a2e 0%,
            #16213e 25%,
            #0f3460 50%,
            #533483 75%,
            #7209b7 100%
          );
          border-radius: 20% 20% 50% 50% / 30% 30% 70% 70%;
          box-shadow: inset -10px -10px 20px rgba(0, 0, 0, 0.5),
            inset 10px 10px 20px rgba(255, 255, 255, 0.1),
            0 0 30px rgba(114, 9, 183, 0.4), 0 0 60px rgba(114, 9, 183, 0.2);
          position: relative;
          overflow: hidden;
        }
        .magic-bottle::before {
          content: "";
          position: absolute;
          top: 10%;
          left: 15%;
          width: 30%;
          height: 60%;
          background: linear-gradient(
            45deg,
            rgba(255, 255, 255, 0.3) 0%,
            rgba(255, 255, 255, 0.1) 50%,
            transparent 100%
          );
          border-radius: 50%;
          transform: rotate(-20deg);
        }
        .magic-bottle::after {
          content: "";
          position: absolute;
          bottom: 20%;
          right: 20%;
          width: 20%;
          height: 20%;
          background: radial-gradient(
            circle,
            rgba(0, 243, 255, 0.6) 0%,
            rgba(0, 243, 255, 0.2) 50%,
            transparent 100%
          );
          border-radius: 50%;
          animation: glow-pulse 2s ease-in-out infinite alternate;
        }
        @keyframes glow-pulse {
          0% {
            opacity: 0.4;
            transform: scale(1);
          }
          100% {
            opacity: 0.8;
            transform: scale(1.2);
          }
        }
        .bottle-neck {
          background: linear-gradient(180deg, #2a2a3e 0%, #1a1a2e 100%);
          box-shadow: inset -2px -2px 4px rgba(0, 0, 0, 0.5),
            inset 2px 2px 4px rgba(255, 255, 255, 0.1);
        }
        .bottle-cork {
          background: linear-gradient(180deg, #8b4513 0%, #654321 100%);
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3),
            inset 0 1px 2px rgba(255, 255, 255, 0.2);
        }
        .magic-bubble {
          background: radial-gradient(
            circle,
            rgba(0, 243, 255, 0.8) 0%,
            rgba(191, 0, 255, 0.6) 50%,
            transparent 100%
          );
          animation: bubble-float 3s ease-in-out infinite;
        }
        @keyframes bubble-float {
          0%,
          100% {
            transform: translateY(0) scale(1);
            opacity: 0.6;
          }
          50% {
            transform: translateY(-10px) scale(1.1);
            opacity: 1;
          }
        }
        .detective-badge {
          background: radial-gradient(circle, #ffd700, #ffb347);
          clip-path: polygon(
            50% 0%,
            61% 35%,
            98% 35%,
            68% 57%,
            79% 91%,
            50% 70%,
            21% 91%,
            32% 57%,
            2% 35%,
            39% 35%
          );
        }
      }
    </style>

    <!-- 引入Google字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Rajdhani:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body class="bg-dark-bg text-gray-200 font-data overflow-x-hidden">
    <!-- 粒子背景容器 -->
    <div id="particles-container" class="fixed inset-0 z-0 opacity-30"></div>

    <!-- 导航栏 -->
    <nav
      class="glass-effect fixed w-full z-50 transition-all duration-300"
      id="main-nav"
    >
      <div
        class="container mx-auto px-4 py-3 flex justify-between items-center"
      >
        <div class="flex items-center space-x-2">
          <div
            class="w-10 h-10 rounded-full bg-gradient-to-r from-neon-blue to-neon-purple flex items-center justify-center"
          >
            <i class="fa fa-flask text-white text-xl"></i>
          </div>
          <h1 class="text-xl md:text-2xl font-future font-bold text-white">
            <span class="text-neon-blue">假设</span
            ><span class="text-white">检验</span>
          </h1>
        </div>

        <!-- 导航链接 -->
        <div class="hidden md:flex items-center space-x-8">
          <a
            href="#logic-foundation"
            class="hover:text-neon-blue transition-colors duration-300"
            >逻辑基础</a
          >
          <a
            href="#magic-potion"
            class="hover:text-neon-purple transition-colors duration-300"
            >魔法药水</a
          >
          <a
            href="#detective-classroom"
            class="hover:text-neon-green transition-colors duration-300"
            >侦探教室</a
          >
          <a
            href="index.html"
            class="px-4 py-2 bg-neon-blue text-dark-bg font-bold rounded-md hover:bg-white transition-all duration-300"
            >返回首页</a
          >
        </div>

        <!-- 移动端菜单按钮 -->
        <button
          class="md:hidden text-white text-2xl"
          id="menu-toggle"
          aria-label="打开导航菜单"
          title="打开导航菜单"
        >
          <i class="fa fa-bars"></i>
        </button>
      </div>
    </nav>

    <!-- 英雄区域 -->
    <header
      class="relative min-h-screen flex items-center justify-center overflow-hidden bg-grid pt-16"
    >
      <div
        class="absolute inset-0 bg-gradient-to-b from-dark-bg/70 via-dark-bg/50 to-dark-bg"
      ></div>

      <!-- 动态图形元素 -->
      <div
        class="absolute w-64 h-64 rounded-full bg-neon-purple/20 blur-3xl -top-20 -left-20 animate-pulse-slow"
      ></div>
      <div
        class="absolute w-96 h-96 rounded-full bg-neon-blue/20 blur-3xl -bottom-40 -right-20 animate-pulse-slow"
        style="animation-delay: 1s"
      ></div>

      <div class="container mx-auto px-4 z-10 text-center">
        <h1
          class="text-[clamp(2.5rem,8vw,5rem)] font-future font-bold leading-tight mb-6 animate-glow"
        >
          <span class="block text-white">假设检验</span>
          <span class="text-neon-purple">概率版反证法</span>
        </h1>
        <p
          class="text-[clamp(1rem,3vw,1.5rem)] text-gray-300 max-w-3xl mx-auto mb-10"
        >
          从反证法到概率世界的逻辑推导，用数据证据破解统计之谜
        </p>
        <div class="flex flex-col sm:flex-row justify-center gap-4">
          <a
            href="#magic-potion"
            class="px-8 py-3 bg-neon-purple text-white font-bold rounded-md hover:bg-neon-purple/80 transition-all duration-300 transform hover:scale-105 border-glow-purple"
          >
            魔法实验 <i class="fa fa-magic ml-2"></i>
          </a>
          <a
            href="#detective-classroom"
            class="px-8 py-3 bg-transparent border border-neon-blue text-neon-blue font-bold rounded-md hover:bg-neon-blue/10 transition-all duration-300"
          >
            侦探推理 <i class="fa fa-search ml-2"></i>
          </a>
        </div>

        <!-- 滚动指示器 -->
        <div
          class="absolute bottom-10 left-1/2 transform -translate-x-1/2 animate-bounce"
        >
          <i class="fa fa-angle-down text-neon-purple text-3xl"></i>
        </div>
      </div>
    </header>

    <!-- 逻辑基础部分 -->
    <section id="logic-foundation" class="py-20 relative">
      <div class="absolute inset-0 bg-grid opacity-20"></div>
      <div class="container mx-auto px-4 relative z-10">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.8rem,5vw,3rem)] font-future font-bold mb-4">
            <span class="text-neon-blue">逻辑</span>基础
          </h2>
          <p class="text-gray-400 max-w-2xl mx-auto">
            理解假设检验的核心思想：概率世界中的反证法
          </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
          <!-- 左侧：反证法解释 -->
          <div
            class="bg-dark-card rounded-xl p-8 border border-gray-800 relative"
          >
            <div
              class="absolute -top-3 -right-3 bg-neon-blue text-dark-bg px-3 py-1 rounded-full text-sm font-bold"
            >
              确定性世界
            </div>
            <h3
              class="text-2xl font-future font-semibold mb-6 text-neon-blue flex items-center"
            >
              <i class="fa fa-lightbulb-o mr-3"></i>传统反证法
            </h3>
            <div class="space-y-4 text-gray-300">
              <p class="leading-relaxed">
                在数学中，<strong class="text-neon-blue">反证法</strong
                >是一种经典的证明思路：
              </p>
              <div
                class="bg-gradient-to-r from-neon-blue/10 to-transparent rounded-lg p-4 border-l-4 border-neon-blue"
              >
                <div class="space-y-3">
                  <div class="flex items-center space-x-3">
                    <div
                      class="w-8 h-8 bg-neon-blue/20 rounded-full flex items-center justify-center text-neon-blue font-bold"
                    >
                      1
                    </div>
                    <span>假设"结论不成立"（反设）</span>
                  </div>
                  <div class="flex items-center space-x-3">
                    <div
                      class="w-8 h-8 bg-neon-blue/20 rounded-full flex items-center justify-center text-neon-blue font-bold"
                    >
                      2
                    </div>
                    <span
                      >通过<strong class="text-neon-blue">严格逻辑推理</strong
                      >推出矛盾</span
                    >
                  </div>
                  <div class="flex items-center space-x-3">
                    <div
                      class="w-8 h-8 bg-neon-blue/20 rounded-full flex items-center justify-center text-neon-blue font-bold"
                    >
                      3
                    </div>
                    <span>确认"原结论成立"</span>
                  </div>
                </div>
              </div>
              <div class="bg-gray-800 rounded-lg p-4 mt-6">
                <p class="text-sm text-gray-400 mb-2 flex items-center">
                  <i class="fa fa-calculator mr-2"></i
                  >经典例子：证明\(\sqrt{2}\)是无理数
                </p>
                <div
                  class="bg-neon-blue/10 rounded p-3 border border-neon-blue/30"
                >
                  <p class="text-neon-blue text-center">
                    假设\(\sqrt{2}\)是有理数 →
                    <span class="text-red-400 font-bold">逻辑矛盾</span> →
                    确认\(\sqrt{2}\)是无理数
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- 右侧：假设检验解释 -->
          <div
            class="bg-dark-card rounded-xl p-8 border border-gray-800 relative"
          >
            <div
              class="absolute -top-3 -right-3 bg-neon-purple text-dark-bg px-3 py-1 rounded-full text-sm font-bold"
            >
              随机性世界
            </div>
            <h3
              class="text-2xl font-future font-semibold mb-6 text-neon-purple flex items-center"
            >
              <i class="fa fa-flask mr-3"></i>假设检验
            </h3>
            <div class="space-y-4 text-gray-300">
              <p class="leading-relaxed">
                假设检验是反证法在<strong class="text-neon-purple"
                  >充满随机性的现实世界</strong
                >中的延伸：
              </p>
              <div
                class="bg-gradient-to-r from-neon-purple/10 to-transparent rounded-lg p-4 border-l-4 border-neon-purple"
              >
                <div class="space-y-3">
                  <div class="flex items-center space-x-3">
                    <div
                      class="w-8 h-8 bg-neon-purple/20 rounded-full flex items-center justify-center text-neon-purple font-bold"
                    >
                      1
                    </div>
                    <span>设定原假设\(H_0\)（我们想推翻的假设）</span>
                  </div>
                  <div class="flex items-center space-x-3">
                    <div
                      class="w-8 h-8 bg-neon-purple/20 rounded-full flex items-center justify-center text-neon-purple font-bold"
                    >
                      2
                    </div>
                    <span
                      >通过<strong class="text-neon-purple">概率计算</strong
                      >得到\(p\)值</span
                    >
                  </div>
                  <div class="flex items-center space-x-3">
                    <div
                      class="w-8 h-8 bg-neon-purple/20 rounded-full flex items-center justify-center text-neon-purple font-bold"
                    >
                      3
                    </div>
                    <span>对比显著性水平\(\alpha\)做出决策</span>
                  </div>
                </div>
              </div>
              <div class="bg-gray-800 rounded-lg p-4 mt-6">
                <p class="text-sm text-gray-400 mb-2 flex items-center">
                  <i class="fa fa-bar-chart mr-2"></i>核心逻辑：
                </p>
                <div
                  class="bg-neon-purple/10 rounded p-3 border border-neon-purple/30"
                >
                  <p class="text-neon-purple text-center">
                    如果\(p < \alpha\) →
                    <span class="text-red-400 font-bold">统计矛盾</span> →
                    拒绝\(H_0\)
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 类比对比说明 -->
        <div
          class="mt-16 bg-gradient-to-r from-dark-card to-dark-bg rounded-2xl p-8 border border-gray-700"
        >
          <h3
            class="text-3xl font-future font-bold text-center mb-8 bg-gradient-to-r from-neon-blue to-neon-purple bg-clip-text text-transparent"
          >
            <i class="fa fa-exchange mr-3"></i>核心类比：从确定到不确定
          </h3>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- 相似性 -->
            <div
              class="bg-neon-green/10 rounded-xl p-6 border border-neon-green/30"
            >
              <h4
                class="text-xl font-semibold text-neon-green mb-4 flex items-center"
              >
                <i class="fa fa-check-circle mr-2"></i>相似性
              </h4>
              <ul class="space-y-3 text-gray-300">
                <li class="flex items-start space-x-2">
                  <i class="fa fa-arrow-right text-neon-green mt-1"></i>
                  <span
                    >都采用<strong class="text-neon-green"
                      >"反向思维"</strong
                    ></span
                  >
                </li>
                <li class="flex items-start space-x-2">
                  <i class="fa fa-arrow-right text-neon-green mt-1"></i>
                  <span
                    >都寻找<strong class="text-neon-green"
                      >"矛盾证据"</strong
                    ></span
                  >
                </li>
                <li class="flex items-start space-x-2">
                  <i class="fa fa-arrow-right text-neon-green mt-1"></i>
                  <span
                    >都通过<strong class="text-neon-green">否定假设</strong
                    >得出结论</span
                  >
                </li>
                <li class="flex items-start space-x-2">
                  <i class="fa fa-arrow-right text-neon-green mt-1"></i>
                  <span
                    >都有<strong class="text-neon-green"
                      >严格的逻辑框架</strong
                    ></span
                  >
                </li>
              </ul>
            </div>

            <!-- 关键差异 -->
            <div class="bg-red-500/10 rounded-xl p-6 border border-red-500/30">
              <h4
                class="text-xl font-semibold text-red-400 mb-4 flex items-center"
              >
                <i class="fa fa-exclamation-triangle mr-2"></i>关键差异
              </h4>
              <div class="space-y-4 text-gray-300">
                <div class="bg-gray-800 rounded p-3">
                  <p class="text-sm text-gray-400 mb-1">矛盾性质：</p>
                  <p class="text-neon-blue">
                    反证法：<strong>绝对矛盾</strong>
                  </p>
                  <p class="text-neon-purple">
                    假设检验：<strong>统计矛盾</strong>
                  </p>
                </div>
                <div class="bg-gray-800 rounded p-3">
                  <p class="text-sm text-gray-400 mb-1">结论确定性：</p>
                  <p class="text-neon-blue">
                    反证法：<strong>100%确定</strong>
                  </p>
                  <p class="text-neon-purple">
                    假设检验：<strong>有错误风险</strong>
                  </p>
                </div>
                <div class="bg-gray-800 rounded p-3">
                  <p class="text-sm text-gray-400 mb-1">适用环境：</p>
                  <p class="text-neon-blue">
                    反证法：<strong>理论数学</strong>
                  </p>
                  <p class="text-neon-purple">
                    假设检验：<strong>实际数据</strong>
                  </p>
                </div>
              </div>
            </div>

            <!-- 进化关系 -->
            <div
              class="bg-yellow-500/10 rounded-xl p-6 border border-yellow-500/30"
            >
              <h4
                class="text-xl font-semibold text-yellow-400 mb-4 flex items-center"
              >
                <i class="fa fa-lightbulb-o mr-2"></i>进化关系
              </h4>
              <div class="space-y-4 text-gray-300">
                <div class="text-center">
                  <div
                    class="bg-neon-blue/20 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-2"
                  >
                    <i class="fa fa-calculator text-neon-blue text-xl"></i>
                  </div>
                  <p class="text-sm text-neon-blue font-semibold">传统反证法</p>
                  <p class="text-xs text-gray-400">确定性数学</p>
                </div>

                <div class="flex justify-center">
                  <i
                    class="fa fa-arrow-down text-yellow-400 text-2xl animate-bounce"
                  ></i>
                </div>

                <div class="text-center">
                  <div
                    class="bg-neon-purple/20 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-2"
                  >
                    <i class="fa fa-bar-chart text-neon-purple text-xl"></i>
                  </div>
                  <p class="text-sm text-neon-purple font-semibold">假设检验</p>
                  <p class="text-xs text-gray-400">统计推断</p>
                </div>

                <div class="bg-yellow-500/20 rounded p-3 mt-4">
                  <p class="text-xs text-yellow-400 text-center">
                    <strong>"当数学遇见现实"</strong><br />
                    从绝对真理到概率推断
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- 底部总结 -->
          <div
            class="mt-8 bg-gradient-to-r from-gray-800 to-gray-700 rounded-xl p-6 border border-gray-600"
          >
            <p class="text-center text-lg text-gray-300 leading-relaxed">
              <i class="fa fa-quote-left text-neon-blue mr-2"></i>
              假设检验本质上是<strong class="text-neon-blue">反证法</strong
              >在<strong class="text-neon-purple">不确定世界</strong
              >中的智慧延伸， 它保持了反证法的<strong class="text-neon-green"
                >逻辑精神</strong
              >，同时适应了现实世界的<strong class="text-yellow-400"
                >随机性特征</strong
              >。
              <i class="fa fa-quote-right text-neon-purple ml-2"></i>
            </p>
          </div>
        </div>

        <!-- 公式展示 -->
        <div class="mt-16 bg-dark-card rounded-xl p-8 border border-gray-800">
          <h3
            class="text-xl font-future font-semibold mb-6 text-center text-white"
          >
            假设检验的数学表达
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
            <div class="space-y-4">
              <h4 class="text-neon-blue font-semibold">1. 设定假设</h4>
              <div class="bg-gray-800 rounded-lg p-4">
                <div class="katex-display">\(H_0: \mu = \mu_0\)</div>
                <div class="katex-display">\(H_1: \mu \neq \mu_0\)</div>
              </div>
            </div>
            <div class="space-y-4">
              <h4 class="text-neon-purple font-semibold">2. 计算统计量</h4>
              <div class="bg-gray-800 rounded-lg p-4">
                <div class="katex-display">
                  \(Z = \frac{\bar{X} - \mu_0}{\sigma/\sqrt{n}}\)
                </div>
              </div>
            </div>
            <div class="space-y-4">
              <h4 class="text-neon-green font-semibold">3. 决策规则</h4>
              <div class="bg-gray-800 rounded-lg p-4">
                <div class="text-sm">如果 p < α，拒绝H₀</div>
                <div class="text-sm">如果 p ≥ α，不拒绝H₀</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 魔法药水实验部分 -->
    <section
      id="magic-potion"
      class="py-20 relative bg-gradient-to-b from-dark-bg to-dark-card/50"
    >
      <div class="absolute inset-0 bg-grid opacity-10"></div>
      <div class="container mx-auto px-4 relative z-10">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.8rem,5vw,3rem)] font-future font-bold mb-4">
            <span class="text-neon-purple">魔法药水</span>效果检验
          </h2>
          <p class="text-gray-400 max-w-2xl mx-auto">
            通过交互实验，直观感受假设检验的核心思想
          </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
          <!-- 左侧：实验控制面板 -->
          <div class="bg-dark-card rounded-xl p-8 border border-gray-800">
            <h3
              class="text-xl font-future font-semibold mb-6 text-white flex items-center"
            >
              <i class="fa fa-cogs text-neon-purple mr-3"></i>实验设置
            </h3>

            <!-- 场景介绍 -->
            <div class="bg-gray-800 rounded-lg p-4 mb-6">
              <p class="text-sm text-gray-300 leading-relaxed">
                🧙‍♂️ 你是魔法学院的学生，得到了一瓶声称"能提高注意力"的神秘药水。
                让我们通过科学的假设检验来验证它的效果！
              </p>
            </div>

            <!-- 参数设置 -->
            <div class="space-y-6">
              <div>
                <label class="block text-gray-300 mb-2">显著性水平 (α):</label>
                <select
                  id="alpha-level"
                  class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 text-white focus:border-neon-purple focus:outline-none"
                >
                  <option value="0.01">0.01 (严格标准)</option>
                  <option value="0.05" selected>0.05 (常用标准)</option>
                  <option value="0.10">0.10 (宽松标准)</option>
                </select>
              </div>

              <div>
                <label class="block text-gray-300 mb-2"
                  >样本量 (志愿者人数):</label
                >
                <div class="flex items-center">
                  <input
                    type="range"
                    id="sample-size"
                    min="10"
                    max="100"
                    step="5"
                    value="30"
                    class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-purple"
                  />
                  <span
                    id="sample-size-value"
                    class="ml-4 text-neon-purple font-bold"
                    >30</span
                  >
                </div>
              </div>

              <div>
                <label class="block text-gray-300 mb-2"
                  >药水真实效果 (平均提升分数):</label
                >
                <div class="flex items-center">
                  <input
                    type="range"
                    id="true-effect"
                    min="0"
                    max="10"
                    step="0.5"
                    value="3"
                    class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-green"
                  />
                  <span
                    id="true-effect-value"
                    class="ml-4 text-neon-green font-bold"
                    >3</span
                  >
                </div>
              </div>
            </div>

            <!-- 假设设定 -->
            <div class="mt-8 p-4 bg-gray-800 rounded-lg">
              <h4 class="text-neon-blue font-semibold mb-2">假设设定：</h4>
              <div class="space-y-1 text-sm">
                <div><strong>H₀:</strong> 药水没有效果 (μ = μ₀)</div>
                <div><strong>H₁:</strong> 药水有效果 (μ > μ₀)</div>
              </div>
            </div>

            <!-- 开始实验按钮 -->
            <button
              id="start-experiment"
              class="w-full mt-6 px-6 py-3 bg-neon-purple text-white font-bold rounded-md hover:bg-neon-purple/80 transition-all duration-300 transform hover:scale-105 animate-magic-pulse"
            >
              🧪 开始魔法实验 <i class="fa fa-magic ml-2"></i>
            </button>
          </div>

          <!-- 右侧：实验结果展示 -->
          <div class="bg-dark-card rounded-xl p-8 border border-gray-800">
            <h3
              class="text-xl font-future font-semibold mb-6 text-white flex items-center"
            >
              <i class="fa fa-flask text-neon-blue mr-3"></i>实验结果
            </h3>

            <!-- 魔法药瓶动画 -->
            <div class="text-center mb-8">
              <div class="relative inline-block">
                <!-- 瓶颈 -->
                <div
                  class="absolute -top-6 left-1/2 transform -translate-x-1/2 w-6 h-8 bottle-neck rounded-t-sm z-20"
                ></div>

                <!-- 瓶口软木塞 -->
                <div
                  class="absolute -top-8 left-1/2 transform -translate-x-1/2 w-8 h-3 bottle-cork rounded-t-lg z-30"
                ></div>

                <div
                  id="magic-bottle"
                  class="inline-block w-28 h-36 magic-bottle relative mx-auto opacity-50 transition-all duration-1000"
                >
                  <!-- 魔法气泡 -->
                  <div
                    class="absolute top-12 left-4 w-3 h-3 magic-bubble rounded-full"
                    style="animation-delay: 0s"
                  ></div>
                  <div
                    class="absolute top-20 right-5 w-2 h-2 magic-bubble rounded-full"
                    style="animation-delay: 1s"
                  ></div>
                  <div
                    class="absolute bottom-8 left-6 w-2.5 h-2.5 magic-bubble rounded-full"
                    style="animation-delay: 2s"
                  ></div>

                  <!-- 液体表面波纹效果 -->
                  <div
                    class="absolute bottom-6 left-1/2 transform -translate-x-1/2 w-20 h-1 bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-60 animate-pulse"
                  ></div>
                </div>

                <!-- 魔法光环 -->
                <div
                  class="absolute inset-0 rounded-full border-2 border-purple-500 opacity-20 animate-spin"
                  style="animation-duration: 8s"
                ></div>
                <div
                  class="absolute inset-2 rounded-full border border-cyan-400 opacity-30 animate-spin"
                  style="animation-duration: 6s; animation-direction: reverse"
                ></div>
              </div>

              <p id="bottle-status" class="text-gray-400 mt-4 font-medium">
                🧪 等待实验开始...
              </p>
            </div>

            <!-- 实验数据展示 -->
            <div id="experiment-data" class="hidden space-y-4">
              <div class="grid grid-cols-2 gap-4">
                <div class="bg-gray-800 rounded-lg p-3">
                  <div class="text-xs text-gray-400">样本均值</div>
                  <div
                    id="sample-mean"
                    class="text-lg font-bold text-neon-blue"
                  >
                    --
                  </div>
                </div>
                <div class="bg-gray-800 rounded-lg p-3">
                  <div class="text-xs text-gray-400">标准差</div>
                  <div
                    id="sample-std"
                    class="text-lg font-bold text-neon-green"
                  >
                    --
                  </div>
                </div>
                <div class="bg-gray-800 rounded-lg p-3">
                  <div class="text-xs text-gray-400">t统计量</div>
                  <div
                    id="t-statistic"
                    class="text-lg font-bold text-neon-purple"
                  >
                    --
                  </div>
                </div>
                <div class="bg-gray-800 rounded-lg p-3">
                  <div class="text-xs text-gray-400">p值</div>
                  <div id="p-value" class="text-lg font-bold text-neon-orange">
                    --
                  </div>
                </div>
              </div>

              <!-- 结论展示 -->
              <div
                id="conclusion"
                class="p-4 rounded-lg border-2 transition-all duration-500"
              >
                <div id="conclusion-text" class="font-semibold"></div>
                <div id="conclusion-explanation" class="text-sm mt-2"></div>
              </div>
            </div>

            <!-- 数据可视化 -->
            <div class="mt-6">
              <canvas id="experiment-chart" class="hidden"></canvas>
            </div>

            <!-- 重复实验按钮 -->
            <button
              id="repeat-experiment"
              class="w-full mt-6 px-6 py-2 bg-gray-600 text-white font-bold rounded-md hover:bg-gray-500 transition-all duration-300 hidden"
            >
              🔄 重复实验
            </button>
          </div>
        </div>

        <!-- 错误类型说明 -->
        <div class="mt-16 bg-dark-card rounded-xl p-8 border border-gray-800">
          <h3
            class="text-xl font-future font-semibold mb-6 text-center text-white"
          >
            两类错误的理解
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-6">
              <h4 class="text-red-400 font-semibold mb-3 flex items-center">
                <i class="fa fa-exclamation-triangle mr-2"></i>第一类错误 (α)
              </h4>
              <p class="text-gray-300 mb-2">药水实际无效，却错误认为"有效"</p>
              <p class="text-sm text-gray-400">类似：冤枉了无辜的人</p>
            </div>
            <div
              class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-6"
            >
              <h4 class="text-yellow-400 font-semibold mb-3 flex items-center">
                <i class="fa fa-question-circle mr-2"></i>第二类错误 (β)
              </h4>
              <p class="text-gray-300 mb-2">药水实际有效，却错误认为"无效"</p>
              <p class="text-sm text-gray-400">类似：放过了真正的罪犯</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 侦探教室部分 -->
    <section id="detective-classroom" class="py-20 relative">
      <div class="absolute inset-0 bg-grid opacity-20"></div>
      <div class="container mx-auto px-4 relative z-10">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.8rem,5vw,3rem)] font-future font-bold mb-4">
            <span class="text-neon-green">侦探教室</span>
          </h2>
          <p class="text-gray-400 max-w-2xl mx-auto">
            破解假设检验之谜：将理论推导转化为侦探破案的互动旅程
          </p>
        </div>

        <!-- 侦探徽章 -->
        <div class="text-center mb-12">
          <div class="inline-block w-20 h-20 detective-badge relative">
            <i
              class="fa fa-search absolute inset-0 flex items-center justify-center text-dark-bg text-2xl"
            ></i>
          </div>
          <p class="text-neon-green mt-2 font-semibold">侦探学院</p>
        </div>

        <!-- 引言 -->
        <div class="bg-dark-card rounded-xl p-8 border border-gray-800 mb-12">
          <p class="text-lg text-gray-300 text-center leading-relaxed">
            🕵️ 欢迎来到侦探学院！今天你将学习如何用数据证据破解谜案。<br />
            原假设H₀是我们的"初始嫌疑"（通常是无辜的），而备择假设H₁是我们要寻找的"真相"。
          </p>
        </div>

        <!-- 步骤式学习 -->
        <div class="space-y-8">
          <!-- 步骤1：设立假设 -->
          <div
            class="bg-dark-card rounded-xl border border-gray-800 overflow-hidden"
          >
            <div class="bg-neon-blue/10 p-6 border-b border-gray-800">
              <h3
                class="text-xl font-future font-semibold text-neon-blue flex items-center"
              >
                <span
                  class="bg-neon-blue text-dark-bg rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                  >1</span
                >
                设立假设——确定调查方向
              </h3>
            </div>
            <div class="p-6">
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                  <h4 class="text-white font-semibold mb-4">核心概念</h4>
                  <p class="text-gray-300 mb-4 leading-relaxed">
                    就像侦探查案必须先明确「调查目标」：
                  </p>
                  <ul class="space-y-2 text-gray-300">
                    <li>
                      •
                      <strong class="text-neon-blue">原假设(H₀)</strong
                      >：案件的「默认现状」（如"嫌疑人无罪"）
                    </li>
                    <li>
                      •
                      <strong class="text-neon-purple">备择假设(H₁)</strong
                      >：我们怀疑的「异常情况」（如"嫌疑人有罪"）
                    </li>
                  </ul>

                  <div class="mt-6 bg-gray-800 rounded-lg p-4">
                    <h5 class="text-neon-green font-semibold mb-2">
                      🔍 案例：珠宝店失窃案
                    </h5>
                    <div class="text-sm space-y-1">
                      <div><strong>H₀:</strong> "店员无盗窃行为"</div>
                      <div><strong>H₁:</strong> "店员有盗窃行为"</div>
                    </div>
                  </div>
                </div>

                <div>
                  <h4 class="text-white font-semibold mb-4">数学表达</h4>
                  <div class="bg-gray-800 rounded-lg p-4 mb-4">
                    <div class="katex-display">\(H_0: \mu = \mu_0\)</div>
                    <div class="text-sm text-gray-400 text-center mb-2">
                      vs.
                    </div>
                    <div class="katex-display">\(H_1: \mu \neq \mu_0\)</div>
                  </div>
                  <p class="text-sm text-gray-400">
                    H₀默认"无差异"，H₁表示"有差异"
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- 步骤2：收集证据 -->
          <div
            class="bg-dark-card rounded-xl border border-gray-800 overflow-hidden"
          >
            <div class="bg-neon-purple/10 p-6 border-b border-gray-800">
              <h3
                class="text-xl font-future font-semibold text-neon-purple flex items-center"
              >
                <span
                  class="bg-neon-purple text-dark-bg rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                  >2</span
                >
                收集证据——计算统计量
              </h3>
            </div>
            <div class="p-6">
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                  <h4 class="text-white font-semibold mb-4">侦探思维</h4>
                  <p class="text-gray-300 mb-4 leading-relaxed">
                    侦探需要收集证据来支持或反驳假设：
                  </p>
                  <ul class="space-y-2 text-gray-300">
                    <li>
                      • 📊
                      <strong class="text-neon-blue">样本数据</strong
                      >：实地调查获得的信息
                    </li>
                    <li>
                      • 🔢
                      <strong class="text-neon-purple">统计量</strong
                      >：将证据量化的工具
                    </li>
                    <li>
                      • 📏
                      <strong class="text-neon-green">标准化</strong
                      >：让不同案件可以比较
                    </li>
                  </ul>

                  <div class="mt-6 bg-gray-800 rounded-lg p-4">
                    <h5 class="text-neon-green font-semibold mb-2">
                      🔍 继续珠宝店案例
                    </h5>
                    <p class="text-sm text-gray-300">
                      调查发现：店员最近3个月的销售记录异常，平均每月"遗失"珠宝价值比正常水平高出很多...
                    </p>
                  </div>
                </div>

                <div>
                  <h4 class="text-white font-semibold mb-4">统计量计算</h4>
                  <div class="bg-gray-800 rounded-lg p-4 mb-4">
                    <div class="text-center mb-2">
                      Z统计量（标准化证据强度）
                    </div>
                    <div class="katex-display">
                      \(Z = \frac{\bar{X} - \mu_0}{\sigma/\sqrt{n}}\)
                    </div>
                  </div>
                  <div class="text-sm text-gray-400 space-y-1">
                    <div>• \(\bar{X}\)：样本均值（观察到的平均值）</div>
                    <div>• \(\mu_0\)：H₀假设的理论值</div>
                    <div>• \(\sigma\)：总体标准差</div>
                    <div>• \(n\)：样本量</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 步骤3：计算p值 -->
          <div
            class="bg-dark-card rounded-xl border border-gray-800 overflow-hidden"
          >
            <div class="bg-neon-green/10 p-6 border-b border-gray-800">
              <h3
                class="text-xl font-future font-semibold text-neon-green flex items-center"
              >
                <span
                  class="bg-neon-green text-dark-bg rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                  >3</span
                >
                计算p值——评估证据强度
              </h3>
            </div>
            <div class="p-6">
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                  <h4 class="text-white font-semibold mb-4">p值的含义</h4>
                  <p class="text-gray-300 mb-4 leading-relaxed">
                    p值回答了一个关键问题：
                  </p>
                  <div
                    class="bg-neon-green/10 border border-neon-green/30 rounded-lg p-4 mb-4"
                  >
                    <p class="text-neon-green font-semibold text-center">
                      "如果嫌疑人真的无辜(H₀成立)，<br />
                      出现当前这些证据的概率有多大？"
                    </p>
                  </div>
                  <ul class="space-y-2 text-gray-300">
                    <li>• p值很小 → 证据很"异常"，H₀可疑</li>
                    <li>• p值较大 → 证据"正常"，H₀合理</li>
                  </ul>
                </div>

                <div>
                  <h4 class="text-white font-semibold mb-4">交互式p值计算器</h4>
                  <div class="bg-gray-800 rounded-lg p-4">
                    <div class="mb-4">
                      <label class="block text-gray-300 mb-2"
                        >Z统计量值：</label
                      >
                      <input
                        type="range"
                        id="z-value-slider"
                        min="-3"
                        max="3"
                        step="0.1"
                        value="0"
                        class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-green"
                      />
                      <div
                        class="flex justify-between text-sm text-gray-400 mt-1"
                      >
                        <span>-3</span>
                        <span
                          id="z-value-display"
                          class="text-neon-green font-bold"
                          >0.0</span
                        >
                        <span>3</span>
                      </div>
                    </div>

                    <div class="text-center">
                      <div class="text-sm text-gray-400">对应的p值：</div>
                      <div
                        id="p-value-display"
                        class="text-2xl font-bold text-neon-orange"
                      >
                        1.0000
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 步骤4：做出决策 -->
          <div
            class="bg-dark-card rounded-xl border border-gray-800 overflow-hidden"
          >
            <div class="bg-neon-orange/10 p-6 border-b border-gray-800">
              <h3
                class="text-xl font-future font-semibold text-neon-orange flex items-center"
              >
                <span
                  class="bg-neon-orange text-dark-bg rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                  >4</span
                >
                做出决策——判断是否拒绝H₀
              </h3>
            </div>
            <div class="p-6">
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                  <h4 class="text-white font-semibold mb-4">决策规则</h4>
                  <p class="text-gray-300 mb-4 leading-relaxed">
                    就像法庭需要"超越合理怀疑"的证据标准：
                  </p>

                  <div class="space-y-4">
                    <div
                      class="bg-red-900/20 border border-red-500/30 rounded-lg p-4"
                    >
                      <h5 class="text-red-400 font-semibold mb-2">
                        🚨 拒绝H₀ (有罪判决)
                      </h5>
                      <p class="text-sm text-gray-300">
                        当 p < α 时，证据足够强烈
                      </p>
                    </div>

                    <div
                      class="bg-gray-700/20 border border-gray-500/30 rounded-lg p-4"
                    >
                      <h5 class="text-gray-400 font-semibold mb-2">
                        ⚖️ 不拒绝H₀ (证据不足)
                      </h5>
                      <p class="text-sm text-gray-300">
                        当 p ≥ α 时，证据不够充分
                      </p>
                    </div>
                  </div>
                </div>

                <div>
                  <h4 class="text-white font-semibold mb-4">交互式决策器</h4>
                  <div class="bg-gray-800 rounded-lg p-4">
                    <div class="mb-4">
                      <label class="block text-gray-300 mb-2"
                        >显著性水平 α：</label
                      >
                      <select
                        id="alpha-selector"
                        class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white"
                      >
                        <option value="0.01">0.01 (严格标准)</option>
                        <option value="0.05" selected>0.05 (常用标准)</option>
                        <option value="0.10">0.10 (宽松标准)</option>
                      </select>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-4">
                      <div class="text-center">
                        <div class="text-sm text-gray-400">当前p值</div>
                        <div
                          id="current-p-value"
                          class="text-lg font-bold text-neon-orange"
                        >
                          1.0000
                        </div>
                      </div>
                      <div class="text-center">
                        <div class="text-sm text-gray-400">α水平</div>
                        <div
                          id="current-alpha"
                          class="text-lg font-bold text-neon-blue"
                        >
                          0.05
                        </div>
                      </div>
                    </div>

                    <div class="text-center p-3 bg-gray-700 rounded-lg">
                      <div class="text-sm text-gray-400">决策结果：</div>
                      <div
                        id="decision-result"
                        class="mt-2 font-semibold text-gray-400"
                      >
                        不拒绝 H₀
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 理解程度自测 -->
        <div class="mt-16 bg-dark-card rounded-xl p-8 border border-gray-800">
          <h3
            class="text-xl font-future font-semibold mb-6 text-center text-white"
          >
            🎯 理解程度自测
          </h3>
          <p class="text-gray-300 text-center mb-6">
            经过侦探训练，你觉得自己对假设检验的理解程度如何？
          </p>
          <div class="flex flex-wrap justify-center gap-4">
            <button
              class="understanding-btn px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg transition-colors"
              data-level="1"
            >
              1 - 完全不懂
            </button>
            <button
              class="understanding-btn px-4 py-2 bg-orange-600 hover:bg-orange-500 text-white rounded-lg transition-colors"
              data-level="2"
            >
              2 - 略有理解
            </button>
            <button
              class="understanding-btn px-4 py-2 bg-yellow-600 hover:bg-yellow-500 text-white rounded-lg transition-colors"
              data-level="3"
            >
              3 - 基本掌握
            </button>
            <button
              class="understanding-btn px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors"
              data-level="4"
            >
              4 - 理解较好
            </button>
            <button
              class="understanding-btn px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg transition-colors"
              data-level="5"
            >
              5 - 完全掌握
            </button>
          </div>
        </div>

        <!-- 可视化分布图 -->
        <div class="mt-16 bg-dark-card rounded-xl p-8 border border-gray-800">
          <h3
            class="text-xl font-future font-semibold mb-6 text-center text-white"
          >
            📊 标准正态分布可视化
          </h3>
          <div class="text-center">
            <canvas
              id="distribution-chart"
              width="600"
              height="300"
              class="border border-gray-600 rounded-lg bg-gray-900"
            ></canvas>
            <p class="text-sm text-gray-400 mt-2">
              蓝色曲线：标准正态分布 | 白色虚线：均值位置
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- 总结部分 -->
    <section
      class="py-20 relative bg-gradient-to-b from-dark-card/50 to-dark-bg"
    >
      <div class="absolute inset-0 bg-grid opacity-10"></div>
      <div class="container mx-auto px-4 relative z-10">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.8rem,5vw,3rem)] font-future font-bold mb-4">
            <span class="text-neon-blue">总结</span>与<span
              class="text-neon-purple"
              >思考</span
            >
          </h2>
          <p class="text-gray-400 max-w-2xl mx-auto">
            假设检验：概率世界中的反证法艺术
          </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          <!-- 核心思想 -->
          <div class="bg-dark-card rounded-xl p-6 border border-gray-800">
            <div class="text-center mb-4">
              <div
                class="w-16 h-16 bg-neon-blue/20 rounded-full flex items-center justify-center mx-auto mb-3"
              >
                <i class="fa fa-lightbulb-o text-neon-blue text-2xl"></i>
              </div>
              <h3 class="text-lg font-future font-semibold text-neon-blue">
                核心思想
              </h3>
            </div>
            <ul class="text-gray-300 space-y-2 text-sm">
              <li>• 反证法的概率版本</li>
              <li>• 通过"矛盾"推翻假设</li>
              <li>• 小概率事件的逻辑</li>
              <li>• 科学决策的工具</li>
            </ul>
          </div>

          <!-- 关键步骤 -->
          <div class="bg-dark-card rounded-xl p-6 border border-gray-800">
            <div class="text-center mb-4">
              <div
                class="w-16 h-16 bg-neon-purple/20 rounded-full flex items-center justify-center mx-auto mb-3"
              >
                <i class="fa fa-list-ol text-neon-purple text-2xl"></i>
              </div>
              <h3 class="text-lg font-future font-semibold text-neon-purple">
                关键步骤
              </h3>
            </div>
            <ol
              class="text-gray-300 space-y-2 text-sm list-decimal list-inside"
            >
              <li>设立假设(H₀ vs H₁)</li>
              <li>收集数据计算统计量</li>
              <li>计算p值</li>
              <li>与α比较做决策</li>
            </ol>
          </div>

          <!-- 实际应用 -->
          <div class="bg-dark-card rounded-xl p-6 border border-gray-800">
            <div class="text-center mb-4">
              <div
                class="w-16 h-16 bg-neon-green/20 rounded-full flex items-center justify-center mx-auto mb-3"
              >
                <i class="fa fa-rocket text-neon-green text-2xl"></i>
              </div>
              <h3 class="text-lg font-future font-semibold text-neon-green">
                实际应用
              </h3>
            </div>
            <ul class="text-gray-300 space-y-2 text-sm">
              <li>• 药物效果检验</li>
              <li>• 质量控制</li>
              <li>• A/B测试</li>
              <li>• 科学研究</li>
            </ul>
          </div>
        </div>

        <!-- 重要提醒 -->
        <div
          class="mt-12 bg-gradient-to-r from-neon-blue/10 to-neon-purple/10 border border-neon-blue/30 rounded-xl p-8"
        >
          <h3
            class="text-xl font-future font-semibold mb-4 text-center text-white flex items-center justify-center"
          >
            <i class="fa fa-exclamation-triangle text-neon-orange mr-3"></i>
            重要提醒
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-300">
            <div>
              <h4 class="font-semibold text-neon-blue mb-2">
                假设检验不能证明H₀正确
              </h4>
              <p class="text-sm">
                "不拒绝H₀"≠"接受H₀"。我们只能说"没有足够证据反驳H₀"，就像法庭的"证据不足"不等于"无罪"。
              </p>
            </div>
            <div>
              <h4 class="font-semibold text-neon-purple mb-2">
                p值不是H₀正确的概率
              </h4>
              <p class="text-sm">
                p值是"假设H₀成立时，观察到当前数据的概率"，而不是"H₀成立的概率"。这是常见的误解。
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 理论探索部分 -->
    <section
      id="theory-exploration"
      class="py-20 relative bg-gradient-to-b from-dark-bg to-dark-card/50"
    >
      <div class="absolute inset-0 bg-grid opacity-10"></div>
      <div class="container mx-auto px-4 relative z-10">
        <div class="text-center mb-16">
          <h2 class="text-3xl font-future font-bold mb-4">
            <span class="text-neon-blue">理论</span>探索
          </h2>
          <p class="text-gray-400 max-w-3xl mx-auto">
            深入理解假设检验的数学原理：从错误类型到各种检验方法的推导
          </p>
        </div>

        <!-- 理论导航 -->
        <div class="flex flex-wrap justify-center gap-4 mb-12">
          <button
            onclick="showTheorySection('error-types')"
            class="theory-nav-btn px-6 py-3 bg-neon-blue/20 text-neon-blue border border-neon-blue/50 rounded-lg hover:bg-neon-blue/30 transition-all duration-300 font-semibold"
          >
            <i class="fa fa-exclamation-triangle mr-2"></i>错误类型分析
          </button>
          <button
            onclick="showTheorySection('z-test')"
            class="theory-nav-btn px-6 py-3 bg-neon-green/20 text-neon-green border border-neon-green/50 rounded-lg hover:bg-neon-green/30 transition-all duration-300 font-semibold"
          >
            <i class="fa fa-calculator mr-2"></i>Z检验推导
          </button>
          <button
            onclick="showTheorySection('t-test')"
            class="theory-nav-btn px-6 py-3 bg-neon-orange/20 text-neon-orange border border-neon-orange/50 rounded-lg hover:bg-neon-orange/30 transition-all duration-300 font-semibold"
          >
            <i class="fa fa-line-chart mr-2"></i>t检验推导
          </button>
          <button
            onclick="showTheorySection('chi-square')"
            class="theory-nav-btn px-6 py-3 bg-neon-purple/20 text-neon-purple border border-neon-purple/50 rounded-lg hover:bg-neon-purple/30 transition-all duration-300 font-semibold"
          >
            <i class="fa fa-pie-chart mr-2"></i>卡方检验推导
          </button>
          <button
            onclick="showTheorySection('power-analysis')"
            class="theory-nav-btn px-6 py-3 bg-neon-pink/20 text-neon-pink border border-neon-pink/50 rounded-lg hover:bg-neon-pink/30 transition-all duration-300 font-semibold"
          >
            <i class="fa fa-bolt mr-2"></i>功效分析
          </button>
        </div>

        <div class="max-w-6xl mx-auto">
          <!-- 渐进式学习提示 -->
          <div
            class="bg-neon-blue/10 border border-neon-blue/30 rounded-lg p-4 mb-8"
          >
            <div class="flex items-center mb-2">
              <i class="fa fa-lightbulb text-neon-blue mr-2"></i>
              <h3 class="text-lg font-semibold text-neon-blue">
                渐进式学习模式
              </h3>
            </div>
            <p class="text-gray-300 text-sm">
              每完成一个理论模块的理解度评分（≥3分），下一模块将自动解锁。如果遇到困难，可以点击AI助手寻求帮助。
            </p>
          </div>

          <!-- 错误类型分析 -->
          <div id="error-types-section" class="theory-section">
            <div class="theory-step unlocked" data-step="1">
              <h3
                class="text-xl font-semibold mb-4 text-neon-blue flex items-center"
              >
                <span
                  class="bg-neon-blue text-dark-bg rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                  >1</span
                >
                第一类错误（Type I Error）- α错误
                <span class="ml-auto text-sm">
                  <i class="fa fa-unlock text-neon-green"></i>
                </span>
              </h3>
              <div class="message-content">
                <p>
                  第一类错误是指<strong>原假设H₀为真时，却错误地拒绝了它</strong>。这就像法庭上"冤枉好人"的情况。
                </p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$P(\text{拒绝}H_0 | H_0\text{为真}) = \alpha$$
                  </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-6">
                  <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-4">
                    <h4 class="text-red-400 font-semibold mb-2">🚨 实际例子</h4>
                    <p class="text-gray-300 text-sm">
                      • 药物实际无效，但检验结果显示有效<br>
                      • 产品质量正常，但被判定为不合格<br>
                      • 无罪的人被判有罪
                    </p>
                  </div>
                  <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
                    <h4 class="text-blue-400 font-semibold mb-2">📊 控制方法</h4>
                    <p class="text-gray-300 text-sm">
                      • 设定显著性水平α（通常0.05）<br>
                      • α越小，第一类错误概率越低<br>
                      • 但会增加第二类错误的风险
                    </p>
                  </div>
                </div>
              </div>
              <div class="understanding-section">
                <div class="understanding-buttons">
                  <span class="text-sm text-gray-400 mr-4">理解程度：</span>
                  <button
                    class="understanding-btn"
                    data-level="1"
                    title="完全不理解"
                  >
                    1
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="2"
                    title="基本不理解"
                  >
                    2
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="3"
                    title="部分理解"
                  >
                    3
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="4"
                    title="基本理解"
                  >
                    4
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="5"
                    title="完全理解"
                  >
                    5
                  </button>
                </div>
                <div class="mt-3 flex items-center gap-4">
                  <button class="ai-help-btn" data-step="1">
                    <i class="fa fa-robot mr-2"></i>需要AI帮助？
                  </button>
                  <div class="next-step-hint hidden text-sm text-neon-green">
                    <i class="fa fa-check-circle mr-1"></i>很好！下一步已解锁
                  </div>
                </div>
              </div>
            </div>

            <!-- 第二类错误 -->
            <div class="theory-step locked" data-step="2">
              <h3
                class="text-xl font-semibold mb-4 text-gray-500 flex items-center"
              >
                <span
                  class="bg-gray-600 text-gray-400 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                  >2</span
                >
                第二类错误（Type II Error）- β错误
                <span class="ml-auto text-sm">
                  <i class="fa fa-lock text-gray-500"></i>
                </span>
              </h3>
              <div class="message-content opacity-50">
                <p>
                  第二类错误是指<strong>原假设H₀为假时，却错误地接受了它</strong>。这就像法庭上"放过坏人"的情况。
                </p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$P(\text{不拒绝}H_0 | H_0\text{为假}) = \beta$$
                  </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-6">
                  <div class="bg-orange-900/20 border border-orange-500/30 rounded-lg p-4">
                    <h4 class="text-orange-400 font-semibold mb-2">⚠️ 实际例子</h4>
                    <p class="text-gray-300 text-sm">
                      • 药物实际有效，但检验结果显示无效<br>
                      • 产品质量有问题，但被判定为合格<br>
                      • 有罪的人被判无罪
                    </p>
                  </div>
                  <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4">
                    <h4 class="text-green-400 font-semibold mb-2">💪 检验功效</h4>
                    <p class="text-gray-300 text-sm">
                      • 功效 = 1 - β<br>
                      • 正确拒绝假H₀的概率<br>
                      • 功效越高，检验越敏感
                    </p>
                  </div>
                </div>
              </div>
              <div class="understanding-section">
                <div class="locked-message text-center py-4">
                  <i class="fa fa-lock text-gray-500 text-2xl mb-2"></i>
                  <p class="text-gray-500">
                    请先完成上一步骤的理解度评分（≥3分）以解锁此内容
                  </p>
                </div>
                <div class="understanding-content hidden">
                  <div class="understanding-buttons">
                    <span class="text-sm text-gray-400 mr-4">理解程度：</span>
                    <button
                      class="understanding-btn"
                      data-level="1"
                      title="完全不理解"
                    >
                      1
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="2"
                      title="基本不理解"
                    >
                      2
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="3"
                      title="部分理解"
                    >
                      3
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="4"
                      title="基本理解"
                    >
                      4
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="5"
                      title="完全理解"
                    >
                      5
                    </button>
                  </div>
                  <div class="mt-3 flex items-center gap-4">
                    <button class="ai-help-btn" data-step="2">
                      <i class="fa fa-robot mr-2"></i>需要AI帮助？
                    </button>
                    <div class="next-step-hint hidden text-sm text-neon-green">
                      <i class="fa fa-check-circle mr-1"></i>很好！下一步已解锁
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 错误类型关系 -->
            <div class="theory-step locked" data-step="3">
              <h3
                class="text-xl font-semibold mb-4 text-gray-500 flex items-center"
              >
                <span
                  class="bg-gray-600 text-gray-400 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                  >3</span
                >
                两类错误的权衡关系
                <span class="ml-auto text-sm">
                  <i class="fa fa-lock text-gray-500"></i>
                </span>
              </h3>
              <div class="message-content opacity-50">
                <p>
                  第一类错误和第二类错误之间存在<strong>权衡关系</strong>：降低一种错误往往会增加另一种错误的概率。
                </p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$\alpha \downarrow \Rightarrow \beta \uparrow \quad \text{（在样本量固定时）}$$
                  </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-6">
                  <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
                    <h4 class="text-purple-400 font-semibold mb-2">⚖️ 权衡策略</h4>
                    <p class="text-gray-300 text-sm">
                      • 医学研究：更关注第一类错误<br>
                      • 质量控制：更关注第二类错误<br>
                      • 根据后果严重性选择策略
                    </p>
                  </div>
                  <div class="bg-teal-900/20 border border-teal-500/30 rounded-lg p-4">
                    <h4 class="text-teal-400 font-semibold mb-2">📈 改善方法</h4>
                    <p class="text-gray-300 text-sm">
                      • 增加样本量<br>
                      • 改进实验设计<br>
                      • 使用更精确的测量方法
                    </p>
                  </div>
                </div>
              </div>
              <div class="understanding-section">
                <div class="locked-message text-center py-4">
                  <i class="fa fa-lock text-gray-500 text-2xl mb-2"></i>
                  <p class="text-gray-500">
                    请先完成上一步骤的理解度评分（≥3分）以解锁此内容
                  </p>
                </div>
                <div class="understanding-content hidden">
                  <div class="understanding-buttons">
                    <span class="text-sm text-gray-400 mr-4">理解程度：</span>
                    <button
                      class="understanding-btn"
                      data-level="1"
                      title="完全不理解"
                    >
                      1
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="2"
                      title="基本不理解"
                    >
                      2
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="3"
                      title="部分理解"
                    >
                      3
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="4"
                      title="基本理解"
                    >
                      4
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="5"
                      title="完全理解"
                    >
                      5
                    </button>
                  </div>
                  <div class="mt-3 flex items-center gap-4">
                    <button class="ai-help-btn" data-step="3">
                      <i class="fa fa-robot mr-2"></i>需要AI帮助？
                    </button>
                    <div class="next-step-hint hidden text-sm text-neon-green">
                      <i class="fa fa-check-circle mr-1"></i>很好！错误类型分析完成
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Z检验推导 -->
          <div id="z-test-section" class="theory-section hidden">
            <div class="theory-step unlocked" data-step="4">
              <h3
                class="text-xl font-semibold mb-4 text-neon-green flex items-center"
              >
                <span
                  class="bg-neon-green text-dark-bg rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                  >1</span
                >
                Z检验的理论基础
                <span class="ml-auto text-sm">
                  <i class="fa fa-unlock text-neon-green"></i>
                </span>
              </h3>
              <div class="message-content">
                <p>
                  Z检验基于<strong>中心极限定理</strong>：当样本量足够大时，样本均值的分布趋近于正态分布。
                </p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$\bar{X} \sim N\left(\mu, \frac{\sigma^2}{n}\right)$$
                  </div>
                </div>
                <p>
                  标准化后得到Z统计量：
                </p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$Z = \frac{\bar{X} - \mu_0}{\sigma/\sqrt{n}} \sim N(0,1)$$
                  </div>
                </div>
                <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4 my-4">
                  <h4 class="text-green-400 font-semibold mb-2">📋 适用条件</h4>
                  <ul class="text-gray-300 text-sm space-y-1">
                    <li>• 总体标准差σ已知</li>
                    <li>• 样本量较大（n ≥ 30）或总体服从正态分布</li>
                    <li>• 样本独立抽取</li>
                  </ul>
                </div>
              </div>
              <div class="understanding-section">
                <div class="understanding-buttons">
                  <span class="text-sm text-gray-400 mr-4">理解程度：</span>
                  <button
                    class="understanding-btn"
                    data-level="1"
                    title="完全不理解"
                  >
                    1
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="2"
                    title="基本不理解"
                  >
                    2
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="3"
                    title="部分理解"
                  >
                    3
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="4"
                    title="基本理解"
                  >
                    4
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="5"
                    title="完全理解"
                  >
                    5
                  </button>
                </div>
                <div class="mt-3 flex items-center gap-4">
                  <button class="ai-help-btn" data-step="4">
                    <i class="fa fa-robot mr-2"></i>需要AI帮助？
                  </button>
                  <div class="next-step-hint hidden text-sm text-neon-green">
                    <i class="fa fa-check-circle mr-1"></i>很好！下一步已解锁
                  </div>
                </div>
              </div>
            </div>

            <!-- Z检验步骤 -->
            <div class="theory-step locked" data-step="5">
              <h3
                class="text-xl font-semibold mb-4 text-gray-500 flex items-center"
              >
                <span
                  class="bg-gray-600 text-gray-400 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                  >2</span
                >
                Z检验的完整推导过程
                <span class="ml-auto text-sm">
                  <i class="fa fa-lock text-gray-500"></i>
                </span>
              </h3>
              <div class="message-content opacity-50">
                <p><strong>步骤1：建立假设</strong></p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$H_0: \mu = \mu_0 \quad \text{vs} \quad H_1: \mu \neq \mu_0$$
                  </div>
                </div>
                <p><strong>步骤2：构造检验统计量</strong></p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$Z = \frac{\bar{X} - \mu_0}{\sigma/\sqrt{n}}$$
                  </div>
                </div>
                <p><strong>步骤3：确定拒绝域</strong></p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$|Z| > Z_{\alpha/2} \text{ 时拒绝 } H_0$$
                  </div>
                </div>
                <p><strong>步骤4：计算p值</strong></p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$p = 2P(Z > |z_{obs}|)$$
                  </div>
                </div>
              </div>
              <div class="understanding-section">
                <div class="locked-message text-center py-4">
                  <i class="fa fa-lock text-gray-500 text-2xl mb-2"></i>
                  <p class="text-gray-500">
                    请先完成上一步骤的理解度评分（≥3分）以解锁此内容
                  </p>
                </div>
                <div class="understanding-content hidden">
                  <div class="understanding-buttons">
                    <span class="text-sm text-gray-400 mr-4">理解程度：</span>
                    <button
                      class="understanding-btn"
                      data-level="1"
                      title="完全不理解"
                    >
                      1
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="2"
                      title="基本不理解"
                    >
                      2
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="3"
                      title="部分理解"
                    >
                      3
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="4"
                      title="基本理解"
                    >
                      4
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="5"
                      title="完全理解"
                    >
                      5
                    </button>
                  </div>
                  <div class="mt-3 flex items-center gap-4">
                    <button class="ai-help-btn" data-step="5">
                      <i class="fa fa-robot mr-2"></i>需要AI帮助？
                    </button>
                    <div class="next-step-hint hidden text-sm text-neon-green">
                      <i class="fa fa-check-circle mr-1"></i>很好！Z检验推导完成
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- t检验推导 -->
          <div id="t-test-section" class="theory-section hidden">
            <div class="theory-step unlocked" data-step="6">
              <h3
                class="text-xl font-semibold mb-4 text-neon-orange flex items-center"
              >
                <span
                  class="bg-neon-orange text-dark-bg rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                  >1</span
                >
                t检验的产生背景
                <span class="ml-auto text-sm">
                  <i class="fa fa-unlock text-neon-green"></i>
                </span>
              </h3>
              <div class="message-content">
                <p>
                  当总体标准差σ<strong>未知</strong>时，我们需要用样本标准差s来估计，这时Z统计量不再服从标准正态分布。
                </p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$t = \frac{\bar{X} - \mu_0}{s/\sqrt{n}} \sim t(n-1)$$
                  </div>
                </div>
                <p>
                  这里的t统计量服从自由度为(n-1)的<strong>t分布</strong>。
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-6">
                  <div class="bg-orange-900/20 border border-orange-500/30 rounded-lg p-4">
                    <h4 class="text-orange-400 font-semibold mb-2">🔍 t分布特点</h4>
                    <p class="text-gray-300 text-sm">
                      • 对称分布，中心为0<br>
                      • 比标准正态分布更"胖"<br>
                      • 随自由度增加趋近标准正态分布
                    </p>
                  </div>
                  <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
                    <h4 class="text-blue-400 font-semibold mb-2">📊 适用条件</h4>
                    <p class="text-gray-300 text-sm">
                      • 总体标准差σ未知<br>
                      • 总体近似正态分布<br>
                      • 样本独立抽取
                    </p>
                  </div>
                </div>
              </div>
              <div class="understanding-section">
                <div class="understanding-buttons">
                  <span class="text-sm text-gray-400 mr-4">理解程度：</span>
                  <button
                    class="understanding-btn"
                    data-level="1"
                    title="完全不理解"
                  >
                    1
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="2"
                    title="基本不理解"
                  >
                    2
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="3"
                    title="部分理解"
                  >
                    3
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="4"
                    title="基本理解"
                  >
                    4
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="5"
                    title="完全理解"
                  >
                    5
                  </button>
                </div>
                <div class="mt-3 flex items-center gap-4">
                  <button class="ai-help-btn" data-step="6">
                    <i class="fa fa-robot mr-2"></i>需要AI帮助？
                  </button>
                  <div class="next-step-hint hidden text-sm text-neon-green">
                    <i class="fa fa-check-circle mr-1"></i>很好！下一步已解锁
                  </div>
                </div>
              </div>
            </div>

            <!-- t检验数学推导 -->
            <div class="theory-step locked" data-step="7">
              <h3
                class="text-xl font-semibold mb-4 text-gray-500 flex items-center"
              >
                <span
                  class="bg-gray-600 text-gray-400 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                  >2</span
                >
                t检验的数学推导
                <span class="ml-auto text-sm">
                  <i class="fa fa-lock text-gray-500"></i>
                </span>
              </h3>
              <div class="message-content opacity-50">
                <p><strong>推导过程：</strong></p>
                <p>1. 样本均值的分布：</p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$\bar{X} \sim N\left(\mu, \frac{\sigma^2}{n}\right)$$
                  </div>
                </div>
                <p>2. 标准化（但σ未知）：</p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$\frac{\bar{X} - \mu}{\sigma/\sqrt{n}} \sim N(0,1)$$
                  </div>
                </div>
                <p>3. 用样本标准差s替代σ：</p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$t = \frac{\bar{X} - \mu_0}{s/\sqrt{n}} \sim t(n-1)$$
                  </div>
                </div>
                <p>4. 关键定理：</p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$\frac{(n-1)s^2}{\sigma^2} \sim \chi^2(n-1)$$
                  </div>
                </div>
              </div>
              <div class="understanding-section">
                <div class="locked-message text-center py-4">
                  <i class="fa fa-lock text-gray-500 text-2xl mb-2"></i>
                  <p class="text-gray-500">
                    请先完成上一步骤的理解度评分（≥3分）以解锁此内容
                  </p>
                </div>
                <div class="understanding-content hidden">
                  <div class="understanding-buttons">
                    <span class="text-sm text-gray-400 mr-4">理解程度：</span>
                    <button
                      class="understanding-btn"
                      data-level="1"
                      title="完全不理解"
                    >
                      1
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="2"
                      title="基本不理解"
                    >
                      2
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="3"
                      title="部分理解"
                    >
                      3
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="4"
                      title="基本理解"
                    >
                      4
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="5"
                      title="完全理解"
                    >
                      5
                    </button>
                  </div>
                  <div class="mt-3 flex items-center gap-4">
                    <button class="ai-help-btn" data-step="7">
                      <i class="fa fa-robot mr-2"></i>需要AI帮助？
                    </button>
                    <div class="next-step-hint hidden text-sm text-neon-green">
                      <i class="fa fa-check-circle mr-1"></i>很好！t检验推导完成
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 卡方检验推导 -->
          <div id="chi-square-section" class="theory-section hidden">
            <div class="theory-step unlocked" data-step="8">
              <h3
                class="text-xl font-semibold mb-4 text-neon-purple flex items-center"
              >
                <span
                  class="bg-neon-purple text-dark-bg rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                  >1</span
                >
                卡方检验的应用场景
                <span class="ml-auto text-sm">
                  <i class="fa fa-unlock text-neon-green"></i>
                </span>
              </h3>
              <div class="message-content">
                <p>
                  卡方检验主要用于<strong>分类数据</strong>的分析，包括拟合优度检验和独立性检验。
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-6">
                  <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
                    <h4 class="text-purple-400 font-semibold mb-2">🎯 拟合优度检验</h4>
                    <p class="text-gray-300 text-sm">
                      检验观察频数是否符合理论分布<br>
                      例如：掷骰子是否公平
                    </p>
                    <div class="bg-dark-bg rounded-lg p-2 mt-2">
                      <div class="text-center text-xs">
                        $$H_0: p_1=p_2=...=p_k$$
                      </div>
                    </div>
                  </div>
                  <div class="bg-pink-900/20 border border-pink-500/30 rounded-lg p-4">
                    <h4 class="text-pink-400 font-semibold mb-2">🔗 独立性检验</h4>
                    <p class="text-gray-300 text-sm">
                      检验两个分类变量是否独立<br>
                      例如：性别与专业选择是否独立
                    </p>
                    <div class="bg-dark-bg rounded-lg p-2 mt-2">
                      <div class="text-center text-xs">
                        $$H_0: \text{两变量独立}$$
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="understanding-section">
                <div class="understanding-buttons">
                  <span class="text-sm text-gray-400 mr-4">理解程度：</span>
                  <button
                    class="understanding-btn"
                    data-level="1"
                    title="完全不理解"
                  >
                    1
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="2"
                    title="基本不理解"
                  >
                    2
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="3"
                    title="部分理解"
                  >
                    3
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="4"
                    title="基本理解"
                  >
                    4
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="5"
                    title="完全理解"
                  >
                    5
                  </button>
                </div>
                <div class="mt-3 flex items-center gap-4">
                  <button class="ai-help-btn" data-step="8">
                    <i class="fa fa-robot mr-2"></i>需要AI帮助？
                  </button>
                  <div class="next-step-hint hidden text-sm text-neon-green">
                    <i class="fa fa-check-circle mr-1"></i>很好！下一步已解锁
                  </div>
                </div>
              </div>
            </div>

            <!-- 卡方统计量推导 -->
            <div class="theory-step locked" data-step="9">
              <h3
                class="text-xl font-semibold mb-4 text-gray-500 flex items-center"
              >
                <span
                  class="bg-gray-600 text-gray-400 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                  >2</span
                >
                卡方统计量的推导
                <span class="ml-auto text-sm">
                  <i class="fa fa-lock text-gray-500"></i>
                </span>
              </h3>
              <div class="message-content opacity-50">
                <p><strong>基本思想：</strong>比较观察频数与期望频数的差异</p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$\chi^2 = \sum_{i=1}^{k} \frac{(O_i - E_i)^2}{E_i}$$
                  </div>
                </div>
                <p>其中：</p>
                <ul class="text-gray-300 space-y-2 my-4">
                  <li>• $O_i$：第i类的观察频数</li>
                  <li>• $E_i$：第i类的期望频数</li>
                  <li>• k：类别总数</li>
                </ul>
                <p><strong>理论基础：</strong></p>
                <p>当样本量足够大时，卡方统计量近似服从卡方分布：</p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$\chi^2 \sim \chi^2(df)$$
                  </div>
                </div>
                <p>自由度df的计算：</p>
                <ul class="text-gray-300 space-y-2 my-4">
                  <li>• 拟合优度检验：df = k - 1 - 估计参数个数</li>
                  <li>• 独立性检验：df = (行数-1) × (列数-1)</li>
                </ul>
              </div>
              <div class="understanding-section">
                <div class="locked-message text-center py-4">
                  <i class="fa fa-lock text-gray-500 text-2xl mb-2"></i>
                  <p class="text-gray-500">
                    请先完成上一步骤的理解度评分（≥3分）以解锁此内容
                  </p>
                </div>
                <div class="understanding-content hidden">
                  <div class="understanding-buttons">
                    <span class="text-sm text-gray-400 mr-4">理解程度：</span>
                    <button
                      class="understanding-btn"
                      data-level="1"
                      title="完全不理解"
                    >
                      1
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="2"
                      title="基本不理解"
                    >
                      2
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="3"
                      title="部分理解"
                    >
                      3
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="4"
                      title="基本理解"
                    >
                      4
                    </button>
                    <button
                      class="understanding-btn"
                      data-level="5"
                      title="完全理解"
                    >
                      5
                    </button>
                  </div>
                  <div class="mt-3 flex items-center gap-4">
                    <button class="ai-help-btn" data-step="9">
                      <i class="fa fa-robot mr-2"></i>需要AI帮助？
                    </button>
                    <div class="next-step-hint hidden text-sm text-neon-green">
                      <i class="fa fa-check-circle mr-1"></i>很好！卡方检验推导完成
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 功效分析 -->
          <div id="power-analysis-section" class="theory-section hidden">
            <div class="theory-step unlocked" data-step="10">
              <h3
                class="text-xl font-semibold mb-4 text-neon-pink flex items-center"
              >
                <span
                  class="bg-neon-pink text-dark-bg rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                  >1</span
                >
                检验功效的定义与意义
                <span class="ml-auto text-sm">
                  <i class="fa fa-unlock text-neon-green"></i>
                </span>
              </h3>
              <div class="message-content">
                <p>
                  检验功效（Power）是指<strong>当备择假设为真时，正确拒绝原假设的概率</strong>。
                </p>
                <div class="bg-dark-bg rounded-lg p-4 my-4">
                  <div class="text-center">
                    $$\text{功效} = P(\text{拒绝}H_0 | H_1\text{为真}) = 1 - \beta$$
                  </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-6">
                  <div class="bg-pink-900/20 border border-pink-500/30 rounded-lg p-4">
                    <h4 class="text-pink-400 font-semibold mb-2">💪 功效的意义</h4>
                    <p class="text-gray-300 text-sm">
                      • 功效越高，检验越敏感<br>
                      • 能更好地发现真实的效应<br>
                      • 减少第二类错误的概率
                    </p>
                  </div>
                  <div class="bg-cyan-900/20 border border-cyan-500/30 rounded-lg p-4">
                    <h4 class="text-cyan-400 font-semibold mb-2">📊 影响因素</h4>
                    <p class="text-gray-300 text-sm">
                      • 效应大小（效应越大，功效越高）<br>
                      • 样本量（样本越大，功效越高）<br>
                      • 显著性水平α（α越大，功效越高）
                    </p>
                  </div>
                </div>
              </div>
              <div class="understanding-section">
                <div class="understanding-buttons">
                  <span class="text-sm text-gray-400 mr-4">理解程度：</span>
                  <button
                    class="understanding-btn"
                    data-level="1"
                    title="完全不理解"
                  >
                    1
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="2"
                    title="基本不理解"
                  >
                    2
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="3"
                    title="部分理解"
                  >
                    3
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="4"
                    title="基本理解"
                  >
                    4
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="5"
                    title="完全理解"
                  >
                    5
                  </button>
                </div>
                <div class="mt-3 flex items-center gap-4">
                  <button class="ai-help-btn" data-step="10">
                    <i class="fa fa-robot mr-2"></i>需要AI帮助？
                  </button>
                  <div class="next-step-hint hidden text-sm text-neon-green">
                    <i class="fa fa-check-circle mr-1"></i>很好！功效分析完成
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 理解度图谱 -->
          <div id="understanding-radar" class="understanding-radar hidden">
            <h3
              class="text-xl font-semibold mb-4 text-neon-green flex items-center"
            >
              <i class="fa fa-chart-radar text-neon-green mr-3"></i>
              个人理解度图谱与学习分析
            </h3>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- 雷达图 -->
              <div class="bg-dark-bg rounded-lg p-4">
                <h4 class="text-lg font-semibold mb-3 text-white">
                  理解度雷达图
                </h4>
                <div class="h-64">
                  <canvas id="theory-understanding-chart"></canvas>
                </div>
              </div>

              <!-- 学习数据分析 -->
              <div class="bg-dark-bg rounded-lg p-4">
                <h4 class="text-lg font-semibold mb-3 text-white">
                  学习数据分析
                </h4>
                <div id="theory-learning-stats" class="space-y-3">
                  <div class="flex justify-between items-center">
                    <span class="text-gray-300">平均理解度:</span>
                    <span
                      id="theory-avg-understanding"
                      class="text-neon-blue font-bold"
                      >-</span
                    >
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-300">最薄弱环节:</span>
                    <span id="theory-weakest-step" class="text-neon-orange font-bold"
                      >-</span
                    >
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-300">最强项:</span>
                    <span id="theory-strongest-step" class="text-neon-green font-bold"
                      >-</span
                    >
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-300">完成时间:</span>
                    <span
                      id="theory-completion-time"
                      class="text-neon-purple font-bold"
                      >-</span
                    >
                  </div>
                </div>

                <!-- 学习建议 -->
                <div class="mt-4 p-3 bg-gray-800 rounded-lg">
                  <h5 class="text-sm font-semibold text-neon-green mb-2">
                    📚 个性化学习建议
                  </h5>
                  <div id="theory-learning-suggestions" class="text-sm text-gray-300">
                    完成所有理论模块后将显示个性化建议
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 实践应用部分 -->
    <section
      id="practical-applications"
      class="py-20 relative bg-gradient-to-b from-dark-bg to-dark-card/30"
    >
      <div class="absolute inset-0 bg-grid opacity-15"></div>
      <div class="container mx-auto px-4 relative z-10">
        <div class="text-center mb-16">
          <h2 class="text-[clamp(1.8rem,5vw,3rem)] font-future font-bold mb-4">
            <span class="text-neon-green">实践应用</span>
          </h2>
          <p class="text-gray-400 max-w-2xl mx-auto">
            将假设检验理论应用到奇幻世界的实际问题中
          </p>
        </div>

        <!-- 应用示例导航 -->
        <div class="flex justify-center mb-12">
          <div class="bg-dark-card rounded-xl p-2 border border-gray-800">
            <button
              id="hero-balance-tab"
              class="application-tab px-6 py-3 rounded-lg font-semibold transition-all duration-300 bg-neon-blue text-dark-bg"
            >
              🗡️ 英雄平衡性检验
            </button>
            <button
              id="magic-agriculture-tab"
              class="application-tab px-6 py-3 rounded-lg font-semibold transition-all duration-300 text-gray-400 hover:text-white"
            >
              🌱 奇幻农业效果评估
            </button>
          </div>
        </div>

        <!-- 英雄平衡性检验 -->
        <div id="hero-balance-content" class="application-content">
          <div
            class="bg-dark-card rounded-xl border border-gray-800 overflow-hidden mb-8"
          >
            <div class="bg-neon-blue/10 p-6 border-b border-gray-800">
              <h3 class="text-2xl font-future font-bold text-neon-blue mb-2">
                🗡️ 英雄平衡性检验
              </h3>
              <p class="text-gray-300">
                游戏设计师需要确保新英雄的胜率不会破坏游戏平衡
              </p>
            </div>

            <div class="p-8">
              <!-- 问题背景 -->
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div>
                  <h4 class="text-xl font-semibold text-white mb-4">
                    📋 问题背景
                  </h4>
                  <div class="bg-gray-800 rounded-lg p-6">
                    <p class="text-gray-300 mb-4">
                      游戏中推出了新英雄"暗影刺客"，设计目标是保持50%的胜率以维持游戏平衡。
                    </p>
                    <p class="text-gray-300 mb-4">
                      经过100场排位赛测试，该英雄获得了58场胜利。
                    </p>
                    <p class="text-neon-orange font-semibold">
                      问题：这个胜率是否显著偏离了设计目标？
                    </p>
                  </div>
                </div>

                <div>
                  <h4 class="text-xl font-semibold text-white mb-4">
                    🎯 假设设定
                  </h4>
                  <div class="space-y-4">
                    <div
                      class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4"
                    >
                      <h5 class="text-blue-400 font-semibold mb-2">
                        原假设 H₀
                      </h5>
                      <p class="text-gray-300 text-sm">
                        英雄胜率 = 50%（平衡状态）
                      </p>
                      <div class="katex-display text-sm mt-2">
                        \(H_0: p = 0.5\)
                      </div>
                    </div>
                    <div
                      class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4"
                    >
                      <h5 class="text-purple-400 font-semibold mb-2">
                        备择假设 H₁
                      </h5>
                      <p class="text-gray-300 text-sm">
                        英雄胜率 ≠ 50%（不平衡）
                      </p>
                      <div class="katex-display text-sm mt-2">
                        \(H_1: p \neq 0.5\)
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 交互式计算器 -->
              <div class="bg-gray-800 rounded-xl p-6 mb-8">
                <h4 class="text-xl font-semibold text-white mb-6 text-center">
                  🧮 交互式假设检验计算器
                </h4>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                  <div>
                    <label class="block text-gray-300 mb-2">样本量 (n):</label>
                    <input
                      type="number"
                      id="hero-sample-size"
                      value="100"
                      min="10"
                      max="1000"
                      class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white"
                    />
                  </div>
                  <div>
                    <label class="block text-gray-300 mb-2"
                      >胜利次数 (x):</label
                    >
                    <input
                      type="number"
                      id="hero-wins"
                      value="58"
                      min="0"
                      max="1000"
                      class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white"
                    />
                  </div>
                  <div>
                    <label class="block text-gray-300 mb-2"
                      >显著性水平 (α):</label
                    >
                    <select
                      id="hero-alpha"
                      class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white"
                    >
                      <option value="0.01">0.01</option>
                      <option value="0.05" selected>0.05</option>
                      <option value="0.10">0.10</option>
                    </select>
                  </div>
                </div>

                <button
                  id="calculate-hero-test"
                  class="w-full bg-neon-blue hover:bg-neon-blue/80 text-dark-bg font-semibold py-3 rounded-lg transition-colors mb-6"
                >
                  🔍 执行假设检验
                </button>

                <!-- 结果显示 -->
                <div id="hero-results" class="hidden">
                  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gray-700 rounded-lg p-4 text-center">
                      <div class="text-sm text-gray-400">样本胜率</div>
                      <div
                        id="hero-sample-rate"
                        class="text-lg font-bold text-neon-green"
                      >
                        0.58
                      </div>
                    </div>
                    <div class="bg-gray-700 rounded-lg p-4 text-center">
                      <div class="text-sm text-gray-400">Z统计量</div>
                      <div
                        id="hero-z-stat"
                        class="text-lg font-bold text-neon-blue"
                      >
                        1.60
                      </div>
                    </div>
                    <div class="bg-gray-700 rounded-lg p-4 text-center">
                      <div class="text-sm text-gray-400">p值</div>
                      <div
                        id="hero-p-value"
                        class="text-lg font-bold text-neon-orange"
                      >
                        0.110
                      </div>
                    </div>
                    <div class="bg-gray-700 rounded-lg p-4 text-center">
                      <div class="text-sm text-gray-400">检验结论</div>
                      <div
                        id="hero-conclusion"
                        class="text-lg font-bold text-gray-400"
                      >
                        不拒绝H₀
                      </div>
                    </div>
                  </div>

                  <div
                    class="bg-gradient-to-r from-neon-blue/10 to-neon-purple/10 border border-neon-blue/30 rounded-lg p-6"
                  >
                    <h5 class="text-white font-semibold mb-3">📊 结果解释</h5>
                    <div id="hero-interpretation" class="text-gray-300">
                      <!-- 动态生成解释内容 -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 奇幻农业效果评估 -->
        <div id="magic-agriculture-content" class="application-content hidden">
          <div
            class="bg-dark-card rounded-xl border border-gray-800 overflow-hidden mb-8"
          >
            <div class="bg-neon-green/10 p-6 border-b border-gray-800">
              <h3 class="text-2xl font-future font-bold text-neon-green mb-2">
                🌱 奇幻农业：神奇肥料效果评估
              </h3>
              <p class="text-gray-300">
                农业魔法师需要验证新研发的神奇肥料是否真的能提高作物产量
              </p>
            </div>

            <div class="p-8">
              <!-- 问题背景 -->
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div>
                  <h4 class="text-xl font-semibold text-white mb-4">
                    🌾 实验背景
                  </h4>
                  <div class="bg-gray-800 rounded-lg p-6">
                    <p class="text-gray-300 mb-4">
                      魔法农场的普通小麦平均产量为每亩500公斤。
                    </p>
                    <p class="text-gray-300 mb-4">
                      使用新型"生长之源"肥料的25块试验田，平均产量为520公斤，标准差为30公斤。
                    </p>
                    <p class="text-neon-orange font-semibold">
                      问题：这种肥料是否真的能显著提高产量？
                    </p>
                  </div>
                </div>

                <div>
                  <h4 class="text-xl font-semibold text-white mb-4">
                    🎯 假设设定
                  </h4>
                  <div class="space-y-4">
                    <div
                      class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4"
                    >
                      <h5 class="text-blue-400 font-semibold mb-2">
                        原假设 H₀
                      </h5>
                      <p class="text-gray-300 text-sm">
                        肥料无效果，产量仍为500公斤
                      </p>
                      <div class="katex-display text-sm mt-2">
                        \(H_0: \mu = 500\)
                      </div>
                    </div>
                    <div
                      class="bg-green-900/20 border border-green-500/30 rounded-lg p-4"
                    >
                      <h5 class="text-green-400 font-semibold mb-2">
                        备择假设 H₁
                      </h5>
                      <p class="text-gray-300 text-sm">
                        肥料有效，产量大于500公斤
                      </p>
                      <div class="katex-display text-sm mt-2">
                        \(H_1: \mu > 500\)
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 交互式计算器 -->
              <div class="bg-gray-800 rounded-xl p-6 mb-8">
                <h4 class="text-xl font-semibold text-white mb-6 text-center">
                  🧪 农业实验假设检验
                </h4>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                  <div>
                    <label class="block text-gray-300 mb-2">样本量 (n):</label>
                    <input
                      type="number"
                      id="agri-sample-size"
                      value="25"
                      min="5"
                      max="100"
                      class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white"
                    />
                  </div>
                  <div>
                    <label class="block text-gray-300 mb-2"
                      >样本均值 (x̄):</label
                    >
                    <input
                      type="number"
                      id="agri-sample-mean"
                      value="520"
                      min="400"
                      max="600"
                      step="0.1"
                      class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white"
                    />
                  </div>
                  <div>
                    <label class="block text-gray-300 mb-2"
                      >样本标准差 (s):</label
                    >
                    <input
                      type="number"
                      id="agri-sample-std"
                      value="30"
                      min="1"
                      max="100"
                      step="0.1"
                      class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white"
                    />
                  </div>
                  <div>
                    <label class="block text-gray-300 mb-2"
                      >显著性水平 (α):</label
                    >
                    <select
                      id="agri-alpha"
                      class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white"
                    >
                      <option value="0.01">0.01</option>
                      <option value="0.05" selected>0.05</option>
                      <option value="0.10">0.10</option>
                    </select>
                  </div>
                </div>

                <button
                  id="calculate-agri-test"
                  class="w-full bg-neon-green hover:bg-neon-green/80 text-dark-bg font-semibold py-3 rounded-lg transition-colors mb-6"
                >
                  🌱 执行产量检验
                </button>

                <!-- 结果显示 -->
                <div id="agri-results" class="hidden">
                  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gray-700 rounded-lg p-4 text-center">
                      <div class="text-sm text-gray-400">产量提升</div>
                      <div
                        id="agri-improvement"
                        class="text-lg font-bold text-neon-green"
                      >
                        +20kg
                      </div>
                    </div>
                    <div class="bg-gray-700 rounded-lg p-4 text-center">
                      <div class="text-sm text-gray-400">t统计量</div>
                      <div
                        id="agri-t-stat"
                        class="text-lg font-bold text-neon-blue"
                      >
                        3.33
                      </div>
                    </div>
                    <div class="bg-gray-700 rounded-lg p-4 text-center">
                      <div class="text-sm text-gray-400">p值</div>
                      <div
                        id="agri-p-value"
                        class="text-lg font-bold text-neon-orange"
                      >
                        0.001
                      </div>
                    </div>
                    <div class="bg-gray-700 rounded-lg p-4 text-center">
                      <div class="text-sm text-gray-400">检验结论</div>
                      <div
                        id="agri-conclusion"
                        class="text-lg font-bold text-neon-green"
                      >
                        拒绝H₀
                      </div>
                    </div>
                  </div>

                  <div
                    class="bg-gradient-to-r from-neon-green/10 to-neon-blue/10 border border-neon-green/30 rounded-lg p-6"
                  >
                    <h5 class="text-white font-semibold mb-3">🌾 结果解释</h5>
                    <div id="agri-interpretation" class="text-gray-300">
                      <!-- 动态生成解释内容 -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 课后问题部分 -->
    <section
      id="exercises"
      class="py-20 bg-gradient-to-br from-dark-bg via-purple-900/20 to-dark-bg"
    >
      <div class="container mx-auto px-6">
        <div class="text-center mb-16">
          <h2
            class="text-4xl font-bold mb-6 bg-gradient-to-r from-neon-blue to-neon-purple bg-clip-text text-transparent"
          >
            📚 课后问题
          </h2>
          <p class="text-xl text-gray-300 max-w-3xl mx-auto">
            通过分层练习巩固假设检验知识，从基础概念到实际应用
          </p>
        </div>

        <!-- 难度级别选择 -->
        <div class="flex justify-center mb-12">
          <div
            class="bg-dark-card/50 backdrop-blur-sm rounded-xl p-2 border border-neon-blue/20"
          >
            <button
              id="level1-tab"
              class="exercise-level-tab px-6 py-3 rounded-lg font-semibold transition-all duration-300 bg-neon-blue text-dark-bg"
            >
              Level 1: 基础概念
            </button>
            <button
              id="level2-tab"
              class="exercise-level-tab px-6 py-3 rounded-lg font-semibold transition-all duration-300 text-gray-400 hover:text-white"
            >
              Level 2: 计算解读
            </button>
            <button
              id="level3-tab"
              class="exercise-level-tab px-6 py-3 rounded-lg font-semibold transition-all duration-300 text-gray-400 hover:text-white"
            >
              Level 3: 分析设计
            </button>
          </div>
        </div>

        <!-- Level 1: 基础概念 -->
        <div id="level1-content" class="exercise-content">
          <div class="grid md:grid-cols-2 gap-8">
            <!-- 题目1 -->
            <div
              class="bg-dark-card/30 backdrop-blur-sm rounded-xl p-6 border border-neon-blue/20"
            >
              <h3 class="text-xl font-bold mb-4 text-neon-blue">🎯 选择题 1</h3>
              <p class="text-gray-300 mb-4">P值的正确定义是什么？</p>
              <div class="space-y-3">
                <label
                  class="flex items-center space-x-3 cursor-pointer hover:bg-neon-blue/10 p-2 rounded"
                >
                  <input
                    type="radio"
                    name="q1"
                    value="A"
                    class="text-neon-blue"
                  />
                  <span class="text-gray-300">A. 原假设为真的概率</span>
                </label>
                <label
                  class="flex items-center space-x-3 cursor-pointer hover:bg-neon-blue/10 p-2 rounded"
                >
                  <input
                    type="radio"
                    name="q1"
                    value="B"
                    class="text-neon-blue"
                  />
                  <span class="text-gray-300"
                    >B.
                    在原假设为真的条件下，观察到当前样本结果或更极端结果的概率</span
                  >
                </label>
                <label
                  class="flex items-center space-x-3 cursor-pointer hover:bg-neon-blue/10 p-2 rounded"
                >
                  <input
                    type="radio"
                    name="q1"
                    value="C"
                    class="text-neon-blue"
                  />
                  <span class="text-gray-300">C. 备择假设为真的概率</span>
                </label>
                <label
                  class="flex items-center space-x-3 cursor-pointer hover:bg-neon-blue/10 p-2 rounded"
                >
                  <input
                    type="radio"
                    name="q1"
                    value="D"
                    class="text-neon-blue"
                  />
                  <span class="text-gray-300">D. 犯第一类错误的概率</span>
                </label>
              </div>
              <button
                onclick="checkAnswer('q1', 'B')"
                class="mt-4 bg-neon-blue text-dark-bg px-4 py-2 rounded-lg font-semibold hover:bg-neon-blue/80 transition-colors"
              >
                检查答案
              </button>
              <div id="q1-result" class="mt-4 hidden"></div>
            </div>

            <!-- 题目2 -->
            <div
              class="bg-dark-card/30 backdrop-blur-sm rounded-xl p-6 border border-neon-purple/20"
            >
              <h3 class="text-xl font-bold mb-4 text-neon-purple">
                ✅ 判断题 1
              </h3>
              <p class="text-gray-300 mb-4">
                判断：显著性水平α是当H₀为假时拒绝它的概率。
              </p>
              <div class="space-y-3">
                <label
                  class="flex items-center space-x-3 cursor-pointer hover:bg-neon-purple/10 p-2 rounded"
                >
                  <input
                    type="radio"
                    name="q2"
                    value="true"
                    class="text-neon-purple"
                  />
                  <span class="text-gray-300">正确</span>
                </label>
                <label
                  class="flex items-center space-x-3 cursor-pointer hover:bg-neon-purple/10 p-2 rounded"
                >
                  <input
                    type="radio"
                    name="q2"
                    value="false"
                    class="text-neon-purple"
                  />
                  <span class="text-gray-300">错误</span>
                </label>
              </div>
              <button
                onclick="checkAnswer('q2', 'false')"
                class="mt-4 bg-neon-purple text-dark-bg px-4 py-2 rounded-lg font-semibold hover:bg-neon-purple/80 transition-colors"
              >
                检查答案
              </button>
              <div id="q2-result" class="mt-4 hidden"></div>
            </div>
          </div>
        </div>

        <!-- Level 2: 计算解读 -->
        <div id="level2-content" class="exercise-content hidden">
          <div class="grid md:grid-cols-1 gap-8">
            <!-- 计算题 -->
            <div
              class="bg-dark-card/30 backdrop-blur-sm rounded-xl p-6 border border-neon-green/20"
            >
              <h3 class="text-xl font-bold mb-4 text-neon-green">🧮 计算题</h3>
              <div class="bg-dark-bg/50 p-4 rounded-lg mb-4">
                <p class="text-gray-300 mb-2">
                  <strong>场景：</strong
                  >某魔法学院声称其新研发的"智慧药水"能显著提高学生的考试成绩。
                </p>
                <p class="text-gray-300 mb-2">
                  <strong>已知：</strong
                  >历史数据显示学生平均成绩为75分，标准差为10分。
                </p>
                <p class="text-gray-300 mb-2">
                  <strong>实验：</strong
                  >随机选择25名学生服用智慧药水后，平均成绩为78分。
                </p>
                <p class="text-gray-300">
                  <strong>问题：</strong
                  >在α=0.05的显著性水平下，能否认为智慧药水有效？
                </p>
              </div>

              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <h4 class="font-semibold mb-3 text-neon-green">计算步骤：</h4>
                  <div class="space-y-3">
                    <div>
                      <label class="block text-sm text-gray-400 mb-1"
                        >1. 检验统计量 Z =</label
                      >
                      <input
                        type="number"
                        id="calc-z"
                        step="0.01"
                        class="w-full bg-dark-bg border border-gray-600 rounded px-3 py-2 text-white"
                        placeholder="输入Z值"
                      />
                    </div>
                    <div>
                      <label class="block text-sm text-gray-400 mb-1"
                        >2. P值 =</label
                      >
                      <input
                        type="number"
                        id="calc-p"
                        step="0.001"
                        class="w-full bg-dark-bg border border-gray-600 rounded px-3 py-2 text-white"
                        placeholder="输入P值"
                      />
                    </div>
                    <div>
                      <label class="block text-sm text-gray-400 mb-1"
                        >3. 结论：</label
                      >
                      <select
                        id="calc-conclusion"
                        class="w-full bg-dark-bg border border-gray-600 rounded px-3 py-2 text-white"
                      >
                        <option value="">选择结论</option>
                        <option value="reject">拒绝H₀，智慧药水有效</option>
                        <option value="not-reject">
                          不拒绝H₀，智慧药水无效
                        </option>
                      </select>
                    </div>
                  </div>
                  <button
                    onclick="checkCalculation()"
                    class="mt-4 bg-neon-green text-dark-bg px-4 py-2 rounded-lg font-semibold hover:bg-neon-green/80 transition-colors"
                  >
                    检查计算
                  </button>
                </div>

                <div>
                  <h4 class="font-semibold mb-3 text-neon-green">提示公式：</h4>
                  <div class="bg-dark-bg/50 p-4 rounded-lg text-sm">
                    <p class="text-gray-300 mb-2">H₀: μ = 75 vs H₁: μ > 75</p>
                    <p class="text-gray-300 mb-2">Z = (x̄ - μ₀) / (σ/√n)</p>
                    <p class="text-gray-300 mb-2">
                      其中：x̄ = 78, μ₀ = 75, σ = 10, n = 25
                    </p>
                    <p class="text-gray-300">单尾检验，α = 0.05</p>
                  </div>
                </div>
              </div>
              <div id="calc-result" class="mt-4 hidden"></div>
            </div>
          </div>
        </div>

        <!-- Level 3: 分析设计 -->
        <div id="level3-content" class="exercise-content hidden">
          <div class="grid md:grid-cols-1 gap-8">
            <!-- 思考题1 -->
            <div
              class="bg-dark-card/30 backdrop-blur-sm rounded-xl p-6 border border-neon-orange/20"
            >
              <h3 class="text-xl font-bold mb-4 text-neon-orange">
                🤔 思考题 1
              </h3>
              <p class="text-gray-300 mb-4">
                第一类错误和第二类错误的概率之间有什么关系？在实际应用中如何平衡这两种错误？
              </p>
              <textarea
                id="thinking1"
                rows="4"
                class="w-full bg-dark-bg border border-gray-600 rounded px-3 py-2 text-white"
                placeholder="请输入你的思考..."
              ></textarea>
              <button
                onclick="showThinkingAnswer(1)"
                class="mt-4 bg-neon-orange text-dark-bg px-4 py-2 rounded-lg font-semibold hover:bg-neon-orange/80 transition-colors"
              >
                查看参考答案
              </button>
              <div
                id="thinking1-answer"
                class="mt-4 hidden bg-dark-bg/50 p-4 rounded-lg"
              >
                <h4 class="font-semibold mb-2 text-neon-orange">参考答案：</h4>
                <p class="text-gray-300 mb-2">
                  •
                  <strong>关系：</strong
                  >在样本量固定的情况下，第一类错误概率α和第二类错误概率β通常呈反比关系
                </p>
                <p class="text-gray-300 mb-2">
                  • <strong>权衡：</strong>降低α会增加β，反之亦然
                </p>
                <p class="text-gray-300 mb-2">• <strong>平衡策略：</strong></p>
                <p class="text-gray-300 ml-4 mb-1">
                  - 增加样本量可同时降低两种错误
                </p>
                <p class="text-gray-300 ml-4 mb-1">
                  - 根据实际后果选择合适的α水平
                </p>
                <p class="text-gray-300 ml-4">- 考虑功效分析来优化检验设计</p>
              </div>
            </div>

            <!-- 思考题2 -->
            <div
              class="bg-dark-card/30 backdrop-blur-sm rounded-xl p-6 border border-neon-pink/20"
            >
              <h3 class="text-xl font-bold mb-4 text-neon-pink">🎨 设计题</h3>
              <p class="text-gray-300 mb-4">
                设计一个实验来检验一种新的魔法咒语是否比传统咒语施法速度更快。请详细说明你的实验设计，包括假设设定、样本选择、数据收集和统计分析方法。
              </p>
              <textarea
                id="design1"
                rows="6"
                class="w-full bg-dark-bg border border-gray-600 rounded px-3 py-2 text-white"
                placeholder="请详细描述你的实验设计..."
              ></textarea>
              <button
                onclick="showDesignAnswer(1)"
                class="mt-4 bg-neon-pink text-dark-bg px-4 py-2 rounded-lg font-semibold hover:bg-neon-pink/80 transition-colors"
              >
                查看设计要点
              </button>
              <div
                id="design1-answer"
                class="mt-4 hidden bg-dark-bg/50 p-4 rounded-lg"
              >
                <h4 class="font-semibold mb-2 text-neon-pink">设计要点：</h4>
                <div class="space-y-3 text-gray-300">
                  <div>
                    <strong>1. 假设设定：</strong>
                    <p class="ml-4">
                      H₀: μ_new = μ_old (新咒语施法时间等于传统咒语)
                    </p>
                    <p class="ml-4">H₁: μ_new < μ_old (新咒语施法时间更短)</p>
                  </div>
                  <div>
                    <strong>2. 实验设计：</strong>
                    <p class="ml-4">• 随机选择法师，分为两组或使用配对设计</p>
                    <p class="ml-4">
                      • 控制变量：法师技能水平、咒语复杂度、环境条件
                    </p>
                    <p class="ml-4">• 盲法设计：避免主观偏差</p>
                  </div>
                  <div>
                    <strong>3. 数据收集：</strong>
                    <p class="ml-4">• 精确测量施法时间（毫秒级）</p>
                    <p class="ml-4">• 记录成功率和副作用</p>
                    <p class="ml-4">• 足够的样本量保证统计功效</p>
                  </div>
                  <div>
                    <strong>4. 统计分析：</strong>
                    <p class="ml-4">• 使用t检验比较两组均值</p>
                    <p class="ml-4">• 检查数据分布和方差齐性</p>
                    <p class="ml-4">• 计算效应大小和置信区间</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 页脚 -->
    <footer class="bg-dark-card border-t border-gray-800 py-12">
      <div class="container mx-auto px-4">
        <div class="text-center">
          <div class="flex items-center justify-center space-x-2 mb-4">
            <div
              class="w-8 h-8 rounded-full bg-gradient-to-r from-neon-blue to-neon-purple flex items-center justify-center"
            >
              <i class="fa fa-flask text-white"></i>
            </div>
            <h3 class="text-xl font-future font-bold text-white">
              <span class="text-neon-blue">概率</span
              ><span class="text-white">维度</span>
            </h3>
          </div>
          <p class="text-gray-400 mb-6">
            让统计学变得生动有趣，让数据科学触手可及
          </p>
          <div class="flex justify-center space-x-6">
            <a
              href="index.html"
              class="text-gray-400 hover:text-neon-blue transition-colors"
            >
              <i class="fa fa-home mr-2"></i>首页
            </a>
            <a
              href="#"
              class="text-gray-400 hover:text-neon-purple transition-colors"
            >
              <i class="fa fa-book mr-2"></i>教程
            </a>
            <a
              href="#"
              class="text-gray-400 hover:text-neon-green transition-colors"
            >
              <i class="fa fa-envelope mr-2"></i>联系
            </a>
          </div>
          <div class="mt-8 pt-8 border-t border-gray-800">
            <p class="text-gray-500 text-sm">
              © 2024 概率维度. 让学习成为一场精彩的冒险.
            </p>
          </div>
        </div>
      </div>
    </footer>

    <script>
      // 初始化粒子背景
      function initParticles() {
        const container = document.getElementById("particles-container");
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(
          75,
          window.innerWidth / window.innerHeight,
          0.1,
          1000
        );
        const renderer = new THREE.WebGLRenderer({ alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);

        // 创建粒子
        const particlesGeometry = new THREE.BufferGeometry();
        const particlesCount = 1000;
        const posArray = new Float32Array(particlesCount * 3);

        for (let i = 0; i < particlesCount * 3; i++) {
          posArray[i] = (Math.random() - 0.5) * 10;
        }

        particlesGeometry.setAttribute(
          "position",
          new THREE.BufferAttribute(posArray, 3)
        );
        const particlesMaterial = new THREE.PointsMaterial({
          size: 0.005,
          color: 0x00f3ff,
          transparent: true,
          opacity: 0.8,
        });

        const particlesMesh = new THREE.Points(
          particlesGeometry,
          particlesMaterial
        );
        scene.add(particlesMesh);
        camera.position.z = 3;

        // 动画循环
        function animate() {
          requestAnimationFrame(animate);
          particlesMesh.rotation.x += 0.0005;
          particlesMesh.rotation.y += 0.0005;
          renderer.render(scene, camera);
        }
        animate();

        // 响应式调整
        window.addEventListener("resize", () => {
          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(window.innerWidth, window.innerHeight);
        });
      }

      // 魔法药水实验
      class MagicPotionExperiment {
        constructor() {
          this.chart = null;
          this.initializeElements();
          this.bindEvents();
        }

        initializeElements() {
          this.alphaLevel = document.getElementById("alpha-level");
          this.sampleSize = document.getElementById("sample-size");
          this.sampleSizeValue = document.getElementById("sample-size-value");
          this.trueEffect = document.getElementById("true-effect");
          this.trueEffectValue = document.getElementById("true-effect-value");
          this.startButton = document.getElementById("start-experiment");
          this.repeatButton = document.getElementById("repeat-experiment");
          this.magicBottle = document.getElementById("magic-bottle");
          this.bottleStatus = document.getElementById("bottle-status");
          this.experimentData = document.getElementById("experiment-data");
        }

        bindEvents() {
          this.sampleSize.addEventListener("input", (e) => {
            this.sampleSizeValue.textContent = e.target.value;
          });

          this.trueEffect.addEventListener("input", (e) => {
            this.trueEffectValue.textContent = e.target.value;
          });

          this.startButton.addEventListener("click", () =>
            this.runExperiment()
          );
          this.repeatButton.addEventListener("click", () =>
            this.runExperiment()
          );
        }

        async runExperiment() {
          const n = parseInt(this.sampleSize.value);
          const trueEffect = parseFloat(this.trueEffect.value);
          const alpha = parseFloat(this.alphaLevel.value);

          // 动画效果
          this.magicBottle.style.opacity = "1";
          this.magicBottle.style.transform = "scale(1.1)";
          this.bottleStatus.textContent = "🧪 实验进行中...";

          // 模拟实验延迟
          await new Promise((resolve) => setTimeout(resolve, 2000));

          // 生成模拟数据
          const baselineScore = 75; // 基准分数
          const data = [];
          for (let i = 0; i < n; i++) {
            const score =
              baselineScore + trueEffect + (Math.random() - 0.5) * 20;
            data.push(Math.max(0, Math.min(100, score)));
          }

          // 计算统计量
          const mean = data.reduce((a, b) => a + b) / n;
          const variance =
            data.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / (n - 1);
          const std = Math.sqrt(variance);
          const tStat = (mean - baselineScore) / (std / Math.sqrt(n));
          const pValue = this.calculatePValue(tStat, n - 1);

          // 显示结果
          this.displayResults(mean, std, tStat, pValue, alpha);
          this.createChart(data, mean, baselineScore);

          this.experimentData.classList.remove("hidden");
          this.repeatButton.classList.remove("hidden");
          this.bottleStatus.textContent = "✨ 实验完成！";
        }

        calculatePValue(t, df) {
          // 简化的t分布p值计算（单尾检验）
          const absT = Math.abs(t);
          if (absT > 3) return 0.001;
          if (absT > 2.5) return 0.01;
          if (absT > 2) return 0.025;
          if (absT > 1.5) return 0.05;
          if (absT > 1) return 0.1;
          return 0.5;
        }

        displayResults(mean, std, tStat, pValue, alpha) {
          document.getElementById("sample-mean").textContent = mean.toFixed(2);
          document.getElementById("sample-std").textContent = std.toFixed(2);
          document.getElementById("t-statistic").textContent = tStat.toFixed(3);
          document.getElementById("p-value").textContent = pValue.toFixed(4);

          const conclusion = document.getElementById("conclusion");
          const conclusionText = document.getElementById("conclusion-text");
          const conclusionExplanation = document.getElementById(
            "conclusion-explanation"
          );

          if (pValue < alpha) {
            conclusion.className =
              "p-4 rounded-lg border-2 border-neon-purple bg-neon-purple/10";
            conclusionText.textContent = "🎉 拒绝原假设！药水有效果！";
            conclusionText.className = "font-semibold text-neon-purple";
            conclusionExplanation.textContent = `p值(${pValue.toFixed(
              4
            )}) < α(${alpha})，证据强烈支持药水有效果的假设。`;
          } else {
            conclusion.className =
              "p-4 rounded-lg border-2 border-gray-500 bg-gray-500/10";
            conclusionText.textContent = "🤔 不拒绝原假设，证据不足";
            conclusionText.className = "font-semibold text-gray-400";
            conclusionExplanation.textContent = `p值(${pValue.toFixed(
              4
            )}) ≥ α(${alpha})，没有足够证据证明药水有效果。`;
          }
        }

        createChart(data, mean, baseline) {
          const ctx = document.getElementById("experiment-chart");
          ctx.classList.remove("hidden");

          if (this.chart) {
            this.chart.destroy();
          }

          // 计算合适的y轴范围
          const minScore = Math.min(...data, baseline, mean) - 5;
          const maxScore = Math.max(...data, baseline, mean) + 5;

          this.chart = new Chart(ctx, {
            type: "bar",
            data: {
              labels: data.map((_, i) => `志愿者${i + 1}`),
              datasets: [
                {
                  label: "测试分数",
                  data: data,
                  backgroundColor: "rgba(191, 0, 255, 0.6)",
                  borderColor: "rgba(191, 0, 255, 1)",
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  labels: { color: "#ffffff" },
                },
                annotation: {
                  annotations: {
                    baseline: {
                      type: "line",
                      yMin: baseline,
                      yMax: baseline,
                      borderColor: "#ff6b6b",
                      borderWidth: 4,
                      borderDash: [8, 4],
                      label: {
                        content: `🎯 实验前平均分: ${baseline}分`,
                        enabled: true,
                        position: "end",
                        backgroundColor: "rgba(255, 107, 107, 0.9)",
                        color: "#ffffff",
                        font: {
                          size: 13,
                          weight: "bold",
                        },
                        padding: 8,
                        cornerRadius: 6,
                      },
                    },
                    mean: {
                      type: "line",
                      yMin: mean,
                      yMax: mean,
                      borderColor: "#4ecdc4",
                      borderWidth: 4,
                      label: {
                        content: `🚀 实验后平均分: ${mean.toFixed(1)}分`,
                        enabled: true,
                        position: "start",
                        backgroundColor: "rgba(78, 205, 196, 0.9)",
                        color: "#ffffff",
                        font: {
                          size: 13,
                          weight: "bold",
                        },
                        padding: 8,
                        cornerRadius: 6,
                      },
                    },
                  },
                },
              },
              scales: {
                y: {
                  min: Math.max(0, minScore),
                  max: maxScore,
                  grid: { color: "rgba(255, 255, 255, 0.1)" },
                  ticks: {
                    color: "#ffffff",
                    stepSize: 2,
                  },
                  title: {
                    display: true,
                    text: "测试分数",
                    color: "#ffffff",
                    font: {
                      size: 14,
                      weight: "bold",
                    },
                  },
                },
                x: {
                  grid: { color: "rgba(255, 255, 255, 0.1)" },
                  ticks: { color: "#ffffff", maxTicksLimit: 10 },
                  title: {
                    display: true,
                    text: "志愿者",
                    color: "#ffffff",
                    font: {
                      size: 14,
                      weight: "bold",
                    },
                  },
                },
              },
            },
          });
        }
      }

      // 实践应用交互
      class PracticalApplications {
        constructor() {
          this.initializeElements();
          this.bindEvents();
        }

        initializeElements() {
          this.heroTab = document.getElementById("hero-balance-tab");
          this.agriTab = document.getElementById("magic-agriculture-tab");
          this.heroContent = document.getElementById("hero-balance-content");
          this.agriContent = document.getElementById(
            "magic-agriculture-content"
          );

          // 英雄平衡检验元素
          this.heroSampleSize = document.getElementById("hero-sample-size");
          this.heroWins = document.getElementById("hero-wins");
          this.heroAlpha = document.getElementById("hero-alpha");
          this.calculateHeroBtn = document.getElementById(
            "calculate-hero-test"
          );
          this.heroResults = document.getElementById("hero-results");

          // 农业检验元素
          this.agriSampleSize = document.getElementById("agri-sample-size");
          this.agriSampleMean = document.getElementById("agri-sample-mean");
          this.agriSampleStd = document.getElementById("agri-sample-std");
          this.agriAlpha = document.getElementById("agri-alpha");
          this.calculateAgriBtn = document.getElementById(
            "calculate-agri-test"
          );
          this.agriResults = document.getElementById("agri-results");
        }

        bindEvents() {
          // 标签切换
          if (this.heroTab)
            this.heroTab.addEventListener("click", () =>
              this.switchTab("hero")
            );
          if (this.agriTab)
            this.agriTab.addEventListener("click", () =>
              this.switchTab("agri")
            );

          // 计算按钮
          if (this.calculateHeroBtn)
            this.calculateHeroBtn.addEventListener("click", () =>
              this.calculateHeroTest()
            );
          if (this.calculateAgriBtn)
            this.calculateAgriBtn.addEventListener("click", () =>
              this.calculateAgriTest()
            );
        }

        switchTab(tab) {
          if (tab === "hero") {
            this.heroTab.className =
              "application-tab px-6 py-3 rounded-lg font-semibold transition-all duration-300 bg-neon-blue text-dark-bg";
            this.agriTab.className =
              "application-tab px-6 py-3 rounded-lg font-semibold transition-all duration-300 text-gray-400 hover:text-white";
            this.heroContent.classList.remove("hidden");
            this.agriContent.classList.add("hidden");
          } else {
            this.agriTab.className =
              "application-tab px-6 py-3 rounded-lg font-semibold transition-all duration-300 bg-neon-green text-dark-bg";
            this.heroTab.className =
              "application-tab px-6 py-3 rounded-lg font-semibold transition-all duration-300 text-gray-400 hover:text-white";
            this.agriContent.classList.remove("hidden");
            this.heroContent.classList.add("hidden");
          }
        }

        calculateHeroTest() {
          const n = parseInt(this.heroSampleSize.value);
          const x = parseInt(this.heroWins.value);
          const alpha = parseFloat(this.heroAlpha.value);
          const p0 = 0.5; // 原假设胜率

          // 计算样本胜率
          const pHat = x / n;

          // 计算Z统计量
          const zStat = (pHat - p0) / Math.sqrt((p0 * (1 - p0)) / n);

          // 计算p值（双尾检验）
          const pValue = 2 * (1 - this.normalCDF(Math.abs(zStat)));

          // 显示结果
          document.getElementById("hero-sample-rate").textContent =
            pHat.toFixed(3);
          document.getElementById("hero-z-stat").textContent = zStat.toFixed(3);
          document.getElementById("hero-p-value").textContent =
            pValue.toFixed(4);

          const conclusion = document.getElementById("hero-conclusion");
          const interpretation = document.getElementById("hero-interpretation");

          if (pValue < alpha) {
            conclusion.textContent = "拒绝H₀";
            conclusion.className = "text-lg font-bold text-red-400";
            interpretation.innerHTML = `
              <p class="mb-3">🚨 <strong>检验结论：拒绝原假设</strong></p>
              <p class="mb-2">• p值(${pValue.toFixed(
                4
              )}) < α(${alpha})，证据显著</p>
              <p class="mb-2">• 暗影刺客的胜率(${(pHat * 100).toFixed(
                1
              )}%)显著偏离50%的平衡目标</p>
              <p class="text-neon-orange">🎮 <strong>游戏建议：</strong>需要调整英雄技能或属性以恢复游戏平衡</p>
            `;
          } else {
            conclusion.textContent = "不拒绝H₀";
            conclusion.className = "text-lg font-bold text-gray-400";
            interpretation.innerHTML = `
              <p class="mb-3">✅ <strong>检验结论：不拒绝原假设</strong></p>
              <p class="mb-2">• p值(${pValue.toFixed(
                4
              )}) ≥ α(${alpha})，证据不足</p>
              <p class="mb-2">• 暗影刺客的胜率(${(pHat * 100).toFixed(
                1
              )}%)与50%的差异可能由随机波动造成</p>
              <p class="text-neon-green">🎮 <strong>游戏建议：</strong>英雄平衡性良好，可以正式发布</p>
            `;
          }

          this.heroResults.classList.remove("hidden");
        }

        calculateAgriTest() {
          const n = parseInt(this.agriSampleSize.value);
          const xBar = parseFloat(this.agriSampleMean.value);
          const s = parseFloat(this.agriSampleStd.value);
          const alpha = parseFloat(this.agriAlpha.value);
          const mu0 = 500; // 原假设产量

          // 计算t统计量
          const tStat = (xBar - mu0) / (s / Math.sqrt(n));

          // 计算p值（单尾检验，右尾）
          const pValue = 1 - this.tCDF(tStat, n - 1);

          // 显示结果
          document.getElementById("agri-improvement").textContent = `+${(
            xBar - mu0
          ).toFixed(1)}kg`;
          document.getElementById("agri-t-stat").textContent = tStat.toFixed(3);
          document.getElementById("agri-p-value").textContent =
            pValue.toFixed(4);

          const conclusion = document.getElementById("agri-conclusion");
          const interpretation = document.getElementById("agri-interpretation");

          if (pValue < alpha) {
            conclusion.textContent = "拒绝H₀";
            conclusion.className = "text-lg font-bold text-neon-green";
            interpretation.innerHTML = `
              <p class="mb-3">🌟 <strong>检验结论：拒绝原假设</strong></p>
              <p class="mb-2">• p值(${pValue.toFixed(
                4
              )}) < α(${alpha})，证据显著</p>
              <p class="mb-2">• "生长之源"肥料显著提高了小麦产量，平均增产${(
                xBar - mu0
              ).toFixed(1)}公斤/亩</p>
              <p class="mb-2">• 提升幅度：${(
                ((xBar - mu0) / mu0) *
                100
              ).toFixed(1)}%</p>
              <p class="text-neon-green">🌱 <strong>农业建议：</strong>可以大规模推广使用这种神奇肥料</p>
            `;
          } else {
            conclusion.textContent = "不拒绝H₀";
            conclusion.className = "text-lg font-bold text-gray-400";
            interpretation.innerHTML = `
              <p class="mb-3">🤔 <strong>检验结论：不拒绝原假设</strong></p>
              <p class="mb-2">• p值(${pValue.toFixed(
                4
              )}) ≥ α(${alpha})，证据不足</p>
              <p class="mb-2">• 虽然观察到${(xBar - mu0).toFixed(
                1
              )}公斤的产量提升，但统计上不显著</p>
              <p class="mb-2">• 可能是随机波动或样本量不足导致</p>
              <p class="text-neon-orange">🌱 <strong>农业建议：</strong>需要更多试验数据或改进肥料配方</p>
            `;
          }

          this.agriResults.classList.remove("hidden");
        }

        // 标准正态分布累积分布函数近似
        normalCDF(x) {
          return 0.5 * (1 + this.erf(x / Math.sqrt(2)));
        }

        // 误差函数近似
        erf(x) {
          const a1 = 0.254829592;
          const a2 = -0.284496736;
          const a3 = 1.421413741;
          const a4 = -1.453152027;
          const a5 = 1.061405429;
          const p = 0.3275911;

          const sign = x >= 0 ? 1 : -1;
          x = Math.abs(x);

          const t = 1.0 / (1.0 + p * x);
          const y =
            1.0 -
            ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) *
              t *
              Math.exp(-x * x);

          return sign * y;
        }

        // t分布累积分布函数近似
        tCDF(t, df) {
          if (df >= 30) {
            return this.normalCDF(t);
          }

          // 简化的t分布近似
          const x = t / Math.sqrt(df);
          const approx = this.normalCDF(x * (1 - 1 / (4 * df)));
          return approx;
        }
      }

      // 课后问题管理
      class ExerciseManager {
        constructor() {
          this.initializeElements();
          this.bindEvents();
        }

        initializeElements() {
          this.level1Tab = document.getElementById("level1-tab");
          this.level2Tab = document.getElementById("level2-tab");
          this.level3Tab = document.getElementById("level3-tab");
          this.level1Content = document.getElementById("level1-content");
          this.level2Content = document.getElementById("level2-content");
          this.level3Content = document.getElementById("level3-content");
        }

        bindEvents() {
          if (this.level1Tab)
            this.level1Tab.addEventListener("click", () => this.switchLevel(1));
          if (this.level2Tab)
            this.level2Tab.addEventListener("click", () => this.switchLevel(2));
          if (this.level3Tab)
            this.level3Tab.addEventListener("click", () => this.switchLevel(3));
        }

        switchLevel(level) {
          // 重置所有标签样式
          [this.level1Tab, this.level2Tab, this.level3Tab].forEach((tab) => {
            if (tab)
              tab.className =
                "exercise-level-tab px-6 py-3 rounded-lg font-semibold transition-all duration-300 text-gray-400 hover:text-white";
          });

          // 隐藏所有内容
          [this.level1Content, this.level2Content, this.level3Content].forEach(
            (content) => {
              if (content) content.classList.add("hidden");
            }
          );

          // 激活选中的级别
          if (level === 1) {
            this.level1Tab.className =
              "exercise-level-tab px-6 py-3 rounded-lg font-semibold transition-all duration-300 bg-neon-blue text-dark-bg";
            this.level1Content.classList.remove("hidden");
          } else if (level === 2) {
            this.level2Tab.className =
              "exercise-level-tab px-6 py-3 rounded-lg font-semibold transition-all duration-300 bg-neon-green text-dark-bg";
            this.level2Content.classList.remove("hidden");
          } else if (level === 3) {
            this.level3Tab.className =
              "exercise-level-tab px-6 py-3 rounded-lg font-semibold transition-all duration-300 bg-neon-orange text-dark-bg";
            this.level3Content.classList.remove("hidden");
          }
        }
      }

      // 理论探索功能
      class TheoryExploration {
        constructor() {
          this.understandingScores = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]; // 10个理论步骤
          this.currentSection = 'error-types';
          this.initializeElements();
          this.bindEvents();
          this.initializeKaTeX();
        }

        initializeElements() {
          this.theoryNavBtns = document.querySelectorAll('.theory-nav-btn');
          this.theorySections = document.querySelectorAll('.theory-section');
          this.understandingBtns = document.querySelectorAll('.understanding-btn');
          this.aiHelpBtns = document.querySelectorAll('.ai-help-btn');
        }

        bindEvents() {
          // 理论导航按钮事件
          this.theoryNavBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
              const section = e.target.closest('button').getAttribute('onclick').match(/'([^']+)'/)[1];
              this.showTheorySection(section);
            });
          });

          // 理解度评分按钮事件
          this.understandingBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
              const step = parseInt(e.target.closest('.theory-step').getAttribute('data-step'));
              const level = parseInt(e.target.getAttribute('data-level'));
              this.setUnderstanding(step, level);
            });
          });

          // AI帮助按钮事件
          this.aiHelpBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
              const step = parseInt(e.target.getAttribute('data-step'));
              this.showAIHelp(step);
            });
          });
        }

        initializeKaTeX() {
          // 渲染数学公式
          if (typeof renderMathInElement !== 'undefined') {
            renderMathInElement(document.body, {
              delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\[", right: "\\]", display: true },
                { left: "\\(", right: "\\)", display: false },
              ],
              throwOnError: false,
              errorColor: "#cc0000",
            });
          }
        }

        showTheorySection(sectionId) {
          // 隐藏所有理论部分
          this.theorySections.forEach(section => {
            section.classList.add('hidden');
          });

          // 显示选中的理论部分
          const targetSection = document.getElementById(`${sectionId}-section`);
          if (targetSection) {
            targetSection.classList.remove('hidden');
            this.currentSection = sectionId;
          }

          // 更新导航按钮状态
          this.theoryNavBtns.forEach(btn => {
            btn.classList.remove('bg-neon-blue/30', 'bg-neon-green/30', 'bg-neon-orange/30', 'bg-neon-purple/30', 'bg-neon-pink/30');
            btn.classList.add('bg-gray-700/20');
          });

          const activeBtn = document.querySelector(`[onclick*="${sectionId}"]`);
          if (activeBtn) {
            activeBtn.classList.remove('bg-gray-700/20');
            if (sectionId === 'error-types') activeBtn.classList.add('bg-neon-blue/30');
            else if (sectionId === 'z-test') activeBtn.classList.add('bg-neon-green/30');
            else if (sectionId === 't-test') activeBtn.classList.add('bg-neon-orange/30');
            else if (sectionId === 'chi-square') activeBtn.classList.add('bg-neon-purple/30');
            else if (sectionId === 'power-analysis') activeBtn.classList.add('bg-neon-pink/30');
          }
        }

        setUnderstanding(step, level) {
          this.understandingScores[step - 1] = level;

          // 更新按钮状态
          const stepElement = document.querySelector(`[data-step="${step}"]`);
          const buttons = stepElement.querySelectorAll('.understanding-btn');
          buttons.forEach((btn, index) => {
            btn.classList.toggle('bg-neon-blue', index + 1 === level);
            btn.classList.toggle('text-dark-bg', index + 1 === level);
            btn.classList.toggle('bg-gray-700', index + 1 !== level);
            btn.classList.toggle('text-white', index + 1 !== level);
          });

          // 显示下一步提示
          const nextStepHint = stepElement.querySelector('.next-step-hint');
          if (level >= 3 && nextStepHint) {
            nextStepHint.classList.remove('hidden');
          }

          // 渐进式解锁下一步
          if (level >= 3 && step < 10) {
            this.unlockNextStep(step + 1);
          }

          // 检查是否所有步骤都已评分
          if (this.understandingScores.every(score => score > 0)) {
            this.showUnderstandingRadar();
          }
        }

        unlockNextStep(step) {
          const nextStepElement = document.querySelector(`[data-step="${step}"]`);
          if (nextStepElement && nextStepElement.classList.contains('locked')) {
            // 移除锁定状态
            nextStepElement.classList.remove('locked');
            nextStepElement.classList.add('unlocked');

            // 更新标题样式
            const title = nextStepElement.querySelector('h3');
            const stepNumber = nextStepElement.querySelector('h3 span');
            const lockIcon = nextStepElement.querySelector('.fa-lock');

            title.classList.remove('text-gray-500');
            title.classList.add('text-neon-blue');
            stepNumber.classList.remove('bg-gray-600', 'text-gray-400');
            stepNumber.classList.add('bg-neon-blue', 'text-dark-bg');

            if (lockIcon) {
              lockIcon.parentElement.innerHTML = '<i class="fa fa-unlock text-neon-green"></i>';
            }

            // 恢复内容透明度
            const content = nextStepElement.querySelector('.message-content');
            content.classList.remove('opacity-50');

            // 显示理解度内容，隐藏锁定消息
            const lockedMessage = nextStepElement.querySelector('.locked-message');
            const understandingContent = nextStepElement.querySelector('.understanding-content');

            if (lockedMessage) lockedMessage.classList.add('hidden');
            if (understandingContent) understandingContent.classList.remove('hidden');

            // 添加解锁动画
            nextStepElement.classList.add('animate-pulse');
            setTimeout(() => {
              nextStepElement.classList.remove('animate-pulse');
            }, 1000);
          }
        }

        showAIHelp(step) {
          const helpTexts = {
            1: "第一类错误（α错误）是指原假设为真时错误地拒绝它。想象法庭冤枉好人的情况，我们通过设定显著性水平α来控制这种错误的概率。",
            2: "第二类错误（β错误）是指原假设为假时错误地接受它。就像法庭放过坏人，检验功效(1-β)衡量我们正确发现真实效应的能力。",
            3: "两类错误存在权衡关系：降低α会增加β。我们需要根据实际情况的严重性来平衡这两种错误，或者通过增加样本量来同时降低两种错误。",
            4: "Z检验基于中心极限定理，当样本量足够大时，样本均值近似正态分布。这为我们构造标准化统计量提供了理论基础。",
            5: "Z检验的关键是构造服从标准正态分布的统计量，然后通过查表或计算得到p值，最后与显著性水平比较做出决策。",
            6: "t检验解决了总体标准差未知的问题。当用样本标准差替代总体标准差时，统计量不再服从正态分布，而是服从t分布。",
            7: "t分布比正态分布更'胖'，反映了用样本标准差估计总体标准差带来的额外不确定性。随着自由度增加，t分布趋近于标准正态分布。",
            8: "卡方检验主要用于分类数据分析，包括拟合优度检验和独立性检验。它比较观察频数与期望频数的差异。",
            9: "卡方统计量的构造基于皮尔逊卡方统计量，通过标准化的平方差之和来衡量观察值与期望值的偏离程度。",
            10: "检验功效是正确拒绝假原假设的概率，反映检验的敏感性。功效分析帮助我们设计更好的实验和选择合适的样本量。"
          };

          alert(`AI助手提示：\n\n${helpTexts[step] || "暂无帮助信息"}`);
        }

        showUnderstandingRadar() {
          const radarSection = document.getElementById('understanding-radar');
          radarSection.classList.remove('hidden');

          // 创建雷达图
          const ctx = document.getElementById('theory-understanding-chart').getContext('2d');
          new Chart(ctx, {
            type: 'radar',
            data: {
              labels: ['第一类错误', '第二类错误', '错误权衡', 'Z检验基础', 'Z检验推导', 't检验背景', 't检验推导', '卡方应用', '卡方推导', '功效分析'],
              datasets: [{
                label: '理解程度',
                data: this.understandingScores,
                backgroundColor: 'rgba(0, 243, 255, 0.2)',
                borderColor: '#00f3ff',
                pointBackgroundColor: '#00f3ff',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: '#00f3ff',
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                r: {
                  beginAtZero: true,
                  max: 5,
                  ticks: {
                    color: '#9ca3af',
                  },
                  grid: {
                    color: 'rgba(156, 163, 175, 0.3)',
                  },
                  angleLines: {
                    color: 'rgba(156, 163, 175, 0.3)',
                  },
                }
              },
              plugins: {
                legend: {
                  labels: {
                    color: '#ffffff',
                  }
                }
              }
            }
          });

          // 更新学习数据分析
          this.updateLearningAnalysis();
        }

        updateLearningAnalysis() {
          const stepNames = ['第一类错误', '第二类错误', '错误权衡', 'Z检验基础', 'Z检验推导', 't检验背景', 't检验推导', '卡方应用', '卡方推导', '功效分析'];

          // 计算平均理解度
          const avgScore = (this.understandingScores.reduce((a, b) => a + b, 0) / this.understandingScores.length).toFixed(1);
          document.getElementById('theory-avg-understanding').textContent = avgScore + '/5.0';

          // 找出最薄弱和最强的环节
          const minScore = Math.min(...this.understandingScores);
          const maxScore = Math.max(...this.understandingScores);
          const weakestIndex = this.understandingScores.indexOf(minScore);
          const strongestIndex = this.understandingScores.indexOf(maxScore);

          document.getElementById('theory-weakest-step').textContent = stepNames[weakestIndex] + ` (${minScore}/5)`;
          document.getElementById('theory-strongest-step').textContent = stepNames[strongestIndex] + ` (${maxScore}/5)`;

          // 计算完成时间（模拟）
          const completionTime = new Date().toLocaleTimeString('zh-CN', { hour12: false });
          document.getElementById('theory-completion-time').textContent = completionTime;

          // 生成个性化学习建议
          this.generateLearningSuggestions(avgScore, weakestIndex, minScore);
        }

        generateLearningSuggestions(avgScore, weakestIndex, minScore) {
          const stepNames = ['第一类错误', '第二类错误', '错误权衡', 'Z检验基础', 'Z检验推导', 't检验背景', 't检验推导', '卡方应用', '卡方推导', '功效分析'];
          const suggestions = [];

          if (avgScore >= 4.0) {
            suggestions.push('🎉 优秀！您已经很好地掌握了假设检验的核心理论。');
            suggestions.push('💡 建议：可以尝试更复杂的假设检验问题，如多重比较、非参数检验等。');
          } else if (avgScore >= 3.0) {
            suggestions.push('👍 不错！您对大部分理论有了基本理解。');
            suggestions.push(`🔍 重点关注：${stepNames[weakestIndex]}部分需要加强理解。`);
          } else {
            suggestions.push('📚 需要更多练习！建议重新学习基础理论。');
            suggestions.push(`⚠️ 优先复习：${stepNames[weakestIndex]}是当前的薄弱环节。`);
          }

          if (minScore <= 2) {
            const helpTexts = {
              0: '建议复习概率论基础，特别是条件概率的概念。',
              1: '建议复习检验功效的定义，理解β错误与功效的关系。',
              2: '建议复习样本量对检验的影响，理解如何平衡两类错误。',
              3: '建议复习中心极限定理，这是Z检验的理论基础。',
              4: '建议复习标准化过程，理解如何构造检验统计量。',
              5: '建议复习t分布的性质，理解它与正态分布的区别。',
              6: '建议复习自由度的概念，理解样本标准差的分布。',
              7: '建议复习分类数据分析，理解频数与概率的关系。',
              8: '建议复习卡方分布的性质，理解期望频数的计算。',
              9: '建议复习功效分析的应用，理解样本量计算的原理。'
            };
            suggestions.push(`📖 具体建议：${helpTexts[weakestIndex]}`);
          }

          document.getElementById('theory-learning-suggestions').innerHTML = suggestions.join('<br>');
        }
      }

      // 全局函数：显示理论部分
      function showTheorySection(sectionId) {
        if (window.theoryExploration) {
          window.theoryExploration.showTheorySection(sectionId);
        }
      }

      // 全局函数：检查答案
      function checkAnswer(questionName, correctAnswer) {
        const selectedOption = document.querySelector(
          `input[name="${questionName}"]:checked`
        );
        const resultDiv = document.getElementById(`${questionName}-result`);

        if (!selectedOption) {
          resultDiv.innerHTML =
            '<p class="text-yellow-400">⚠️ 请先选择一个答案</p>';
          resultDiv.classList.remove("hidden");
          return;
        }

        const isCorrect = selectedOption.value === correctAnswer;

        if (isCorrect) {
          if (questionName === "q1") {
            resultDiv.innerHTML = `
              <div class="bg-green-900/30 border border-green-500/50 rounded-lg p-4">
                <p class="text-green-400 font-semibold mb-2">✅ 正确！</p>
                <p class="text-gray-300 text-sm">P值确实是在原假设为真的条件下，观察到当前样本结果或更极端结果的概率。这是假设检验的核心概念。</p>
              </div>
            `;
          } else if (questionName === "q2") {
            resultDiv.innerHTML = `
              <div class="bg-green-900/30 border border-green-500/50 rounded-lg p-4">
                <p class="text-green-400 font-semibold mb-2">✅ 正确！</p>
                <p class="text-gray-300 text-sm">显著性水平α是当H₀为真时错误拒绝它的概率（第一类错误），而不是当H₀为假时拒绝它的概率。</p>
              </div>
            `;
          }
        } else {
          if (questionName === "q1") {
            resultDiv.innerHTML = `
              <div class="bg-red-900/30 border border-red-500/50 rounded-lg p-4">
                <p class="text-red-400 font-semibold mb-2">❌ 不正确</p>
                <p class="text-gray-300 text-sm">P值不是原假设为真的概率，而是在原假设为真的前提下，观察到当前或更极端结果的概率。请重新思考。</p>
              </div>
            `;
          } else if (questionName === "q2") {
            resultDiv.innerHTML = `
              <div class="bg-red-900/30 border border-red-500/50 rounded-lg p-4">
                <p class="text-red-400 font-semibold mb-2">❌ 不正确</p>
                <p class="text-gray-300 text-sm">显著性水平α是第一类错误的概率，即当H₀为真时错误拒绝它的概率，不是当H₀为假时拒绝它的概率。</p>
              </div>
            `;
          }
        }

        resultDiv.classList.remove("hidden");
      }

      // 全局函数：检查计算题
      function checkCalculation() {
        const zInput = document.getElementById("calc-z");
        const pInput = document.getElementById("calc-p");
        const conclusionSelect = document.getElementById("calc-conclusion");
        const resultDiv = document.getElementById("calc-result");

        const zValue = parseFloat(zInput.value);
        const pValue = parseFloat(pInput.value);
        const conclusion = conclusionSelect.value;

        // 正确答案
        const correctZ = 1.5; // (78-75)/(10/√25) = 3/2 = 1.5
        const correctP = 0.0668; // P(Z > 1.5) ≈ 0.0668
        const correctConclusion = "not-reject"; // p > 0.05

        let feedback = [];
        let allCorrect = true;

        // 检查Z值
        if (Math.abs(zValue - correctZ) < 0.1) {
          feedback.push('<p class="text-green-400">✅ Z统计量计算正确</p>');
        } else {
          feedback.push(
            '<p class="text-red-400">❌ Z统计量不正确，正确答案是1.5</p>'
          );
          allCorrect = false;
        }

        // 检查P值
        if (Math.abs(pValue - correctP) < 0.01) {
          feedback.push('<p class="text-green-400">✅ P值计算正确</p>');
        } else {
          feedback.push(
            '<p class="text-red-400">❌ P值不正确，正确答案约为0.067</p>'
          );
          allCorrect = false;
        }

        // 检查结论
        if (conclusion === correctConclusion) {
          feedback.push('<p class="text-green-400">✅ 结论正确</p>');
        } else {
          feedback.push(
            '<p class="text-red-400">❌ 结论不正确，应该是不拒绝H₀</p>'
          );
          allCorrect = false;
        }

        const borderColor = allCorrect
          ? "border-green-500/50"
          : "border-yellow-500/50";
        const bgColor = allCorrect ? "bg-green-900/30" : "bg-yellow-900/30";

        resultDiv.innerHTML = `
          <div class="${bgColor} border ${borderColor} rounded-lg p-4">
            ${feedback.join("")}
            <div class="mt-4 pt-4 border-t border-gray-600">
              <p class="text-gray-300 font-semibold mb-2">解题步骤：</p>
              <p class="text-gray-300 text-sm mb-1">1. Z = (78-75)/(10/√25) = 3/2 = 1.5</p>
              <p class="text-gray-300 text-sm mb-1">2. P值 = P(Z > 1.5) ≈ 0.0668</p>
              <p class="text-gray-300 text-sm">3. 因为P值(0.0668) > α(0.05)，所以不拒绝H₀，智慧药水效果不显著</p>
            </div>
          </div>
        `;

        resultDiv.classList.remove("hidden");
      }

      // 全局函数：显示思考题答案
      function showThinkingAnswer(questionNum) {
        const answerDiv = document.getElementById(
          `thinking${questionNum}-answer`
        );
        answerDiv.classList.toggle("hidden");
      }

      // 全局函数：显示设计题答案
      function showDesignAnswer(questionNum) {
        const answerDiv = document.getElementById(
          `design${questionNum}-answer`
        );
        answerDiv.classList.toggle("hidden");
      }

      // 侦探教室交互
      class DetectiveClassroom {
        constructor() {
          this.initializeElements();
          this.bindEvents();
          this.drawDistribution();
        }

        initializeElements() {
          this.zSlider = document.getElementById("z-value-slider");
          this.zDisplay = document.getElementById("z-value-display");
          this.pValueDisplay = document.getElementById("p-value-display");
          this.alphaSelector = document.getElementById("alpha-selector");
          this.currentPValue = document.getElementById("current-p-value");
          this.currentAlpha = document.getElementById("current-alpha");
          this.decisionResult = document.getElementById("decision-result");
        }

        bindEvents() {
          this.zSlider.addEventListener("input", (e) => {
            const zValue = parseFloat(e.target.value);
            this.updatePValue(zValue);
          });

          this.alphaSelector.addEventListener("change", (e) => {
            this.updateDecision();
          });

          // 理解程度按钮
          document.querySelectorAll(".understanding-btn").forEach((btn) => {
            btn.addEventListener("click", (e) => {
              const level = e.target.dataset.level;
              this.showUnderstandingFeedback(level);
            });
          });
        }

        updatePValue(zValue) {
          this.zDisplay.textContent = zValue.toFixed(1);
          const pValue = this.calculateStandardNormalPValue(zValue);
          this.pValueDisplay.textContent = pValue.toFixed(4);
          this.currentPValue.textContent = pValue.toFixed(4);
          this.updateDecision();
        }

        calculateStandardNormalPValue(z) {
          // 简化的标准正态分布p值计算（双尾检验）
          const absZ = Math.abs(z);
          if (absZ >= 3) return 0.0027;
          if (absZ >= 2.5) return 0.0124;
          if (absZ >= 2) return 0.0455;
          if (absZ >= 1.5) return 0.1336;
          if (absZ >= 1) return 0.3173;
          if (absZ >= 0.5) return 0.6171;
          return 1.0;
        }

        updateDecision() {
          const pValue = parseFloat(this.currentPValue.textContent);
          const alpha = parseFloat(this.alphaSelector.value);
          this.currentAlpha.textContent = alpha;

          if (pValue < alpha) {
            this.decisionResult.textContent = "拒绝 H₀";
            this.decisionResult.className =
              "mt-2 font-semibold text-neon-purple";
          } else {
            this.decisionResult.textContent = "不拒绝 H₀";
            this.decisionResult.className = "mt-2 font-semibold text-gray-400";
          }
        }

        drawDistribution() {
          const canvas = document.getElementById("distribution-chart");
          if (!canvas) return;

          const ctx = canvas.getContext("2d");
          const width = canvas.width;
          const height = canvas.height;

          // 清空画布
          ctx.clearRect(0, 0, width, height);

          // 绘制正态分布曲线
          ctx.strokeStyle = "#00f3ff";
          ctx.lineWidth = 2;
          ctx.beginPath();

          for (let x = 0; x < width; x++) {
            const z = (x - width / 2) / (width / 6); // 映射到-3到3的范围
            const y =
              height -
              ((height * 0.8 * Math.exp(-0.5 * z * z)) /
                Math.sqrt(2 * Math.PI)) *
                2.5;
            if (x === 0) {
              ctx.moveTo(x, y);
            } else {
              ctx.lineTo(x, y);
            }
          }
          ctx.stroke();

          // 绘制中心线
          ctx.strokeStyle = "#ffffff";
          ctx.lineWidth = 1;
          ctx.setLineDash([5, 5]);
          ctx.beginPath();
          ctx.moveTo(width / 2, 0);
          ctx.lineTo(width / 2, height);
          ctx.stroke();
          ctx.setLineDash([]);
        }

        showUnderstandingFeedback(level) {
          const messages = {
            1: "别担心，假设检验确实需要时间理解。建议先复习概率基础知识。",
            2: "你已经有了基础理解！继续学习p值的含义会很有帮助。",
            3: "不错的理解水平！试着多做几个实际例子来巩固。",
            4: "很好的掌握程度！你可以尝试解释给别人听来加深理解。",
            5: "优秀！你已经很好地掌握了假设检验的核心概念。",
          };

          alert(`理解程度 ${level}/5: ${messages[level]}`);
        }
      }

      // 页面加载完成后初始化
      document.addEventListener("DOMContentLoaded", function () {
        // 渲染LaTeX公式
        renderMathInElement(document.body, {
          delimiters: [
            { left: "$$", right: "$$", display: true },
            { left: "$", right: "$", display: false },
            { left: "\\(", right: "\\)", display: false },
            { left: "\\[", right: "\\]", display: true },
          ],
        });

        // 初始化各个模块
        initParticles();
        new MagicPotionExperiment();
        new DetectiveClassroom();
        new PracticalApplications();
        new ExerciseManager();
        window.theoryExploration = new TheoryExploration(); // 添加理论探索功能

        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
          anchor.addEventListener("click", function (e) {
            e.preventDefault();
            const href = this.getAttribute("href");
            if (href && href !== "#") {
              const target = document.querySelector(href);
              if (target) {
                target.scrollIntoView({
                  behavior: "smooth",
                });
              }
            }
          });
        });

        // 导航栏滚动效果
        window.addEventListener("scroll", function () {
          const nav = document.getElementById("main-nav");
          if (window.scrollY > 100) {
            nav.style.backgroundColor = "rgba(15, 23, 48, 0.95)";
          } else {
            nav.style.backgroundColor = "rgba(15, 23, 48, 0.6)";
          }
        });

        // 移动端菜单
        const menuToggle = document.getElementById("menu-toggle");
        if (menuToggle) {
          menuToggle.addEventListener("click", function () {
            // 这里可以添加移动端菜单逻辑
            alert("移动端菜单功能待实现");
          });
        }
      });
    </script>

    <!-- 引入工具箱脚本 -->
    <script src="../static/js/toolbox.js"></script>
  </body>
</html>


