<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>随机变量探索 - 概率统计可视化</title>
    <link rel="stylesheet" href="../static/libs/fontawesome/font-awesome.min.css">
    <!-- 注释掉CDN版本 -->
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    
    <!-- 使用本地CSS文件或者保持CDN但添加生产环境检查 -->
    <script>
        if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
            // 开发环境使用CDN
            const script = document.createElement('script');
            script.src = 'https://cdn.tailwindcss.com';
            document.head.appendChild(script);
        }
    </script>
    <script src="../static/libs/chart/chart.umd.min.js"></script>
    <script src="../static/libs/chart/chartjs-plugin-annotation.min.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
<!--     <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>amp; -->
    <script id="MathJax-script" async src="../static/libs/mathjax/tex-mml-chtml.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-bg': '#0f172a',
                        'dark-card': '#1e293b',
                        'neon-blue': '#00f3ff',
                        'neon-purple': '#bf00ff',
                        'neon-green': '#00ff66',
                        'neon-pink': '#ff00ff',
                        'neon-orange': '#ff6b35',
                        'neon-yellow': '#ffd300',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
        
        :root {
            --dark-bg: #0f172a;
            --dark-card: #1e293b;
            --neon-blue: #00f3ff;
            --neon-purple: #bf00ff;
            --neon-green: #00ff66;
            --neon-pink: #ff00ff;
            --neon-orange: #ff6b35;
            --neon-yellow: #ffd300;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--dark-bg);
            color: #fff;
            overflow-x: hidden;
        }
        
        .font-future {
            font-family: 'Roboto', sans-serif;
            letter-spacing: 0.05em;
        }
        
        .text-neon-blue { color: var(--neon-blue); }
        .text-neon-purple { color: var(--neon-purple); }
        .text-neon-green { color: var(--neon-green); }
        .text-neon-pink { color: var(--neon-pink); }
        .text-neon-orange { color: var(--neon-orange); }
        .text-neon-yellow { color: var(--neon-yellow); }
        
        .bg-neon-blue { background-color: var(--neon-blue); }
        .bg-neon-purple { background-color: var(--neon-purple); }
        .bg-neon-green { background-color: var(--neon-green); }
        .bg-neon-pink { background-color: var(--neon-pink); }
        .bg-neon-orange { background-color: var(--neon-orange); }
        .bg-neon-yellow { background-color: var(--neon-yellow); }
        
        .bg-dark-bg { background-color: var(--dark-bg); }
        .bg-dark-card { background-color: var(--dark-card); }
        
        .accent-neon-blue { accent-color: var(--neon-blue); }
        .accent-neon-purple { accent-color: var(--neon-purple); }
        .accent-neon-green { accent-color: var(--neon-green); }
        .accent-neon-pink { accent-color: var(--neon-pink); }
        .accent-neon-orange { accent-color: var(--neon-orange); }
        .accent-neon-yellow { accent-color: var(--neon-yellow); }
        
        /* 数学公式样式 */
        .MathJax {
            font-size: 1.1em !important;
        }
        
        .math-formula {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid var(--neon-blue);
        }
        
        .math-formula .MathJax {
            color: #ffffff !important;
        }
        
        /* 公式容器样式 */
        .formula-container {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.1));
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        
        .formula-title {
            color: #a78bfa;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .border-neon-blue { border-color: var(--neon-blue); }
        .border-neon-purple { border-color: var(--neon-purple); }
        .border-neon-green { border-color: var(--neon-green); }
        .border-neon-pink { border-color: var(--neon-pink); }
        .border-neon-orange { border-color: var(--neon-orange); }
        .border-neon-yellow { border-color: var(--neon-yellow); }
        
        .clip-path-slant {
            clip-path: polygon(0 0, 100% 0, 100% 95%, 0 100%);
        }
        
        .bg-grid {
            background-image: 
                linear-gradient(to right, rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .hidden { display: none; }
        
        /* 粒子动画 */
        #particles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .particle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.5;
            animation: float 15s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-30px) translateX(15px); }
            50% { transform: translateY(-15px) translateX(-15px); }
            75% { transform: translateY(30px) translateX(15px); }
        }
        
        /* 卡片悬停效果 */
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }
        
        /* 按钮悬停效果 */
        .btn-hover {
            transition: all 0.3s ease;
        }
        
        .btn-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        /* 滑块样式 */
        input[type="range"] {
            height: 6px;
            border-radius: 3px;
            background: #334155;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
        
        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #0f172a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .animate-fadeIn { animation: fadeIn 0.5s ease-in-out; }
        .animate-pulse { animation: pulse 1.5s infinite; }
        .animate-scaleIn { animation: scaleIn 0.5s ease-in-out; }
        
        /* 转盘样式 */
        .wheel-canvas {
            border-radius: 50%;
            border: 4px solid var(--neon-blue);
        }
        
        /* 答案反馈样式 */
        .answer-correct {
            background-color: rgba(0, 255, 102, 0.2);
            border: 2px solid var(--neon-green);
        }
        
        .answer-incorrect {
            background-color: rgba(255, 0, 102, 0.2);
            border: 2px solid #ff0066;
        }
        
        /* 硬币翻转动画样式 */
        #coin-display {
            transition: transform 0.6s ease-in-out, background-color 0.3s ease;
        }
        
        .coin-flip {
            animation: flip 0.6s ease-in-out;
        }
        
        @keyframes flip {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(90deg); }
            100% { transform: rotateY(0deg); }
        }
    </style>
</head>
<body>
    <!-- 粒子背景 -->
    <div id="particles-container"></div>

    <!-- 导航栏 -->
    <nav class="bg-dark-bg/80 backdrop-blur-md py-4 sticky top-0 z-50 border-b border-gray-800">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-future font-bold flex items-center">
                <span class="text-neon-blue">概率统计</span><span class="ml-2">可视化</span>
            </a>
            <div class="flex space-x-6">
                <a href="index.html" class="text-gray-300 hover:text-neon-blue transition-colors duration-300">首页</a>
                <a href="random_variables.html" class="text-neon-blue border-b-2 border-neon-blue pb-1">随机变量</a>
                <a href="probability_distributions.html" class="text-gray-300 hover:text-neon-purple transition-colors duration-300">概率分布</a>
                <a href="expectation_variance.html" class="text-gray-300 hover:text-neon-green transition-colors duration-300">期望方差</a>
            </div>
        </div>
    </nav>

    <!-- 页面标题 -->
    <section class="py-20 relative bg-gradient-to-b from-dark-bg to-dark-card/50 clip-path-slant">
        <div class="absolute inset-0 bg-grid opacity-10"></div>
        <div class="container mx-auto px-4 relative z-10">
            <div class="text-center mb-16">
                <h1 class="text-[clamp(2rem,6vw,4rem)] font-future font-bold mb-4">
                    <span class="text-neon-blue">随机变量</span>探索
                </h1>
                <p class="text-gray-400 max-w-2xl mx-auto text-lg">
                    从不确定性中提炼数学对象 - 通过交互式可视化，深入理解随机变量的本质和特性
                </p>
            </div>
        </div>
    </section>

    <!-- 示例展示部分 -->
    <section id="example-showcase" class="py-20 relative bg-gradient-to-b from-dark-card/50 to-dark-bg">
        <div class="absolute inset-0 bg-grid opacity-10"></div>
        <div class="container mx-auto px-4 relative z-10">
            <div class="text-center mb-16">
                <h2 class="text-[clamp(1.5rem,4vw,3rem)] font-future font-bold mb-4">
                    <span class="text-neon-blue">示例展示</span> - 感受随机变量
                </h2>
                <p class="text-gray-400 max-w-3xl mx-auto text-lg">
                    通过交互模拟，直观感受什么是随机变量及其分布，理解它如何将随机现象"数字化"
                </p>
            </div>

            <div class="bg-dark-card rounded-xl p-8 border border-gray-800 card-hover">
                <h3 class="text-2xl font-future font-semibold mb-6 text-white flex items-center">
                    <i class="fa fa-dice text-neon-blue mr-3"></i>
                    "幸运大转盘"与"分布直方图"
                </h3>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- 左侧：场景设定和说明 -->
                    <div>
                        <h4 class="text-xl font-semibold mb-4 text-gray-200">场景设定</h4>
                        <p class="text-gray-300 mb-4">
                            我们有一个幸运大转盘，被划分为不同颜色的区域，每个区域对应不同的中奖金额。每次转动转盘都是一个随机现象。
                        </p>

                        <div class="bg-dark-bg rounded-lg p-4 mb-4">
                            <h5 class="text-lg font-semibold mb-3 text-gray-200">用户输入</h5>
                            <ul class="text-gray-300 space-y-2 text-sm">
                                <li class="flex items-center">
                                    <i class="fa fa-sliders text-neon-blue mr-2"></i>
                                    用户可以设置转盘各区域的<strong>面积（即概率）</strong>和对应的<strong>奖金（数值）</strong>
                                </li>
                                <li class="flex items-center">
                                    <i class="fa fa-cog text-neon-blue mr-2"></i>
                                    例如：60%区域为"谢谢惠顾"（0元），30%区域为"中小奖"（10元），10%区域为"中大奖"（100元）
                                </li>
                            </ul>
                        </div>

                        <div class="bg-dark-bg rounded-lg p-4">
                            <h5 class="text-lg font-semibold mb-3 text-gray-200">初学者收获</h5>
                            <p class="text-gray-300 text-sm">
                                他们立刻理解：随机变量<span class="text-neon-blue">X</span>（如中奖金额）是一个函数，它将随机现象的所有可能结果（转盘区域）映射到实数上。而直方图展示的稳定形态，就是这个随机变量的<strong>概率分布</strong>的直观体现。
                            </p>
                        </div>
                    </div>

                    <!-- 中间：交互转盘 -->
                    <div>
                        <h4 class="text-xl font-semibold mb-4 text-gray-200">交互模拟</h4>
                        
                        <div class="bg-dark-bg rounded-lg p-4 mb-4">
                            <!-- 转盘显示 -->
                            <div class="flex justify-center mb-4">
                                <div class="relative">
                                    <canvas id="wheel-canvas" width="200" height="200" class="wheel-canvas"></canvas>
                                    <div class="absolute top-0 left-1/2 transform -translate-x-1/2 -mt-2 w-4 h-4 bg-neon-blue rounded-full z-10"></div>
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <div class="text-center">
                                            <div id="wheel-result" class="text-3xl font-bold text-neon-blue mb-2">0</div>
                                            <div class="text-gray-400 text-sm">当前结果</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 概率和奖金设置 -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4 mb-4">
                                <div class="bg-gray-800 p-3 rounded-lg text-center">
                                    <div class="text-sm text-gray-400">区域1概率</div>
                                    <input type="range" id="prob1" min="0" max="100" value="60" class="w-full accent-neon-blue">
                                    <div id="prob1-display" class="text-neon-blue font-semibold">60%</div>
                                </div>
                                <div class="bg-gray-800 p-3 rounded-lg text-center">
                                    <div class="text-sm text-gray-400">区域1奖金</div>
                                    <input type="number" id="reward1" value="0" class="w-full bg-gray-700 text-white p-1 rounded text-center">
                                    <div class="text-neon-blue font-semibold text-sm">元</div>
                                </div>
                                <div class="bg-gray-800 p-3 rounded-lg text-center">
                                    <div class="text-sm text-gray-400">区域2概率</div>
                                    <input type="range" id="prob2" min="0" max="100" value="30" class="w-full accent-neon-purple">
                                    <div id="prob2-display" class="text-neon-purple font-semibold">30%</div>
                                </div>
                                <div class="bg-gray-800 p-3 rounded-lg text-center">
                                    <div class="text-sm text-gray-400">区域2奖金</div>
                                    <input type="number" id="reward2" value="10" class="w-full bg-gray-700 text-white p-1 rounded text-center">
                                    <div class="text-neon-purple font-semibold text-sm">元</div>
                                </div>
                                <div class="bg-gray-800 p-3 rounded-lg text-center">
                                    <div class="text-sm text-gray-400">区域3概率</div>
                                    <input type="range" id="prob3" min="0" max="100" value="10" class="w-full accent-neon-green">
                                    <div id="prob3-display" class="text-neon-green font-semibold">10%</div>
                                </div>
                                <div class="bg-gray-800 p-3 rounded-lg text-center">
                    <div class="text-sm text-gray-400">区域3奖金</div>
                    <input type="number" id="reward3" value="100" class="w-full bg-gray-700 text-white p-1 rounded text-center">
                    <div class="text-neon-green font-semibold text-sm">元</div>
                </div>
            </div>
            
            <!-- 添加概率总和显示 -->
            <div class="col-span-2 bg-gray-800 p-3 rounded-lg text-center mb-4">
                <div class="text-sm text-gray-400">概率总和验证</div>
                <div id="probability-total" class="text-neon-green font-semibold">总和: 100.0%</div>
            </div>

                        <!-- 统计信息 -->
                            <div class="grid grid-cols-3 gap-2 mb-4 text-center text-sm">
                                <div class="bg-gray-800 p-2 rounded">
                                    <div class="text-gray-400">期望值</div>
                                    <div id="wheel-expectation" class="text-neon-yellow font-bold">13.00元</div>
                                </div>
                                <div class="bg-gray-800 p-2 rounded">
                                    <div class="text-gray-400">方差</div>
                                    <div id="wheel-variance" class="text-neon-orange font-bold">819.00</div>
                                </div>
                                <div class="bg-gray-800 p-2 rounded">
                                    <div class="text-gray-400">转动次数</div>
                                    <div id="wheel-count" class="text-neon-pink font-bold">0</div>
                                </div>
                            </div>

                            <!-- 操作按钮 -->
                            <div class="flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4">
                                <button id="spin-once-btn" class="px-6 py-2 bg-neon-blue text-dark-bg font-bold rounded-md hover:bg-neon-blue/80 transition-all duration-300 btn-hover">
                                    转动1次 <i class="fa fa-refresh ml-2"></i>
                                </button>
                                <button id="spin-hundred-btn" class="px-6 py-2 bg-neon-purple text-dark-bg font-bold rounded-md hover:bg-neon-purple/80 transition-all duration-300 btn-hover">
                                    转动100次 <i class="fa fa-forward ml-2"></i>
                                </button>
                                <button id="reset-wheel-btn" class="px-6 py-2 bg-neon-orange text-dark-bg font-bold rounded-md hover:bg-neon-orange/80 transition-all duration-300 btn-hover">
                                    重置 <i class="fa fa-undo ml-2"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 右侧：直方图显示 -->
                    <div>
                        <h4 class="text-xl font-semibold mb-4 text-gray-200">分布直方图</h4>
                        <div class="bg-dark-bg rounded-lg p-4">
                            <div class="h-64 mb-4">
                                <canvas id="wheel-histogram"></canvas>
                            </div>
                            <div class="text-sm text-gray-400">
                                <p>随着转动次数增加，直方图中各柱子的高度比例会逐渐稳定在设置的概率附近，这就是<strong>大数定律</strong>的体现。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 随机变量映射函数可视化演示 -->
    <section id="mapping-demo" class="py-20 relative bg-gradient-to-b from-dark-bg to-dark-card/50">
        <div class="absolute inset-0 bg-grid opacity-10"></div>
        <div class="container mx-auto px-4 relative z-10">
            <div class="text-center mb-16">
                <h2 class="text-[clamp(1.5rem,4vw,3rem)] font-future font-bold mb-4">
                    <span class="text-neon-orange">随机变量映射函数</span> - 可视化演示
                </h2>
                <p class="text-gray-400 max-w-3xl mx-auto text-lg">
                    随机变量是将样本空间中的每一个结果，映射到一个实数的函数
                </p>
            </div>

            <div class="bg-dark-card rounded-xl p-8 border border-gray-800 card-hover">
                <h3 class="text-2xl font-future font-semibold mb-6 text-white flex items-center">
                    <i class="fa fa-arrow-right text-neon-orange mr-3"></i>
                    映射函数演示
                </h3>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- 左侧：实验选择和控制 -->
                    <div>
                        <div class="bg-dark-bg rounded-lg p-4 mb-4">
                            <h4 class="text-lg font-semibold mb-3 text-gray-200">选择实验类型</h4>
                            <select id="mapping-experiment" class="w-full bg-gray-800 text-white py-2 px-3 rounded-lg border border-gray-700 focus:outline-none focus:ring-2 focus:ring-neon-orange">
                                <option value="coin">抛硬币实验</option>
                                <option value="dice">掷骰子实验</option>
                                <option value="card">抽卡实验</option>
                            </select>
                        </div>

                        <!-- 抛硬币实验 -->
                        <div id="coin-mapping" class="mapping-demo bg-dark-bg rounded-lg p-4 mb-4">
                            <h5 class="text-gray-200 mb-3 font-semibold">抛硬币实验</h5>
                            <div class="mb-4">
                                <p class="text-gray-300 text-sm mb-2">样本空间 Ω = {正面, 反面}</p>
                                <p class="text-gray-300 text-sm mb-2">随机变量 X: 正面→1, 反面→0</p>
                            </div>
                            <div class="flex justify-center mb-4">
                                <div id="coin-display" class="w-16 h-16 bg-neon-orange rounded-full flex items-center justify-center text-dark-bg text-2xl font-bold">
                                    ?
                                </div>
                            </div>
                            <div class="text-center mb-4">
                                <span class="text-gray-300">X = </span>
                                <span id="coin-value" class="text-neon-orange font-bold text-xl">?</span>
                            </div>
                            <button id="flip-coin-btn" class="w-full px-4 py-2 bg-neon-orange text-dark-bg font-bold rounded-md hover:bg-neon-orange/80 transition-all duration-300 btn-hover">
                                抛硬币 <i class="fa fa-coins ml-2"></i>
                            </button>
                        </div>

                        <!-- 掷骰子实验 -->
                        <div id="dice-mapping" class="mapping-demo bg-dark-bg rounded-lg p-4 mb-4 hidden">
                            <h5 class="text-gray-200 mb-3 font-semibold">掷骰子实验</h5>
                            <div class="mb-4">
                                <p class="text-gray-300 text-sm mb-2">样本空间 Ω = {1, 2, 3, 4, 5, 6}</p>
                                <p class="text-gray-300 text-sm mb-2">随机变量 X: 点数 → 点数本身</p>
                            </div>
                            <div class="flex justify-center mb-4">
                                <div id="dice-display" class="w-16 h-16 bg-white rounded-lg flex items-center justify-center text-dark-bg text-2xl font-bold">
                                    ?
                                </div>
                            </div>
                            <div class="text-center mb-4">
                                <span class="text-gray-300">X = </span>
                                <span id="dice-value" class="text-neon-orange font-bold text-xl">?</span>
                            </div>
                            <button id="roll-dice-mapping-btn" class="w-full px-4 py-2 bg-neon-orange text-dark-bg font-bold rounded-md hover:bg-neon-orange/80 transition-all duration-300 btn-hover">
                                掷骰子 <i class="fa fa-dice ml-2"></i>
                            </button>
                        </div>

                        <!-- 抽卡实验 -->
                        <div id="card-mapping" class="mapping-demo bg-dark-bg rounded-lg p-4 mb-4 hidden">
                            <h5 class="text-gray-200 mb-3 font-semibold">抽卡实验</h5>
                            <div class="mb-4">
                                <p class="text-gray-300 text-sm mb-2">样本空间 Ω = {♠, ♥, ♦, ♣}</p>
                                <p class="text-gray-300 text-sm mb-2">随机变量 X: 红色→1, 黑色→0</p>
                            </div>
                            <div class="flex justify-center mb-4">
                                <div id="card-display" class="w-16 h-16 bg-white rounded-lg flex items-center justify-center text-4xl">
                                    ?
                                </div>
                            </div>
                            <div class="text-center mb-4">
                                <span class="text-gray-300">X = </span>
                                <span id="card-value" class="text-neon-orange font-bold text-xl">?</span>
                            </div>
                            <button id="draw-card-btn" class="w-full px-4 py-2 bg-neon-orange text-dark-bg font-bold rounded-md hover:bg-neon-orange/80 transition-all duration-300 btn-hover">
                                抽卡 <i class="fa fa-clone ml-2"></i>
                            </button>
                        </div>

                        <!-- 批量实验控制 -->
                        <div class="bg-dark-bg rounded-lg p-4">
                            <div class="bg-gray-900 rounded-lg p-3 mb-4 border-l-4 border-neon-orange">
                                <h5 class="text-neon-orange font-semibold mb-2">映射函数定义</h5>
                                <div class="text-center text-white text-sm mb-2">
                                    $$X: \Omega \to \mathbb{R}$$
                                </div>
                                <p class="text-gray-400 text-xs">
                                    随机变量是从样本空间 $\Omega$ 到实数集 $\mathbb{R}$ 的函数。
                                </p>
                            </div>
                            
                            <h5 class="text-gray-200 mb-3 font-semibold">批量实验</h5>
                            <div class="flex space-x-2">
                                <button id="batch-10-btn" class="flex-1 px-3 py-2 bg-neon-purple text-dark-bg font-bold rounded-md hover:bg-neon-purple/80 transition-all duration-300 btn-hover text-sm">
                                    10次
                                </button>
                                <button id="batch-100-btn" class="flex-1 px-3 py-2 bg-neon-green text-dark-bg font-bold rounded-md hover:bg-neon-green/80 transition-all duration-300 btn-hover text-sm">
                                    100次
                                </button>
                                <button id="reset-mapping-btn" class="flex-1 px-3 py-2 bg-gray-600 text-white font-bold rounded-md hover:bg-gray-500 transition-all duration-300 btn-hover text-sm">
                                    重置
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 右侧：统计结果和图表 -->
                    <div>
                        <div class="bg-dark-bg rounded-lg p-4 mb-4">
                            <h5 class="text-gray-200 mb-3 font-semibold">统计结果</h5>
                            <div class="grid grid-cols-2 gap-4 text-center">
                                <div class="bg-gray-800 p-3 rounded-lg">
                                    <div class="text-sm text-gray-400">实验次数</div>
                                    <div id="mapping-total" class="text-xl font-semibold text-neon-blue">0</div>
                                </div>
                                <div class="bg-gray-800 p-3 rounded-lg">
                                    <div class="text-sm text-gray-400">平均值</div>
                                    <div id="mapping-average" class="text-xl font-semibold text-neon-green">0.00</div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-dark-bg rounded-lg p-4">
                            <h5 class="text-gray-200 mb-3 font-semibold">分布图表</h5>
                            <div class="h-64">
                                <canvas id="mapping-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 理论探索部分 -->
    <section id="theoretical-exploration" class="py-20 relative bg-gradient-to-b from-dark-card/50 to-dark-bg">
        <div class="absolute inset-0 bg-grid opacity-10"></div>
        <div class="container mx-auto px-4 relative z-10">
            <div class="text-center mb-16">
                <h2 class="text-[clamp(1.5rem,4vw,3rem)] font-future font-bold mb-4">
                    <span class="text-neon-purple">理论探索</span> - 定义、类型与性质
                </h2>
                <p class="text-gray-400 max-w-3xl mx-auto text-lg">
                    将理论概念分解为循序渐进的模块，辅以可视化工具，让用户自主探索
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- 离散型随机变量 -->
                <div class="bg-dark-card rounded-xl p-6 border border-gray-800 card-hover">
                    <h3 class="text-xl font-future font-semibold mb-6 text-white flex items-center">
                        <i class="fa fa-cubes text-neon-blue mr-3"></i> 离散型随机变量
                    </h3>

                    <div class="mb-6">
                        <p class="text-gray-300 mb-4">
                            离散型随机变量只能取有限个或可数无限个值，如掷骰子的点数、抛硬币的正反面等。
                        </p>
                        
                        <!-- 添加数学公式 -->
                        <div class="bg-gray-900 rounded-lg p-4 mb-4 border-l-4 border-neon-blue">
                            <h5 class="text-neon-blue font-semibold mb-2">概率质量函数 (PMF)</h5>
                            <div class="text-center text-white text-lg mb-2">
                                $$P(X = x_i) = p_i, \quad \sum_{i} p_i = 1$$
                            </div>
                            <p class="text-gray-400 text-sm">
                                其中 $X$ 是离散随机变量，$x_i$ 是其可能取值，$p_i$ 是对应的概率。
                            </p>
                        </div>
                        
                        <div class="bg-gray-900 rounded-lg p-4 mb-4 border-l-4 border-neon-green">
                            <h5 class="text-neon-green font-semibold mb-2">期望值</h5>
                            <div class="text-center text-white text-lg mb-2">
                                $$E[X] = \sum_{i} x_i \cdot P(X = x_i)$$
                            </div>
                            <p class="text-gray-400 text-sm">
                                期望值是随机变量所有可能取值的加权平均。
                            </p>
                        </div>
                        
                        <div class="bg-gray-900 rounded-lg p-4 mb-4 border-l-4 border-neon-purple">
                            <h5 class="text-neon-purple font-semibold mb-2">方差</h5>
                            <div class="text-center text-white text-lg mb-2">
                                $$Var(X) = E[(X - E[X])^2] = \sum_{i} (x_i - E[X])^2 \cdot P(X = x_i)$$
                            </div>
                            <p class="text-gray-400 text-sm">
                                方差衡量随机变量取值的离散程度。
                            </p>
                        </div>

                        <div class="bg-dark-bg rounded-lg p-4 mb-4">
                            <h4 class="text-gray-200 mb-2 font-semibold">
                                示例：掷两个骰子的点数和
                            </h4>
                            
                            <div class="bg-gray-900 rounded-lg p-3 mb-4 border-l-4 border-neon-blue">
                                <h5 class="text-neon-blue font-semibold mb-2">概率质量函数 (PMF)</h5>
                                <div class="text-center text-white text-sm mb-2">
                                    $$P(X = k) = \frac{\text{有利结果数}}{\text{总结果数}}$$
                                </div>
                                <p class="text-gray-400 text-xs">
                                    对于两个骰子的点数和，$P(X = 7) = \frac{6}{36} = \frac{1}{6}$（最大概率）
                                </p>
                            </div>
                            <div class="flex justify-center mb-4">
                                <div
                                    id="dice1"
                                    class="w-16 h-16 bg-white rounded-lg flex items-center justify-center text-dark-bg text-2xl font-bold mr-4 transition-transform duration-300"
                                >
                                    1
                                </div>
                                <div
                                    id="dice2"
                                    class="w-16 h-16 bg-white rounded-lg flex items-center justify-center text-dark-bg text-2xl font-bold transition-transform duration-300"
                                >
                                    1
                                </div>
                            </div>
                            <div class="text-center mb-4">
                                <div class="flex justify-center items-center space-x-4 mb-6">
                                    <div class="bg-dark-card p-4 rounded-lg border border-neon-blue/30">
                                        <div class="text-sm text-gray-400 mb-1 text-center">骰子1</div>
                                        <span id="dice1-result" class="text-neon-green font-bold text-3xl block text-center">1</span>
                                    </div>
                                    <div class="text-neon-yellow text-3xl">+</div>
                                    <div class="bg-dark-card p-4 rounded-lg border border-neon-blue/30">
                                        <div class="text-sm text-gray-400 mb-1 text-center">骰子2</div>
                                        <span id="dice2-result" class="text-neon-green font-bold text-3xl block text-center">1</span>
                                    </div>
                                    <div class="text-neon-yellow text-3xl">=</div>
                                    <div class="bg-dark-card p-4 rounded-lg border border-neon-blue/30">
                                        <div class="text-sm text-gray-400 mb-1 text-center">总和</div>
                                        <span id="dice-sum" class="text-neon-blue font-bold text-3xl block text-center">2</span>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center mb-4">
                                <span class="text-gray-300">总次数: </span>
                                <span id="total-rolls" class="text-neon-green font-bold text-lg">0</span>
                            </div>
                            <div class="flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4">
                                <button id="roll-dice-btn" class="px-6 py-2 bg-neon-blue text-dark-bg font-bold rounded-md hover:bg-neon-blue/80 transition-all duration-300 btn-hover">
                                    掷1次骰子 <i class="fa fa-refresh ml-2"></i>
                                </button>
                                <button id="roll-dice-ten-btn" class="px-6 py-2 bg-neon-purple text-dark-bg font-bold rounded-md hover:bg-neon-purple/80 transition-all duration-300 btn-hover">
                                    掷10次骰子 <i class="fa fa-dice ml-2"></i>
                                </button>
                                <button id="roll-dice-hundred-btn" class="px-6 py-2 bg-neon-green text-dark-bg font-bold rounded-md hover:bg-neon-green/80 transition-all duration-300 btn-hover">
                                    掷100次 <i class="fa fa-bolt ml-2"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="h-64">
                        <canvas id="discrete-rv-chart"></canvas>
                    </div>

                    <div class="mt-6 pt-4 border-t border-gray-800 text-sm text-gray-400">
                        <p>
                            概率质量函数(PMF)描述了离散随机变量在各个可能取值上的概率。上图展示了两个骰子点数和的概率分布。
                        </p>
                    </div>
                </div>

                <!-- 连续型随机变量 -->
                <div class="bg-dark-card rounded-xl p-6 border border-gray-800 card-hover">
                    <h3 class="text-xl font-future font-semibold mb-6 text-white flex items-center">
                        <i class="fa fa-wave-square text-neon-purple mr-3"></i>
                        连续型随机变量
                    </h3>

                    <div class="mb-6">
                        <p class="text-gray-300 mb-4">
                            连续型随机变量可以取某个区间内的任意值，如身高、体重、时间等。
                        </p>
                        
                        <!-- 添加数学公式 -->
                        <div class="bg-gray-900 rounded-lg p-4 mb-4 border-l-4 border-neon-purple">
                            <h5 class="text-neon-purple font-semibold mb-2">概率密度函数 (PDF)</h5>
                            <div class="text-center text-white text-lg mb-2">
                                $$P(a \leq X \leq b) = \int_a^b f(x) dx$$
                            </div>
                            <p class="text-gray-400 text-sm">
                                其中 $f(x)$ 是概率密度函数，满足 $f(x) \geq 0$ 且 $\int_{-\infty}^{\infty} f(x) dx = 1$。
                            </p>
                        </div>
                        
                        <div class="bg-gray-900 rounded-lg p-4 mb-4 border-l-4 border-neon-blue">
                            <h5 class="text-neon-blue font-semibold mb-2">常见分布</h5>
                            <div class="space-y-3">
                                <div>
                                    <span class="text-neon-green font-medium">正态分布：</span>
                                    <div class="text-center text-white mt-1">
                                        $$f(x) = \frac{1}{\sigma\sqrt{2\pi}} e^{-\frac{(x-\mu)^2}{2\sigma^2}}$$
                                    </div>
                                </div>
                                <div>
                                    <span class="text-neon-yellow font-medium">均匀分布：</span>
                                    <div class="text-center text-white mt-1">
                                        $$f(x) = \begin{cases} \frac{1}{b-a} & a \leq x \leq b \\\\ 0 & \text{其他} \end{cases}$$
                                    </div>
                                </div>
                                <div>
                                    <span class="text-neon-orange font-medium">指数分布：</span>
                                    <div class="text-center text-white mt-1">
                                        $$f(x) = \lambda e^{-\lambda x}, \quad x \geq 0$$
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-dark-bg rounded-lg p-4 mb-4">
                            <h4 class="text-gray-200 mb-2 font-semibold">随机数生成器</h4>
                            
                            <div class="bg-gray-900 rounded-lg p-3 mb-4 border-l-4 border-neon-purple">
                                <h5 class="text-neon-purple font-semibold mb-2">大数定律</h5>
                                <div class="text-center text-white text-sm mb-2">
                                    $$\lim_{n \to \infty} \frac{1}{n} \sum_{i=1}^{n} X_i = E[X]$$
                                </div>
                                <p class="text-gray-400 text-xs">
                                    随着样本数量增加，样本均值会趋近于理论期望值。
                                </p>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-300 mb-2">分布类型:</label>
                                <select id="continuous-distribution" class="w-full bg-gray-800 text-white py-2 px-3 rounded-lg border border-gray-700 focus:outline-none focus:ring-2 focus:ring-neon-purple">
                                    <option value="uniform">均匀分布</option>
                                    <option value="normal">正态分布</option>
                                    <option value="exponential">指数分布</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-300 mb-2">样本数量: <span id="continuous-samples-value">1000</span></label>
                                <input type="range" id="continuous-samples" min="100" max="10000" step="100" value="1000" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-purple">
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-300 mb-2">X轴最小值: <span id="x-axis-min-value">-5</span></label>
                                <input type="range" id="x-axis-min" min="-10" max="0" step="0.5" value="-5" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-purple">
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-300 mb-2">X轴最大值: <span id="x-axis-max-value">5</span></label>
                                <input type="range" id="x-axis-max" min="0" max="10" step="0.5" value="5" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-purple">
                            </div>
                            <div class="flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4">
                                <button id="generate-samples-btn" class="px-6 py-2 bg-neon-purple text-dark-bg font-bold rounded-md hover:bg-neon-purple/80 transition-all duration-300 btn-hover">
                                    生成样本 <i class="fa fa-random ml-2"></i>
                                </button>
                                <button id="generate-many-samples-btn" class="px-6 py-2 bg-neon-pink text-dark-bg font-bold rounded-md hover:bg-neon-pink/80 transition-all duration-300 btn-hover">
                                    生成10000样本 <i class="fa fa-rocket ml-2"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="h-64">
                        <canvas id="continuous-rv-chart"></canvas>
                    </div>

                    <div class="mt-6 pt-4 border-t border-gray-800 text-sm text-gray-400">
                        <p>
                            概率密度函数(PDF)描述了连续随机变量的概率分布。上图展示了不同分布类型的样本直方图与理论密度曲线。
                        </p>
                    </div>
                </div>
            </div>

            <!-- 随机变量数字特征 -->
            <div class="mt-12 bg-dark-card rounded-xl p-6 border border-gray-800 card-hover">
                <h3 class="text-xl font-future font-semibold mb-6 text-white flex items-center">
                    <i class="fa fa-chart-line text-neon-green mr-3"></i>
                    随机变量数字特征
                </h3>

                <div class="mb-6">
                    <p class="text-gray-300 mb-4">
                        随机变量的数字特征（如期望、方差、标准差）提供了对其分布的重要描述。调整参数，观察这些特征的变化。
                    </p>
                    
                    <!-- 添加数字特征公式 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-gray-900 rounded-lg p-4 border-l-4 border-neon-green">
                            <h5 class="text-neon-green font-semibold mb-2">期望值性质</h5>
                            <div class="space-y-2 text-sm">
                                <div class="text-center text-white">
                                    $$E[aX + b] = aE[X] + b$$
                                </div>
                                <div class="text-center text-white">
                                    $$E[X + Y] = E[X] + E[Y]$$
                                </div>
                                <p class="text-gray-400 text-xs">
                                    期望值具有线性性质。
                                </p>
                            </div>
                        </div>
                        
                        <div class="bg-gray-900 rounded-lg p-4 border-l-4 border-neon-purple">
                            <h5 class="text-neon-purple font-semibold mb-2">方差性质</h5>
                            <div class="space-y-2 text-sm">
                                <div class="text-center text-white">
                                    $$Var(aX + b) = a^2 Var(X)$$
                                </div>
                                <div class="text-center text-white">
                                    $$\sigma = \sqrt{Var(X)}$$
                                </div>
                                <p class="text-gray-400 text-xs">
                                    标准差 $\sigma$ 是方差的平方根。
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-dark-bg rounded-lg p-4">
                            <div class="mb-4">
                                <label class="block text-gray-300 mb-2">分布类型:</label>
                                <select id="rv-distribution" class="w-full bg-gray-800 text-white py-2 px-3 rounded-lg border border-gray-700 focus:outline-none focus:ring-2 focus:ring-neon-green">
                                    <option value="normal">正态分布</option>
                                    <option value="uniform">均匀分布</option>
                                    <option value="exponential">指数分布</option>
                                    <option value="binomial">二项分布</option>
                                </select>
                            </div>

                            <!-- 正态分布参数 -->
            <div id="rv-normal-params" class="mb-4 rv-params">
                <div class="mb-3">
                    <label class="block text-gray-300 mb-1">均值 (μ): <span id="rv-normal-mean-value">0</span></label>
                    <input type="range" id="rv-normal-mean" min="-5" max="5" step="0.1" value="0" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-green">
                </div>
                <div class="mb-3">
                    <label class="block text-gray-300 mb-1">标准差 (σ): <span id="rv-normal-std-value">1</span></label>
                    <input type="range" id="rv-normal-std" min="0.1" max="3" step="0.1" value="1" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-green">
                </div>
            </div>
            
            <!-- 正态分布参数（连续型随机变量部分） -->
            <div id="normal-params" class="mb-4 hidden">
                <div class="mb-3">
                    <label class="block text-gray-300 mb-1">均值 (μ): <span id="normal-mu-value">0</span></label>
                    <input type="range" id="normal-mu" min="-5" max="5" step="0.1" value="0" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-green">
                </div>
                <div class="mb-3">
                    <label class="block text-gray-300 mb-1">标准差 (σ): <span id="normal-sigma-value">1</span></label>
                    <input type="range" id="normal-sigma" min="0.1" max="3" step="0.1" value="1" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-green">
                </div>
            </div>

                            <!-- 均匀分布参数 -->
            <div id="rv-uniform-params" class="mb-4 rv-params hidden">
                <div class="mb-3">
                    <label class="block text-gray-300 mb-1">最小值 (a): <span id="rv-uniform-min-value">-2</span></label>
                    <input type="range" id="rv-uniform-min" min="-5" max="0" step="0.1" value="-2" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-green">
                </div>
                <div class="mb-3">
                    <label class="block text-gray-300 mb-1">最大值 (b): <span id="rv-uniform-max-value">2</span></label>
                    <input type="range" id="rv-uniform-max" min="0" max="5" step="0.1" value="2" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-green">
                </div>
            </div>
            
            <!-- 均匀分布参数（连续型随机变量部分） -->
            <div id="uniform-params" class="mb-4 hidden">
                <div class="mb-3">
                    <label class="block text-gray-300 mb-1">最小值 (a): <span id="uniform-a-value">0</span></label>
                    <input type="range" id="uniform-a" min="-5" max="0" step="0.1" value="0" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-green">
                </div>
                <div class="mb-3">
                    <label class="block text-gray-300 mb-1">最大值 (b): <span id="uniform-b-value">1</span></label>
                    <input type="range" id="uniform-b" min="0" max="5" step="0.1" value="1" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-green">
                </div>
            </div>

                            <!-- 指数分布参数 -->
            <div id="rv-exponential-params" class="mb-4 rv-params hidden">
                <div class="mb-3">
                    <label class="block text-gray-300 mb-1">λ参数: <span id="rv-exponential-lambda-value">1</span></label>
                    <input type="range" id="rv-exponential-lambda" min="0.1" max="3" step="0.1" value="1" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-green">
                </div>
            </div>
            
            <!-- 指数分布参数（连续型随机变量部分） -->
            <div id="exponential-params" class="mb-4 hidden">
                <div class="mb-3">
                    <label class="block text-gray-300 mb-1">λ参数: <span id="exponential-lambda-value">1</span></label>
                    <input type="range" id="exponential-lambda" min="0.1" max="3" step="0.1" value="1" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-green">
                </div>
            </div>

                            <!-- 二项分布参数 -->
                            <div id="rv-binomial-params" class="mb-4 rv-params hidden">
                                <div class="mb-3">
                                    <label class="block text-gray-300 mb-1">试验次数 (n): <span id="rv-binomial-n-value">10</span></label>
                                    <input type="range" id="rv-binomial-n" min="1" max="30" step="1" value="10" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-green">
                                </div>
                                <div class="mb-3">
                                    <label class="block text-gray-300 mb-1">成功概率 (p): <span id="rv-binomial-p-value">0.5</span></label>
                                    <input type="range" id="rv-binomial-p" min="0.1" max="0.9" step="0.05" value="0.5" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-green">
                                </div>
                            </div>

                            <!-- X轴范围控制 -->
                            <div class="mb-4">
                                <h5 class="text-gray-200 mb-3 font-semibold">图表X轴范围</h5>
                                <div class="mb-3">
                                    <label class="block text-gray-300 mb-1">X轴最小值: <span id="rv-x-axis-min-value">-5</span></label>
                                    <input type="range" id="rv-x-axis-min" min="-10" max="0" step="0.5" value="-5" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-green">
                                </div>
                                <div class="mb-3">
                                    <label class="block text-gray-300 mb-1">X轴最大值: <span id="rv-x-axis-max-value">5</span></label>
                                    <input type="range" id="rv-x-axis-max" min="0" max="10" step="0.5" value="5" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-green">
                                </div>
                            </div>

                            <div class="grid grid-cols-3 gap-4 text-center">
                                <div class="bg-gray-800 p-3 rounded-lg">
                                    <div class="text-sm text-gray-400">期望 E[X]</div>
                                    <div id="rv-expectation" class="text-xl font-semibold text-neon-green">0.00</div>
                                </div>
                                <div class="bg-gray-800 p-3 rounded-lg">
                                    <div class="text-sm text-gray-400">方差 Var[X]</div>
                                    <div id="rv-variance" class="text-xl font-semibold text-neon-green">1.00</div>
                                </div>
                                <div class="bg-gray-800 p-3 rounded-lg">
                                    <div class="text-sm text-gray-400">标准差 σ</div>
                                    <div id="rv-std" class="text-xl font-semibold text-neon-green">1.00</div>
                                </div>
                            </div>
                        </div>

                        <div class="h-64">
                            <canvas id="rv-features-chart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="mt-6 pt-4 border-t border-gray-800 text-sm text-gray-400">
                    <p>
                        期望值表示随机变量的平均值，方差和标准差则描述了随机变量取值的离散程度。上图展示了不同参数下的概率密度函数和期望值位置。
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- 实践应用部分 -->
    <section id="practical-applications" class="py-20 relative bg-gradient-to-b from-dark-bg to-dark-card/50">
        <div class="absolute inset-0 bg-grid opacity-10"></div>
        <div class="container mx-auto px-4 relative z-10">
            <div class="text-center mb-16">
                <h2 class="text-[clamp(1.5rem,4vw,3rem)] font-future font-bold mb-4">
                    <span class="text-neon-yellow">实践应用</span> - 现实世界中的随机变量
                </h2>
                <p class="text-gray-400 max-w-3xl mx-auto text-lg">
                    通过具体的应用案例，理解随机变量在金融、游戏设计等领域的重要作用
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- 金融风险管理 -->
                <div class="bg-dark-card rounded-xl p-6 border border-gray-800 card-hover">
                    <h3 class="text-xl font-future font-semibold mb-6 text-white flex items-center">
                        <i class="fa fa-chart-line text-neon-yellow mr-3"></i>
                        金融风险管理 - 投资组合收益分析
                    </h3>

                    <div class="mb-6">
                        <p class="text-gray-300 mb-4">
                            你持有两种资产：股票A和债券B。设未来一年的收益率为随机变量，分析投资组合的风险和收益。
                        </p>

                        <div class="bg-dark-bg rounded-lg p-4 mb-4">
                            <h4 class="text-gray-200 mb-3 font-semibold">资产配置</h4>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-300 mb-2">股票A比例: <span id="stock-ratio-value">60</span>%</label>
                                    <input type="range" id="stock-ratio" min="0" max="100" value="60" class="w-full accent-neon-yellow">
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2">债券B比例: <span id="bond-ratio-value">40</span>%</label>
                    <input type="range" id="bond-ratio" min="0" max="100" value="40" class="w-full accent-neon-blue">
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div class="bg-gray-800 p-3 rounded-lg">
                                    <h5 class="text-gray-200 mb-2 font-semibold">股票A</h5>
                                    <div class="text-sm text-gray-400">期望收益率: <span class="text-neon-green">8%</span></div>
                                    <div class="text-sm text-gray-400">标准差: <span class="text-neon-orange">15%</span></div>
                                </div>
                                <div class="bg-gray-800 p-3 rounded-lg">
                                    <h5 class="text-gray-200 mb-2 font-semibold">债券B</h5>
                                    <div class="text-sm text-gray-400">期望收益率: <span class="text-neon-green">3%</span></div>
                                    <div class="text-sm text-gray-400">标准差: <span class="text-neon-orange">5%</span></div>
                                </div>
                            </div>

                            <div class="grid grid-cols-3 gap-4 text-center">
                                <div class="bg-gray-800 p-3 rounded-lg">
                                    <div class="text-sm text-gray-400">组合期望收益</div>
                                    <div id="portfolio-return" class="text-xl font-semibold text-neon-green">6.0%</div>
                                </div>
                                <div class="bg-gray-800 p-3 rounded-lg">
                                    <div class="text-sm text-gray-400">组合风险</div>
                                    <div id="portfolio-risk" class="text-xl font-semibold text-neon-orange">11.0%</div>
                                </div>
                                <div class="bg-gray-800 p-3 rounded-lg">
                                    <div class="text-sm text-gray-400">夏普比率</div>
                                    <div id="sharpe-ratio" class="text-xl font-semibold text-neon-purple">0.55</div>
                                </div>
                            </div>

                            <button id="simulate-portfolio-btn" class="w-full mt-4 px-4 py-2 bg-neon-yellow text-dark-bg font-bold rounded-md hover:bg-neon-yellow/80 transition-all duration-300 btn-hover">
                                模拟1000次投资结果 <i class="fa fa-play ml-2"></i>
                            </button>
                        </div>
                    </div>
// ... existing code ...
    </section>

    <!-- 实践应用部分 -->
    <section id="practical-applications" class="py-20 relative bg-gradient-to-b from-dark-card/50 to-dark-bg">
        <div class="absolute inset-0 bg-grid opacity-10"></div>
        <div class="container mx-auto px-4 relative z-10">
            <div class="text-center mb-16">
                <h2 class="text-[clamp(1.5rem,4vw,3rem)] font-future font-bold mb-4">
                    <span class="text-neon-orange">实践应用</span> - 随机变量在现实中的应用
                </h2>
                <p class="text-gray-400 max-w-3xl mx-auto text-lg">
                    通过真实场景的模拟，理解随机变量在金融、游戏等领域的实际应用
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- 金融风险管理 -->
                <div class="bg-dark-card rounded-xl p-6 border border-gray-800 card-hover">
                    <h3 class="text-xl font-future font-semibold mb-6 text-white flex items-center">
                        <i class="fa fa-chart-line text-neon-orange mr-3"></i>
                        金融风险管理：投资组合模拟
                    </h3>

                    <!-- 重新组织为左右布局 -->
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                        <!-- 左侧：参数设置 -->
                        <div>
                            <p class="text-gray-300 mb-4">
                                假设您有一个投资组合，包含股票A和股票B。每只股票的日收益率都服从正态分布，我们来模拟投资组合的风险。
                            </p>

                            <div class="bg-dark-bg rounded-lg p-4 mb-4">
                                <h4 class="text-gray-200 mb-3 font-semibold">投资组合参数设置</h4>
                                
                                <div class="grid grid-cols-1 gap-4 mb-4">
                                    <div>
                                        <label class="block text-gray-300 mb-1">股票A权重: <span id="stock-a-weight-value">60</span>%</label>
                                        <input type="range" id="stock-a-weight" min="0" max="100" step="5" value="60" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-orange">
                                    </div>
                                    <div>
                                        <label class="block text-gray-300 mb-1">股票B权重: <span id="stock-b-weight-value">40</span>%</label>
                                        <input type="range" id="stock-b-weight" min="0" max="100" step="5" value="40" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-orange">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 gap-4 mb-4">
                                    <div>
                                        <label class="block text-gray-300 mb-1">股票A期望收益率: <span id="stock-a-return-value">0.08</span>%</label>
                                        <input type="range" id="stock-a-return" min="-0.5" max="0.5" step="0.01" value="0.08" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-orange">
                                    </div>
                                    <div>
                                        <label class="block text-gray-300 mb-1">股票A波动率: <span id="stock-a-volatility-value">1.5</span>%</label>
                                        <input type="range" id="stock-a-volatility" min="0.5" max="5" step="0.1" value="1.5" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-orange">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 gap-4 mb-4">
                                    <div>
                                        <label class="block text-gray-300 mb-1">股票B期望收益率: <span id="stock-b-return-value">0.12</span>%</label>
                                        <input type="range" id="stock-b-return" min="-0.5" max="0.5" step="0.01" value="0.12" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-orange">
                                    </div>
                                    <div>
                                        <label class="block text-gray-300 mb-1">股票B波动率: <span id="stock-b-volatility-value">2.0</span>%</label>
                                        <input type="range" id="stock-b-volatility" min="0.5" max="5" step="0.1" value="2.0" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-orange">
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-gray-300 mb-1">相关系数: <span id="correlation-value">0.3</span></label>
                                    <input type="range" id="correlation" min="-0.9" max="0.9" step="0.1" value="0.3" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-neon-orange">
                                </div>
                                
                                <div class="grid grid-cols-1 gap-2 text-center mb-4">
                                    <div class="bg-gray-800 p-3 rounded-lg">
                                        <div class="text-sm text-gray-400">组合期望收益</div>
                                        <div id="portfolio-expected-return" class="text-lg font-semibold text-neon-orange">0.096%</div>
                                    </div>
                                    <div class="bg-gray-800 p-3 rounded-lg">
                                        <div class="text-sm text-gray-400">组合风险(σ)</div>
                                        <div id="portfolio-risk" class="text-lg font-semibold text-neon-orange">1.65%</div>
                                    </div>
                                    <div class="bg-gray-800 p-3 rounded-lg">
                                        <div class="text-sm text-gray-400">VaR(95%)</div>
                                        <div id="portfolio-var" class="text-lg font-semibold text-neon-red">-2.62%</div>
                                    </div>
                                </div>
                                
                                <div class="flex flex-col space-y-2">
                                    <button id="simulate-portfolio-btn" class="px-6 py-2 bg-neon-orange text-dark-bg font-bold rounded-md hover:bg-neon-orange/80 transition-all duration-300 btn-hover">
                                        模拟1000次投资结果 <i class="fa fa-play ml-2"></i>
                                    </button>
                                    <button id="simulate-portfolio-10k-btn" class="px-6 py-2 bg-neon-yellow text-dark-bg font-bold rounded-md hover:bg-neon-yellow/80 transition-all duration-300 btn-hover">
                                        模拟10000次 <i class="fa fa-rocket ml-2"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 右侧：投资结果展示 -->
                        <div>
                            <div class="h-64 mb-4">
                                <canvas id="portfolio-chart"></canvas>
                            </div>
                            
                            <div class="bg-dark-bg rounded-lg p-4">
                                <h5 class="text-lg font-semibold mb-3 text-gray-200">模拟结果统计</h5>
                                <div class="grid grid-cols-2 gap-4 text-center">
                                    <div class="bg-gray-800 p-3 rounded-lg">
                                        <div class="text-sm text-gray-400">平均收益</div>
                                        <div id="avg-return" class="text-xl font-semibold text-neon-green">0</div>
                                    </div>
                                    <div class="bg-gray-800 p-3 rounded-lg">
                                        <div class="text-sm text-gray-400">最小价值</div>
                                        <div id="min-value" class="text-xl font-semibold text-neon-blue">0</div>
                                    </div>
                                    <div class="bg-gray-800 p-3 rounded-lg">
                                        <div class="text-sm text-gray-400">最大价值</div>
                                        <div id="max-value" class="text-xl font-semibold text-neon-purple">0</div>
                                    </div>
                                    <div class="bg-gray-800 p-3 rounded-lg">
                                        <div class="text-sm text-gray-400">亏损概率</div>
                                        <div id="loss-probability" class="text-xl font-semibold text-neon-red">0%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 游戏设计应用 -->
                <div class="bg-dark-card rounded-xl p-6 border border-gray-800 card-hover">
                    <h3 class="text-xl font-future font-semibold mb-6 text-white flex items-center">
                        <i class="fa fa-gamepad text-neon-pink mr-3"></i>
                        游戏设计：装备掉落系统
                    </h3>

                    <div class="mb-6">
                        <p class="text-gray-300 mb-4">
                            设计一个RPG游戏的装备掉落系统，不同稀有度的装备有不同的掉落概率，我们来分析玩家获得稀有装备的期望。
                        </p>

                        <div class="bg-dark-bg rounded-lg p-4 mb-4">
                            <h4 class="text-gray-200 mb-3 font-semibold">装备掉落概率设置</h4>
                            
                            <div class="space-y-3 mb-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-300">普通装备(白色)</span>
                                    <div class="flex items-center space-x-2">
                                        <input type="range" id="common-drop-rate" min="40" max="80" step="1" value="60" class="accent-gray-400">
                                        <span id="common-drop-rate-value" class="text-gray-400 w-12">60%</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-green-400">稀有装备(绿色)</span>
                                    <div class="flex items-center space-x-2">
                                        <input type="range" id="rare-drop-rate" min="15" max="35" step="1" value="25" class="accent-green-400">
                                        <span id="rare-drop-rate-value" class="text-green-400 w-12">25%</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-blue-400">史诗装备(蓝色)</span>
                                    <div class="flex items-center space-x-2">
                                        <input type="range" id="epic-drop-rate" min="5" max="20" step="1" value="12" class="accent-blue-400">
                                        <span id="epic-drop-rate-value" class="text-blue-400 w-12">12%</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-purple-400">传说装备(紫色)</span>
                                    <div class="flex items-center space-x-2">
                                        <input type="range" id="legendary-drop-rate" min="1" max="8" step="0.5" value="2.5" class="accent-purple-400">
                                        <span id="legendary-drop-rate-value" class="text-purple-400 w-12">2.5%</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-yellow-400">神话装备(金色)</span>
                                    <div class="flex items-center space-x-2">
                                        <input type="range" id="mythic-drop-rate" min="0.1" max="2" step="0.1" value="0.5" class="accent-yellow-400">
                                        <span id="mythic-drop-rate-value" class="text-yellow-400 w-12">0.5%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4 text-center mb-4">
                                <div class="bg-gray-800 p-3 rounded-lg">
                                    <div class="text-sm text-gray-400">获得传说装备期望次数</div>
                                    <div id="legendary-expected-tries" class="text-lg font-semibold text-purple-400">40次</div>
                                </div>
                                <div class="bg-gray-800 p-3 rounded-lg">
                                    <div class="text-sm text-gray-400">获得神话装备期望次数</div>
                                    <div id="mythic-expected-tries" class="text-lg font-semibold text-yellow-400">200次</div>
                                </div>
                            </div>
                            
                            <div class="flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4">
                                <button id="simulate-drops-btn" class="px-6 py-2 bg-neon-pink text-dark-bg font-bold rounded-md hover:bg-neon-pink/80 transition-all duration-300 btn-hover">
                                    模拟1000次掉落 <i class="fa fa-gift ml-2"></i>
                                </button>
                                <button id="simulate-drops-10k-btn" class="px-6 py-2 bg-neon-purple text-dark-bg font-bold rounded-md hover:bg-neon-purple/80 transition-all duration-300 btn-hover">
                                    模拟10000次 <i class="fa fa-star ml-2"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="h-64 mb-4">
                        <canvas id="drops-chart"></canvas>
                    </div>
                    
                    <div class="bg-dark-bg rounded-lg p-4">
                        <h5 class="text-lg font-semibold mb-3 text-gray-200">掉落统计</h5>
                        <div class="grid grid-cols-3 gap-2 text-center text-sm">
                            <div class="bg-gray-800 p-2 rounded">
                                <div class="text-gray-400">普通</div>
                                <div id="common-drops" class="font-semibold text-gray-400">0</div>
                            </div>
                            <div class="bg-gray-800 p-2 rounded">
                                <div class="text-green-400">稀有</div>
                                <div id="rare-drops" class="font-semibold text-green-400">0</div>
                            </div>
                            <div class="bg-gray-800 p-2 rounded">
                                <div class="text-blue-400">史诗</div>
                                <div id="epic-drops" class="font-semibold text-blue-400">0</div>
                            </div>
                            <div class="bg-gray-800 p-2 rounded">
                                <div class="text-purple-400">传说</div>
                                <div id="legendary-drops" class="font-semibold text-purple-400">0</div>
                            </div>
                            <div class="bg-gray-800 p-2 rounded">
                                <div class="text-yellow-400">神话</div>
                                <div id="mythic-drops" class="font-semibold text-yellow-400">0</div>
                            </div>
                            <div class="bg-gray-800 p-2 rounded">
                                <div class="text-gray-400">总计</div>
                                <div id="total-drops" class="font-semibold text-white">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 章节练习部分 -->
    <section id="chapter-exercises" class="py-20 relative bg-gradient-to-b from-dark-bg to-dark-card/50">
        <div class="absolute inset-0 bg-grid opacity-10"></div>
        <div class="container mx-auto px-4 relative z-10">
            <div class="text-center mb-16">
                <h2 class="text-[clamp(1.5rem,4vw,3rem)] font-future font-bold mb-4">
                    <span class="text-neon-yellow">章节练习</span> - 巩固理解
                </h2>
                <p class="text-gray-400 max-w-3xl mx-auto text-lg">
                    通过交互式练习题，检验您对随机变量概念的理解和掌握程度
                </p>
            </div>

            <div class="space-y-8">
                <!-- 练习题1 -->
                <div class="bg-dark-card rounded-xl p-6 border border-gray-800 card-hover">
                    <h3 class="text-xl font-future font-semibold mb-4 text-white flex items-center">
                        <i class="fa fa-question-circle text-neon-yellow mr-3"></i>
                        练习题1：随机变量的定义
                    </h3>
                    
                    <div class="mb-6">
                        <p class="text-gray-300 mb-4">
                            设随机试验为"掷一枚硬币3次"，样本空间为Ω = {HHH, HHT, HTH, HTT, THH, THT, TTH, TTT}。
                            定义随机变量X为"3次投掷中正面朝上的次数"，请选择X的所有可能取值：
                        </p>
                        
                        <div class="space-y-2">
                            <label class="flex items-center text-gray-300 cursor-pointer hover:text-white transition-colors">
                                <input type="checkbox" class="mr-3 accent-neon-yellow" data-answer="correct" data-question="1">
                                A. X = 0（如TTT）
                            </label>
                            <label class="flex items-center text-gray-300 cursor-pointer hover:text-white transition-colors">
                                <input type="checkbox" class="mr-3 accent-neon-yellow" data-answer="correct" data-question="1">
                                B. X = 1（如HTT, THT, TTH）
                            </label>
                            <label class="flex items-center text-gray-300 cursor-pointer hover:text-white transition-colors">
                                <input type="checkbox" class="mr-3 accent-neon-yellow" data-answer="correct" data-question="1">
                                C. X = 2（如HHT, HTH, THH）
                            </label>
                            <label class="flex items-center text-gray-300 cursor-pointer hover:text-white transition-colors">
                                <input type="checkbox" class="mr-3 accent-neon-yellow" data-answer="correct" data-question="1">
                                D. X = 3（如HHH）
                            </label>
                            <label class="flex items-center text-gray-300 cursor-pointer hover:text-white transition-colors">
                                <input type="checkbox" class="mr-3 accent-neon-yellow" data-answer="wrong" data-question="1">
                                E. X = 4
                            </label>
                        </div>
                        
                        <div class="mt-4 flex space-x-4">
                            <button onclick="checkAnswer(1)" class="px-6 py-2 bg-neon-yellow text-dark-bg font-bold rounded-md hover:bg-neon-yellow/80 transition-all duration-300 btn-hover">
                                检查答案 <i class="fa fa-check ml-2"></i>
                            </button>
                            <button onclick="resetQuestion(1)" class="px-6 py-2 bg-gray-600 text-white font-bold rounded-md hover:bg-gray-500 transition-all duration-300 btn-hover">
                                重置 <i class="fa fa-refresh ml-2"></i>
                            </button>
                        </div>
                        
                        <div id="answer-1" class="mt-4 p-4 rounded-lg hidden">
                            <!-- 答案反馈将在这里显示 -->
                        </div>
                    </div>
                </div>

                <!-- 练习题2 -->
                <div class="bg-dark-card rounded-xl p-6 border border-gray-800 card-hover">
                    <h3 class="text-xl font-future font-semibold mb-4 text-white flex items-center">
                        <i class="fa fa-question-circle text-neon-yellow mr-3"></i>
                        练习题2：期望值计算
                    </h3>
                    
                    <div class="mb-6">
                        <p class="text-gray-300 mb-4">
                            某彩票的中奖规则如下：以概率0.7不中奖（获得0元），以概率0.2中小奖（获得10元），以概率0.1中大奖（获得100元）。
                            请计算购买一张彩票的期望收益：
                        </p>
                        
                        <div class="bg-gray-900 rounded-lg p-4 mb-4 border-l-4 border-neon-yellow">
                            <h5 class="text-neon-yellow font-semibold mb-2">期望值计算公式</h5>
                            <div class="text-center text-white text-lg mb-2">
                                $$E[X] = \sum_{i} x_i \cdot P(X = x_i)$$
                            </div>
                            <div class="text-center text-white text-sm">
                                $$E[X] = 0 \times 0.7 + 10 \times 0.2 + 100 \times 0.1 = 12$$
                            </div>
                        </div>
                        
                        <div class="space-y-2">
                            <label class="flex items-center text-gray-300 cursor-pointer hover:text-white transition-colors">
                                <input type="radio" name="question2" class="mr-3 accent-neon-yellow" data-answer="wrong" data-question="2">
                                A. 0元
                            </label>
                            <label class="flex items-center text-gray-300 cursor-pointer hover:text-white transition-colors">
                                <input type="radio" name="question2" class="mr-3 accent-neon-yellow" data-answer="wrong" data-question="2">
                                B. 10元
                            </label>
                            <label class="flex items-center text-gray-300 cursor-pointer hover:text-white transition-colors">
                                <input type="radio" name="question2" class="mr-3 accent-neon-yellow" data-answer="correct" data-question="2">
                                C. 12元
                            </label>
                            <label class="flex items-center text-gray-300 cursor-pointer hover:text-white transition-colors">
                                <input type="radio" name="question2" class="mr-3 accent-neon-yellow" data-answer="wrong" data-question="2">
                                D. 100元
                            </label>
                        </div>
                        
                        <div class="mt-4 flex space-x-4">
                            <button onclick="checkAnswer(2)" class="px-6 py-2 bg-neon-yellow text-dark-bg font-bold rounded-md hover:bg-neon-yellow/80 transition-all duration-300 btn-hover">
                                检查答案 <i class="fa fa-check ml-2"></i>
                            </button>
                            <button onclick="resetQuestion(2)" class="px-6 py-2 bg-gray-600 text-white font-bold rounded-md hover:bg-gray-500 transition-all duration-300 btn-hover">
                                重置 <i class="fa fa-refresh ml-2"></i>
                            </button>
                        </div>
                        
                        <div id="answer-2" class="mt-4 p-4 rounded-lg hidden">
                            <!-- 答案反馈将在这里显示 -->
                        </div>
                    </div>
                </div>

                <!-- 练习题3 -->
                <div class="bg-dark-card rounded-xl p-6 border border-gray-800 card-hover">
                    <h3 class="text-xl font-future font-semibold mb-4 text-white flex items-center">
                        <i class="fa fa-question-circle text-neon-yellow mr-3"></i>
                        练习题3：方差的意义
                    </h3>
                    
                    <div class="mb-6">
                        <p class="text-gray-300 mb-4">
                            有两个随机变量X和Y，它们的期望值都是10，但X的方差是4，Y的方差是16。
                            关于这两个随机变量，下列说法正确的是：
                        </p>
                        
                        <div class="space-y-2">
                            <label class="flex items-center text-gray-300 cursor-pointer hover:text-white transition-colors">
                                <input type="radio" name="question3" class="mr-3 accent-neon-yellow" data-answer="wrong" data-question="3">
                                A. X和Y的取值完全相同
                            </label>
                            <label class="flex items-center text-gray-300 cursor-pointer hover:text-white transition-colors">
                                <input type="radio" name="question3" class="mr-3 accent-neon-yellow" data-answer="correct" data-question="3">
                                B. X的取值比Y更集中在期望值附近
                            </label>
                            <label class="flex items-center text-gray-300 cursor-pointer hover:text-white transition-colors">
                                <input type="radio" name="question3" class="mr-3 accent-neon-yellow" data-answer="wrong" data-question="3">
                                C. Y的取值比X更集中在期望值附近
                            </label>
                            <label class="flex items-center text-gray-300 cursor-pointer hover:text-white transition-colors">
                                <input type="radio" name="question3" class="mr-3 accent-neon-yellow" data-answer="wrong" data-question="3">
                                D. 无法比较两者的离散程度
                            </label>
                        </div>
                        
                        <div class="mt-4 flex space-x-4">
                            <button onclick="checkAnswer(3)" class="px-6 py-2 bg-neon-yellow text-dark-bg font-bold rounded-md hover:bg-neon-yellow/80 transition-all duration-300 btn-hover">
                                检查答案 <i class="fa fa-check ml-2"></i>
                            </button>
                            <button onclick="resetQuestion(3)" class="px-6 py-2 bg-gray-600 text-white font-bold rounded-md hover:bg-gray-500 transition-all duration-300 btn-hover">
                                重置 <i class="fa fa-refresh ml-2"></i>
                            </button>
                        </div>
                        
                        <div id="answer-3" class="mt-4 p-4 rounded-lg hidden">
                            <!-- 答案反馈将在这里显示 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

// ... existing code ...
    <!-- 页脚 -->
    <footer class="bg-dark-card py-12 border-t border-gray-800">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <h3 class="text-2xl font-future font-bold mb-4">
                    <span class="text-neon-blue">概率统计</span><span class="ml-2">可视化教学平台</span>
                </h3>
                <p class="text-gray-400 mb-6">通过交互式可视化，让抽象的数学概念变得生动有趣</p>
                <div class="flex justify-center space-x-6">
                    <a href="#" class="text-gray-400 hover:text-neon-blue transition-colors duration-300">
                        <i class="fab fa-github text-2xl"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-neon-purple transition-colors duration-300">
                        <i class="fab fa-twitter text-2xl"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-neon-green transition-colors duration-300">
                        <i class="fab fa-linkedin text-2xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // 全局变量
        let discreteChart = null;
        let continuousChart = null;
        let rvFeaturesChart = null;
        let wheelHistogramChart = null;
        let mappingChart = null;
        let portfolioChart = null;
        let dropRateChart = null;
        
        let wheelResults = [];
        let wheelSpinCount = 0;
        let isSpinning = false;
        
        // 添加映射函数演示相关变量和统计数据
        let mappingStats = {
            coin: { total: 0, sum: 0, values: [] },
            dice: { total: 0, sum: 0, values: [] },
            card: { total: 0, sum: 0, values: [] }
        };
        let currentExperiment = 'coin';
        
        // 粒子背景创建函数
        function createParticles() {
            const container = document.getElementById('particles-container');
            const colors = ['#00f3ff', '#bf00ff', '#00ff66', '#ff00ff', '#ff6b35', '#ffd300'];
            
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.width = Math.random() * 4 + 2 + 'px';
                particle.style.height = particle.style.width;
                particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                particle.style.animationDelay = Math.random() * 15 + 's';
                container.appendChild(particle);
            }
        }
        
        // 离散型随机变量图表初始化
        function initDiscreteRvChart() {
            const ctx = document.getElementById('discrete-rv-chart');
            if (!ctx) return;
            
            discreteChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],
                    datasets: [{
                        label: '理论概率',
                        data: [1/36, 2/36, 3/36, 4/36, 5/36, 6/36, 5/36, 4/36, 3/36, 2/36, 1/36],
                        backgroundColor: 'rgba(0, 243, 255, 0.6)',
                        borderColor: '#00f3ff',
                        borderWidth: 2
                    }, {
                        label: '实验频率',
                        data: new Array(11).fill(0),
                        backgroundColor: 'rgba(191, 0, 255, 0.6)',
                        borderColor: '#bf00ff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }
        
        // 掷骰子函数
        function rollTwoDice() {
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const sum = dice1 + dice2;
            
            // 显示骰子结果
            const dice1Element = document.getElementById('dice1-result');
            const dice2Element = document.getElementById('dice2-result');
            const diceSumElement = document.getElementById('dice-sum');
            
            if (dice1Element) {
                dice1Element.textContent = dice1;
            }
            if (dice2Element) {
                dice2Element.textContent = dice2;
            }
            if (diceSumElement) {
                diceSumElement.textContent = sum;
            }
            
            // 添加动画效果
            if (dice1Element) {
                dice1Element.classList.add('animate-pulse');
                setTimeout(() => {
                    dice1Element.classList.remove('animate-pulse');
                }, 1000);
            }
            
            if (dice2Element) {
                dice2Element.classList.add('animate-pulse');
                setTimeout(() => {
                    dice2Element.classList.remove('animate-pulse');
                }, 1000);
            }
            
            return sum;
        }
        
        // 多次掷骰子
        function rollMultipleTimes(times) {
            const results = new Array(11).fill(0);
            let totalRolls = parseInt(document.getElementById('total-rolls')?.textContent || '0');
            
            for (let i = 0; i < times; i++) {
                const sum = rollTwoDice();
                results[sum - 2]++;
                totalRolls++;
            }
            
            // 更新总次数显示
            const totalRollsElement = document.getElementById('total-rolls');
            if (totalRollsElement) {
                totalRollsElement.textContent = totalRolls;
            }
            
            // 累积更新图表数据
            if (discreteChart) {
                for (let i = 0; i < results.length; i++) {
                    if (!discreteChart.data.datasets[1].data[i]) {
                        discreteChart.data.datasets[1].data[i] = 0;
                    }
                    discreteChart.data.datasets[1].data[i] += results[i];
                }
                
                // 转换为频率
                const frequencies = discreteChart.data.datasets[1].data.map(count => count / totalRolls);
                discreteChart.data.datasets[1].data = frequencies;
                discreteChart.update();
            }
        }
        
        // 连续型随机变量图表初始化
        function initContinuousRvChart() {
            const ctx = document.getElementById('continuous-rv-chart');
            if (!ctx) return;
            
            continuousChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: '样本直方图',
                        data: [],
                        backgroundColor: 'rgba(0, 255, 102, 0.6)',
                        borderColor: '#00ff66',
                        borderWidth: 2
                    }, {
                        label: '理论密度',
                        data: [],
                        type: 'line',
                        backgroundColor: 'rgba(255, 0, 255, 0.2)',
                        borderColor: '#ff00ff',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }
        
        // 生成连续型随机变量样本
        function generateContinuousSamples(sampleSize = 1000) {
            try {
                const distributionElement = document.getElementById('continuous-distribution');
                if (!distributionElement) {
                    console.error('分布选择元素未找到');
                    return;
                }
                
                const distribution = distributionElement.value;
                const samples = [];
                
                for (let i = 0; i < sampleSize; i++) {
                    let sample;
                    switch (distribution) {
                        case 'normal':
                            const muElement = document.getElementById('normal-mu');
                            const sigmaElement = document.getElementById('normal-sigma');
                            const mu = muElement ? parseFloat(muElement.value) || 0 : 0;
                            const sigma = sigmaElement ? parseFloat(sigmaElement.value) || 1 : 1;
                            sample = normalRandom(mu, sigma);
                            break;
                        case 'uniform':
                            const aElement = document.getElementById('uniform-a');
                            const bElement = document.getElementById('uniform-b');
                            const a = aElement ? parseFloat(aElement.value) || 0 : 0;
                            const b = bElement ? parseFloat(bElement.value) || 1 : 1;
                            sample = Math.random() * (b - a) + a;
                            break;
                        case 'exponential':
                            const lambdaElement = document.getElementById('exponential-lambda');
                            const lambda = lambdaElement ? parseFloat(lambdaElement.value) || 1 : 1;
                            sample = -Math.log(Math.random()) / lambda;
                            break;
                        default:
                            sample = Math.random();
                    }
                    samples.push(sample);
                }
                
                // 更新图表
                if (typeof continuousChart !== 'undefined' && continuousChart) {
                    updateContinuousChart(samples, distribution);
                }
                
                console.log(`生成了 ${sampleSize} 个 ${distribution} 分布样本`);
            } catch (error) {
                console.error('样本生成错误:', error);
            }
        }
        
        // 辅助函数：生成正态分布随机数
        function normalRandom(mu = 0, sigma = 1) {
            let u = 0, v = 0;
            while(u === 0) u = Math.random();
            while(v === 0) v = Math.random();
            const z = Math.sqrt(-2 * Math.log(u)) * Math.cos(2 * Math.PI * v);
            return z * sigma + mu;
        }
        
        // 更新连续型随机变量图表
        function updateContinuousChart(samples, distribution) {
            try {
                // 创建直方图数据
                const bins = 20;
                const min = Math.min(...samples);
                const max = Math.max(...samples);
                const binWidth = (max - min) / bins;
                const histogram = new Array(bins).fill(0);
                const labels = [];
                
                for (let i = 0; i < bins; i++) {
                    labels.push((min + i * binWidth).toFixed(1));
                }
                
                samples.forEach(sample => {
                    const binIndex = Math.min(Math.floor((sample - min) / binWidth), bins - 1);
                    histogram[binIndex]++;
                });
                
                // 归一化
                const normalizedHistogram = histogram.map(count => count / (samples.length * binWidth));
                
                // 生成理论密度曲线
                const theoryData = [];
                for (let i = 0; i < bins; i++) {
                    const x = min + i * binWidth;
                    let density = 0;
                    
                    switch (distribution) {
                        case 'uniform':
                            const aElement = document.getElementById('uniform-a');
                            const bElement = document.getElementById('uniform-b');
                            const a = aElement ? parseFloat(aElement.value) || 0 : 0;
                            const b = bElement ? parseFloat(bElement.value) || 1 : 1;
                            density = (x >= a && x <= b) ? 1 / (b - a) : 0;
                            break;
                        case 'normal':
                            const muElement = document.getElementById('normal-mu');
                            const sigmaElement = document.getElementById('normal-sigma');
                            const mu = muElement ? parseFloat(muElement.value) || 0 : 0;
                            const sigma = sigmaElement ? parseFloat(sigmaElement.value) || 1 : 1;
                            density = (1 / (sigma * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((x - mu) / sigma, 2));
                            break;
                        case 'exponential':
                            const lambdaElement = document.getElementById('exponential-lambda');
                            const lambda = lambdaElement ? parseFloat(lambdaElement.value) || 1 : 1;
                            density = x >= 0 ? lambda * Math.exp(-lambda * x) : 0;
                            break;
                    }
                    theoryData.push(density);
                }
                
                // 更新图表
                if (continuousChart) {
                    continuousChart.data.labels = labels;
                    continuousChart.data.datasets[0].data = normalizedHistogram;
                    continuousChart.data.datasets[1].data = theoryData;
                    continuousChart.update();
                }
            } catch (error) {
                console.error('图表更新错误:', error);
            }
        }
        
        // 随机变量数字特征图表初始化
        function initRvFeaturesChart() {
            const ctx = document.getElementById('rv-features-chart');
            if (!ctx) return;
            
            rvFeaturesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: '概率密度函数',
                        data: [],
                        backgroundColor: 'rgba(255, 107, 53, 0.2)',
                        borderColor: '#ff6b35',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }
        
        // 更新随机变量数字特征
        function updateRvFeatures() {
            const distribution = document.getElementById('rv-distribution')?.value;
            if (!distribution) return;
            
            let expectation, variance, labels = [], data = [];
            
            // 生成x轴数据
            const xMin = parseFloat(document.getElementById('rv-x-axis-min')?.value || -5);
            const xMax = parseFloat(document.getElementById('rv-x-axis-max')?.value || 15);
            const step = (xMax - xMin) / 100;
            
            for (let x = xMin; x <= xMax; x += step) {
                labels.push(x.toFixed(2));
                let y = 0;
                
                switch (distribution) {
                    case 'normal':
                        const mu = parseFloat(document.getElementById('rv-normal-mean')?.value || 0);
                        const sigma = parseFloat(document.getElementById('rv-normal-std')?.value || 1);
                        y = (1 / (sigma * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((x - mu) / sigma, 2));
                        expectation = mu;
                        variance = sigma * sigma;
                        break;
                    case 'uniform':
                        const a = parseFloat(document.getElementById('rv-uniform-min')?.value || -2);
                        const b = parseFloat(document.getElementById('rv-uniform-max')?.value || 2);
                        y = (x >= a && x <= b) ? 1 / (b - a) : 0;
                        expectation = (a + b) / 2;
                        variance = Math.pow(b - a, 2) / 12;
                        break;
                    case 'exponential':
                        const lambda = parseFloat(document.getElementById('rv-exponential-lambda')?.value || 1);
                        y = x >= 0 ? lambda * Math.exp(-lambda * x) : 0;
                        expectation = 1 / lambda;
                        variance = 1 / (lambda * lambda);
                        break;
                    case 'binomial':
                        const n = parseInt(document.getElementById('rv-binomial-n')?.value || 10);
                        const p = parseFloat(document.getElementById('rv-binomial-p')?.value || 0.5);
                        const k = Math.round(x);
                        if (k >= 0 && k <= n && k === x) {
                            y = binomialPmf(n, k, p);
                        }
                        expectation = n * p;
                        variance = n * p * (1 - p);
                        break;
                }
                data.push(y);
            }
            
            // 更新显示的数字特征
            if (document.getElementById('rv-expectation')) {
                document.getElementById('rv-expectation').textContent = expectation.toFixed(3);
            }
            if (document.getElementById('rv-variance')) {
                document.getElementById('rv-variance').textContent = variance.toFixed(3);
            }
            if (document.getElementById('rv-std')) {
                document.getElementById('rv-std').textContent = Math.sqrt(variance).toFixed(3);
            }
            
            // 更新图表
            if (rvFeaturesChart) {
                rvFeaturesChart.data.labels = labels;
                rvFeaturesChart.data.datasets[0].data = data;
                rvFeaturesChart.update();
            }
        }
        
        // 二项分布概率质量函数
        function binomialPmf(n, k, p) {
            function factorial(num) {
                if (num <= 1) return 1;
                return num * factorial(num - 1);
            }
            
            function combination(n, k) {
                return factorial(n) / (factorial(k) * factorial(n - k));
            }
            
            return combination(n, k) * Math.pow(p, k) * Math.pow(1 - p, n - k);
        }
        
        // 幸运大转盘模拟
        function spinWheel() {
            try {
                if (isSpinning) return;
                
                isSpinning = true;
                
                // 获取概率和奖金设置
                const prob1Element = document.getElementById('prob1');
                const prob2Element = document.getElementById('prob2');
                const prob3Element = document.getElementById('prob3');
                const reward1Element = document.getElementById('reward1');
                const reward2Element = document.getElementById('reward2');
                const reward3Element = document.getElementById('reward3');
                
                if (!prob1Element || !prob2Element || !prob3Element || 
                    !reward1Element || !reward2Element || !reward3Element) {
                    console.error('转盘元素未找到');
                    isSpinning = false;
                    return;
                }
                
                const prob1 = parseFloat(prob1Element.value) / 100;
                const prob2 = parseFloat(prob2Element.value) / 100;
                const prob3 = parseFloat(prob3Element.value) / 100;
                
                const reward1 = parseFloat(reward1Element.value);
                const reward2 = parseFloat(reward2Element.value);
                const reward3 = parseFloat(reward3Element.value);
                
                // 确保概率总和为1
                const totalProb = prob1 + prob2 + prob3;
                const normalizedProb1 = prob1 / totalProb;
                const normalizedProb2 = prob2 / totalProb;
                const normalizedProb3 = prob3 / totalProb;
                
                // 生成随机结果
                const random = Math.random();
                let result;
                
                if (random < normalizedProb1) {
                    result = reward1;
                } else if (random < normalizedProb1 + normalizedProb2) {
                    result = reward2;
                } else {
                    result = reward3;
                }
                
                // 记录结果
                wheelResults.push(result);
                wheelSpinCount++;
                
                // 更新显示
                const wheelResultElement = document.getElementById('wheel-result');
                const wheelCountElement = document.getElementById('wheel-count');
                
                if (wheelResultElement) {
                    wheelResultElement.textContent = result;
                }
                if (wheelCountElement) {
                    wheelCountElement.textContent = wheelSpinCount;
                }
                
                // 更新统计信息
                updateWheelStats();
                
                // 更新直方图
                updateWheelHistogram();
                
                setTimeout(() => {
                    isSpinning = false;
                }, 1000);
                
                console.log(`转盘结果: ${result}`);
            } catch (error) {
                console.error('转盘功能错误:', error);
                isSpinning = false;
            }
        }
        
        // 多次转动转盘
        function spinMultipleTimes(times) {
            try {
                if (isSpinning) return;
                
                isSpinning = true;
                let completed = 0;
                
                // 获取概率和奖金设置
                const prob1Element = document.getElementById('prob1');
                const prob2Element = document.getElementById('prob2');
                const prob3Element = document.getElementById('prob3');
                const reward1Element = document.getElementById('reward1');
                const reward2Element = document.getElementById('reward2');
                const reward3Element = document.getElementById('reward3');
                
                if (!prob1Element || !prob2Element || !prob3Element || 
                    !reward1Element || !reward2Element || !reward3Element) {
                    console.error('转盘元素未找到');
                    isSpinning = false;
                    return;
                }
                
                const prob1 = parseFloat(prob1Element.value) / 100;
                const prob2 = parseFloat(prob2Element.value) / 100;
                const prob3 = parseFloat(prob3Element.value) / 100;
                
                const reward1 = parseFloat(reward1Element.value);
                const reward2 = parseFloat(reward2Element.value);
                const reward3 = parseFloat(reward3Element.value);
                
                // 确保概率总和为1
                const totalProb = prob1 + prob2 + prob3;
                const normalizedProb1 = prob1 / totalProb;
                const normalizedProb2 = prob2 / totalProb;
                const normalizedProb3 = prob3 / totalProb;
                
                // 批量生成结果
                for (let i = 0; i < times; i++) {
                    const random = Math.random();
                    let result;
                    
                    if (random < normalizedProb1) {
                        result = reward1;
                    } else if (random < normalizedProb1 + normalizedProb2) {
                        result = reward2;
                    } else {
                        result = reward3;
                    }
                    
                    wheelResults.push(result);
                    wheelSpinCount++;
                }
                
                // 更新显示（显示最后一个结果）
                const lastResult = wheelResults[wheelResults.length - 1];
                const wheelResultElement = document.getElementById('wheel-result');
                const wheelCountElement = document.getElementById('wheel-count');
                
                if (wheelResultElement) {
                    wheelResultElement.textContent = lastResult;
                }
                if (wheelCountElement) {
                    wheelCountElement.textContent = wheelSpinCount;
                }
                
                // 更新统计信息
                updateWheelStats();
                
                // 更新直方图
                updateWheelHistogram();
                
                isSpinning = false;
                
                console.log(`批量转盘完成: ${times}次`);
            } catch (error) {
                console.error('批量转盘错误:', error);
                isSpinning = false;
            }
        }
        
        // 更新转盘统计信息
        function updateWheelStats() {
            try {
                const prob1Element = document.getElementById('prob1');
                const prob2Element = document.getElementById('prob2');
                const prob3Element = document.getElementById('prob3');
                const reward1Element = document.getElementById('reward1');
                const reward2Element = document.getElementById('reward2');
                const reward3Element = document.getElementById('reward3');
                
                if (!prob1Element || !prob2Element || !prob3Element || 
                    !reward1Element || !reward2Element || !reward3Element) {
                    console.error('转盘统计元素未找到');
                    return;
                }
                
                const prob1 = parseFloat(prob1Element.value) / 100;
                const prob2 = parseFloat(prob2Element.value) / 100;
                const prob3 = parseFloat(prob3Element.value) / 100;
                
                const reward1 = parseFloat(reward1Element.value);
                const reward2 = parseFloat(reward2Element.value);
                const reward3 = parseFloat(reward3Element.value);
                
                // 归一化概率
                const total = prob1 + prob2 + prob3;
                const normalizedProb1 = prob1 / total;
                const normalizedProb2 = prob2 / total;
                const normalizedProb3 = prob3 / total;
                
                // 计算期望值
                const expectation = normalizedProb1 * reward1 + normalizedProb2 * reward2 + normalizedProb3 * reward3;
                
                // 计算方差
                const variance = normalizedProb1 * Math.pow(reward1 - expectation, 2) + 
                               normalizedProb2 * Math.pow(reward2 - expectation, 2) + 
                               normalizedProb3 * Math.pow(reward3 - expectation, 2);
                
                const expectationElement = document.getElementById('wheel-expectation');
                const varianceElement = document.getElementById('wheel-variance');
                
                if (expectationElement) {
                    expectationElement.textContent = expectation.toFixed(2) + '元';
                }
                if (varianceElement) {
                    varianceElement.textContent = variance.toFixed(2);
                }
            } catch (error) {
                console.error('转盘统计更新错误:', error);
            }
        }
        
        // 更新转盘直方图
        function updateWheelHistogram() {
            try {
                if (!wheelHistogramChart) {
                    const ctx = document.getElementById('wheel-histogram');
                    if (!ctx) {
                        console.error('转盘直方图画布未找到');
                        return;
                    }
                    
                    wheelHistogramChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: [],
                            datasets: [{
                                label: '频率',
                                data: [],
                                backgroundColor: 'rgba(0, 243, 255, 0.6)',
                                borderColor: '#00f3ff',
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    labels: { color: '#fff' }
                                }
                            },
                            scales: {
                                x: {
                                    ticks: { color: '#fff' },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                },
                                y: {
                                    ticks: { color: '#fff' },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                }
                            }
                        }
                    });
                }
                
                if (wheelResults.length === 0) {
                    return;
                }
                
                // 统计各结果的频率
                const resultCounts = {};
                wheelResults.forEach(result => {
                    resultCounts[result] = (resultCounts[result] || 0) + 1;
                });
                
                const labels = Object.keys(resultCounts).sort((a, b) => parseFloat(a) - parseFloat(b));
                const frequencies = labels.map(label => resultCounts[label] / wheelResults.length);
                
                wheelHistogramChart.data.labels = labels;
                wheelHistogramChart.data.datasets[0].data = frequencies;
                wheelHistogramChart.update();
            } catch (error) {
                console.error('转盘直方图更新错误:', error);
            }
        }
        
        // 随机变量映射演示初始化
        function initMappingDemo() {
            const ctx = document.getElementById('mapping-chart');
            if (!ctx) return;
            
            mappingChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: '样本空间',
                        data: [],
                        backgroundColor: 'rgba(0, 243, 255, 0.6)',
                        borderColor: '#00f3ff',
                        pointRadius: 8
                    }, {
                        label: '随机变量值',
                        data: [],
                        backgroundColor: 'rgba(191, 0, 255, 0.6)',
                        borderColor: '#bf00ff',
                        pointRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }
        
        // 实践应用相关函数
        function initPortfolioChart() {
            const ctx = document.getElementById('portfolio-chart');
            if (!ctx) return;
            
            portfolioChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: '投资组合价值',
                        data: [],
                        backgroundColor: 'rgba(0, 255, 102, 0.2)',
                        borderColor: '#00ff66',
                        borderWidth: 2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }
        
        function initDropRateChart() {
            const ctx = document.getElementById('drop-rate-chart');
            if (!ctx) return;
            
            dropRateChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['普通', '稀有', '史诗', '传说'],
                    datasets: [{
                        label: '理论概率',
                        data: [0.7, 0.2, 0.08, 0.02],
                        backgroundColor: 'rgba(255, 107, 53, 0.6)',
                        borderColor: '#ff6b35',
                        borderWidth: 2
                    }, {
                        label: '实际频率',
                        data: [0, 0, 0, 0],
                        backgroundColor: 'rgba(255, 211, 0, 0.6)',
                        borderColor: '#ffd300',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#fff' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }
        
        // 投资组合参数更新
        function updatePortfolioParams() {
            try {
                const stockAWeight = parseFloat(document.getElementById('stock-a-weight')?.value || 60);
                const stockBWeight = parseFloat(document.getElementById('stock-b-weight')?.value || 40);
                const stockAReturn = parseFloat(document.getElementById('stock-a-return')?.value || 0.08);
                const stockBReturn = parseFloat(document.getElementById('stock-b-return')?.value || 0.12);
                const stockAVolatility = parseFloat(document.getElementById('stock-a-volatility')?.value || 1.5);
                const stockBVolatility = parseFloat(document.getElementById('stock-b-volatility')?.value || 2.0);
                const correlation = parseFloat(document.getElementById('correlation')?.value || 0.3);
                
                // 更新显示值
                updateElementSafely('stock-a-weight-value', stockAWeight);
                updateElementSafely('stock-b-weight-value', stockBWeight);
                updateElementSafely('stock-a-return-value', stockAReturn.toFixed(2));
                updateElementSafely('stock-b-return-value', stockBReturn.toFixed(2));
                updateElementSafely('stock-a-volatility-value', stockAVolatility.toFixed(1));
                updateElementSafely('stock-b-volatility-value', stockBVolatility.toFixed(1));
                updateElementSafely('correlation-value', correlation.toFixed(1));
                
                // 计算投资组合指标
                const portfolioReturn = (stockAWeight/100) * stockAReturn + (stockBWeight/100) * stockBReturn;
                const portfolioVariance = Math.pow((stockAWeight/100) * (stockAVolatility/100), 2) + 
                                        Math.pow((stockBWeight/100) * (stockBVolatility/100), 2) + 
                                        2 * (stockAWeight/100) * (stockBWeight/100) * (stockAVolatility/100) * (stockBVolatility/100) * correlation;
                const portfolioRisk = Math.sqrt(portfolioVariance) * 100;
                const portfolioVaR = portfolioReturn - 1.645 * (portfolioRisk/100); // 95% VaR
                
                // 更新投资组合指标显示
                updateElementSafely('portfolio-expected-return', (portfolioReturn * 100).toFixed(3) + '%');
                updateElementSafely('portfolio-risk', portfolioRisk.toFixed(2) + '%');
                updateElementSafely('portfolio-var', (portfolioVaR * 100).toFixed(2) + '%');
                
            } catch (error) {
                console.error('更新投资组合参数时出错:', error);
            }
        }
        
        // 模拟投资组合
        function simulatePortfolio() {
            try {
                // 获取投资组合参数 - 使用正确的元素ID
                const stockAWeight = parseFloat(document.getElementById('stock-a-weight')?.value || 60) / 100;
                const stockBWeight = parseFloat(document.getElementById('stock-b-weight')?.value || 40) / 100;
                const stockAReturn = parseFloat(document.getElementById('stock-a-return')?.value || 0.08);
                const stockBReturn = parseFloat(document.getElementById('stock-b-return')?.value || 0.12);
                const stockAVolatility = parseFloat(document.getElementById('stock-a-volatility')?.value || 1.5) / 100;
                const stockBVolatility = parseFloat(document.getElementById('stock-b-volatility')?.value || 2.0) / 100;
                const correlation = parseFloat(document.getElementById('correlation')?.value || 0.3);
                
                const initialValue = 10000; // 初始投资金额
                const timeHorizon = 252; // 一年交易日
                const simulations = 1000; // 模拟次数
                
                // 计算投资组合期望收益和风险
                const portfolioReturn = stockAWeight * stockAReturn + stockBWeight * stockBReturn;
                const portfolioVariance = Math.pow(stockAWeight * stockAVolatility, 2) + 
                                        Math.pow(stockBWeight * stockBVolatility, 2) + 
                                        2 * stockAWeight * stockBWeight * stockAVolatility * stockBVolatility * correlation;
                const portfolioVolatility = Math.sqrt(portfolioVariance);
                
                const finalValues = [];
                
                // 蒙特卡洛模拟
                for (let sim = 0; sim < simulations; sim++) {
                    let currentValue = initialValue;
                    
                    for (let day = 1; day <= timeHorizon; day++) {
                        // 生成相关的随机数（Box-Muller变换）
                        const u1 = Math.random();
                        const u2 = Math.random();
                        const z1 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                        const z2 = Math.sqrt(-2 * Math.log(u1)) * Math.sin(2 * Math.PI * u2);
                        
                        // 计算相关随机数
                        const stockAShock = z1;
                        const stockBShock = correlation * z1 + Math.sqrt(1 - correlation * correlation) * z2;
                        
                        // 计算每日收益
                        const stockADailyReturn = stockAReturn / 252 + stockAVolatility / Math.sqrt(252) * stockAShock;
                        const stockBDailyReturn = stockBReturn / 252 + stockBVolatility / Math.sqrt(252) * stockBShock;
                        
                        // 投资组合日收益
                        const portfolioDailyReturn = stockAWeight * stockADailyReturn + stockBWeight * stockBDailyReturn;
                        currentValue *= (1 + portfolioDailyReturn);
                    }
                    
                    finalValues.push(currentValue);
                }
                
                // 计算统计结果
                const avgFinalValue = finalValues.reduce((sum, val) => sum + val, 0) / finalValues.length;
                const minValue = Math.min(...finalValues);
                const maxValue = Math.max(...finalValues);
                const lossProb = finalValues.filter(val => val < initialValue).length / finalValues.length;
                
                // 创建结果显示
                const results = {
                    平均最终价值: avgFinalValue.toLocaleString('zh-CN', {maximumFractionDigits: 0}),
                    最小值: minValue.toLocaleString('zh-CN', {maximumFractionDigits: 0}),
                    最大值: maxValue.toLocaleString('zh-CN', {maximumFractionDigits: 0}),
                    亏损概率: (lossProb * 100).toFixed(1) + '%'
                };
                
                console.log('投资组合模拟完成:', results);
                
                // 显示结果通知
                const message = `投资组合模拟完成！\n平均收益: ${results.平均最终价值}\n亏损概率: ${results.亏损概率}`;
                showNotification(message, 'success', 5000);
                
                // 安全更新显示元素
                updateElementSafely('avg-return', results.平均最终价值);
                updateElementSafely('min-value', results.最小值);
                updateElementSafely('max-value', results.最大值);
                updateElementSafely('loss-probability', results.亏损概率);
                
                // 更新图表（显示一条模拟路径）
                if (portfolioChart) {
                    const samplePath = [initialValue];
                    let currentValue = initialValue;
                    
                    for (let day = 1; day <= timeHorizon; day++) {
                        const u1 = Math.random();
                        const u2 = Math.random();
                        const z1 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                        const z2 = Math.sqrt(-2 * Math.log(u1)) * Math.sin(2 * Math.PI * u2);
                        
                        const stockAShock = z1;
                        const stockBShock = correlation * z1 + Math.sqrt(1 - correlation * correlation) * z2;
                        
                        const stockADailyReturn = stockAReturn / 252 + stockAVolatility / Math.sqrt(252) * stockAShock;
                        const stockBDailyReturn = stockBReturn / 252 + stockBVolatility / Math.sqrt(252) * stockBShock;
                        
                        const portfolioDailyReturn = stockAWeight * stockADailyReturn + stockBWeight * stockBDailyReturn;
                        currentValue *= (1 + portfolioDailyReturn);
                        samplePath.push(currentValue);
                    }
                    
                    const labels = Array.from({length: timeHorizon + 1}, (_, i) => `第${i}天`);
                    portfolioChart.data.labels = labels;
                    portfolioChart.data.datasets[0].data = samplePath;
                    portfolioChart.update();
                }
            } catch (error) {
                console.error('投资组合模拟错误:', error);
                showNotification('投资组合模拟出错: ' + error.message, 'error');
            }
        }
        
        // 装备掉落参数更新
        function updateDropRates() {
            try {
                const commonRate = parseFloat(document.getElementById('common-drop-rate')?.value || 60) / 100;
                const rareRate = parseFloat(document.getElementById('rare-drop-rate')?.value || 25) / 100;
                const epicRate = parseFloat(document.getElementById('epic-drop-rate')?.value || 12) / 100;
                const legendaryRate = parseFloat(document.getElementById('legendary-drop-rate')?.value || 2.5) / 100;
                const mythicRate = parseFloat(document.getElementById('mythic-drop-rate')?.value || 0.5) / 100;
                
                // 更新显示值
                const commonRateElement = document.getElementById('common-drop-rate-value');
                if (commonRateElement) {
                    commonRateElement.textContent = (commonRate * 100).toFixed(1) + '%';
                }
                
                const rareRateElement = document.getElementById('rare-drop-rate-value');
                if (rareRateElement) {
                    rareRateElement.textContent = (rareRate * 100).toFixed(1) + '%';
                }
                
                const epicRateElement = document.getElementById('epic-drop-rate-value');
                if (epicRateElement) {
                    epicRateElement.textContent = (epicRate * 100).toFixed(1) + '%';
                }
                
                const legendaryRateElement = document.getElementById('legendary-drop-rate-value');
                if (legendaryRateElement) {
                    legendaryRateElement.textContent = (legendaryRate * 100).toFixed(1) + '%';
                }
                
                const mythicRateElement = document.getElementById('mythic-drop-rate-value');
                if (mythicRateElement) {
                    mythicRateElement.textContent = (mythicRate * 100).toFixed(1) + '%';
                }
                
                // 更新期望次数
                const legendaryExpected = document.getElementById('legendary-expected-tries');
                if (legendaryExpected) {
                    legendaryExpected.textContent = Math.round(1 / legendaryRate) + '次';
                }
                
                const mythicExpected = document.getElementById('mythic-expected-tries');
                if (mythicExpected) {
                    mythicExpected.textContent = Math.round(1 / mythicRate) + '次';
                }
                
                console.log('装备掉落参数更新成功');
            } catch (error) {
                console.error('更新装备掉落参数时出错:', error);
            }
        }
        
        // 模拟装备掉落
        function simulateDrops() {
            try {
                const simulations = parseInt(document.getElementById('drop-simulations')?.value) || 1000;
                const dropCounts = [0, 0, 0, 0]; // [common, rare, epic, legendary]
                
                for (let i = 0; i < simulations; i++) {
                    const rand = Math.random();
                    if (rand < 0.5) {
                        dropCounts[0]++; // common
                    } else if (rand < 0.8) {
                        dropCounts[1]++; // rare
                    } else if (rand < 0.95) {
                        dropCounts[2]++; // epic
                    } else {
                        dropCounts[3]++; // legendary
                    }
                }
                
                const frequencies = dropCounts.map(count => count / simulations);
                const results = {
                    普通: dropCounts[0],
                    稀有: dropCounts[1],
                    史诗: dropCounts[2],
                    传说: dropCounts[3],
                    频率: frequencies.map(f => (f * 100).toFixed(1) + '%')
                };
                
                console.log('装备掉落模拟完成:', results);
                
                // 显示结果通知
                const message = `装备掉落模拟完成！\n普通: ${results.普通} (${results.频率[0]})\n稀有: ${results.稀有} (${results.频率[1]})\n史诗: ${results.史诗} (${results.频率[2]})\n传说: ${results.传说} (${results.频率[3]})`;
                showNotification(message, 'success', 6000);
                
                // 安全更新显示元素
                updateElementSafely('common-drops', dropCounts[0]);
                updateElementSafely('rare-drops', dropCounts[1]);
                updateElementSafely('epic-drops', dropCounts[2]);
                updateElementSafely('legendary-drops', dropCounts[3]);
                
                // 更新图表
                if (dropRateChart) {
                    dropRateChart.data.datasets[1].data = frequencies;
                    dropRateChart.update();
                }
            } catch (error) {
                console.error('装备掉落模拟错误:', error);
                showNotification('装备掉落模拟出错: ' + error.message, 'error');
            }
        }
        
        // 练习题答案检查
        function checkAnswer(questionNum) {
            const answerDiv = document.getElementById(`answer-${questionNum}`);
            
            if (questionNum === 1) {
                // 处理练习题1的checkbox多选
                const checkboxes = document.querySelectorAll(`input[data-question="${questionNum}"]`);
                const selectedAnswers = Array.from(checkboxes).filter(cb => cb.checked);
                
                if (selectedAnswers.length === 0) {
                    alert('请先选择一个或多个答案！');
                    return;
                }
                
                // 检查是否所有正确答案都被选中，且没有选中错误答案
                const correctAnswers = Array.from(checkboxes).filter(cb => cb.dataset.answer === 'correct');
                const wrongAnswers = Array.from(checkboxes).filter(cb => cb.dataset.answer === 'wrong');
                
                const selectedCorrect = selectedAnswers.filter(cb => cb.dataset.answer === 'correct');
                const selectedWrong = selectedAnswers.filter(cb => cb.dataset.answer === 'wrong');
                
                const isCorrect = selectedCorrect.length === correctAnswers.length && selectedWrong.length === 0;
                
                answerDiv.classList.remove('hidden', 'answer-correct', 'answer-incorrect');
                
                if (isCorrect) {
                    answerDiv.classList.add('answer-correct');
                    answerDiv.innerHTML = `
                        <div class="flex items-center mb-2">
                            <i class="fa fa-check-circle text-neon-green mr-2"></i>
                            <span class="text-neon-green font-bold">回答正确！</span>
                        </div>
                        <p class="text-gray-300">${getCorrectExplanation(questionNum)}</p>
                    `;
                } else {
                    answerDiv.classList.add('answer-incorrect');
                    let feedback = '回答错误。';
                    if (selectedCorrect.length < correctAnswers.length) {
                        feedback += ' 还有正确答案未选中。';
                    }
                    if (selectedWrong.length > 0) {
                        feedback += ' 选中了错误答案。';
                    }
                    answerDiv.innerHTML = `
                        <div class="flex items-center mb-2">
                            <i class="fa fa-times-circle text-red-400 mr-2"></i>
                            <span class="text-red-400 font-bold">${feedback}</span>
                        </div>
                        <p class="text-gray-300">${getCorrectExplanation(questionNum)}</p>
                    `;
                }
            } else {
                // 处理其他题目的radio单选
                const selectedAnswer = document.querySelector(`input[name="question${questionNum}"]:checked`);
                
                if (!selectedAnswer) {
                    alert('请先选择一个答案！');
                    return;
                }
                
                const isCorrect = selectedAnswer.dataset.answer === 'correct';
                answerDiv.classList.remove('hidden', 'answer-correct', 'answer-incorrect');
                
                if (isCorrect) {
                    answerDiv.classList.add('answer-correct');
                    answerDiv.innerHTML = `
                        <div class="flex items-center mb-2">
                            <i class="fa fa-check-circle text-neon-green mr-2"></i>
                            <span class="text-neon-green font-bold">回答正确！</span>
                        </div>
                        <p class="text-gray-300">${getCorrectExplanation(questionNum)}</p>
                    `;
                } else {
                    answerDiv.classList.add('answer-incorrect');
                    answerDiv.innerHTML = `
                        <div class="flex items-center mb-2">
                            <i class="fa fa-times-circle text-red-400 mr-2"></i>
                            <span class="text-red-400 font-bold">回答错误</span>
                        </div>
                        <p class="text-gray-300">${getCorrectExplanation(questionNum)}</p>
                    `;
                }
            }
        }
        
        // 重置练习题
        function resetQuestion(questionNum) {
            if (questionNum === 1) {
                // 重置练习题1的checkbox
                const checkboxes = document.querySelectorAll(`input[data-question="${questionNum}"]`);
                checkboxes.forEach(checkbox => checkbox.checked = false);
            } else {
                // 重置其他题目的radio
                const radios = document.querySelectorAll(`input[name="question${questionNum}"]`);
                radios.forEach(radio => radio.checked = false);
            }
            
            const answerDiv = document.getElementById(`answer-${questionNum}`);
            answerDiv.classList.add('hidden');
            answerDiv.classList.remove('answer-correct', 'answer-incorrect');
        }
        
        // 获取正确答案解释
        function getCorrectExplanation(questionNum) {
            const explanations = {
                1: '正确答案是A、B、C、D。随机变量X表示3次投掷中正面朝上的次数，可能的取值为0、1、2、3。X=0对应TTT，X=1对应HTT、THT、TTH，X=2对应HHT、HTH、THH，X=3对应HHH。X不可能等于4，因为只投掷3次。',
                2: '正确答案是C。期望值E(X) = 0×0.7 + 10×0.2 + 100×0.1 = 0 + 2 + 10 = 12元',
                3: '正确答案是B。方差衡量随机变量取值的离散程度，方差越小，取值越集中在期望值附近。X的方差(4)小于Y的方差(16)，所以X的取值更集中。'
            };
            return explanations[questionNum] || '';
        }
        
        // 初始化随机变量参数滑块事件
        function initRvParamEvents() {
            // 正态分布参数（数字特征部分）
            const rvNormalMean = document.getElementById('rv-normal-mean');
            const rvNormalStd = document.getElementById('rv-normal-std');
            
            if (rvNormalMean) {
                rvNormalMean.addEventListener('input', function() {
                    document.getElementById('rv-normal-mean-value').textContent = this.value;
                    updateRvFeatures();
                });
            }
            
            if (rvNormalStd) {
                rvNormalStd.addEventListener('input', function() {
                    document.getElementById('rv-normal-std-value').textContent = this.value;
                    updateRvFeatures();
                });
            }
            
            // 正态分布参数（连续型随机变量部分）
            const normalMu = document.getElementById('normal-mu');
            const normalSigma = document.getElementById('normal-sigma');
            
            if (normalMu) {
                normalMu.addEventListener('input', function() {
                    document.getElementById('normal-mu-value').textContent = this.value;
                });
            }
            
            if (normalSigma) {
                normalSigma.addEventListener('input', function() {
                    document.getElementById('normal-sigma-value').textContent = this.value;
                });
            }
            
            // 均匀分布参数（数字特征部分）
            const rvUniformMin = document.getElementById('rv-uniform-min');
            const rvUniformMax = document.getElementById('rv-uniform-max');
            
            if (rvUniformMin) {
                rvUniformMin.addEventListener('input', function() {
                    document.getElementById('rv-uniform-min-value').textContent = this.value;
                    updateRvFeatures();
                });
            }
            
            if (rvUniformMax) {
                rvUniformMax.addEventListener('input', function() {
                    document.getElementById('rv-uniform-max-value').textContent = this.value;
                    updateRvFeatures();
                });
            }
            
            // 均匀分布参数（连续型随机变量部分）
            const uniformA = document.getElementById('uniform-a');
            const uniformB = document.getElementById('uniform-b');
            
            if (uniformA) {
                uniformA.addEventListener('input', function() {
                    document.getElementById('uniform-a-value').textContent = this.value;
                });
            }
            
            if (uniformB) {
                uniformB.addEventListener('input', function() {
                    document.getElementById('uniform-b-value').textContent = this.value;
                });
            }
            
            // 指数分布参数（数字特征部分）
            const rvExponentialLambda = document.getElementById('rv-exponential-lambda');
            
            if (rvExponentialLambda) {
                rvExponentialLambda.addEventListener('input', function() {
                    document.getElementById('rv-exponential-lambda-value').textContent = this.value;
                    updateRvFeatures();
                });
            }
            
            // 指数分布参数（连续型随机变量部分）
            const exponentialLambda = document.getElementById('exponential-lambda');
            
            if (exponentialLambda) {
                exponentialLambda.addEventListener('input', function() {
                    document.getElementById('exponential-lambda-value').textContent = this.value;
                });
            }
            
            // 二项分布参数
            const binomialN = document.getElementById('rv-binomial-n');
            const binomialP = document.getElementById('rv-binomial-p');
            
            if (binomialN) {
                binomialN.addEventListener('input', function() {
                    document.getElementById('rv-binomial-n-value').textContent = this.value;
                    updateRvFeatures();
                });
            }
            
            if (binomialP) {
                binomialP.addEventListener('input', function() {
                    document.getElementById('rv-binomial-p-value').textContent = this.value;
                    updateRvFeatures();
                });
            }
            
            // X轴范围参数
            const xAxisMin = document.getElementById('rv-x-axis-min');
            const xAxisMax = document.getElementById('rv-x-axis-max');
            
            if (xAxisMin) {
                xAxisMin.addEventListener('input', function() {
                    document.getElementById('rv-x-axis-min-value').textContent = this.value;
                    updateRvFeatures();
                });
            }
            
            if (xAxisMax) {
                xAxisMax.addEventListener('input', function() {
                    document.getElementById('rv-x-axis-max-value').textContent = this.value;
                    updateRvFeatures();
                });
            }
            
            // 连续型随机变量样本数量参数
            const continuousSamples = document.getElementById('continuous-samples');
            
            if (continuousSamples) {
                continuousSamples.addEventListener('input', function() {
                    document.getElementById('continuous-samples-value').textContent = this.value;
                });
            }
            
            // 连续型随机变量X轴范围参数
            const continuousXMin = document.getElementById('x-axis-min');
            const continuousXMax = document.getElementById('x-axis-max');
            
            if (continuousXMin) {
                continuousXMin.addEventListener('input', function() {
                    document.getElementById('x-axis-min-value').textContent = this.value;
                });
            }
            
            if (continuousXMax) {
                continuousXMax.addEventListener('input', function() {
                    document.getElementById('x-axis-max-value').textContent = this.value;
                });
            }
            
            // 转盘概率滑块事件
            const prob1 = document.getElementById('prob1');
            const prob2 = document.getElementById('prob2');
            const prob3 = document.getElementById('prob3');
            
            // 概率滑块自动调整逻辑
            let isUpdating = false;
            
            function updateProbabilities(changedSlider, newValue) {
                if (isUpdating) return;
                isUpdating = true;
                
                const sliders = [prob1, prob2, prob3];
                const displays = ['prob1-display', 'prob2-display', 'prob3-display'];
                const changedIndex = sliders.indexOf(changedSlider);
                
                // 获取当前值
                let values = sliders.map(slider => parseFloat(slider?.value || 0));
                values[changedIndex] = newValue;
                
                // 计算其他两个滑块需要调整的总量
                const remaining = 100 - newValue;
                const otherIndices = [0, 1, 2].filter(i => i !== changedIndex);
                
                if (remaining >= 0) {
                    // 按比例分配剩余概率
                    const currentOtherSum = otherIndices.reduce((sum, i) => sum + values[i], 0);
                    
                    if (currentOtherSum > 0) {
                        otherIndices.forEach(i => {
                            values[i] = Math.round(values[i] / currentOtherSum * remaining);
                        });
                    } else {
                        // 如果其他滑块都是0，平均分配
                        const avgValue = Math.floor(remaining / otherIndices.length);
                        otherIndices.forEach((i, idx) => {
                            values[i] = idx === 0 ? remaining - avgValue * (otherIndices.length - 1) : avgValue;
                        });
                    }
                    
                    // 确保总和正好是100
                    const currentSum = values.reduce((sum, val) => sum + val, 0);
                    if (currentSum !== 100) {
                        values[otherIndices[0]] += 100 - currentSum;
                    }
                } else {
                    // 如果新值超过100，限制为100，其他设为0
                    values[changedIndex] = 100;
                    otherIndices.forEach(i => values[i] = 0);
                }
                
                // 更新滑块值和显示
                sliders.forEach((slider, i) => {
                    if (slider && i !== changedIndex) {
                        slider.value = Math.max(0, Math.min(100, values[i]));
                    }
                });
                
                // 更新显示
                displays.forEach((displayId, i) => {
                    const display = document.getElementById(displayId);
                    if (display) {
                        display.textContent = values[i].toFixed(1) + '%';
                    }
                });
                
                // 显示总和验证
                const totalSum = values.reduce((sum, val) => sum + val, 0);
                const totalDisplay = document.getElementById('probability-total');
                if (totalDisplay) {
                    totalDisplay.textContent = `总和: ${totalSum.toFixed(1)}%`;
                    totalDisplay.className = totalSum === 100 ? 'text-neon-green font-semibold' : 'text-neon-orange font-semibold';
                }
                
                updateWheelStats();
                drawWheel();
                isUpdating = false;
            }

            // 添加缺失的prob1和prob2事件绑定
            if (prob1) {
                prob1.addEventListener('input', (e) => {
                    updateProbabilities(prob1, parseFloat(e.target.value));
                });
            }
            if (prob2) {
                prob2.addEventListener('input', (e) => {
                    updateProbabilities(prob2, parseFloat(e.target.value));
                });
            }
            if (prob3) {
                prob3.addEventListener('input', (e) => {
                    updateProbabilities(prob3, parseFloat(e.target.value));
                });
            }
            
            // 奖金输入框事件
            const reward1 = document.getElementById('reward1');
            const reward2 = document.getElementById('reward2');
            const reward3 = document.getElementById('reward3');
            
            if (reward1) {
                reward1.addEventListener('input', updateWheelStats);
            }
            if (reward2) {
                reward2.addEventListener('input', updateWheelStats);
            }
            if (reward3) {
                reward3.addEventListener('input', updateWheelStats);
            }
        }
        
        // 绘制转盘
        function drawWheel() {
            try {
                const canvas = document.getElementById('wheel-canvas');
                if (!canvas) {
                    console.error('转盘画布未找到');
                    return;
                }
                
                const ctx = canvas.getContext('2d');
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = 90;
                
                // 获取概率
                const prob1Element = document.getElementById('prob1');
                const prob2Element = document.getElementById('prob2');
                const prob3Element = document.getElementById('prob3');
                
                if (!prob1Element || !prob2Element || !prob3Element) {
                    console.error('转盘概率元素未找到');
                    return;
                }
                
                const prob1 = parseFloat(prob1Element.value) || 60;
                const prob2 = parseFloat(prob2Element.value) || 30;
                const prob3 = parseFloat(prob3Element.value) || 10;
                
                const total = prob1 + prob2 + prob3;
                const angle1 = (prob1 / total) * 2 * Math.PI;
                const angle2 = (prob2 / total) * 2 * Math.PI;
                const angle3 = (prob3 / total) * 2 * Math.PI;
                
                // 清除画布
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // 绘制区域1
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, 0, angle1);
                ctx.closePath();
                ctx.fillStyle = '#00f3ff';
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // 添加区域1标签
                const midAngle1 = angle1 / 2;
                const labelX1 = centerX + Math.cos(midAngle1) * radius * 0.7;
                const labelY1 = centerY + Math.sin(midAngle1) * radius * 0.7;
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${(prob1/total*100).toFixed(0)}%`, labelX1, labelY1);
                
                // 绘制区域2
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, angle1, angle1 + angle2);
                ctx.closePath();
                ctx.fillStyle = '#bf00ff';
                ctx.fill();
                ctx.stroke();
                
                // 添加区域2标签
                const midAngle2 = angle1 + angle2 / 2;
                const labelX2 = centerX + Math.cos(midAngle2) * radius * 0.7;
                const labelY2 = centerY + Math.sin(midAngle2) * radius * 0.7;
                ctx.fillStyle = '#fff';
                ctx.fillText(`${(prob2/total*100).toFixed(0)}%`, labelX2, labelY2);
                
                // 绘制区域3
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, angle1 + angle2, 2 * Math.PI);
                ctx.closePath();
                ctx.fillStyle = '#00ff66';
                ctx.fill();
                ctx.stroke();
                
                // 添加区域3标签
                const midAngle3 = angle1 + angle2 + angle3 / 2;
                const labelX3 = centerX + Math.cos(midAngle3) * radius * 0.7;
                const labelY3 = centerY + Math.sin(midAngle3) * radius * 0.7;
                ctx.fillStyle = '#fff';
                ctx.fillText(`${(prob3/total*100).toFixed(0)}%`, labelX3, labelY3);
            } catch (error) {
                console.error('转盘绘制错误:', error);
            }
        }
        
        // 初始化实践应用事件
        function initPracticalApplicationEvents() {
            // 投资组合参数滑块
            const initialInvestment = document.getElementById('initial-investment');
            const expectedReturn = document.getElementById('expected-return');
            const volatility = document.getElementById('volatility');
            
            if (initialInvestment) {
                initialInvestment.addEventListener('input', updatePortfolioParams);
            }
            if (expectedReturn) {
                expectedReturn.addEventListener('input', updatePortfolioParams);
            }
            if (volatility) {
                volatility.addEventListener('input', updatePortfolioParams);
            }
            
            // 装备掉落概率滑块
            const commonRate = document.getElementById('common-rate');
            const rareRate = document.getElementById('rare-rate');
            const epicRate = document.getElementById('epic-rate');
            const legendaryRate = document.getElementById('legendary-rate');
            
            if (commonRate) {
                commonRate.addEventListener('input', updateDropRates);
            }
            if (rareRate) {
                rareRate.addEventListener('input', updateDropRates);
            }
            if (epicRate) {
                epicRate.addEventListener('input', updateDropRates);
            }
            if (legendaryRate) {
                legendaryRate.addEventListener('input', updateDropRates);
            }
        }
        
        // 掷骰子映射函数
        function rollDiceMapping() {
            const result = Math.floor(Math.random() * 6) + 1;
            const diceDisplay = document.getElementById('dice-display');
            const diceValue = document.getElementById('dice-value');
            
            if (diceDisplay && diceValue) {
                diceDisplay.textContent = result;
                diceValue.textContent = result;
                
                // 更新统计数据
                mappingStats.dice.total++;
                mappingStats.dice.sum += result;
                mappingStats.dice.values.push(result);
                
                updateMappingStats();
                updateMappingChart();
                
                console.log('掷骰子结果:', result);
                showNotification(`骰子结果: ${result}`, 'success');
                return result;
            } else {
                console.error('未找到骰子显示元素');
                return result;
            }
        }
        
        // 抽卡映射函数
        function drawCard() {
            const suits = ['♠', '♥', '♦', '♣'];
            const colors = ['black', 'red', 'red', 'black'];
            const suitIndex = Math.floor(Math.random() * 4);
            const suit = suits[suitIndex];
            const color = colors[suitIndex];
            const value = color === 'red' ? 1 : 0;
            
            const cardDisplay = document.getElementById('card-display');
            const cardValue = document.getElementById('card-value');
            
            if (cardDisplay && cardValue) {
                cardDisplay.textContent = suit;
                cardDisplay.style.color = color;
                cardValue.textContent = value;
                
                // 更新统计数据
                mappingStats.card.total++;
                mappingStats.card.sum += value;
                mappingStats.card.values.push(value);
                
                updateMappingStats();
                updateMappingChart();
                
                console.log('抽卡结果:', suit, '值:', value);
                showNotification(`抽卡结果: ${suit} (${color === 'red' ? '红色' : '黑色'})`, 'success');
                return { suit, value };
            } else {
                console.error('未找到卡片显示元素');
                return { suit, value };
            }
        }
        
        // 更新映射统计结果
        function updateMappingStats() {
            const stats = mappingStats[currentExperiment];
            const totalElement = document.getElementById('mapping-total');
            const averageElement = document.getElementById('mapping-average');
            
            if (totalElement) {
                totalElement.textContent = stats.total;
            }
            
            if (averageElement) {
                const average = stats.total > 0 ? (stats.sum / stats.total).toFixed(2) : '0.00';
                averageElement.textContent = average;
            }
        }
        
        // 更新映射图表
        function updateMappingChart() {
            if (!mappingChart) return;
            
            const stats = mappingStats[currentExperiment];
            const values = stats.values;
            
            if (values.length === 0) return;
            
            // 准备图表数据
            const chartData = values.map((value, index) => ({ x: index + 1, y: value }));
            
            mappingChart.data.datasets[0].data = chartData;
            mappingChart.data.datasets[1].data = chartData;
            
            // 更新图表标签和范围
            if (currentExperiment === 'coin') {
                mappingChart.options.scales.y.min = -0.5;
                mappingChart.options.scales.y.max = 1.5;
                mappingChart.data.datasets[0].label = '样本空间 (正面/反面)';
                mappingChart.data.datasets[1].label = '随机变量值 (1/0)';
            } else if (currentExperiment === 'dice') {
                mappingChart.options.scales.y.min = 0;
                mappingChart.options.scales.y.max = 7;
                mappingChart.data.datasets[0].label = '样本空间 (1-6)';
                mappingChart.data.datasets[1].label = '随机变量值 (1-6)';
            } else if (currentExperiment === 'card') {
                mappingChart.options.scales.y.min = -0.5;
                mappingChart.options.scales.y.max = 1.5;
                mappingChart.data.datasets[0].label = '样本空间 (花色)';
                mappingChart.data.datasets[1].label = '随机变量值 (1/0)';
            }
            
            mappingChart.update();
        }
        
        // 切换实验类型
        function switchMappingExperiment(experimentType) {
            currentExperiment = experimentType;
            
            // 隐藏所有实验演示
            document.querySelectorAll('.mapping-demo').forEach(demo => {
                demo.classList.add('hidden');
            });
            
            // 显示选中的实验演示
            const selectedDemo = document.getElementById(`${experimentType}-mapping`);
            if (selectedDemo) {
                selectedDemo.classList.remove('hidden');
            }
            
            // 更新统计显示
            updateMappingStats();
            updateMappingChart();
            
            console.log('切换到实验类型:', experimentType);
        }
        
        // 批量实验函数
        function runBatchExperiment(times) {
            for (let i = 0; i < times; i++) {
                if (currentExperiment === 'coin') {
                    const result = Math.random() < 0.5 ? 1 : 0;
                    mappingStats.coin.total++;
                    mappingStats.coin.sum += result;
                    mappingStats.coin.values.push(result);
                } else if (currentExperiment === 'dice') {
                    const result = Math.floor(Math.random() * 6) + 1;
                    mappingStats.dice.total++;
                    mappingStats.dice.sum += result;
                    mappingStats.dice.values.push(result);
                } else if (currentExperiment === 'card') {
                    const result = Math.random() < 0.5 ? 1 : 0; // 红色概率50%
                    mappingStats.card.total++;
                    mappingStats.card.sum += result;
                    mappingStats.card.values.push(result);
                }
            }
            
            updateMappingStats();
            updateMappingChart();
            showNotification(`批量实验${times}次完成`, 'success');
        }
        
        // 重置映射演示
        function resetMappingDemo() {
            mappingStats = {
                coin: { total: 0, sum: 0, values: [] },
                dice: { total: 0, sum: 0, values: [] },
                card: { total: 0, sum: 0, values: [] }
            };
            
            // 重置显示
            document.getElementById('coin-display').textContent = '?';
            document.getElementById('coin-value').textContent = '?';
            document.getElementById('dice-display').textContent = '?';
            document.getElementById('dice-value').textContent = '?';
            document.getElementById('card-display').textContent = '?';
            document.getElementById('card-value').textContent = '?';
            
            updateMappingStats();
            
            if (mappingChart) {
                mappingChart.data.datasets[0].data = [];
                mappingChart.data.datasets[1].data = [];
                mappingChart.update();
            }
            
            showNotification('映射演示已重置', 'success');
        }
        
        // 抛硬币功能
        function flipCoin() {
            const result = Math.random() < 0.5 ? 'H' : 'T';
            const value = result === 'H' ? 1 : 0;
            const coinDisplay = document.getElementById('coin-display');
            const coinValue = document.getElementById('coin-value');
            
            if (coinDisplay && coinValue) {
                // 添加翻转动画
                coinDisplay.classList.add('coin-flip');
                
                setTimeout(() => {
                    coinDisplay.textContent = result === 'H' ? 'H' : 'T';
                    coinValue.textContent = value;
                    coinDisplay.style.backgroundColor = result === 'H' ? '#f59e0b' : '#6b7280';
                    coinDisplay.classList.remove('coin-flip');
                    
                    // 更新统计数据
                    mappingStats.coin.total++;
                    mappingStats.coin.sum += value;
                    mappingStats.coin.values.push(value);
                    
                    updateMappingStats();
                    updateMappingChart();
                }, 600);
                
                console.log('抛硬币结果:', result === 'H' ? '正面' : '反面');
                showNotification(`硬币结果: ${result === 'H' ? '正面' : '反面'}`, 'success');
                return result;
            } else {
                console.error('未找到硬币显示元素');
                showNotification('硬币显示元素缺失', 'error');
                return result;
            }
        }
        
        // 参数验证函数
        function validateInput(input, max, defaultValue) {
            const value = parseFloat(input.value);
            if (isNaN(value) || value < min || value > max) {
                showErrorMessage(`请输入${min}到${max}之间的数值`);
                input.value = defaultValue;
                return defaultValue;
            }
            return value;
        }
        
        // 错误提示函数
        function showErrorMessage(message) {
            const errorDiv = document.getElementById('error-message') || createErrorDiv();
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            errorDiv.classList.add('animate-fadeIn');
            
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 3000);
        }
        
        function createErrorDiv() {
            const errorDiv = document.createElement('div');
            errorDiv.id = 'error-message';
            errorDiv.className = 'fixed top-20 right-4 bg-red-600 text-white px-4 py-2 rounded-lg shadow-lg z-50 hidden';
            document.body.appendChild(errorDiv);
            return errorDiv;
        }
        
        // 通知提示函数
        function showNotification(message, type = 'info', duration = 3000) {
            // 创建通知元素
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 max-w-sm ${
                type === 'success' ? 'bg-green-600 text-white' :
                type === 'error' ? 'bg-red-600 text-white' :
                type === 'warning' ? 'bg-yellow-600 text-black' :
                'bg-blue-600 text-white'
            }`;
            notification.style.whiteSpace = 'pre-line';
            notification.textContent = message;
            
            // 添加关闭按钮
            const closeBtn = document.createElement('button');
            closeBtn.innerHTML = '×';
            closeBtn.className = 'ml-2 text-xl font-bold opacity-70 hover:opacity-100';
            closeBtn.onclick = () => notification.remove();
            notification.appendChild(closeBtn);
            
            document.body.appendChild(notification);
            
            // 自动移除
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, duration);
        }
        
        // 安全更新元素函数
        function updateElementSafely(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value;
                return true;
            } else {
                console.warn(`元素 ${elementId} 未找到，无法更新内容: ${value}`);
                return false;
            }
        }
        
        function createNotificationDiv() {
            const notificationDiv = document.createElement('div');
            notificationDiv.id = 'notification';
            notificationDiv.className = 'fixed top-20 right-4 px-4 py-2 rounded-lg shadow-lg z-50 hidden';
            document.body.appendChild(notificationDiv);
            return notificationDiv;
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            console.log('页面加载完成，开始初始化...');
            
            try {
                // 创建粒子背景
                createParticles();
                console.log('粒子背景创建完成');
                
                // 初始化随机变量相关图表
                initDiscreteRvChart();
                console.log('离散随机变量图表初始化完成');
                
                initContinuousRvChart();
                console.log('连续随机变量图表初始化完成');
                
                initRvFeaturesChart();
                console.log('随机变量特征图表初始化完成');
                
                initMappingDemo();
                console.log('映射演示初始化完成');
                
                // 初始化映射演示
                switchMappingExperiment('coin');
                console.log('映射演示默认实验设置完成');
                
                initPortfolioChart();
                console.log('投资组合图表初始化完成');
                
                initDropRateChart();
                console.log('掉落率图表初始化完成');
                
                initRvParamEvents();
                console.log('随机变量参数事件初始化完成');
                
                initPracticalApplicationEvents();
                console.log('实践应用事件初始化完成');
                
                // 更新随机变量数字特征
                updateRvFeatures();
                console.log('随机变量特征更新完成');
                
                if (typeof updatePortfolioParams === 'function') {
                    updatePortfolioParams();
                    console.log('投资组合参数更新完成');
                }
                if (typeof updateDropRates === 'function') {
                    updateDropRates();
                    console.log('掉落率更新完成');
                }
                
                // 绘制转盘
                drawWheel();
                console.log('转盘绘制完成');
                
                updateWheelStats();
                console.log('转盘统计更新完成');
                
                // 初始化映射统计
                updateMappingStats();
                console.log('映射统计初始化完成');
                
                console.log('所有初始化完成');
            } catch (error) {
                console.error('初始化过程中出现错误:', error);
            }
            
            // 设置随机变量相关按钮事件
            const rollDiceBtn = document.getElementById('roll-dice-btn');
            const rollDiceTenBtn = document.getElementById('roll-dice-ten-btn');
            const rollDiceHundredBtn = document.getElementById('roll-dice-hundred-btn');
            const generateSamplesBtn = document.getElementById('generate-samples-btn');
            const generateManySamplesBtn = document.getElementById('generate-many-samples-btn');
            const rvDistribution = document.getElementById('rv-distribution');
            const continuousDistribution = document.getElementById('continuous-distribution');
            const spinOnceBtn = document.getElementById('spin-once-btn');
            const spinHundredBtn = document.getElementById('spin-hundred-btn');
            const resetWheelBtn = document.getElementById('reset-wheel-btn');
            const simulatePortfolioBtn = document.getElementById('simulate-portfolio-btn');
            const simulateDropsBtn = document.getElementById('simulate-drops-btn');
            const flipCoinBtn = document.getElementById('flip-coin-btn'); // 添加抛硬币按钮
            
            // 映射函数演示按钮
            const mappingExperimentSelect = document.getElementById('mapping-experiment');
            const rollDiceMappingBtn = document.getElementById('roll-dice-mapping-btn');
            const drawCardBtn = document.getElementById('draw-card-btn');
            const batch10Btn = document.getElementById('batch-10-btn');
            const batch100Btn = document.getElementById('batch-100-btn');
            const resetMappingBtn = document.getElementById('reset-mapping-btn');
            
            // 添加股票比例滑块变量
            const stockRatioSlider = document.getElementById('stock-ratio');
            const stockRatioValue = document.getElementById('stock-ratio-value');
            const bondRatioSlider = document.getElementById('bond-ratio');
            const bondRatioValue = document.getElementById('bond-ratio-value');
            const stockAWeightSlider = document.getElementById('stock-a-weight');
            const stockAWeightValue = document.getElementById('stock-a-weight-value');
            const stockBWeightSlider = document.getElementById('stock-b-weight');
            const stockBWeightValue = document.getElementById('stock-b-weight-value');
            const stockAReturnSlider = document.getElementById('stock-a-return');
            const stockAReturnValue = document.getElementById('stock-a-return-value');
            const stockAVolatilitySlider = document.getElementById('stock-a-volatility');
            const stockAVolatilityValue = document.getElementById('stock-a-volatility-value');
            const stockBReturnSlider = document.getElementById('stock-b-return');
            const stockBReturnValue = document.getElementById('stock-b-return-value');
            const stockBVolatilitySlider = document.getElementById('stock-b-volatility');
            const stockBVolatilityValue = document.getElementById('stock-b-volatility-value');
            
            if (rollDiceBtn) {
                rollDiceBtn.addEventListener('click', () => {
                    try {
                        const sum = rollTwoDice();
                        console.log('掷骰子结果:', sum);
                        
                        // 更新总次数
                        let totalRolls = parseInt(document.getElementById('total-rolls')?.textContent || '0');
                        totalRolls++;
                        const totalRollsElement = document.getElementById('total-rolls');
                        if (totalRollsElement) {
                            totalRollsElement.textContent = totalRolls;
                        }
                        
                        // 更新图表
                        if (discreteChart) {
                            const index = sum - 2;
                            if (!discreteChart.data.datasets[1].data[index]) {
                                discreteChart.data.datasets[1].data[index] = 0;
                            }
                            discreteChart.data.datasets[1].data[index]++;
                            
                            // 转换为频率
                            const frequencies = discreteChart.data.datasets[1].data.map(count => count / totalRolls);
                            discreteChart.data.datasets[1].data = frequencies;
                            discreteChart.update();
                            console.log('离散图表更新完成');
                        } else {
                            console.error('离散图表未初始化');
                        }
                    } catch (error) {
                        console.error('掷骰子功能错误:', error);
                        showNotification('掷骰子功能出错: ' + error.message, 'error');
                    }
                });
                console.log('骰子按钮事件绑定成功');
            } else {
                console.error('未找到骰子按钮');
            }
            
            if (rollDiceTenBtn) {
                rollDiceTenBtn.addEventListener('click', () => {
                    try {
                        rollMultipleTimes(10);
                        console.log('掷10次骰子完成');
                        showNotification('掷10次骰子完成', 'success');
                    } catch (error) {
                        console.error('掷10次骰子错误:', error);
                        showNotification('掷10次骰子出错: ' + error.message, 'error');
                    }
                });
                console.log('掷10次骰子按钮事件绑定成功');
            } else {
                console.error('未找到掷10次骰子按钮');
            }
            
            if (rollDiceHundredBtn) {
                rollDiceHundredBtn.addEventListener('click', () => {
                    try {
                        rollMultipleTimes(100);
                        console.log('掷100次骰子完成');
                        showNotification('掷100次骰子完成', 'success');
                    } catch (error) {
                        console.error('掷100次骰子错误:', error);
                        showNotification('掷100次骰子出错: ' + error.message, 'error');
                    }
                });
                console.log('掷100次骰子按钮事件绑定成功');
            } else {
                console.error('未找到掷100次骰子按钮');
            }
            
            if (generateSamplesBtn) {
                generateSamplesBtn.addEventListener('click', () => {
                    try {
                        const sampleSize = parseInt(document.getElementById('continuous-samples')?.value || 1000);
                        generateContinuousSamples(sampleSize);
                        console.log('生成样本完成，样本数量:', sampleSize);
                        showNotification(`生成${sampleSize}个样本完成`, 'success');
                    } catch (error) {
                        console.error('生成样本错误:', error);
                        showNotification('生成样本出错: ' + error.message, 'error');
                    }
                });
                console.log('样本生成按钮事件绑定成功');
            } else {
                console.error('未找到样本生成按钮');
            }
            
            if (generateManySamplesBtn) {
                generateManySamplesBtn.addEventListener('click', () => {
                    try {
                        generateContinuousSamples(10000);
                        console.log('生成10000个样本完成');
                        showNotification('生成10000个样本完成', 'success');
                    } catch (error) {
                        console.error('生成10000个样本错误:', error);
                        showNotification('生成10000个样本出错: ' + error.message, 'error');
                    }
                });
                console.log('生成大量样本按钮事件绑定成功');
            } else {
                console.error('未找到生成大量样本按钮');
            }
            
            if (rvDistribution) {
                rvDistribution.addEventListener('change', () => {
                    try {
                        updateRvFeatures();
                        console.log('随机变量分布类型更改:', rvDistribution.value);
                    } catch (error) {
                        console.error('更新随机变量特征错误:', error);
                    }
                });
                console.log('随机变量分布选择器事件绑定成功');
            } else {
                console.error('未找到随机变量分布选择器');
            }
            
            if (continuousDistribution) {
                continuousDistribution.addEventListener('change', () => {
                    try {
                        const sampleSize = parseInt(document.getElementById('continuous-samples')?.value || 1000);
                        generateContinuousSamples(sampleSize);
                        console.log('连续分布类型更改:', continuousDistribution.value);
                    } catch (error) {
                        console.error('更新连续分布错误:', error);
                    }
                });
                console.log('连续分布选择器事件绑定成功');
            } else {
                console.error('未找到连续分布选择器');
            }
            
            if (spinOnceBtn) {
                spinOnceBtn.addEventListener('click', () => {
                    try {
                        spinWheel();
                        console.log('转盘转动一次');
                    } catch (error) {
                        console.error('转盘转动错误:', error);
                        showNotification('转盘转动出错: ' + error.message, 'error');
                    }
                });
                console.log('转盘按钮事件绑定成功');
            } else {
                console.error('未找到转盘按钮');
            }
            
            if (spinHundredBtn) {
                spinHundredBtn.addEventListener('click', () => {
                    try {
                        spinMultipleTimes(100);
                        console.log('转盘转动100次完成');
                        showNotification('转盘转动100次完成', 'success');
                    } catch (error) {
                        console.error('转盘转动100次错误:', error);
                        showNotification('转盘转动100次出错: ' + error.message, 'error');
                    }
                });
                console.log('转盘100次按钮事件绑定成功');
            } else {
                console.error('未找到转盘100次按钮');
            }
            
            if (resetWheelBtn) {
                resetWheelBtn.addEventListener('click', () => {
                    try {
                        wheelResults = [];
                        wheelSpinCount = 0;
                        
                        const wheelResultElement = document.getElementById('wheel-result');
                        const wheelCountElement = document.getElementById('wheel-count');
                        
                        if (wheelResultElement) {
                            wheelResultElement.textContent = '0';
                        }
                        if (wheelCountElement) {
                            wheelCountElement.textContent = '0';
                        }
                        
                        if (wheelHistogramChart) {
                            wheelHistogramChart.data.labels = [];
                            wheelHistogramChart.data.datasets[0].data = [];
                            wheelHistogramChart.update();
                        }
                        
                        console.log('转盘已重置');
                        showNotification('转盘已重置', 'success');
                    } catch (error) {
                        console.error('转盘重置错误:', error);
                        showNotification('转盘重置出错: ' + error.message, 'error');
                    }
                });
                console.log('转盘重置按钮事件绑定成功');
            } else {
                console.error('未找到转盘重置按钮');
            }
            
            if (simulatePortfolioBtn && typeof simulatePortfolio === 'function') {
                simulatePortfolioBtn.addEventListener('click', () => {
                    try {
                        simulatePortfolio();
                        console.log('投资组合模拟完成');
                    } catch (error) {
                        console.error('投资组合模拟错误:', error);
                        showNotification('投资组合模拟出错: ' + error.message, 'error');
                    }
                });
                console.log('投资组合模拟按钮事件绑定成功');
            } else {
                console.error('未找到投资组合模拟按钮或函数');
            }
            
            if (simulateDropsBtn && typeof simulateDrops === 'function') {
                simulateDropsBtn.addEventListener('click', () => {
                    try {
                        simulateDrops();
                        console.log('装备掉落模拟完成');
                    } catch (error) {
                        console.error('装备掉落模拟错误:', error);
                        showNotification('装备掉落模拟出错: ' + error.message, 'error');
                    }
                });
                console.log('装备掉落模拟按钮事件绑定成功');
            } else {
                console.error('未找到装备掉落模拟按钮或函数');
            }
            
            // 添加抛硬币按钮事件绑定
            if (flipCoinBtn) {
                flipCoinBtn.addEventListener('click', () => {
                    try {
                        flipCoin();
                        console.log('抛硬币功能执行完成');
                    } catch (error) {
                        console.error('抛硬币功能错误:', error);
                        showNotification('抛硬币功能出错: ' + error.message, 'error');
                    }
                });
                console.log('抛硬币按钮事件绑定成功');
            } else {
                console.error('未找到抛硬币按钮');
            }
            
            // 添加股票比例滑块事件绑定
            if (stockRatioSlider && stockRatioValue) {
                stockRatioSlider.addEventListener('input', (e) => {
                    try {
                        const value = e.target.value;
                        stockRatioValue.textContent = value;
                        // 自动调整债券B比例
                        const bondValue = 100 - parseInt(value);
                        if (bondRatioSlider && bondRatioValue) {
                            bondRatioSlider.value = bondValue;
                            bondRatioValue.textContent = bondValue;
                        }
                        console.log('股票A比例更新为:', value + '%', '债券B比例:', bondValue + '%');
                        // 可以在这里添加重新计算投资组合的逻辑
                        if (typeof updatePortfolioParams === 'function') {
                            updatePortfolioParams();
                        }
                    } catch (error) {
                        console.error('股票比例滑块错误:', error);
                    }
                });
                console.log('股票比例滑块事件绑定成功');
            } else {
                console.error('未找到股票比例滑块或显示元素');
            }
            
            // 添加债券B比例滑块事件绑定
            if (bondRatioSlider && bondRatioValue) {
                bondRatioSlider.addEventListener('input', (e) => {
                    try {
                        const value = e.target.value;
                        bondRatioValue.textContent = value;
                        // 自动调整股票A比例
                        const stockValue = 100 - parseInt(value);
                        if (stockRatioSlider && stockRatioValue) {
                            stockRatioSlider.value = stockValue;
                            stockRatioValue.textContent = stockValue;
                        }
                        console.log('债券B比例更新为:', value + '%', '股票A比例:', stockValue + '%');
                        if (typeof updatePortfolioParams === 'function') {
                            updatePortfolioParams();
                        }
                    } catch (error) {
                        console.error('债券B比例滑块错误:', error);
                    }
                });
                console.log('债券B比例滑块事件绑定成功');
            } else {
                console.error('未找到债券B比例滑块或显示元素');
            }
            
            if (stockAWeightSlider && stockAWeightValue) {
                stockAWeightSlider.addEventListener('input', (e) => {
                    try {
                        const value = e.target.value;
                        stockAWeightValue.textContent = value;
                        // 自动调整股票B权重
                        const stockBValue = 100 - parseInt(value);
                        if (stockBWeightSlider && stockBWeightValue) {
                            stockBWeightSlider.value = stockBValue;
                            stockBWeightValue.textContent = stockBValue;
                        }
                        console.log('股票A权重更新为:', value + '%', '股票B权重:', stockBValue + '%');
                        if (typeof updatePortfolioParams === 'function') {
                            updatePortfolioParams();
                        }
                    } catch (error) {
                        console.error('股票A权重滑块错误:', error);
                    }
                });
                console.log('股票A权重滑块事件绑定成功');
            }
            
            if (stockBWeightSlider && stockBWeightValue) {
                stockBWeightSlider.addEventListener('input', (e) => {
                    try {
                        const value = e.target.value;
                        stockBWeightValue.textContent = value;
                        // 自动调整股票A权重
                        const stockAValue = 100 - parseInt(value);
                        if (stockAWeightSlider && stockAWeightValue) {
                            stockAWeightSlider.value = stockAValue;
                            stockAWeightValue.textContent = stockAValue;
                        }
                        console.log('股票B权重更新为:', value + '%', '股票A权重:', stockAValue + '%');
                        if (typeof updatePortfolioParams === 'function') {
                            updatePortfolioParams();
                        }
                    } catch (error) {
                        console.error('股票B权重滑块错误:', error);
                    }
                });
                console.log('股票B权重滑块事件绑定成功');
            }
            
            if (stockAReturnSlider && stockAReturnValue) {
                stockAReturnSlider.addEventListener('input', (e) => {
                    try {
                        const value = e.target.value;
                        stockAReturnValue.textContent = (parseFloat(value) * 100).toFixed(1) + '%';
                        console.log('股票A预期收益率更新为:', value);
                        if (typeof updatePortfolioParams === 'function') {
                            updatePortfolioParams();
                        }
                    } catch (error) {
                        console.error('股票A收益率滑块错误:', error);
                    }
                });
                console.log('股票A收益率滑块事件绑定成功');
            }
            
            if (stockAVolatilitySlider && stockAVolatilityValue) {
                stockAVolatilitySlider.addEventListener('input', (e) => {
                    try {
                        const value = e.target.value;
                        stockAVolatilityValue.textContent = value;
                        console.log('股票A波动率更新为:', value);
                        if (typeof updatePortfolioParams === 'function') {
                            updatePortfolioParams();
                        }
                    } catch (error) {
                        console.error('股票A波动率滑块错误:', error);
                    }
                });
                console.log('股票A波动率滑块事件绑定成功');
            }
            
            if (stockBReturnSlider && stockBReturnValue) {
                stockBReturnSlider.addEventListener('input', (e) => {
                    try {
                        const value = e.target.value;
                        stockBReturnValue.textContent = (parseFloat(value) * 100).toFixed(1) + '%';
                        console.log('股票B预期收益率更新为:', value);
                        if (typeof updatePortfolioParams === 'function') {
                            updatePortfolioParams();
                        }
                    } catch (error) {
                        console.error('股票B收益率滑块错误:', error);
                    }
                });
                console.log('股票B收益率滑块事件绑定成功');
            }
            
            if (stockBVolatilitySlider && stockBVolatilityValue) {
                stockBVolatilitySlider.addEventListener('input', (e) => {
                    try {
                        const value = e.target.value;
                        stockBVolatilityValue.textContent = value;
                        console.log('股票B波动率更新为:', value);
                        if (typeof updatePortfolioParams === 'function') {
                            updatePortfolioParams();
                        }
                    } catch (error) {
                        console.error('股票B波动率滑块错误:', error);
                    }
                });
                console.log('股票B波动率滑块事件绑定成功');
            }
            
            // 装备掉落概率滑块事件绑定
            const commonDropRate = document.getElementById('common-drop-rate');
            const rareDropRate = document.getElementById('rare-drop-rate');
            const epicDropRate = document.getElementById('epic-drop-rate');
            const legendaryDropRate = document.getElementById('legendary-drop-rate');
            const mythicDropRate = document.getElementById('mythic-drop-rate');
            
            if (commonDropRate) {
                commonDropRate.addEventListener('input', () => {
                    updateDropRates();
                    console.log('普通装备掉落率更新');
                });
                console.log('普通装备掉落率滑块事件绑定成功');
            }
            
            if (rareDropRate) {
                rareDropRate.addEventListener('input', () => {
                    updateDropRates();
                    console.log('稀有装备掉落率更新');
                });
                console.log('稀有装备掉落率滑块事件绑定成功');
            }
            
            if (epicDropRate) {
                epicDropRate.addEventListener('input', () => {
                    updateDropRates();
                    console.log('史诗装备掉落率更新');
                });
                console.log('史诗装备掉落率滑块事件绑定成功');
            }
            
            if (legendaryDropRate) {
                legendaryDropRate.addEventListener('input', () => {
                    updateDropRates();
                    console.log('传说装备掉落率更新');
                });
                console.log('传说装备掉落率滑块事件绑定成功');
            }
            
            if (mythicDropRate) {
                mythicDropRate.addEventListener('input', () => {
                    updateDropRates();
                    console.log('神话装备掉落率更新');
                });
                console.log('神话装备掉落率滑块事件绑定成功');
            }
            
            // 实验类型选择器事件绑定
            if (mappingExperimentSelect) {
                mappingExperimentSelect.addEventListener('change', (e) => {
                    try {
                        switchMappingExperiment(e.target.value);
                        console.log('实验类型切换为:', e.target.value);
                    } catch (error) {
                        console.error('切换实验类型错误:', error);
                        showNotification('切换实验类型出错: ' + error.message, 'error');
                    }
                });
                console.log('映射实验选择器事件绑定成功');
            } else {
                console.error('未找到映射实验选择器');
            }
            
            // 掷骰子按钮事件绑定
            if (rollDiceMappingBtn) {
                rollDiceMappingBtn.addEventListener('click', () => {
                    try {
                        rollDiceMapping();
                        console.log('掷骰子映射功能执行完成');
                    } catch (error) {
                        console.error('掷骰子映射功能错误:', error);
                        showNotification('掷骰子映射功能出错: ' + error.message, 'error');
                    }
                });
                console.log('掷骰子映射按钮事件绑定成功');
            } else {
                console.error('未找到掷骰子映射按钮');
            }
            
            // 抽卡按钮事件绑定
            if (drawCardBtn) {
                drawCardBtn.addEventListener('click', () => {
                    try {
                        drawCard();
                        console.log('抽卡映射功能执行完成');
                    } catch (error) {
                        console.error('抽卡映射功能错误:', error);
                        showNotification('抽卡映射功能出错: ' + error.message, 'error');
                    }
                });
                console.log('抽卡映射按钮事件绑定成功');
            } else {
                console.error('未找到抽卡映射按钮');
            }
            
            // 批量实验按钮事件绑定
            if (batch10Btn) {
                batch10Btn.addEventListener('click', () => {
                    try {
                        runBatchExperiment(10);
                        console.log('批量实验10次完成');
                    } catch (error) {
                        console.error('批量实验10次错误:', error);
                        showNotification('批量实验10次出错: ' + error.message, 'error');
                    }
                });
                console.log('批量实验10次按钮事件绑定成功');
            } else {
                console.error('未找到批量实验10次按钮');
            }
            
            if (batch100Btn) {
                batch100Btn.addEventListener('click', () => {
                    try {
                        runBatchExperiment(100);
                        console.log('批量实验100次完成');
                    } catch (error) {
                        console.error('批量实验100次错误:', error);
                        showNotification('批量实验100次出错: ' + error.message, 'error');
                    }
                });
                console.log('批量实验100次按钮事件绑定成功');
            } else {
                console.error('未找到批量实验100次按钮');
            }
            
            // 重置按钮事件绑定
            if (resetMappingBtn) {
                resetMappingBtn.addEventListener('click', () => {
                    try {
                        resetMappingDemo();
                        console.log('映射演示重置完成');
                    } catch (error) {
                        console.error('映射演示重置错误:', error);
                        showNotification('映射演示重置出错: ' + error.message, 'error');
                    }
                });
                console.log('映射演示重置按钮事件绑定成功');
            } else {
                console.error('未找到映射演示重置按钮');
            }
            
            console.log('所有事件绑定完成');
            
        }); // 关闭 DOMContentLoaded 事件监听器

</script>
</body>
</html>


