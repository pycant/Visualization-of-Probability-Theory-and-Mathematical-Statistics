<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åŒºé—´ä¼°è®¡æ¢ç´¢ - æ¦‚ç‡ç»Ÿè®¡å¯è§†åŒ–</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../static/libs/chart/chart.umd.min.js"></script>
    <script src="../static/libs/chart/chartjs-plugin-annotation.min.js"></script>
    <!-- Marked.js for Markdown rendering -->
    <script src="../static/libs/marked/marked.min.js"></script>

    <!-- KaTeX for LaTeX rendering -->
    <link rel="stylesheet" href="../static/libs/katex/css/katex.min.css" />
    <script defer src="../static/libs/katex/js/katex.min.js"></script>
    <script defer src="../static/libs/katex/js/auto-render.min.js"></script>
    <script>
      // ç­‰å¾…é¡µé¢å’Œæ‰€æœ‰è„šæœ¬å®Œå…¨åŠ è½½åå†æ¸²æŸ“æ•°å­¦å…¬å¼
      window.addEventListener("load", function () {
        setTimeout(function () {
          if (typeof renderMathInElement !== "undefined") {
            renderMathInElement(document.body, {
              delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\[", right: "\\]", display: true },
                { left: "\\(", right: "\\)", display: false },
              ],
              throwOnError: false,
              errorColor: "#cc0000",
            });
            console.log("KaTeXæ¸²æŸ“å®Œæˆ");
          } else {
            console.error("KaTeXæœªåŠ è½½");
          }
        }, 200);
      });
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap");

      :root {
        --dark-bg: #0f172a;
        --dark-card: #1e293b;
        --neon-blue: #00f3ff;
        --neon-purple: #bf00ff;
        --neon-green: #00ff66;
        --neon-orange: #ff8c00;
      }

      body {
        font-family: "Roboto", sans-serif;
        background-color: var(--dark-bg);
        color: #fff;
        overflow-x: hidden;
      }

      .font-future {
        font-family: "Roboto", sans-serif;
        letter-spacing: 0.05em;
      }

      .text-neon-blue {
        color: var(--neon-blue);
      }

      .text-neon-purple {
        color: var(--neon-purple);
      }

      .text-neon-green {
        color: var(--neon-green);
      }

      .text-neon-orange {
        color: var(--neon-orange);
      }

      .bg-neon-blue {
        background-color: var(--neon-blue);
      }

      .bg-neon-purple {
        background-color: var(--neon-purple);
      }

      .bg-neon-green {
        background-color: var(--neon-green);
      }

      .bg-neon-orange {
        background-color: var(--neon-orange);
      }

      .bg-dark-bg {
        background-color: var(--dark-bg);
      }

      .bg-dark-card {
        background-color: var(--dark-card);
      }

      .accent-neon-blue {
        accent-color: var(--neon-blue);
      }

      .accent-neon-purple {
        accent-color: var(--neon-purple);
      }

      .accent-neon-green {
        accent-color: var(--neon-green);
      }

      .accent-neon-orange {
        accent-color: var(--neon-orange);
      }

      .clip-path-slant {
        clip-path: polygon(0 0, 100% 0, 100% 95%, 0 100%);
      }

      .bg-grid {
        background-image: linear-gradient(
            to right,
            rgba(255, 255, 255, 0.05) 1px,
            transparent 1px
          ),
          linear-gradient(
            to bottom,
            rgba(255, 255, 255, 0.05) 1px,
            transparent 1px
          );
        background-size: 20px 20px;
      }

      .hidden {
        display: none;
      }

      /* è´å¶æ–¯æ§åˆ¶é¢æ¿æ ·å¼ */
      #bayesian-controls {
        display: none; /* åˆå§‹éšè— */
        margin-top: 10px;
        padding: 15px;
        background-color: rgba(0, 243, 255, 0.1);
        border: 1px solid rgba(0, 243, 255, 0.3);
        border-radius: 8px;
        backdrop-filter: blur(10px);
      }

      /* ç²’å­åŠ¨ç”» */
      #particles-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        overflow: hidden;
      }

      .particle {
        position: absolute;
        border-radius: 50%;
        opacity: 0.5;
        animation: float 15s infinite ease-in-out;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0) translateX(0);
        }
        25% {
          transform: translateY(-30px) translateX(15px);
        }
        50% {
          transform: translateY(-15px) translateX(-15px);
        }
        75% {
          transform: translateY(30px) translateX(15px);
        }
      }

      /* æ€è€ƒåŠ¨ç”»æ ·å¼ */
      .thinking-animation {
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .thinking-animation .dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background-color: #00f3ff;
        animation: thinking-pulse 1.4s ease-in-out infinite both;
      }

      .thinking-animation .dot:nth-child(1) {
        animation-delay: -0.32s;
      }

      /* æ¸è¿›å¼å­¦ä¹ æ ·å¼ */
      .theory-step.locked {
        position: relative;
      }

      .theory-step.locked .message-content {
        pointer-events: none;
      }

      .theory-step.unlocked {
        animation: unlock-glow 0.5s ease-in-out;
      }

      @keyframes unlock-glow {
        0% {
          box-shadow: 0 0 0 rgba(0, 243, 255, 0.5);
        }
        50% {
          box-shadow: 0 0 20px rgba(0, 243, 255, 0.8);
        }
        100% {
          box-shadow: 0 0 0 rgba(0, 243, 255, 0.5);
        }
      }

      .ai-help-btn {
        background: linear-gradient(45deg, #6366f1, #8b5cf6);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .ai-help-btn:hover {
        background: linear-gradient(45deg, #4f46e5, #7c3aed);
        transform: translateY(-2px);
      }

      .understanding-btn {
        transition: all 0.3s ease;
      }

      .understanding-btn:hover {
        transform: scale(1.1);
      }

      .progressive-hint {
        background: linear-gradient(
          135deg,
          rgba(0, 243, 255, 0.1),
          rgba(139, 92, 246, 0.1)
        );
        border: 1px solid rgba(0, 243, 255, 0.3);
      }

      .thinking-animation .dot:nth-child(2) {
        animation-delay: -0.16s;
      }

      .thinking-animation .dot:nth-child(3) {
        animation-delay: 0s;
      }

      @keyframes thinking-pulse {
        0%,
        80%,
        100% {
          transform: scale(0.8);
          opacity: 0.5;
        }
        40% {
          transform: scale(1.2);
          opacity: 1;
        }
      }

      /* Markdownå†…å®¹æ ·å¼ */
      .message-content {
        line-height: 1.6;
      }

      .message-content h1,
      .message-content h2,
      .message-content h3,
      .message-content h4,
      .message-content h5,
      .message-content h6 {
        margin-top: 1.5rem;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: var(--neon-blue);
      }

      .message-content p {
        margin-bottom: 1rem;
      }

      .message-content ul,
      .message-content ol {
        margin-bottom: 1rem;
        padding-left: 1.5rem;
      }

      .message-content li {
        margin-bottom: 0.25rem;
      }

      .message-content table {
        width: 100%;
        border-collapse: collapse;
        margin: 1rem 0;
        background-color: rgba(30, 41, 59, 0.5);
        border-radius: 0.5rem;
        overflow: hidden;
      }

      .message-content th,
      .message-content td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .message-content th {
        background-color: rgba(0, 243, 255, 0.1);
        font-weight: 600;
        color: #00f3ff;
      }

      .message-content code {
        background-color: rgba(30, 41, 59, 0.8);
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-family: "Courier New", monospace;
        color: #00ff66;
      }

      .message-content pre {
        background-color: rgba(30, 41, 59, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        overflow-x: auto;
        margin: 1rem 0;
      }

      .message-content pre code {
        background: none;
        padding: 0;
      }

      .message-content blockquote {
        border-left: 4px solid #00f3ff;
        padding-left: 1rem;
        margin: 1rem 0;
        font-style: italic;
        color: #cbd5e1;
      }

      .message-content .katex {
        color: #e5e7eb !important;
      }

      .message-content .katex-display {
        margin: 1rem 0;
      }

      /* ç³–æœç›’åŠ¨ç”» */
      .candy-box {
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        animation: candy-glow 2s ease-in-out infinite alternate;
      }

      @keyframes candy-glow {
        0% {
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        100% {
          box-shadow: 0 10px 30px rgba(255, 107, 107, 0.5),
            0 0 20px rgba(78, 205, 196, 0.3);
        }
      }

      .candy {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin: 2px;
        animation: candy-bounce 0.5s ease-out;
      }

      .candy.red {
        background-color: #ff4757;
      }

      .candy.blue {
        background-color: #3742fa;
      }

      .alarm-record {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin: 3px;
        animation: record-bounce 0.5s ease-out;
        font-size: 12px;
      }

      .alarm-record.rain {
        background: linear-gradient(45deg, #3b82f6, #1d4ed8);
        color: white;
      }

      .alarm-record.no-rain {
        background: linear-gradient(45deg, #fbbf24, #f59e0b);
        color: white;
      }

      @keyframes candy-bounce {
        0% {
          transform: scale(0) rotate(0deg);
        }
        50% {
          transform: scale(1.2) rotate(180deg);
        }
        100% {
          transform: scale(1) rotate(360deg);
        }
      }

      @keyframes record-bounce {
        0% {
          transform: scale(0) rotate(0deg);
        }
        50% {
          transform: scale(1.2) rotate(180deg);
        }
        100% {
          transform: scale(1) rotate(360deg);
        }
      }

      /* ç½®ä¿¡åŒºé—´å¯è§†åŒ– */
      .confidence-interval {
        height: 20px;
        border-radius: 10px;
        margin: 5px 0;
        position: relative;
        transition: all 0.3s ease;
      }

      .confidence-interval.contains-true {
        background: linear-gradient(90deg, #00ff66, #00cc52);
        box-shadow: 0 0 10px rgba(0, 255, 102, 0.5);
      }

      .confidence-interval.misses-true {
        background: linear-gradient(90deg, #ff4757, #ff3742);
        box-shadow: 0 0 10px rgba(255, 71, 87, 0.5);
      }

      .true-value-line {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 3px;
        background: #ffd700;
        box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        z-index: 10;
        pointer-events: none;
      }

      #intervals-container {
        position: relative;
      }

      #intervals-container .true-value-line {
        position: absolute;
        margin-left: -1.5px;
      }

      /* ç†è®ºæ¨å¯¼æ­¥éª¤ */
      .theory-step {
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid rgba(0, 243, 255, 0.3);
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
        transition: all 0.3s ease;
      }

      .theory-step:hover {
        border-color: var(--neon-blue);
        box-shadow: 0 0 20px rgba(0, 243, 255, 0.2);
      }

      .understanding-buttons {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      .understanding-btn {
        padding: 8px 16px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        background: transparent;
        color: white;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .understanding-btn:hover {
        background: var(--neon-blue);
        color: var(--dark-bg);
      }

      .understanding-btn.selected {
        background: var(--neon-blue);
        color: var(--dark-bg);
        border-color: var(--neon-blue);
      }

      /* ç†è§£åº¦å›¾è°± */
      .understanding-radar {
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid var(--neon-green);
        border-radius: 15px;
        padding: 20px;
        margin-top: 20px;
      }

      /* æ•°æ®ç‚¹åŠ¨ç”»æ•ˆæœ */
      .data-point-enter {
        animation: dataPointEnter 0.6s ease-out;
      }

      @keyframes dataPointEnter {
        0% {
          transform: scale(0) rotate(180deg);
          opacity: 0;
        }
        50% {
          transform: scale(1.2) rotate(90deg);
          opacity: 0.8;
        }
        100% {
          transform: scale(1) rotate(0deg);
          opacity: 1;
        }
      }

      /* ç½®ä¿¡åŒºé—´åŠ¨ç”» */
      .confidence-interval-fade {
        animation: confidenceIntervalFade 1s ease-in-out;
      }

      @keyframes confidenceIntervalFade {
        0% {
          opacity: 0;
          transform: scale(0.8);
        }
        100% {
          opacity: 0.3;
          transform: scale(1);
        }
      }

      /* ç»“æœæ˜¾ç¤ºåŠ¨ç”» */
      .result-slide-in {
        animation: resultSlideIn 0.8s ease-out;
      }

      @keyframes resultSlideIn {
        0% {
          transform: translateY(20px);
          opacity: 0;
        }
        100% {
          transform: translateY(0);
          opacity: 1;
        }
      }

      /* æŒ‰é’®ç‚¹å‡»æ•ˆæœ */
      .button-click-effect {
        animation: buttonClickEffect 0.3s ease-out;
      }

      @keyframes buttonClickEffect {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(0.95);
        }
        100% {
          transform: scale(1);
        }
      }

      /* è„‰å†²æ•ˆæœ */
      .pulse-effect {
        animation: pulseEffect 2s ease-in-out infinite;
      }

      @keyframes pulseEffect {
        0%,
        100% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.05);
          opacity: 0.8;
        }
      }

      /* æ•°æ®åŠ è½½åŠ¨ç”» */
      .loading-dots {
        display: inline-block;
      }

      .loading-dots::after {
        content: "";
        animation: loadingDots 1.5s steps(4, end) infinite;
      }

      @keyframes loadingDots {
        0%,
        20% {
          content: "";
        }
        40% {
          content: ".";
        }
        60% {
          content: "..";
        }
        80%,
        100% {
          content: "...";
        }
      }

      /* æˆåŠŸæç¤ºåŠ¨ç”» */
      .success-flash {
        animation: successFlash 0.6s ease-out;
      }

      @keyframes successFlash {
        0% {
          background-color: transparent;
        }
        50% {
          background-color: rgba(0, 255, 102, 0.2);
        }
        100% {
          background-color: transparent;
        }
      }
    </style>
  </head>
  <body>
    <!-- ç²’å­èƒŒæ™¯ -->
    <div id="particles-container"></div>

    <!-- å¯¼èˆªæ  -->
    <nav
      class="bg-dark-bg/80 backdrop-blur-md py-4 sticky top-0 z-50 border-b border-gray-800"
    >
      <div class="container mx-auto px-4 flex justify-between items-center">
        <a
          href="index.html"
          class="text-2xl font-future font-bold flex items-center"
        >
          <span class="text-neon-blue">æ¦‚ç‡ç»Ÿè®¡</span
          ><span class="ml-2">å¯è§†åŒ–</span>
        </a>
        <div class="flex space-x-6">
          <a
            href="index.html"
            class="text-gray-300 hover:text-neon-blue transition-colors duration-300"
            >é¦–é¡µ</a
          >
          <a
            href="random_variables.html"
            class="text-gray-300 hover:text-neon-blue transition-colors duration-300"
            >éšæœºå˜é‡</a
          >
          <a
            href="interval_estimation.html"
            class="text-neon-blue border-b-2 border-neon-blue pb-1"
            >åŒºé—´ä¼°è®¡</a
          >
        </div>
      </div>
    </nav>

    <!-- é¡µé¢æ ‡é¢˜ -->
    <section
      class="py-20 relative bg-gradient-to-b from-dark-bg to-dark-card/50 clip-path-slant"
    >
      <div class="absolute inset-0 bg-grid opacity-10"></div>
      <div class="container mx-auto px-4 relative z-10">
        <div class="text-center mb-16">
          <h1 class="text-[clamp(2rem,6vw,4rem)] font-future font-bold mb-4">
            <span class="text-neon-blue">åŒºé—´ä¼°è®¡</span>æ¢ç´¢
          </h1>
          <p class="text-gray-400 max-w-2xl mx-auto">
            ç”¨æ ·æœ¬æ„å»ºä¸€ä¸ªæœ‰ä¿¡å¿ƒçš„èŒƒå›´ï¼Œæ¢ç´¢ç½®ä¿¡åŒºé—´çš„å¥¥ç§˜
          </p>
        </div>
      </div>
    </section>

    <!-- ç¤ºä¾‹å±•ç¤ºéƒ¨åˆ† -->
    <section id="candy-box-demo" class="py-20 relative">
      <div class="absolute inset-0 bg-grid opacity-10"></div>
      <div class="container mx-auto px-4 relative z-10">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-future font-bold mb-4">
            <span class="text-neon-orange">ç¥ç§˜ç³–æœç›’</span>çŒœæƒ³
          </h2>
          <p class="text-gray-400 max-w-3xl mx-auto">
            é€šè¿‡ä¸€ä¸ªç›´è§‚çš„ä¾‹å­ï¼Œç¬é—´ç†è§£ä»€ä¹ˆæ˜¯åŒºé—´ä¼°è®¡å’Œç½®ä¿¡æ°´å¹³
          </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
          <!-- ç³–æœç›’äº¤äº’åŒº -->
          <div class="bg-dark-card rounded-xl p-6 border border-gray-800">
            <h3
              class="text-xl font-future font-semibold mb-6 text-white flex items-center"
            >
              <i class="fa fa-cloud-rain text-neon-orange mr-3"></i>
              æ¹¿åº¦è­¦æŠ¥å™¨å®éªŒ
            </h3>

            <div class="candy-box mb-6 text-center">
              <div class="text-white font-bold mb-4">æ™ºèƒ½æ¹¿åº¦è­¦æŠ¥å™¨</div>
              <div
                id="candy-display"
                class="min-h-[100px] flex flex-wrap justify-center items-center"
              >
                <div class="text-gray-300">ç‚¹å‡»"è®°å½•æ ·æœ¬"å¼€å§‹å®éªŒ</div>
              </div>
            </div>

            <div class="bg-dark-bg rounded-lg p-4 mb-6">
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-gray-300 mb-2">æ ·æœ¬é‡ (n):</label>
                  <select
                    id="sample-size"
                    class="w-full bg-gray-800 text-white py-2 px-3 rounded-lg border border-gray-700"
                  >
                    <option value="20">20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                  </select>
                </div>
                <div>
                  <label class="block text-gray-300 mb-2">ç½®ä¿¡æ°´å¹³:</label>
                  <select
                    id="confidence-level"
                    class="w-full bg-gray-800 text-white py-2 px-3 rounded-lg border border-gray-700"
                  >
                    <option value="0.90">90%</option>
                    <option value="0.95">95%</option>
                    <option value="0.99">99%</option>
                  </select>
                </div>
              </div>

              <div class="text-center mb-4">
                <div class="text-gray-300 mb-2">
                  æŠ¥è­¦åä¸‹é›¨æ¯”ä¾‹:
                  <span
                    id="sample-proportion"
                    class="text-neon-orange font-bold"
                    >--</span
                  >
                </div>
                <div class="text-gray-300 mb-4">
                  ç½®ä¿¡åŒºé—´:
                  <span
                    id="confidence-interval-text"
                    class="text-neon-blue font-bold"
                    >--</span
                  >
                </div>
              </div>

              <div class="flex justify-center space-x-4">
                <button
                  id="sample-btn"
                  class="px-6 py-2 bg-neon-orange text-dark-bg font-bold rounded-md hover:bg-neon-orange/80 transition-all duration-300"
                >
                  è®°å½•æ ·æœ¬ <i class="fa fa-clipboard ml-2"></i>
                </button>
                <button
                  id="reveal-truth-btn"
                  class="px-6 py-2 bg-neon-purple text-dark-bg font-bold rounded-md hover:bg-neon-purple/80 transition-all duration-300"
                >
                  æ­ç¤ºçœŸç›¸ <i class="fa fa-eye ml-2"></i>
                </button>
                <button
                  id="repeat-experiment-btn"
                  class="px-6 py-2 bg-neon-green text-dark-bg font-bold rounded-md hover:bg-neon-green/80 transition-all duration-300"
                >
                  é‡å¤100æ¬¡ <i class="fa fa-repeat ml-2"></i>
                </button>
              </div>
            </div>

            <div class="text-sm text-gray-400">
              <p class="mb-2"><strong>å®éªŒè¯´æ˜:</strong></p>
              <p>â€¢ æ¹¿åº¦è­¦æŠ¥å™¨åœ¨æ¹¿åº¦è¾¾åˆ°é˜ˆå€¼æ—¶å‘å‡ºè­¦æŠ¥</p>
              <p>â€¢ è®°å½•è­¦æŠ¥åä¸€æ®µæ—¶é—´å†…æ˜¯å¦ä¸‹é›¨ï¼ˆçœŸå®æ¦‚ç‡0.6ï¼‰</p>
              <p>â€¢ é€šè¿‡æŠ½æ ·ä¼°è®¡æŠ¥è­¦åä¸‹é›¨çš„æ¦‚ç‡</p>
              <p>â€¢ è§‚å¯Ÿç½®ä¿¡åŒºé—´å¦‚ä½•"æ•æ‰"çœŸå®å€¼</p>
            </div>
          </div>

          <!-- ç½®ä¿¡åŒºé—´å¯è§†åŒ– -->
          <div class="bg-dark-card rounded-xl p-6 border border-gray-800">
            <h3
              class="text-xl font-future font-semibold mb-6 text-white flex items-center"
            >
              <i class="fa fa-chart-line text-neon-blue mr-3"></i>
              ç½®ä¿¡åŒºé—´å¯è§†åŒ–
            </h3>

            <div class="mb-6">
              <div class="text-center mb-4">
                <div class="text-gray-300">
                  æˆåŠŸæ•æ‰çœŸå®å€¼çš„åŒºé—´:
                  <span id="success-count" class="text-neon-green font-bold"
                    >0</span
                  >
                  / <span id="total-intervals" class="text-gray-400">0</span>
                </div>
                <div class="text-gray-300">
                  æˆåŠŸç‡:
                  <span id="success-rate" class="text-neon-blue font-bold"
                    >--%</span
                  >
                </div>
              </div>

              <div
                id="intervals-container"
                class="relative bg-dark-bg rounded-lg p-4 min-h-[300px] overflow-y-auto"
              >
                <div class="text-gray-400 text-center py-8">
                  ç‚¹å‡»"é‡å¤100æ¬¡"æŸ¥çœ‹ç½®ä¿¡åŒºé—´åˆ†å¸ƒ
                </div>
              </div>
            </div>

            <div
              class="text-sm text-gray-400 sticky bottom-0 bg-dark-bg/90 backdrop-blur-sm p-4 rounded-lg border border-gray-700/50"
            >
              <p class="mb-2"><strong>å›¾ä¾‹:</strong></p>
              <div class="flex items-center mb-1">
                <div class="w-4 h-4 bg-neon-green rounded mr-2"></div>
                <span>åŒ…å«çœŸå®å€¼çš„åŒºé—´</span>
              </div>
              <div class="flex items-center mb-1">
                <div class="w-4 h-4 bg-red-500 rounded mr-2"></div>
                <span>æœªåŒ…å«çœŸå®å€¼çš„åŒºé—´</span>
              </div>
              <div class="flex items-center">
                <div class="w-1 h-4 bg-yellow-400 mr-2"></div>
                <span>çœŸå®å€¼ä½ç½®</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ç†è®ºæ¢ç´¢éƒ¨åˆ† -->
    <section
      id="theory-exploration"
      class="py-20 relative bg-gradient-to-b from-dark-bg to-dark-card/50"
    >
      <div class="absolute inset-0 bg-grid opacity-10"></div>
      <div class="container mx-auto px-4 relative z-10">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-future font-bold mb-4">
            <span class="text-neon-blue">ç†è®º</span>æ¢ç´¢
          </h2>
          <p class="text-gray-400 max-w-3xl mx-auto">
            æ­ç§˜ç½®ä¿¡åŒºé—´ï¼šä»æŠ½æ ·åˆ†å¸ƒåˆ°æœ€ç»ˆå…¬å¼çš„æ¨å¯¼ä¹‹æ—…
          </p>
        </div>

        <div class="max-w-4xl mx-auto">
          <!-- æ¸è¿›å¼å­¦ä¹ æç¤º -->
          <div
            class="bg-neon-blue/10 border border-neon-blue/30 rounded-lg p-4 mb-8"
          >
            <div class="flex items-center mb-2">
              <i class="fa fa-lightbulb text-neon-blue mr-2"></i>
              <h3 class="text-lg font-semibold text-neon-blue">
                æ¸è¿›å¼å­¦ä¹ æ¨¡å¼
              </h3>
            </div>
            <p class="text-gray-300 text-sm">
              æ¯å®Œæˆä¸€ä¸ªæ­¥éª¤çš„ç†è§£åº¦è¯„åˆ†ï¼ˆâ‰¥3åˆ†ï¼‰ï¼Œä¸‹ä¸€æ­¥éª¤å°†è‡ªåŠ¨è§£é”ã€‚å¦‚æœé‡åˆ°å›°éš¾ï¼Œå¯ä»¥ç‚¹å‡»å³ä¾§å·¥å…·ç®±ä¸­çš„AIåŠ©æ‰‹å¯»æ±‚å¸®åŠ©ã€‚
            </p>
          </div>

          <!-- æ­¥éª¤1 -->
          <div class="theory-step unlocked" data-step="1">
            <h3
              class="text-xl font-semibold mb-4 text-neon-blue flex items-center"
            >
              <span
                class="bg-neon-blue text-dark-bg rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                >1</span
              >
              èµ·ç‚¹â€”â€”æˆ‘ä»¬æœ€å¥½çš„çŒœæµ‹ (ç‚¹ä¼°è®¡)
              <span class="ml-auto text-sm">
                <i class="fa fa-unlock text-neon-green"></i>
              </span>
            </h3>
            <div class="message-content">
              <p>
                è¦ä¼°è®¡ä¸€ä¸ªæœªçŸ¥çš„æ€»ä½“å‡å€¼
                Î¼ï¼Œæˆ‘ä»¬æœ€ç›´æ¥ã€æœ€å¥½çš„æ–¹æ³•å°±æ˜¯è®¡ç®—æ ·æœ¬å‡å€¼ $\bar{X}$ã€‚
              </p>
              <div class="bg-dark-bg rounded-lg p-4 my-4">
                <div class="text-center">
                  $$\bar{X} = \frac{1}{n} \sum_{i=1}^{n} X_i$$
                </div>
              </div>
              <p>
                ä½†æ˜¯ï¼Œå•å‡­ä¸€ä¸ª
                $\bar{X}$ï¼Œæˆ‘ä»¬ä¸çŸ¥é“è¿™ä¸ªä¼°è®¡çš„'è¯¯å·®'æœ‰å¤šå¤§ã€‚æˆ‘ä»¬éœ€è¦ç”¨æ¦‚ç‡çš„è¯­è¨€æ¥é‡åŒ–è¿™ä¸ªä¸ç¡®å®šæ€§ã€‚
              </p>
            </div>
            <div class="understanding-section">
              <div class="understanding-buttons">
                <span class="text-sm text-gray-400 mr-4">ç†è§£ç¨‹åº¦ï¼š</span>
                <button
                  class="understanding-btn"
                  data-level="1"
                  title="å®Œå…¨ä¸ç†è§£"
                >
                  1
                </button>
                <button
                  class="understanding-btn"
                  data-level="2"
                  title="åŸºæœ¬ä¸ç†è§£"
                >
                  2
                </button>
                <button
                  class="understanding-btn"
                  data-level="3"
                  title="éƒ¨åˆ†ç†è§£"
                >
                  3
                </button>
                <button
                  class="understanding-btn"
                  data-level="4"
                  title="åŸºæœ¬ç†è§£"
                >
                  4
                </button>
                <button
                  class="understanding-btn"
                  data-level="5"
                  title="å®Œå…¨ç†è§£"
                >
                  5
                </button>
              </div>
              <div class="mt-3 flex items-center gap-4">
                <button class="ai-help-btn" data-step="1">
                  <i class="fa fa-robot mr-2"></i>éœ€è¦AIå¸®åŠ©ï¼Ÿ
                </button>
                <div class="next-step-hint hidden text-sm text-neon-green">
                  <i class="fa fa-check-circle mr-1"></i>å¾ˆå¥½ï¼ä¸‹ä¸€æ­¥å·²è§£é”
                </div>
              </div>
            </div>
          </div>

          <!-- æ­¥éª¤2 -->
          <div class="theory-step locked" data-step="2">
            <h3
              class="text-xl font-semibold mb-4 text-gray-500 flex items-center"
            >
              <span
                class="bg-gray-600 text-gray-400 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                >2</span
              >
              é’¥åŒ™â€”â€”æŠ½æ ·åˆ†å¸ƒä¸ä¸­å¿ƒæé™å®šç† (CLT)
              <span class="ml-auto text-sm">
                <i class="fa fa-lock text-gray-500"></i>
              </span>
            </h3>
            <div class="message-content opacity-50">
              <p>
                ç¥å¥‡çš„å®šç†æ¥äº†ï¼šä¸­å¿ƒæé™å®šç†ï¼ˆCLTï¼‰å‘Šè¯‰æˆ‘ä»¬ï¼Œæ— è®ºæ€»ä½“æ˜¯ä»€ä¹ˆåˆ†å¸ƒï¼Œåªè¦æ ·æœ¬é‡nè¶³å¤Ÿå¤§ï¼Œæ ·æœ¬å‡å€¼
                $\bar{X}$ çš„åˆ†å¸ƒå°±ä¼šæ¥è¿‘ä¸€ä¸ª<strong>æ­£æ€åˆ†å¸ƒ</strong>ã€‚
              </p>
              <div class="bg-dark-bg rounded-lg p-4 my-4">
                <div class="text-center">
                  $$\bar{X} \sim N\left(\mu, \frac{\sigma^2}{n}\right)$$
                </div>
              </div>
              <p>
                è¿™ä¸ªåˆ†å¸ƒä»¥çœŸæ­£çš„ Î¼ ä¸ºä¸­å¿ƒï¼Œå…¶æ³¢åŠ¨èŒƒå›´ç”±
                $\frac{\sigma^2}{n}$ï¼ˆæ–¹å·®é™¤ä»¥æ ·æœ¬é‡ï¼‰å†³å®šã€‚nè¶Šå¤§ï¼Œåˆ†å¸ƒè¶Šé›†ä¸­ï¼Œ$\bar{X}$
                ä½œä¸ºä¼°è®¡å°±è¶Šå‡†ã€‚
              </p>
            </div>
            <div class="understanding-section">
              <div class="locked-message text-center py-4">
                <i class="fa fa-lock text-gray-500 text-2xl mb-2"></i>
                <p class="text-gray-500">
                  è¯·å…ˆå®Œæˆä¸Šä¸€æ­¥éª¤çš„ç†è§£åº¦è¯„åˆ†ï¼ˆâ‰¥3åˆ†ï¼‰ä»¥è§£é”æ­¤å†…å®¹
                </p>
              </div>
              <div class="understanding-content hidden">
                <div class="understanding-buttons">
                  <span class="text-sm text-gray-400 mr-4">ç†è§£ç¨‹åº¦ï¼š</span>
                  <button
                    class="understanding-btn"
                    data-level="1"
                    title="å®Œå…¨ä¸ç†è§£"
                  >
                    1
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="2"
                    title="åŸºæœ¬ä¸ç†è§£"
                  >
                    2
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="3"
                    title="éƒ¨åˆ†ç†è§£"
                  >
                    3
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="4"
                    title="åŸºæœ¬ç†è§£"
                  >
                    4
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="5"
                    title="å®Œå…¨ç†è§£"
                  >
                    5
                  </button>
                </div>
                <div class="mt-3 flex items-center gap-4">
                  <button class="ai-help-btn" data-step="2">
                    <i class="fa fa-robot mr-2"></i>éœ€è¦AIå¸®åŠ©ï¼Ÿ
                  </button>
                  <div class="next-step-hint hidden text-sm text-neon-green">
                    <i class="fa fa-check-circle mr-1"></i>å¾ˆå¥½ï¼ä¸‹ä¸€æ­¥å·²è§£é”
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- æ­¥éª¤3 -->
          <div class="theory-step locked" data-step="3">
            <h3
              class="text-xl font-semibold mb-4 text-gray-500 flex items-center"
            >
              <span
                class="bg-gray-600 text-gray-400 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                >3</span
              >
              è½¬æ¢â€”â€”æ„é€ æ¢è½´é‡ (Pivotal Quantity)
              <span class="ml-auto text-sm">
                <i class="fa fa-lock text-gray-500"></i>
              </span>
            </h3>
            <div class="message-content opacity-50">
              <p>
                æ—¢ç„¶çŸ¥é“äº†$\bar{X}$çš„åˆ†å¸ƒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>æ ‡å‡†åŒ–</strong>ï¼Œå°†å…¶è½¬åŒ–ä¸ºè‘—åçš„Zå€¼ã€‚è¿™ä¸ªæ–°çš„é‡ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º'æ¢è½´é‡'ã€‚
              </p>
              <div class="bg-dark-bg rounded-lg p-4 my-4">
                <div class="text-center">
                  $$Z = \frac{\bar{X} - \mu}{\sigma/\sqrt{n}}$$
                </div>
              </div>
              <p>
                æœ€å…³é”®çš„ä¸€ç‚¹æ¥äº†ï¼š<strong
                  >Zçš„åˆ†å¸ƒæ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒ N(0,
                  1)ï¼Œè€Œä¸”å®ƒçš„åˆ†å¸ƒå®Œå…¨å·²çŸ¥ï¼Œä¸å†ä¾èµ–äºä»»ä½•æœªçŸ¥å‚æ•°ï¼ˆÎ¼æˆ–Ïƒï¼‰ï¼</strong
                >
                è¿™å°±ä¸ºæˆ‘ä»¬æ„é€ åŒºé—´æä¾›äº†å¯èƒ½ã€‚
              </p>
              <div class="bg-dark-bg rounded-lg p-4 my-4">
                <div class="text-center">$$Z \sim N(0, 1)$$</div>
              </div>
            </div>
            <div class="understanding-section">
              <div class="locked-message text-center py-4">
                <i class="fa fa-lock text-gray-500 text-2xl mb-2"></i>
                <p class="text-gray-500">
                  è¯·å…ˆå®Œæˆä¸Šä¸€æ­¥éª¤çš„ç†è§£åº¦è¯„åˆ†ï¼ˆâ‰¥3åˆ†ï¼‰ä»¥è§£é”æ­¤å†…å®¹
                </p>
              </div>
              <div class="understanding-content hidden">
                <div class="understanding-buttons">
                  <span class="text-sm text-gray-400 mr-4">ç†è§£ç¨‹åº¦ï¼š</span>
                  <button
                    class="understanding-btn"
                    data-level="1"
                    title="å®Œå…¨ä¸ç†è§£"
                  >
                    1
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="2"
                    title="åŸºæœ¬ä¸ç†è§£"
                  >
                    2
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="3"
                    title="éƒ¨åˆ†ç†è§£"
                  >
                    3
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="4"
                    title="åŸºæœ¬ç†è§£"
                  >
                    4
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="5"
                    title="å®Œå…¨ç†è§£"
                  >
                    5
                  </button>
                </div>
                <div class="mt-3 flex items-center gap-4">
                  <button class="ai-help-btn" data-step="3">
                    <i class="fa fa-robot mr-2"></i>éœ€è¦AIå¸®åŠ©ï¼Ÿ
                  </button>
                  <div class="next-step-hint hidden text-sm text-neon-green">
                    <i class="fa fa-check-circle mr-1"></i>å¾ˆå¥½ï¼ä¸‹ä¸€æ­¥å·²è§£é”
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- æ­¥éª¤4 -->
          <div class="theory-step locked" data-step="4">
            <h3
              class="text-xl font-semibold mb-4 text-gray-500 flex items-center"
            >
              <span
                class="bg-gray-600 text-gray-400 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                >4</span
              >
              æ¦‚ç‡è¡¨è¿°â€”â€”æ‰¾åˆ°ä¸´ç•Œå€¼
              <span class="ml-auto text-sm">
                <i class="fa fa-lock text-gray-500"></i>
              </span>
            </h3>
            <div class="message-content opacity-50">
              <p>
                å› ä¸ºZæœä»æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾æ±‚å‡ºï¼ŒZå€¼è½åœ¨$-Z_{\alpha/2}$å’Œ$Z_{\alpha/2}$ä¹‹é—´çš„æ¦‚ç‡æ˜¯
                $(1-\alpha)$ã€‚
              </p>
              <div class="bg-dark-bg rounded-lg p-4 my-4">
                <div class="text-center">
                  $$P\left( -Z_{\alpha/2} \leq Z \leq Z_{\alpha/2} \right) = 1 -
                  \alpha$$
                </div>
              </div>
              <p>ç°åœ¨ï¼Œæˆ‘ä»¬æŠŠæ­¥éª¤3çš„Zä»£å›å»ï¼</p>
              <div class="bg-dark-bg rounded-lg p-4 my-4">
                <div class="text-center">
                  $$P\left( -Z_{\alpha/2} \leq \frac{\bar{X} -
                  \mu}{\sigma/\sqrt{n}} \leq Z_{\alpha/2} \right) = 1 - \alpha$$
                </div>
              </div>
            </div>
            <div class="understanding-section">
              <div class="locked-message text-center py-4">
                <i class="fa fa-lock text-gray-500 text-2xl mb-2"></i>
                <p class="text-gray-500">
                  è¯·å…ˆå®Œæˆä¸Šä¸€æ­¥éª¤çš„ç†è§£åº¦è¯„åˆ†ï¼ˆâ‰¥3åˆ†ï¼‰ä»¥è§£é”æ­¤å†…å®¹
                </p>
              </div>
              <div class="understanding-content hidden">
                <div class="understanding-buttons">
                  <span class="text-sm text-gray-400 mr-4">ç†è§£ç¨‹åº¦ï¼š</span>
                  <button
                    class="understanding-btn"
                    data-level="1"
                    title="å®Œå…¨ä¸ç†è§£"
                  >
                    1
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="2"
                    title="åŸºæœ¬ä¸ç†è§£"
                  >
                    2
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="3"
                    title="éƒ¨åˆ†ç†è§£"
                  >
                    3
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="4"
                    title="åŸºæœ¬ç†è§£"
                  >
                    4
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="5"
                    title="å®Œå…¨ç†è§£"
                  >
                    5
                  </button>
                </div>
                <div class="mt-3 flex items-center gap-4">
                  <button class="ai-help-btn" data-step="4">
                    <i class="fa fa-robot mr-2"></i>éœ€è¦AIå¸®åŠ©ï¼Ÿ
                  </button>
                  <div class="next-step-hint hidden text-sm text-neon-green">
                    <i class="fa fa-check-circle mr-1"></i>å¾ˆå¥½ï¼ä¸‹ä¸€æ­¥å·²è§£é”
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- æ­¥éª¤5 -->
          <div class="theory-step locked" data-step="5">
            <h3
              class="text-xl font-semibold mb-4 text-gray-500 flex items-center"
            >
              <span
                class="bg-gray-600 text-gray-400 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold"
                >5</span
              >
              æ±‚è§£â€”â€”å¾—åˆ°ç½®ä¿¡åŒºé—´
              <span class="ml-auto text-sm">
                <i class="fa fa-lock text-gray-500"></i>
              </span>
            </h3>
            <div class="message-content opacity-50">
              <p>
                æœ€åä¸€æ­¥ï¼æˆ‘ä»¬å¯¹ä¸ç­‰å¼è¿›è¡Œä»£æ•°å˜å½¢ï¼Œç›®çš„æ˜¯è§£å‡ºè¢«åŒ…å›´åœ¨ä¸­é—´çš„ Î¼ã€‚
              </p>
              <p>
                <strong
                  >1. ä¸ç­‰å¼å„éƒ¨åˆ†åŒæ—¶ä¹˜ä»¥ $\frac{\sigma}{\sqrt{n}}$ï¼š</strong
                >
              </p>
              <div class="bg-dark-bg rounded-lg p-4 my-2">
                <div class="text-center">
                  $$-Z_{\alpha/2} \cdot \frac{\sigma}{\sqrt{n}} \leq \bar{X} -
                  \mu \leq Z_{\alpha/2} \cdot \frac{\sigma}{\sqrt{n}}$$
                </div>
              </div>
              <p><strong>2. ä¸ç­‰å¼å„éƒ¨åˆ†åŒæ—¶å‡å» $\bar{X}$ï¼š</strong></p>
              <div class="bg-dark-bg rounded-lg p-4 my-2">
                <div class="text-center">
                  $$-\bar{X} - Z_{\alpha/2} \cdot \frac{\sigma}{\sqrt{n}} \leq
                  -\mu \leq -\bar{X} + Z_{\alpha/2} \cdot
                  \frac{\sigma}{\sqrt{n}}$$
                </div>
              </div>
              <p>
                <strong
                  >3. ä¸ç­‰å¼å„éƒ¨åˆ†åŒæ—¶ä¹˜ä»¥ -1ï¼ˆæ³¨æ„ï¼šä¹˜è´Ÿæ•°è¦å˜å·ï¼ï¼‰ï¼š</strong
                >
              </p>
              <div class="bg-dark-bg rounded-lg p-4 my-2">
                <div class="text-center">
                  $$\bar{X} + Z_{\alpha/2} \cdot \frac{\sigma}{\sqrt{n}} \geq
                  \mu \geq \bar{X} - Z_{\alpha/2} \cdot
                  \frac{\sigma}{\sqrt{n}}$$
                </div>
              </div>
              <p><strong>4. æ”¹å†™ä¸ºä¼ ç»Ÿçš„åŒºé—´å½¢å¼ï¼š</strong></p>
              <div
                class="bg-dark-bg rounded-lg p-4 my-4 border border-neon-green"
              >
                <div class="text-center">
                  $$P\left( \bar{X} - Z_{\alpha/2} \cdot \frac{\sigma}{\sqrt{n}}
                  \leq \mu \leq \bar{X} + Z_{\alpha/2} \cdot
                  \frac{\sigma}{\sqrt{n}} \right) = 1 - \alpha$$
                </div>
              </div>
              <p class="text-neon-green font-bold">
                å¤§åŠŸå‘Šæˆï¼è¿™å°±æ˜¯ç½®ä¿¡åŒºé—´çš„å…¬å¼ã€‚åŒºé—´ $\left[\bar{X} \pm
                Z_{\alpha/2} \cdot \frac{\sigma}{\sqrt{n}}\right]$ ä»¥
                $(1-\alpha)$ çš„ç½®ä¿¡æ°´å¹³åŒ…å«äº†æœªçŸ¥å‚æ•° Î¼ã€‚
              </p>
            </div>
            <div class="understanding-section">
              <div class="locked-message text-center py-4">
                <i class="fa fa-lock text-gray-500 text-2xl mb-2"></i>
                <p class="text-gray-500">
                  è¯·å…ˆå®Œæˆä¸Šä¸€æ­¥éª¤çš„ç†è§£åº¦è¯„åˆ†ï¼ˆâ‰¥3åˆ†ï¼‰ä»¥è§£é”æ­¤å†…å®¹
                </p>
              </div>
              <div class="understanding-content hidden">
                <div class="understanding-buttons">
                  <span class="text-sm text-gray-400 mr-4">ç†è§£ç¨‹åº¦ï¼š</span>
                  <button
                    class="understanding-btn"
                    data-level="1"
                    title="å®Œå…¨ä¸ç†è§£"
                  >
                    1
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="2"
                    title="åŸºæœ¬ä¸ç†è§£"
                  >
                    2
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="3"
                    title="éƒ¨åˆ†ç†è§£"
                  >
                    3
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="4"
                    title="åŸºæœ¬ç†è§£"
                  >
                    4
                  </button>
                  <button
                    class="understanding-btn"
                    data-level="5"
                    title="å®Œå…¨ç†è§£"
                  >
                    5
                  </button>
                </div>
                <div class="mt-3 flex items-center gap-4">
                  <button class="ai-help-btn" data-step="5">
                    <i class="fa fa-robot mr-2"></i>éœ€è¦AIå¸®åŠ©ï¼Ÿ
                  </button>
                  <div class="next-step-hint hidden text-sm text-neon-green">
                    <i class="fa fa-check-circle mr-1"></i>æ­å–œï¼æ‰€æœ‰æ­¥éª¤å·²å®Œæˆ
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ç†è§£åº¦å›¾è°± -->
          <div id="understanding-radar" class="understanding-radar hidden">
            <h3
              class="text-xl font-semibold mb-4 text-neon-green flex items-center"
            >
              <i class="fa fa-chart-radar text-neon-green mr-3"></i>
              ä¸ªäººç†è§£åº¦å›¾è°±ä¸å­¦ä¹ åˆ†æ
            </h3>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- é›·è¾¾å›¾ -->
              <div class="bg-dark-bg rounded-lg p-4">
                <h4 class="text-lg font-semibold mb-3 text-white">
                  ç†è§£åº¦é›·è¾¾å›¾
                </h4>
                <div class="h-64">
                  <canvas id="understanding-chart"></canvas>
                </div>
              </div>

              <!-- å­¦ä¹ æ•°æ®åˆ†æ -->
              <div class="bg-dark-bg rounded-lg p-4">
                <h4 class="text-lg font-semibold mb-3 text-white">
                  å­¦ä¹ æ•°æ®åˆ†æ
                </h4>
                <div id="learning-stats" class="space-y-3">
                  <div class="flex justify-between items-center">
                    <span class="text-gray-300">å¹³å‡ç†è§£åº¦:</span>
                    <span
                      id="avg-understanding"
                      class="text-neon-blue font-bold"
                      >-</span
                    >
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-300">æœ€è–„å¼±ç¯èŠ‚:</span>
                    <span id="weakest-step" class="text-neon-orange font-bold"
                      >-</span
                    >
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-300">æœ€å¼ºé¡¹:</span>
                    <span id="strongest-step" class="text-neon-green font-bold"
                      >-</span
                    >
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-300">å®Œæˆæ—¶é—´:</span>
                    <span
                      id="completion-time"
                      class="text-neon-purple font-bold"
                      >-</span
                    >
                  </div>
                </div>

                <!-- å­¦ä¹ å»ºè®® -->
                <div class="mt-4 p-3 bg-gray-800 rounded-lg">
                  <h5 class="text-sm font-semibold text-neon-green mb-2">
                    ğŸ“š ä¸ªæ€§åŒ–å­¦ä¹ å»ºè®®
                  </h5>
                  <div id="learning-suggestions" class="text-sm text-gray-300">
                    å®Œæˆæ‰€æœ‰æ­¥éª¤åå°†æ˜¾ç¤ºä¸ªæ€§åŒ–å»ºè®®
                  </div>
                </div>
              </div>
            </div>

            <div class="text-sm text-gray-400 mt-4">
              <p>
                <i class="fa fa-info-circle mr-1"></i>
                è¿™ä¸ªå›¾è°±è®°å½•äº†æ‚¨çš„å­¦ä¹ è½¨è¿¹ï¼Œå¸®åŠ©è¯†åˆ«éœ€è¦é‡ç‚¹å¤ä¹ çš„å†…å®¹ã€‚æ•°æ®ä»…åœ¨æœ¬åœ°å­˜å‚¨ï¼Œä¿æŠ¤æ‚¨çš„éšç§ã€‚
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- å®è·µåº”ç”¨éƒ¨åˆ† -->
    <section id="practical-applications" class="py-20 relative">
      <div class="absolute inset-0 bg-grid opacity-10"></div>
      <div class="container mx-auto px-4 relative z-10">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-future font-bold mb-4">
            <span class="text-neon-green">å®è·µ</span>åº”ç”¨
          </h2>
          <p class="text-gray-400 max-w-3xl mx-auto">
            å°†åŒºé—´ä¼°è®¡ç†è®ºåº”ç”¨åˆ°çœŸå®åœºæ™¯ä¸­
          </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
          <!-- å†›äº‹åˆ†æåº”ç”¨ -->
          <div class="bg-dark-card rounded-xl p-6 border border-gray-800">
            <h3
              class="text-xl font-future font-semibold mb-6 text-white flex items-center"
            >
              <i class="fa fa-crosshairs text-neon-orange mr-3"></i>
              å†›äº‹åˆ†æï¼šå¯»æ‰¾é—å¤±çš„ç‚®å¼¹
            </h3>

            <div class="mb-6">
              <p class="text-gray-300 mb-4">
                ä¸€æ¶æˆ˜æœºåœ¨è®­ç»ƒæµ·åŸŸé—å¤±ä¸€é—¨ç‚®å¼¹ã€‚ä½¿ç”¨å£°çº³æµ®æ ‡è¿›è¡Œæœç´¢ï¼Œæ¯ä¸ªæµ®æ ‡çš„æ¢æµ‹å­˜åœ¨éšæœºè¯¯å·®ã€‚
              </p>

              <div class="bg-dark-bg rounded-lg p-4 mb-4">
                <div class="grid grid-cols-3 gap-4 mb-4">
                  <div>
                    <label class="block text-gray-300 mb-2"
                      >å£°çº³ç²¾åº¦ (Ïƒ):</label
                    >
                    <select
                      id="sonar-accuracy"
                      class="w-full bg-gray-800 text-white py-2 px-3 rounded-lg border border-gray-700"
                    >
                      <option value="0.1">é«˜ç²¾åº¦ (Â±0.1km)</option>
                      <option value="0.3" selected>ä¸­ç²¾åº¦ (Â±0.3km)</option>
                      <option value="0.5">ä½ç²¾åº¦ (Â±0.5km)</option>
                      <option value="1.0">æä½ç²¾åº¦ (Â±1.0km)</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-gray-300 mb-2">ç½®ä¿¡æ°´å¹³:</label>
                    <select
                      id="sonar-confidence"
                      class="w-full bg-gray-800 text-white py-2 px-3 rounded-lg border border-gray-700"
                    >
                      <option value="0.90">90%</option>
                      <option value="0.95" selected>95%</option>
                      <option value="0.99">99%</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-gray-300 mb-2">æŠ•æ”¾æ¨¡å¼:</label>
                    <select
                      id="deployment-mode"
                      class="w-full bg-gray-800 text-white py-2 px-3 rounded-lg border border-gray-700"
                    >
                      <option value="single">å•æ¬¡æŠ•æ”¾</option>
                      <option value="batch" selected>æ‰¹é‡æŠ•æ”¾</option>
                    </select>
                  </div>
                </div>

                <div class="text-center mb-4">
                  <div class="text-gray-300 mb-2">
                    ä¼°è®¡ä½ç½®:
                    <span
                      id="estimated-position"
                      class="text-neon-orange font-bold"
                      >(0.0, 0.0)</span
                    >
                  </div>
                  <div class="text-gray-300 mb-4">
                    æœç´¢åŒºåŸŸ:
                    <span id="search-area" class="text-neon-blue font-bold"
                      >-- kmÂ²</span
                    >
                  </div>
                </div>

                <div class="flex justify-center space-x-3 flex-wrap gap-2">
                  <button
                    id="deploy-single-btn"
                    class="px-4 py-2 bg-neon-orange text-dark-bg font-bold rounded-md hover:bg-neon-orange/80 transition-all duration-300"
                  >
                    æŠ•æ”¾1ä¸ªæµ®æ ‡ <i class="fa fa-anchor ml-2"></i>
                  </button>
                  <button
                    id="deploy-batch-btn"
                    class="px-4 py-2 bg-neon-blue text-white font-bold rounded-md hover:bg-neon-blue/80 transition-all duration-300"
                  >
                    æŠ•æ”¾10ä¸ªæµ®æ ‡ <i class="fa fa-ship ml-2"></i>
                  </button>
                  <button
                    id="reveal-shell-btn"
                    class="px-4 py-2 bg-neon-green text-dark-bg font-bold rounded-md hover:bg-neon-green/80 transition-all duration-300"
                  >
                    æ­ç¤ºçœŸå®ä½ç½® <i class="fa fa-eye ml-2"></i>
                  </button>
                  <button
                    id="reset-search-btn"
                    class="px-4 py-2 bg-gray-600 text-white font-bold rounded-md hover:bg-gray-500 transition-all duration-300"
                  >
                    é‡ç½®æœç´¢ <i class="fa fa-refresh ml-2"></i>
                  </button>
                  <button
                    id="debug-btn"
                    class="px-4 py-2 bg-purple-600 text-white font-bold rounded-md hover:bg-purple-500 transition-all duration-300"
                    style="display: none"
                  >
                    è°ƒè¯•ä¿¡æ¯ <i class="fa fa-bug ml-2"></i>
                  </button>
                </div>
              </div>
            </div>

            <div
              class="h-96 bg-dark-bg rounded-lg p-4 relative overflow-hidden"
            >
              <canvas
                id="sonar-map"
                width="800"
                height="600"
                style="
                  width: 100%;
                  height: 100%;
                  image-rendering: auto;
                  cursor: crosshair;
                "
                class="border border-gray-600 rounded"
              >
              </canvas>
              <!-- åæ ‡æ˜¾ç¤º -->
              <div
                id="sonar-coordinate-display"
                class="absolute top-2 left-2 bg-black/70 text-white px-2 py-1 rounded text-xs font-mono"
              >
                åæ ‡: (0, 0) km
              </div>
              <!-- ç¼©æ”¾æ§åˆ¶ -->
              <div class="absolute top-2 right-2 flex flex-col gap-1">
                <button
                  id="sonar-zoom-in"
                  class="bg-gray-700 hover:bg-gray-600 text-white w-8 h-8 rounded flex items-center justify-center text-sm"
                >
                  +
                </button>
                <button
                  id="sonar-zoom-out"
                  class="bg-gray-700 hover:bg-gray-600 text-white w-8 h-8 rounded flex items-center justify-center text-sm"
                >
                  -
                </button>
                <button
                  id="sonar-reset-view"
                  class="bg-gray-700 hover:bg-gray-600 text-white w-8 h-8 rounded flex items-center justify-center text-xs"
                >
                  âŒ‚
                </button>
              </div>
            </div>

            <!-- é¢„æµ‹ç»“æœåˆ†æåŒºåŸŸ -->
            <div
              id="prediction-feedback"
              class="mt-4 p-4 bg-gray-800 rounded-lg border border-gray-600"
              style="display: none"
            >
              <div class="flex items-center justify-between mb-3">
                <h3 class="text-lg font-bold text-neon-green flex items-center">
                  <i class="fa fa-chart-line mr-2"></i>
                  é¢„æµ‹ç»“æœåˆ†æ
                </h3>
                <button
                  id="close-feedback"
                  class="text-gray-400 hover:text-white transition-colors"
                >
                  <i class="fa fa-times"></i>
                </button>
              </div>
              <div
                id="feedback-content"
                class="text-sm text-gray-300 space-y-2"
              >
                <!-- åŠ¨æ€å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
              </div>
            </div>

            <div class="mt-4 text-sm text-gray-400">
              <p>
                <strong>æ ¸å¿ƒå…¬å¼:</strong> $\bar{X} \pm t_{\alpha/2}(n-1) \cdot
                \frac{S}{\sqrt{n}}$
              </p>
              <p>è§‚å¯Ÿç½®ä¿¡åŒºåŸŸå¦‚ä½•éšç€æ ·æœ¬é‡nçš„å¢åŠ è€Œç¼©å°ï¼</p>
            </div>
          </div>

          <!-- æ¸¸æˆç­–ç•¥åº”ç”¨ -->
          <div class="bg-dark-card rounded-xl p-6 border border-gray-800">
            <h3
              class="text-xl font-future font-semibold mb-6 text-white flex items-center"
            >
              <i class="fa fa-gamepad text-neon-purple mr-3"></i>
              æ¸¸æˆç­–ç•¥ï¼šã€Šæˆ‘çš„ä¸–ç•Œã€‹æœ«åœ°ä¹‹é—¨å®šä½
            </h3>

            <div class="mb-6">
              <p class="text-gray-300 mb-4">
                ç©å®¶æŠ•æ·æœ«å½±ä¹‹çœ¼å¯»æ‰¾æœ«åœ°è¦å¡ã€‚ç”±äºæ¸¸æˆæœºåˆ¶ï¼Œæ¯æ¬¡æŠ•æ·éƒ½å­˜åœ¨éšæœºè¯¯å·®ã€‚
              </p>

              <div class="bg-dark-bg rounded-lg p-4 mb-4">
                <div class="grid grid-cols-3 gap-4 mb-4">
                  <div>
                    <label class="block text-gray-300 mb-2">æŠ•æ·æ¬¡æ•°:</label>
                    <select
                      id="eye-count"
                      class="w-full bg-gray-800 text-white py-2 px-3 rounded-lg border border-gray-700"
                    >
                      <option value="5">5æ¬¡</option>
                      <option value="12" selected>12æ¬¡</option>
                      <option value="20">20æ¬¡</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-gray-300 mb-2">ç½®ä¿¡æ°´å¹³:</label>
                    <select
                      id="eye-confidence"
                      class="w-full bg-gray-800 text-white py-2 px-3 rounded-lg border border-gray-700"
                    >
                      <option value="0.90">90%</option>
                      <option value="0.95" selected>95%</option>
                      <option value="0.99">99%</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-gray-300 mb-2">Alphaå€¼ (Î±):</label>
                    <select
                      id="alpha-level"
                      class="w-full bg-gray-800 text-white py-2 px-3 rounded-lg border border-gray-700"
                    >
                      <option value="0.01">0.01</option>
                      <option value="0.05" selected>0.05</option>
                      <option value="0.10">0.10</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-gray-300 mb-2">ç»Ÿè®¡æ–¹æ³•:</label>
                    <select
                      id="statistical-method"
                      class="w-full bg-gray-800 text-white py-2 px-3 rounded-lg border border-gray-700"
                    >
                      <option value="classical">ç»å…¸ç»Ÿè®¡</option>
                      <option value="bayesian" selected>è´å¶æ–¯æ–¹æ³•</option>
                    </select>
                  </div>
                </div>

                <div id="bayesian-controls" class="mb-4">
                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <label class="block text-gray-300 mb-2">å…ˆéªŒåˆ†å¸ƒ:</label>
                      <select
                        id="prior-distribution"
                        class="w-full bg-gray-800 text-white py-2 px-3 rounded-lg border border-gray-700"
                      >
                        <option value="uniform" selected>å‡åŒ€åˆ†å¸ƒ</option>
                        <option value="normal">æ­£æ€åˆ†å¸ƒ</option>
                        <option value="informed">æœ‰ä¿¡æ¯å…ˆéªŒ</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-gray-300 mb-2">æ˜¾ç¤ºæ¨¡å¼:</label>
                      <select
                        id="display-mode"
                        class="w-full bg-gray-800 text-white py-2 px-3 rounded-lg border border-gray-700"
                      >
                        <option value="points">ç‚¹å›¾</option>
                        <option value="contour" selected>ç­‰é«˜çº¿</option>
                      </select>
                    </div>
                  </div>
                </div>

                <div class="text-center mb-4">
                  <div class="text-gray-300 mb-2">
                    è¦å¡é¢„æµ‹ä½ç½®:
                    <span
                      id="stronghold-position"
                      class="text-neon-purple font-bold"
                      >(0, 0)</span
                    >
                  </div>
                  <div class="text-gray-300 mb-2">
                    æœå¯»èŒƒå›´:
                    <span id="search-range" class="text-neon-blue font-bold"
                      >Â±-- æ ¼</span
                    >
                  </div>
                  <div class="text-gray-300 mb-4">
                    è§’åº¦ç½®ä¿¡åŒºé—´:
                    <span
                      id="angle-confidence-interval"
                      class="text-neon-green font-bold"
                      >--Â°</span
                    >
                  </div>

                  <!-- æˆåŠŸä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
                  <div
                    id="success-info"
                    class="mb-4 p-4 bg-gradient-to-r from-green-600 to-emerald-600 rounded-lg border border-green-400"
                    style="display: none"
                  >
                    <div class="text-center">
                      <div class="text-2xl mb-2">ğŸ‰ æ­å–œæ‰¾åˆ°è¦å¡ï¼ ğŸ‰</div>
                      <div class="text-lg mb-3 text-green-100">
                        è·ç¦»è¦å¡ä»…
                        <span
                          id="final-distance"
                          class="font-bold text-yellow-300"
                          >0</span
                        >
                        æ ¼
                      </div>
                      <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="bg-black/20 p-2 rounded">
                          <div class="text-green-200">æŠ•æ·æ¬¡æ•°</div>
                          <div class="font-bold text-xl" id="total-throws">
                            0
                          </div>
                        </div>
                        <div class="bg-black/20 p-2 rounded">
                          <div class="text-green-200">ä½¿ç”¨ä½ç½®</div>
                          <div class="font-bold text-xl" id="total-positions">
                            0
                          </div>
                        </div>
                        <div class="bg-black/20 p-2 rounded">
                          <div class="text-green-200">å¹³å‡è¯¯å·®</div>
                          <div class="font-bold text-xl" id="avg-error">0Â°</div>
                        </div>
                        <div class="bg-black/20 p-2 rounded">
                          <div class="text-green-200">æœ€ç»ˆç²¾åº¦</div>
                          <div class="font-bold text-xl" id="final-accuracy">
                            0%
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="flex justify-center space-x-4">
                  <button
                    id="throw-eye-btn"
                    class="px-6 py-2 bg-neon-purple text-dark-bg font-bold rounded-md hover:bg-neon-purple/80 transition-all duration-300"
                  >
                    æŠ•æ·æœ«å½±ä¹‹çœ¼ <i class="fa fa-eye ml-2"></i>
                  </button>
                  <button
                    id="move-player-btn"
                    class="px-6 py-2 bg-neon-blue text-white font-bold rounded-md hover:bg-neon-blue/80 transition-all duration-300"
                  >
                    ç§»åŠ¨ç©å®¶ä½ç½® <i class="fa fa-arrows-alt ml-2"></i>
                  </button>
                  <button
                    id="toggle-stronghold-btn"
                    class="px-6 py-2 bg-neon-orange text-dark-bg font-bold rounded-md hover:bg-neon-orange/80 transition-all duration-300"
                    style="display: none"
                  >
                    æ˜¾ç¤ºè¦å¡ä½ç½® <i class="fa fa-map-marker ml-2"></i>
                  </button>
                  <button
                    id="reset-game-btn"
                    class="px-6 py-2 bg-red-600 text-white font-bold rounded-md hover:bg-red-700 transition-all duration-300"
                  >
                    é‡ç½®æ¸¸æˆ <i class="fa fa-refresh ml-2"></i>
                  </button>
                </div>
              </div>
            </div>

            <div
              class="h-96 bg-dark-bg rounded-lg p-4 relative overflow-hidden"
            >
              <canvas
                id="minecraft-map"
                width="800"
                height="600"
                style="
                  width: 100%;
                  height: 100%;
                  image-rendering: pixelated;
                  cursor: crosshair;
                "
                class="border border-gray-600 rounded"
              >
              </canvas>
              <!-- åæ ‡æ˜¾ç¤º -->
              <div
                id="coordinate-display"
                class="absolute top-2 left-2 bg-black/70 text-white px-2 py-1 rounded text-xs font-mono"
              >
                åæ ‡: (0, 0)
              </div>
              <!-- ç¼©æ”¾æ§åˆ¶ -->
              <div class="absolute top-2 right-2 flex flex-col gap-1">
                <button
                  id="zoom-in"
                  class="bg-gray-700 hover:bg-gray-600 text-white w-8 h-8 rounded flex items-center justify-center text-sm"
                >
                  +
                </button>
                <button
                  id="zoom-out"
                  class="bg-gray-700 hover:bg-gray-600 text-white w-8 h-8 rounded flex items-center justify-center text-sm"
                >
                  -
                </button>
                <button
                  id="reset-view"
                  class="bg-gray-700 hover:bg-gray-600 text-white w-8 h-8 rounded flex items-center justify-center text-xs"
                >
                  âŒ‚
                </button>
              </div>
            </div>

            <div class="mt-4 text-sm text-gray-400">
              <p><strong>åŠ¨æ€æç¤º:</strong></p>
              <div id="minecraft-tips" class="text-neon-green">
                <p>å¼€å§‹æŠ•æ·æœ«å½±ä¹‹çœ¼æ¥å®šä½æœ«åœ°è¦å¡ï¼</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <script src="../static/js/toolbox.js"></script>
    <script>
      // å…¨å±€å˜é‡
      let rainAfterAlarmRatio = 0.6; // çœŸå®çš„æŠ¥è­¦åä¸‹é›¨æ¦‚ç‡
      let currentSample = [];
      let allIntervals = [];
      let understandingScores = [0, 0, 0, 0, 0];
      let sonarData = [];
      let eyeData = [];
      let playerPosition = { x: 0, z: 0 }; // ç©å®¶å½“å‰ä½ç½®
      let isThrowingEye = false; // é˜²æŠ–æ ‡å¿—ï¼Œé˜²æ­¢å¿«é€Ÿè¿ç»­ç‚¹å‡»
      let isMovingPlayer = false; // ç§»åŠ¨ç©å®¶æ¨¡å¼æ ‡å¿—
      let showTruePosition = false; // æ§åˆ¶è¦å¡ä½ç½®æ˜¾ç¤º

      // åœ¨ç©å®¶ä½ç½®ä¸ºä¸­å¿ƒçš„1800x1800åŒºåŸŸå†…éšæœºç”Ÿæˆè¦å¡ä½ç½®
      function generateRandomStrongholdPosition() {
        const range = 18000; // 1800*20/2 = 18000ï¼Œä»¥ç©å®¶ä¸ºä¸­å¿ƒçš„åŠå¾„ï¼ˆåœ°å›¾åæ ‡ï¼‰
        const randomX = playerPosition.x + (Math.random() - 0.5) * 2 * range;
        const randomZ = playerPosition.z + (Math.random() - 0.5) * 2 * range;
        return { x: randomX, z: randomZ };
      }

      // å»¶è¿Ÿåˆå§‹åŒ–è¦å¡ä½ç½®ï¼Œç¡®ä¿playerPositionå·²å®šä¹‰
      let strongholdTruePosition = { x: 0, z: 0 }; // ä¸´æ—¶åˆå§‹åŒ–
      // åœ¨é¡µé¢åŠ è½½å®Œæˆåé‡æ–°ç”Ÿæˆè¦å¡ä½ç½®
      setTimeout(() => {
        strongholdTruePosition = generateRandomStrongholdPosition();
      }, 100);

      // å£°çº³æ¢æµ‹ç›®æ ‡ä½ç½®ï¼ˆåŠ¨æ€è·å–è¦å¡ä½ç½®ï¼‰
      function getSonarTruePosition() {
        // å°†è¦å¡ä½ç½®è½¬æ¢ä¸ºå£°çº³åæ ‡ç³»ç»Ÿï¼ˆx, yï¼‰
        return {
          x: strongholdTruePosition.x,
          y: strongholdTruePosition.z, // å°†zåæ ‡æ˜ å°„ä¸ºyåæ ‡
        };
      }
      // showTruePositionå˜é‡å·²åœ¨ä¸Šæ–¹å£°æ˜
      let canDeployBuoy = true; // æ§åˆ¶æ˜¯å¦å¯ä»¥æŠ•æ”¾æµ®æ ‡

      // åœ°å›¾ç¼©æ”¾å’Œæ»‘åŠ¨å…¨å±€å˜é‡
      let mapZoom = 1;
      let mapOffsetX = 0;
      let mapOffsetY = 0;
      let isDragging = false;
      let lastMouseX = 0;
      let lastMouseY = 0;
      let minecraftMapZoom = 1;
      let minecraftMapOffsetX = 0;
      let minecraftMapOffsetY = 0;
      let minecraftIsDragging = false;
      let minecraftLastMouseX = 0;
      let minecraftLastMouseY = 0;
      let eyeThrowColors = [
        "#ff6b6b",
        "#4ecdc4",
        "#45b7d1",
        "#96ceb4",
        "#feca57",
        "#ff9ff3",
        "#54a0ff",
        "#5f27cd",
      ];
      let eyeThrowIndex = 0;

      // åˆå§‹åŒ–ç²’å­èƒŒæ™¯
      function initParticles() {
        const container = document.getElementById("particles-container");
        for (let i = 0; i < 50; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";
          particle.style.left = Math.random() * 100 + "%";
          particle.style.top = Math.random() * 100 + "%";
          particle.style.width = Math.random() * 4 + 2 + "px";
          particle.style.height = particle.style.width;
          particle.style.backgroundColor = `hsl(${
            Math.random() * 60 + 180
          }, 70%, 60%)`;
          particle.style.animationDelay = Math.random() * 15 + "s";
          container.appendChild(particle);
        }
      }

      // æ¹¿åº¦è­¦æŠ¥å™¨å®éªŒ
      function sampleCandies() {
        const sampleSize = parseInt(
          document.getElementById("sample-size").value
        );
        const confidenceLevel = parseFloat(
          document.getElementById("confidence-level").value
        );

        // ç”Ÿæˆæ ·æœ¬ï¼ˆè­¦æŠ¥è®°å½•ï¼‰
        currentSample = [];
        for (let i = 0; i < sampleSize; i++) {
          currentSample.push(
            Math.random() < rainAfterAlarmRatio ? "rain" : "no-rain"
          );
        }

        // æ˜¾ç¤ºè­¦æŠ¥è®°å½•
        const candyDisplay = document.getElementById("candy-display");
        candyDisplay.innerHTML = "";
        currentSample.forEach((result, index) => {
          setTimeout(() => {
            const record = document.createElement("div");
            record.className = `alarm-record ${result}`;
            record.innerHTML =
              result === "rain"
                ? '<i class="fa fa-cloud-rain text-blue-400"></i>'
                : '<i class="fa fa-sun text-yellow-400"></i>';
            candyDisplay.appendChild(record);
          }, index * 50);
        });

        // è®¡ç®—æ ·æœ¬æ¯”ä¾‹
        const rainCount = currentSample.filter((c) => c === "rain").length;
        const sampleProportion = rainCount / sampleSize;

        // è®¡ç®—ç½®ä¿¡åŒºé—´
        const z =
          confidenceLevel === 0.9
            ? 1.645
            : confidenceLevel === 0.95
            ? 1.96
            : 2.576;
        const standardError = Math.sqrt(
          (sampleProportion * (1 - sampleProportion)) / sampleSize
        );
        const marginError = z * standardError;
        const lowerBound = Math.max(0, sampleProportion - marginError);
        const upperBound = Math.min(1, sampleProportion + marginError);

        // æ›´æ–°æ˜¾ç¤º
        document.getElementById("sample-proportion").textContent =
          sampleProportion.toFixed(3);
        document.getElementById(
          "confidence-interval-text"
        ).textContent = `[${lowerBound.toFixed(3)}, ${upperBound.toFixed(3)}]`;
      }

      // æ­ç¤ºçœŸç›¸
      function revealTruth() {
        alert(`çœŸå®çš„æŠ¥è­¦åä¸‹é›¨æ¦‚ç‡æ˜¯: ${rainAfterAlarmRatio.toFixed(3)}`);
      }

      // é‡å¤å®éªŒ100æ¬¡
      function repeatExperiment() {
        const sampleSize = parseInt(
          document.getElementById("sample-size").value
        );
        const confidenceLevel = parseFloat(
          document.getElementById("confidence-level").value
        );
        const z =
          confidenceLevel === 0.9
            ? 1.645
            : confidenceLevel === 0.95
            ? 1.96
            : 2.576;

        allIntervals = [];
        let successCount = 0;

        for (let exp = 0; exp < 100; exp++) {
          // ç”Ÿæˆæ ·æœ¬
          let rainCount = 0;
          for (let i = 0; i < sampleSize; i++) {
            if (Math.random() < rainAfterAlarmRatio) rainCount++;
          }

          const sampleProportion = rainCount / sampleSize;
          const standardError = Math.sqrt(
            (sampleProportion * (1 - sampleProportion)) / sampleSize
          );
          const marginError = z * standardError;
          const lowerBound = Math.max(0, sampleProportion - marginError);
          const upperBound = Math.min(1, sampleProportion + marginError);

          const containsTrue =
            lowerBound <= rainAfterAlarmRatio &&
            rainAfterAlarmRatio <= upperBound;
          if (containsTrue) successCount++;

          allIntervals.push({
            lower: lowerBound,
            upper: upperBound,
            containsTrue: containsTrue,
          });
        }

        // æ›´æ–°æ˜¾ç¤º
        document.getElementById("success-count").textContent = successCount;
        document.getElementById("total-intervals").textContent = "100";
        document.getElementById("success-rate").textContent =
          successCount + "%";

        // å¯è§†åŒ–åŒºé—´
        visualizeIntervals();
      }

      // å¯è§†åŒ–ç½®ä¿¡åŒºé—´
      function visualizeIntervals() {
        const container = document.getElementById("intervals-container");
        container.innerHTML = "";

        // æ·»åŠ åŒºé—´
        allIntervals.forEach((interval, index) => {
          const intervalDiv = document.createElement("div");
          intervalDiv.className = `confidence-interval ${
            interval.containsTrue ? "contains-true" : "misses-true"
          }`;
          intervalDiv.style.left = interval.lower * 100 + "%";
          intervalDiv.style.width =
            (interval.upper - interval.lower) * 100 + "%";
          intervalDiv.style.top = index * 3 + "px";
          intervalDiv.title = `åŒºé—´ ${index + 1}: [${interval.lower.toFixed(
            3
          )}, ${interval.upper.toFixed(3)}]`;
          container.appendChild(intervalDiv);
        });

        // è®¾ç½®å®¹å™¨é«˜åº¦ - è¿™æ˜¯å®¹å™¨çš„å¯è§†é«˜åº¦
        const containerVisibleHeight = 320; // å›ºå®šå¯è§†é«˜åº¦
        container.style.height = containerVisibleHeight + "px";
        console.log("å®¹å™¨å¯è§†é«˜åº¦è®¾ç½®ä¸º:", containerVisibleHeight + "px");
        console.log("ç½®ä¿¡åŒºé—´æ€»æ•°:", allIntervals.length);

        // æ·»åŠ çœŸå®å€¼çº¿
        const trueLine = document.createElement("div");
        trueLine.className = "true-value-line";
        trueLine.style.left = rainAfterAlarmRatio * 100 + "%";

        // ç­‰å¾…DOMæ›´æ–°åè·å–å®é™…çš„scrollHeight
        setTimeout(() => {
          const actualScrollHeight = container.scrollHeight;
          console.log("å®¹å™¨å®é™…scrollHeight:", actualScrollHeight + "px");

          // ä½¿ç”¨å®é™…çš„scrollHeightè®¾ç½®çœŸå®å€¼çº¿é«˜åº¦
          trueLine.style.height = actualScrollHeight + "px";
          console.log("çœŸå®å€¼çº¿é«˜åº¦æ›´æ–°ä¸º:", actualScrollHeight + "px");
        }, 50);

        console.log("çœŸå®å€¼çº¿ä½ç½®è®¾ç½®ä¸º:", rainAfterAlarmRatio * 100 + "%");
        container.appendChild(trueLine);

        // è°ƒè¯•ä¿¡æ¯ï¼šæ£€æŸ¥å®¹å™¨å’Œçº¿æ¡çš„å®é™…å°ºå¯¸
        setTimeout(() => {
          const containerRect = container.getBoundingClientRect();
          const lineRect = trueLine.getBoundingClientRect();
          console.log("å®¹å™¨å®é™…å°ºå¯¸:", {
            width: containerRect.width,
            height: containerRect.height,
            scrollHeight: container.scrollHeight,
          });
          console.log("çœŸå®å€¼çº¿å®é™…å°ºå¯¸:", {
            width: lineRect.width,
            height: lineRect.height,
            top: lineRect.top,
            left: lineRect.left,
          });
          console.log("å†…å®¹å®é™…é«˜åº¦:", actualContentHeight + "px");
        }, 100);
      }

      // ç†è§£åº¦è¯„åˆ†
      function setUnderstanding(step, level) {
        understandingScores[step - 1] = level;

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        const buttons = document.querySelectorAll(
          `[data-step="${step}"] .understanding-btn`
        );
        buttons.forEach((btn, index) => {
          btn.classList.toggle("selected", index + 1 === level);
        });

        // æ˜¾ç¤ºä¸‹ä¸€æ­¥æç¤º
        const currentStep = document.querySelector(`[data-step="${step}"]`);
        const nextStepHint = currentStep.querySelector(".next-step-hint");
        if (level >= 3 && nextStepHint) {
          nextStepHint.classList.remove("hidden");
        }

        // æ¸è¿›å¼è§£é”ä¸‹ä¸€æ­¥
        if (level >= 3 && step < 5) {
          unlockNextStep(step + 1);
        }

        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æ­¥éª¤éƒ½å·²è¯„åˆ†
        if (understandingScores.every((score) => score > 0)) {
          showUnderstandingRadar();
        }
      }

      // è§£é”ä¸‹ä¸€æ­¥
      function unlockNextStep(step) {
        const nextStepElement = document.querySelector(`[data-step="${step}"]`);
        if (nextStepElement && nextStepElement.classList.contains("locked")) {
          // ç§»é™¤é”å®šçŠ¶æ€
          nextStepElement.classList.remove("locked");
          nextStepElement.classList.add("unlocked");

          // æ›´æ–°æ ‡é¢˜æ ·å¼
          const title = nextStepElement.querySelector("h3");
          const stepNumber = nextStepElement.querySelector("h3 span");
          const lockIcon = nextStepElement.querySelector(".fa-lock");

          title.classList.remove("text-gray-500");
          title.classList.add("text-neon-blue");
          stepNumber.classList.remove("bg-gray-600", "text-gray-400");
          stepNumber.classList.add("bg-neon-blue", "text-dark-bg");

          if (lockIcon) {
            lockIcon.parentElement.innerHTML =
              '<i class="fa fa-unlock text-neon-green"></i>';
          }

          // æ¢å¤å†…å®¹é€æ˜åº¦
          const content = nextStepElement.querySelector(".message-content");
          content.classList.remove("opacity-50");

          // æ˜¾ç¤ºç†è§£åº¦å†…å®¹ï¼Œéšè—é”å®šæ¶ˆæ¯
          const lockedMessage =
            nextStepElement.querySelector(".locked-message");
          const understandingContent = nextStepElement.querySelector(
            ".understanding-content"
          );

          if (lockedMessage) lockedMessage.classList.add("hidden");
          if (understandingContent)
            understandingContent.classList.remove("hidden");
        }
      }

      // AIå¸®åŠ©åŠŸèƒ½
      function showAIHelp(step) {
        const helpTexts = {
          1: "ç‚¹ä¼°è®¡æ˜¯ç”¨æ ·æœ¬ç»Ÿè®¡é‡æ¥ä¼°è®¡æ€»ä½“å‚æ•°çš„æ–¹æ³•ã€‚æ ·æœ¬å‡å€¼æ˜¯æ€»ä½“å‡å€¼çš„æ— åä¼°è®¡é‡ï¼Œè¿™æ„å‘³ç€åœ¨å¤šæ¬¡æŠ½æ ·ä¸­ï¼Œæ ·æœ¬å‡å€¼çš„æœŸæœ›å€¼ç­‰äºæ€»ä½“å‡å€¼ã€‚",
          2: "ä¸­å¿ƒæé™å®šç†å‘Šè¯‰æˆ‘ä»¬ï¼Œå½“æ ·æœ¬é‡è¶³å¤Ÿå¤§æ—¶ï¼Œæ ·æœ¬å‡å€¼çš„åˆ†å¸ƒä¼šè¶‹å‘äºæ­£æ€åˆ†å¸ƒï¼Œæ— è®ºåŸæ€»ä½“æ˜¯ä»€ä¹ˆåˆ†å¸ƒã€‚è¿™ä¸ºæˆ‘ä»¬æ„é€ ç½®ä¿¡åŒºé—´æä¾›äº†ç†è®ºåŸºç¡€ã€‚",
          3: "æ¢è½´é‡æ˜¯ä¸€ä¸ªåŒ…å«æœªçŸ¥å‚æ•°ä½†å…¶åˆ†å¸ƒå·²çŸ¥çš„ç»Ÿè®¡é‡ã€‚é€šè¿‡æ ‡å‡†åŒ–ï¼Œæˆ‘ä»¬å¾—åˆ°äº†æœä»æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„Zç»Ÿè®¡é‡ã€‚",
          4: "åˆ©ç”¨æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä½¿å¾—Zè½åœ¨æŸä¸ªåŒºé—´å†…çš„æ¦‚ç‡ä¸º1-Î±çš„ä¸´ç•Œå€¼ã€‚è¿™äº›ä¸´ç•Œå€¼å¸®åŠ©æˆ‘ä»¬æ„é€ ç½®ä¿¡åŒºé—´ã€‚",
          5: "é€šè¿‡ä»£æ•°å˜æ¢ï¼Œæˆ‘ä»¬å°†åŒ…å«Zçš„ä¸ç­‰å¼è½¬æ¢ä¸ºåŒ…å«Î¼çš„ä¸ç­‰å¼ï¼Œä»è€Œå¾—åˆ°ç½®ä¿¡åŒºé—´çš„æœ€ç»ˆå½¢å¼ã€‚æ³¨æ„ä¹˜ä»¥è´Ÿæ•°æ—¶ä¸ç­‰å·è¦å˜å‘ï¼",
        };

        alert(`AIåŠ©æ‰‹æç¤ºï¼š\n\n${helpTexts[step] || "æš‚æ— å¸®åŠ©ä¿¡æ¯"}`);
      }

      // æ˜¾ç¤ºç†è§£åº¦å›¾è°±
      function showUnderstandingRadar() {
        const radarSection = document.getElementById("understanding-radar");
        radarSection.classList.remove("hidden");

        // åˆ›å»ºé›·è¾¾å›¾
        const ctx = document
          .getElementById("understanding-chart")
          .getContext("2d");
        new Chart(ctx, {
          type: "radar",
          data: {
            labels: ["ç‚¹ä¼°è®¡", "CLT", "æ¢è½´é‡", "æ¦‚ç‡è¡¨è¿°", "æ±‚è§£"],
            datasets: [
              {
                label: "ç†è§£ç¨‹åº¦",
                data: understandingScores,
                backgroundColor: "rgba(0, 243, 255, 0.2)",
                borderColor: "#00f3ff",
                pointBackgroundColor: "#00f3ff",
                pointBorderColor: "#fff",
                pointHoverBackgroundColor: "#fff",
                pointHoverBorderColor: "#00f3ff",
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              r: {
                beginAtZero: true,
                max: 5,
                ticks: {
                  color: "#9ca3af",
                },
                grid: {
                  color: "rgba(156, 163, 175, 0.3)",
                },
                angleLines: {
                  color: "rgba(156, 163, 175, 0.3)",
                },
              },
            },
            plugins: {
              legend: {
                labels: {
                  color: "#ffffff",
                },
              },
            },
          },
        });

        // æ›´æ–°å­¦ä¹ æ•°æ®åˆ†æ
        updateLearningAnalysis();
      }

      // æ›´æ–°å­¦ä¹ æ•°æ®åˆ†æ
      function updateLearningAnalysis() {
        const stepNames = [
          "ç‚¹ä¼°è®¡",
          "ä¸­å¿ƒæé™å®šç†",
          "æ¢è½´é‡æ„é€ ",
          "æ¦‚ç‡è¡¨è¿°",
          "ä»£æ•°æ±‚è§£",
        ];

        // è®¡ç®—å¹³å‡ç†è§£åº¦
        const avgScore = (
          understandingScores.reduce((a, b) => a + b, 0) /
          understandingScores.length
        ).toFixed(1);
        document.getElementById("avg-understanding").textContent =
          avgScore + "/5.0";

        // æ‰¾å‡ºæœ€è–„å¼±å’Œæœ€å¼ºçš„ç¯èŠ‚
        const minScore = Math.min(...understandingScores);
        const maxScore = Math.max(...understandingScores);
        const weakestIndex = understandingScores.indexOf(minScore);
        const strongestIndex = understandingScores.indexOf(maxScore);

        document.getElementById("weakest-step").textContent =
          stepNames[weakestIndex] + ` (${minScore}/5)`;
        document.getElementById("strongest-step").textContent =
          stepNames[strongestIndex] + ` (${maxScore}/5)`;

        // è®¡ç®—å®Œæˆæ—¶é—´ï¼ˆæ¨¡æ‹Ÿï¼‰
        const completionTime = new Date().toLocaleTimeString("zh-CN", {
          hour12: false,
        });
        document.getElementById("completion-time").textContent = completionTime;

        // ç”Ÿæˆä¸ªæ€§åŒ–å­¦ä¹ å»ºè®®
        generateLearningSuggestions(avgScore, weakestIndex, minScore);
      }

      // ç”Ÿæˆä¸ªæ€§åŒ–å­¦ä¹ å»ºè®®
      function generateLearningSuggestions(avgScore, weakestIndex, minScore) {
        const stepNames = [
          "ç‚¹ä¼°è®¡",
          "ä¸­å¿ƒæé™å®šç†",
          "æ¢è½´é‡æ„é€ ",
          "æ¦‚ç‡è¡¨è¿°",
          "ä»£æ•°æ±‚è§£",
        ];
        const suggestions = [];

        if (avgScore >= 4.0) {
          suggestions.push("ğŸ‰ ä¼˜ç§€ï¼æ‚¨å·²ç»å¾ˆå¥½åœ°æŒæ¡äº†åŒºé—´ä¼°è®¡çš„æ ¸å¿ƒæ¦‚å¿µã€‚");
          suggestions.push(
            "ğŸ’¡ å»ºè®®ï¼šå¯ä»¥å°è¯•æ›´å¤æ‚çš„ç½®ä¿¡åŒºé—´é—®é¢˜ï¼Œå¦‚tåˆ†å¸ƒã€å¡æ–¹åˆ†å¸ƒç­‰ã€‚"
          );
        } else if (avgScore >= 3.0) {
          suggestions.push("ğŸ‘ ä¸é”™ï¼æ‚¨å¯¹å¤§éƒ¨åˆ†æ¦‚å¿µæœ‰äº†åŸºæœ¬ç†è§£ã€‚");
          suggestions.push(
            `ğŸ” é‡ç‚¹å…³æ³¨ï¼š${stepNames[weakestIndex]}éƒ¨åˆ†éœ€è¦åŠ å¼ºç†è§£ã€‚`
          );
        } else {
          suggestions.push("ğŸ“š éœ€è¦æ›´å¤šç»ƒä¹ ï¼å»ºè®®é‡æ–°å­¦ä¹ åŸºç¡€æ¦‚å¿µã€‚");
          suggestions.push(
            `âš ï¸ ä¼˜å…ˆå¤ä¹ ï¼š${stepNames[weakestIndex]}æ˜¯å½“å‰çš„è–„å¼±ç¯èŠ‚ã€‚`
          );
        }

        if (minScore <= 2) {
          const helpTexts = {
            0: "å»ºè®®å¤ä¹ æ¦‚ç‡è®ºåŸºç¡€ï¼Œç‰¹åˆ«æ˜¯æœŸæœ›å€¼å’Œæ— åä¼°è®¡çš„æ¦‚å¿µã€‚",
            1: "å»ºè®®å¤ä¹ æ­£æ€åˆ†å¸ƒå’Œæé™å®šç†ï¼Œè¿™æ˜¯ç†è§£CLTçš„å…³é”®ã€‚",
            2: "å»ºè®®å¤ä¹ æ ‡å‡†åŒ–è¿‡ç¨‹ï¼Œç†è§£å¦‚ä½•æ„é€ å·²çŸ¥åˆ†å¸ƒçš„ç»Ÿè®¡é‡ã€‚",
            3: "å»ºè®®å¤ä¹ æ¦‚ç‡è®¡ç®—ï¼Œç‰¹åˆ«æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒçš„æ€§è´¨ã€‚",
            4: "å»ºè®®å¤ä¹ ä»£æ•°è¿ç®—ï¼Œç‰¹åˆ«æ˜¯ä¸ç­‰å¼å˜æ¢çš„è§„åˆ™ã€‚",
          };
          suggestions.push(`ğŸ“– å…·ä½“å»ºè®®ï¼š${helpTexts[weakestIndex]}`);
        }

        document.getElementById("learning-suggestions").innerHTML =
          suggestions.join("<br>");
      }

      // å£°çº³æµ®æ ‡å®éªŒ
      let sonarDeploymentAnimation = null;

      // å•æ¬¡æŠ•æ”¾æµ®æ ‡
      function deploySingleSonar() {
        deployBuoys(1, "single");
      }

      // æ‰¹é‡æŠ•æ”¾æµ®æ ‡
      function deployBatchSonar() {
        deployBuoys(10, "batch");
      }

      // é€šç”¨æŠ•æ”¾æµ®æ ‡å‡½æ•°
      function deployBuoys(count, mode) {
        // æ£€æŸ¥æ˜¯å¦å¯ä»¥æŠ•æ”¾æµ®æ ‡
        if (!canDeployBuoy) {
          return;
        }

        const confidenceLevel = parseFloat(
          document.getElementById("sonar-confidence").value
        );
        const sonarAccuracy = parseFloat(
          document.getElementById("sonar-accuracy").value
        );

        // ç¦ç”¨æŠ•æ”¾æŒ‰é’®
        canDeployBuoy = false;
        const singleBtn = document.getElementById("deploy-single-btn");
        const batchBtn = document.getElementById("deploy-batch-btn");

        // ç¦ç”¨æ‰€æœ‰æŠ•æ”¾æŒ‰é’®
        singleBtn.disabled = true;
        batchBtn.disabled = true;

        // æ·»åŠ éƒ¨ç½²åŠ¨ç”»æ•ˆæœ
        const activeBtn = mode === "single" ? singleBtn : batchBtn;
        activeBtn.classList.add("button-click-effect");
        setTimeout(
          () => activeBtn.classList.remove("button-click-effect"),
          300
        );

        if (mode === "single") {
          activeBtn.innerHTML =
            'æŠ•æ”¾ä¸­... <i class="fa fa-spinner fa-spin ml-2"></i>';
        } else {
          activeBtn.innerHTML =
            'æ‰¹é‡æŠ•æ”¾ä¸­... <i class="fa fa-spinner fa-spin ml-2"></i>';
        }

        // æ¨¡æ‹Ÿé€ä¸ªéƒ¨ç½²æµ®æ ‡çš„åŠ¨ç”»
        let deployedCount = 0;
        const deployInterval = setInterval(
          () => {
            if (deployedCount < count) {
              // æ¨¡æ‹Ÿå£°çº³æ¢æµ‹ï¼ŒåŸºäºé€‰æ‹©çš„ç²¾åº¦æ·»åŠ éšæœºè¯¯å·®
              // ä½¿ç”¨æ­£æ€åˆ†å¸ƒç”Ÿæˆæ›´çœŸå®çš„å£°çº³è¯¯å·®
              const errorX = normalRandom(0, sonarAccuracy);
              const errorY = normalRandom(0, sonarAccuracy);
              const truePos = getSonarTruePosition();
              sonarData.push({
                x: truePos.x + errorX,
                y: truePos.y + errorY,
                deployed: true,
                timestamp: Date.now() + deployedCount * 100, // ç”¨äºåŠ¨ç”»æ’åº
              });
              deployedCount++;

              // å®æ—¶æ›´æ–°åœ°å›¾æ˜¾ç¤º
              if (sonarData.length >= 1) {
                calculateAndDisplayResults(confidenceLevel);
              }

              // æ·»åŠ æ•°æ®ç‚¹åŠ¨ç”»æ•ˆæœï¼ˆç§»é™¤canvasæ—‹è½¬åŠ¨ç”»ï¼‰
              // æ³¨é‡Šæ‰canvasåŠ¨ç”»ï¼Œé¿å…æ•´ä¸ªåœ°å›¾æ—‹è½¬
              // const canvas = document.getElementById("sonar-map");
              // if (canvas) {
              //   canvas.classList.add("data-point-enter");
              //   setTimeout(
              //     () => canvas.classList.remove("data-point-enter"),
              //     600
              //   );
              // }
            } else {
              clearInterval(deployInterval);

              // æ¢å¤æŒ‰é’®çŠ¶æ€
              singleBtn.innerHTML =
                'æŠ•æ”¾1ä¸ªæµ®æ ‡ <i class="fa fa-anchor ml-2"></i>';
              batchBtn.innerHTML =
                'æŠ•æ”¾10ä¸ªæµ®æ ‡ <i class="fa fa-ship ml-2"></i>';
              singleBtn.disabled = false;
              batchBtn.disabled = false;

              activeBtn.classList.add("success-flash");
              setTimeout(
                () => activeBtn.classList.remove("success-flash"),
                600
              );

              // é‡æ–°å¯ç”¨æŠ•æ”¾åŠŸèƒ½
              canDeployBuoy = true;
              calculateAndDisplayResults(confidenceLevel);

              // æ˜¾ç¤ºæŠ•æ”¾å®Œæˆæç¤º
              showDeploymentSuccess(count, mode);
            }
          },
          mode === "single" ? 500 : 150
        ); // å•æ¬¡æŠ•æ”¾æ…¢ä¸€äº›ï¼Œæ‰¹é‡æŠ•æ”¾å¿«ä¸€äº›
      }

      // æ˜¾ç¤ºæŠ•æ”¾æˆåŠŸæç¤º
      function showDeploymentSuccess(count, mode) {
        const message =
          mode === "single"
            ? `æˆåŠŸæŠ•æ”¾1ä¸ªå£°çº³æµ®æ ‡ï¼å½“å‰å…±æœ‰${sonarData.length}ä¸ªæ•°æ®ç‚¹ã€‚`
            : `æˆåŠŸæ‰¹é‡æŠ•æ”¾${count}ä¸ªå£°çº³æµ®æ ‡ï¼å½“å‰å…±æœ‰${sonarData.length}ä¸ªæ•°æ®ç‚¹ã€‚`;

        // åˆ›å»ºä¸´æ—¶æç¤ºå…ƒç´ 
        const notification = document.createElement("div");
        notification.className =
          "fixed top-4 right-4 bg-neon-green text-dark-bg px-4 py-2 rounded-lg font-bold z-50 transform translate-x-full transition-transform duration-300";
        notification.textContent = message;
        document.body.appendChild(notification);

        // æ˜¾ç¤ºåŠ¨ç”»
        setTimeout(() => {
          notification.classList.remove("translate-x-full");
        }, 100);

        // éšè—åŠ¨ç”»
        setTimeout(() => {
          notification.classList.add("translate-x-full");
          setTimeout(() => {
            document.body.removeChild(notification);
          }, 300);
        }, 3000);
      }

      function calculateAndDisplayResults(confidenceLevel) {
        if (sonarData.length < 2) return;

        const sonarCount = sonarData.length;

        // è®¡ç®—å¹³å‡ä½ç½®
        const avgX =
          sonarData.reduce((sum, point) => sum + point.x, 0) / sonarCount;
        const avgY =
          sonarData.reduce((sum, point) => sum + point.y, 0) / sonarCount;

        // è®¡ç®—æ ‡å‡†å·®
        const stdX = Math.sqrt(
          sonarData.reduce(
            (sum, point) => sum + Math.pow(point.x - avgX, 2),
            0
          ) / Math.max(1, sonarCount - 1)
        );
        const stdY = Math.sqrt(
          sonarData.reduce(
            (sum, point) => sum + Math.pow(point.y - avgY, 2),
            0
          ) / Math.max(1, sonarCount - 1)
        );

        // tåˆ†å¸ƒä¸´ç•Œå€¼ï¼ˆæ ¹æ®è‡ªç”±åº¦è°ƒæ•´ï¼‰
        const df = Math.max(1, sonarCount - 1);
        let t;
        if (confidenceLevel === 0.9) {
          t =
            df <= 10
              ? [
                  0, 6.314, 2.92, 2.353, 2.132, 2.015, 1.943, 1.895, 1.86,
                  1.833, 1.812,
                ][df] || 1.729
              : 1.645;
        } else if (confidenceLevel === 0.95) {
          t =
            df <= 10
              ? [
                  0, 12.706, 4.303, 3.182, 2.776, 2.571, 2.447, 2.365, 2.306,
                  2.262, 2.228,
                ][df] || 2.093
              : 1.96;
        } else {
          t =
            df <= 10
              ? [
                  0, 63.657, 9.925, 5.841, 4.604, 4.032, 3.707, 3.499, 3.355,
                  3.25, 3.169,
                ][df] || 2.861
              : 2.576;
        }

        const marginX = (t * stdX) / Math.sqrt(sonarCount);
        const marginY = (t * stdY) / Math.sqrt(sonarCount);

        // æ›´æ–°æ˜¾ç¤ºå¹¶æ·»åŠ åŠ¨ç”»æ•ˆæœ
        const positionElement = document.getElementById("estimated-position");
        const areaElement = document.getElementById("search-area");

        // æ·»åŠ ç»“æœæ˜¾ç¤ºåŠ¨ç”»
        positionElement.classList.add("result-slide-in");
        areaElement.classList.add("result-slide-in");

        positionElement.textContent = `(${avgX.toFixed(2)}, ${avgY.toFixed(
          2
        )})`;
        const searchArea = 4 * marginX * marginY; // çŸ©å½¢é¢ç§¯
        areaElement.textContent = searchArea.toFixed(2) + " kmÂ²";

        // ç§»é™¤åŠ¨ç”»ç±»
        setTimeout(() => {
          positionElement.classList.remove("result-slide-in");
          areaElement.classList.remove("result-slide-in");
        }, 600);

        // ç»˜åˆ¶å£°çº³åœ°å›¾
        drawSonarMap(avgX, avgY, marginX, marginY);
      }

      // æ­ç¤ºçœŸå®ç‚®å¼¹ä½ç½®
      function revealShellPosition() {
        // æ£€æŸ¥æ˜¯å¦æœ‰æµ®æ ‡æ•°æ®
        if (sonarData.length === 0) {
          alert("è¯·å…ˆæŠ•æ”¾ä¸€äº›å£°çº³æµ®æ ‡å†æ­ç¤ºçœŸå®ä½ç½®ï¼");
          return;
        }

        // æ˜¾ç¤ºçœŸå®ä½ç½®
        showTruePosition = true;

        // æ·»åŠ æŒ‰é’®ç‚¹å‡»åŠ¨ç”»
        const revealBtn = document.getElementById("reveal-shell-btn");
        if (revealBtn) {
          revealBtn.classList.add("button-click-effect");
          setTimeout(
            () => revealBtn.classList.remove("button-click-effect"),
            300
          );
        }

        // é‡æ–°ç»˜åˆ¶åœ°å›¾ä»¥æ˜¾ç¤ºçœŸå®ä½ç½®
        const confidenceLevel = parseFloat(
          document.getElementById("sonar-confidence").value
        );
        calculateAndDisplayResults(confidenceLevel);

        // æ·»åŠ é—ªçƒæ•ˆæœå’Œæ•™å­¦åé¦ˆ
        const canvas = document.getElementById("sonar-map");
        const ctx = canvas.getContext("2d");
        let flashCount = 0;
        const flashInterval = setInterval(() => {
          if (flashCount < 6) {
            // é‡æ–°ç»˜åˆ¶åœ°å›¾
            calculateAndDisplayResults(confidenceLevel);

            // æ·»åŠ é—ªçƒçš„çœŸå®ä½ç½®
            const rect = canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            ctx.scale(dpr, dpr);

            const toCanvasX = (x) => ((x + 3) * rect.width) / 6;
            const toCanvasY = (y) => ((3 - y) * rect.height) / 6;

            const truePos = getSonarTruePosition();
            ctx.fillStyle = flashCount % 2 === 0 ? "#ffd700" : "#ff4444";
            ctx.beginPath();
            ctx.arc(
              toCanvasX(truePos.x),
              toCanvasY(truePos.y),
              8,
              0,
              2 * Math.PI
            );
            ctx.fill();

            // æ·»åŠ æ–‡å­—æ ‡ç­¾
            ctx.fillStyle = "#ffffff";
            ctx.font = "bold 12px Arial";
            ctx.fillText(
              "çœŸå®ä½ç½®",
              toCanvasX(truePos.x) + 12,
              toCanvasY(truePos.y) - 8
            );

            flashCount++;
          } else {
            clearInterval(flashInterval);
            // æ˜¾ç¤ºæ•™å­¦åé¦ˆ
            showPredictionFeedback();
          }
        }, 400);
      }

      // æ˜¾ç¤ºé¢„æµ‹åé¦ˆ
      function showPredictionFeedback() {
        const truePos = getSonarTruePosition();
        const confidenceLevel = parseFloat(
          document.getElementById("sonar-confidence").value
        );

        if (sonarData.length === 0) return;

        // è®¡ç®—ç½®ä¿¡åŒºé—´
        const n = sonarData.length;
        const avgX = sonarData.reduce((sum, d) => sum + d.x, 0) / n;
        const avgY = sonarData.reduce((sum, d) => sum + d.y, 0) / n;

        const stdX = Math.sqrt(
          sonarData.reduce((sum, d) => sum + Math.pow(d.x - avgX, 2), 0) /
            (n - 1)
        );
        const stdY = Math.sqrt(
          sonarData.reduce((sum, d) => sum + Math.pow(d.y - avgY, 2), 0) /
            (n - 1)
        );

        // è·å–tåˆ†å¸ƒä¸´ç•Œå€¼
        const alpha = 1 - confidenceLevel;
        const df = n - 1;
        const t =
          df >= 30
            ? 1.96
            : [
                0, 12.706, 4.303, 3.182, 2.776, 2.571, 2.447, 2.365, 2.306,
                2.262, 2.228, 2.201, 2.179, 2.16, 2.145, 2.131, 2.12, 2.11,
                2.101, 2.093, 2.086, 2.08, 2.074, 2.069, 2.064, 2.06, 2.056,
                2.052, 2.048, 2.045, 2.042,
              ][df] || 1.96;

        const marginX = (t * stdX) / Math.sqrt(n);
        const marginY = (t * stdY) / Math.sqrt(n);

        // æ£€æŸ¥çœŸå®ä½ç½®æ˜¯å¦åœ¨ç½®ä¿¡åŒºé—´å†…
        const inConfidenceX =
          truePos.x >= avgX - marginX && truePos.x <= avgX + marginX;
        const inConfidenceY =
          truePos.y >= avgY - marginY && truePos.y <= avgY + marginY;
        const inConfidenceRegion = inConfidenceX && inConfidenceY;

        // è®¡ç®—ä¼°è®¡è¯¯å·®
        const errorX = Math.abs(truePos.x - avgX);
        const errorY = Math.abs(truePos.y - avgY);
        const totalError = Math.sqrt(errorX * errorX + errorY * errorY);

        // ç”Ÿæˆåé¦ˆæ¶ˆæ¯
        let message = `ğŸ¯ **é¢„æµ‹ç»“æœåˆ†æ**\n\n`;
        message += `ğŸ“ çœŸå®ç‚®å¼¹ä½ç½®: (${truePos.x.toFixed(
          2
        )}, ${truePos.y.toFixed(2)})\n`;
        message += `ğŸ“Š ä¼°è®¡ä½ç½®: (${avgX.toFixed(2)}, ${avgY.toFixed(2)})\n`;
        message += `ğŸ“ ä¼°è®¡è¯¯å·®: ${totalError.toFixed(2)} km\n\n`;

        if (inConfidenceRegion) {
          message += `âœ… **é¢„æµ‹æˆåŠŸï¼**\n`;
          message += `çœŸå®ä½ç½®è½åœ¨äº†${(confidenceLevel * 100).toFixed(
            0
          )}%ç½®ä¿¡åŒºé—´å†…ã€‚\n`;
          message += `è¿™è¯æ˜äº†åŒºé—´ä¼°è®¡çš„æœ‰æ•ˆæ€§ï¼\n\n`;
        } else {
          message += `âŒ **é¢„æµ‹æœªå®Œå…¨æˆåŠŸ**\n`;
          message += `çœŸå®ä½ç½®æœªå®Œå…¨è½åœ¨${(confidenceLevel * 100).toFixed(
            0
          )}%ç½®ä¿¡åŒºé—´å†…ã€‚\n`;
          message += `è¿™æ˜¯${((1 - confidenceLevel) * 100).toFixed(
            0
          )}%çš„å°æ¦‚ç‡äº‹ä»¶ï¼Œå±äºæ­£å¸¸ç°è±¡ã€‚\n\n`;
        }

        message += `ğŸ’¡ **æ•™å­¦è¦ç‚¹ï¼š**\n`;
        message += `â€¢ æ ·æœ¬é‡è¶Šå¤§ï¼Œä¼°è®¡è¶Šå‡†ç¡®\n`;
        message += `â€¢ ç½®ä¿¡æ°´å¹³è¶Šé«˜ï¼Œç½®ä¿¡åŒºé—´è¶Šå®½\n`;
        message += `â€¢ å£°çº³ç²¾åº¦å½±å“æµ‹é‡è¯¯å·®\n`;
        message += `â€¢ å³ä½¿é¢„æµ‹"å¤±è´¥"ï¼Œä¹Ÿåœ¨ç»Ÿè®¡é¢„æœŸå†…`;

        // å°†æ¶ˆæ¯æ˜¾ç¤ºåœ¨ç½‘é¡µä¸­è€Œä¸æ˜¯alertå¼¹çª—
        displayFeedbackInPage(message);
      }

      // åœ¨ç½‘é¡µä¸­æ˜¾ç¤ºåé¦ˆä¿¡æ¯
      function displayFeedbackInPage(message) {
        const feedbackDiv = document.getElementById("prediction-feedback");
        const contentDiv = document.getElementById("feedback-content");

        // å°†markdownæ ¼å¼çš„æ¶ˆæ¯è½¬æ¢ä¸ºHTML
        let htmlContent = message
          .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>") // ç²—ä½“
          .replace(/\n/g, "<br>") // æ¢è¡Œ
          .replace(
            /^([ğŸ¯ğŸ“ğŸ“ŠğŸ“âœ…âŒğŸ’¡].*?):/gm,
            '<div class="mb-2"><span class="text-neon-blue">$1:</span></div>'
          ) // å›¾æ ‡è¡Œ
          .replace(/^â€¢ (.*?)$/gm, '<div class="ml-4 text-gray-400">â€¢ $1</div>'); // åˆ—è¡¨é¡¹

        contentDiv.innerHTML = htmlContent;
        feedbackDiv.style.display = "block";

        // æ»šåŠ¨åˆ°åé¦ˆåŒºåŸŸ
        feedbackDiv.scrollIntoView({ behavior: "smooth", block: "nearest" });
      }

      // ç»˜åˆ¶å£°çº³åœ°å›¾
      function drawSonarMap(avgX, avgY, marginX, marginY) {
        const canvas = document.getElementById("sonar-map");
        const ctx = canvas.getContext("2d");

        // è·å–è®¾å¤‡åƒç´ æ¯”ä»¥æå‡æ¸…æ™°åº¦
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();

        // è®¾ç½®canvaså®é™…åˆ†è¾¨ç‡ï¼ˆè€ƒè™‘è®¾å¤‡åƒç´ æ¯”ï¼‰
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;

        // è®¾ç½®canvasæ˜¾ç¤ºå°ºå¯¸
        canvas.style.width = rect.width + "px";
        canvas.style.height = rect.height + "px";

        // ç¼©æ”¾ç»˜å›¾ä¸Šä¸‹æ–‡ä»¥åŒ¹é…è®¾å¤‡åƒç´ æ¯”
        ctx.scale(dpr, dpr);

        // å¯ç”¨æŠ—é”¯é½¿
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = "high";

        ctx.clearRect(0, 0, rect.width, rect.height);

        // ä¿å­˜ä¸Šä¸‹æ–‡ï¼ˆå›ºå®šæ˜¾ç¤ºï¼Œæ— å˜æ¢ï¼‰
        ctx.save();
        // ç§»é™¤ç¼©æ”¾å’Œå¹³ç§»å˜æ¢ä»¥ä¿æŒå›ºå®šæ˜¾ç¤ºèŒƒå›´
        // ctx.translate(mapOffsetX, mapOffsetY);
        // ctx.scale(mapZoom, mapZoom);

        // åæ ‡è½¬æ¢å‡½æ•°ï¼ˆå›ºå®šæ˜¾ç¤ºèŒƒå›´ï¼‰
        // è®¡ç®—å®é™…æ•°æ®èŒƒå›´ï¼Œç„¶åæ˜ å°„åˆ°å›ºå®šçš„canvasæ˜¾ç¤ºåŒºåŸŸ
        let dataMinX = -3,
          dataMaxX = 3,
          dataMinY = -3,
          dataMaxY = 3;

        if (sonarData.length > 0) {
          // è®¡ç®—å®é™…æ•°æ®èŒƒå›´
          dataMinX = Math.min(...sonarData.map((p) => p.x));
          dataMaxX = Math.max(...sonarData.map((p) => p.x));
          dataMinY = Math.min(...sonarData.map((p) => p.y));
          dataMaxY = Math.max(...sonarData.map((p) => p.y));

          // æ·»åŠ ä¸€äº›è¾¹è·ä»¥ç¡®ä¿æ•°æ®ç‚¹ä¸ä¼šè´´è¾¹
          const rangeX = dataMaxX - dataMinX || 1;
          const rangeY = dataMaxY - dataMinY || 1;
          const marginX = rangeX * 0.1;
          const marginY = rangeY * 0.1;

          dataMinX -= marginX;
          dataMaxX += marginX;
          dataMinY -= marginY;
          dataMaxY += marginY;
        }

        const padding = 20;
        const scaleX = (rect.width - 2 * padding) / (dataMaxX - dataMinX);
        const scaleY = (rect.height - 2 * padding) / (dataMaxY - dataMinY);

        const toCanvasX = (x) => (x - dataMinX) * scaleX + padding;
        const toCanvasY = (y) =>
          rect.height - ((y - dataMinY) * scaleY + padding);

        // è°ƒè¯•è¾“å‡ºåæ ‡è½¬æ¢å‚æ•°
        console.log("å£°çº³åœ°å›¾åæ ‡è½¬æ¢å‚æ•°:", {
          canvasWidth: rect.width,
          canvasHeight: rect.height,
          mapZoom: mapZoom,
          mapOffsetX: mapOffsetX,
          mapOffsetY: mapOffsetY,
          dataRange: { dataMinX, dataMaxX, dataMinY, dataMaxY },
          scale: { scaleX, scaleY },
          padding: padding,
        });
        console.log("å£°çº³æ•°æ®çŠ¶æ€:", {
          sonarDataLength: sonarData.length,
          avgX: avgX,
          avgY: avgY,
          showTruePosition: showTruePosition,
        });

        // ç»˜åˆ¶ç½‘æ ¼
        ctx.strokeStyle = "rgba(255, 255, 255, 0.1)";
        ctx.lineWidth = 1;
        for (let i = 0; i <= 6; i++) {
          ctx.beginPath();
          ctx.moveTo((i * rect.width) / 6, 0);
          ctx.lineTo((i * rect.width) / 6, rect.height);
          ctx.stroke();
        }
        for (let i = 0; i <= 6; i++) {
          ctx.beginPath();
          ctx.moveTo(0, (i * rect.height) / 6);
          ctx.lineTo(rect.width, (i * rect.height) / 6);
          ctx.stroke();
        }

        // ç»˜åˆ¶åæ ‡è½´æ ‡ç­¾
        ctx.fillStyle = "rgba(255, 255, 255, 0.7)";
        ctx.font = "12px Arial";
        ctx.textAlign = "center";

        // Xè½´æ ‡ç­¾
        for (let i = 0; i <= 6; i++) {
          const x = (i * rect.width) / 6;
          const label = (i - 3).toString();
          ctx.fillText(label, x, rect.height - 5);
        }

        // Yè½´æ ‡ç­¾
        ctx.textAlign = "left";
        for (let i = 0; i <= 6; i++) {
          const y = (i * rect.height) / 6;
          const label = (3 - i).toString();
          ctx.fillText(label, 5, y + 4);
        }

        // ç»˜åˆ¶åæ ‡è½´
        ctx.strokeStyle = "rgba(255, 255, 255, 0.3)";
        ctx.lineWidth = 2;
        // Xè½´ (y=0)
        ctx.beginPath();
        ctx.moveTo(0, toCanvasY(0));
        ctx.lineTo(rect.width, toCanvasY(0));
        ctx.stroke();
        // Yè½´ (x=0)
        ctx.beginPath();
        ctx.moveTo(toCanvasX(0), 0);
        ctx.lineTo(toCanvasX(0), rect.height);
        ctx.stroke();

        // æ·»åŠ æ ‡é¢˜
        ctx.fillStyle = "rgba(255, 255, 255, 0.9)";
        ctx.font = "14px Arial";
        ctx.textAlign = "center";
        ctx.fillText("å£°çº³æ¢æµ‹åŒºåŸŸ (km)", rect.width / 2, 20);

        // ç»˜åˆ¶ç½®ä¿¡åŒºåŸŸï¼ˆä»…å½“æœ‰æ•°æ®æ—¶ï¼‰
        if (sonarData.length > 0 && marginX > 0 && marginY > 0) {
          ctx.fillStyle = "rgba(0, 243, 255, 0.2)";
          ctx.strokeStyle = "#00f3ff";
          ctx.lineWidth = 2;
          const rectX = toCanvasX(avgX - marginX);
          const rectY = toCanvasY(avgY + marginY);
          const rectW = toCanvasX(avgX + marginX) - rectX;
          const rectH = toCanvasY(avgY - marginY) - rectY;
          ctx.fillRect(rectX, rectY, rectW, rectH);
          ctx.strokeRect(rectX, rectY, rectW, rectH);
        }

        // ç»˜åˆ¶å£°çº³æ¢æµ‹ç‚¹ï¼ˆæ·»åŠ æè¾¹ä»¥æé«˜å¯è§æ€§ï¼‰
        console.log("ç»˜åˆ¶å£°çº³æ¢æµ‹ç‚¹ï¼Œæ•°æ®é•¿åº¦:", sonarData.length);
        sonarData.forEach((point, index) => {
          const canvasX = toCanvasX(point.x);
          const canvasY = toCanvasY(point.y);
          console.log(
            `æ¢æµ‹ç‚¹${index + 1}: åŸå§‹åæ ‡(${point.x}, ${
              point.y
            }) -> canvasåæ ‡(${canvasX}, ${canvasY})`
          );

          ctx.fillStyle = "#00ff66";
          ctx.strokeStyle = "#ffffff";
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.arc(canvasX, canvasY, 4, 0, 2 * Math.PI);
          ctx.fill();
          ctx.stroke();

          // æ·»åŠ æ¢æµ‹ç‚¹æ ‡ç­¾
          ctx.fillStyle = "#ffffff";
          ctx.font = "10px Arial";
          ctx.textAlign = "center";
          ctx.fillText((index + 1).toString(), canvasX, canvasY - 8);
        });

        // ç»˜åˆ¶ä¼°è®¡ä½ç½®ï¼ˆä»…å½“æœ‰æ•°æ®æ—¶ï¼‰
        if (sonarData.length > 0) {
          const estCanvasX = toCanvasX(avgX);
          const estCanvasY = toCanvasY(avgY);
          console.log(
            `ä¼°è®¡ä½ç½®: åŸå§‹åæ ‡(${avgX}, ${avgY}) -> canvasåæ ‡(${estCanvasX}, ${estCanvasY})`
          );

          ctx.fillStyle = "#00f3ff";
          ctx.strokeStyle = "#ffffff";
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.arc(estCanvasX, estCanvasY, 6, 0, 2 * Math.PI);
          ctx.fill();
          ctx.stroke();

          // æ·»åŠ ä¼°è®¡ä½ç½®æ ‡ç­¾
          ctx.fillStyle = "#ffffff";
          ctx.font = "12px Arial";
          ctx.textAlign = "left";
          ctx.fillText("ä¼°è®¡ä½ç½®", estCanvasX + 10, estCanvasY - 5);
        } else {
          console.log("æ²¡æœ‰å£°çº³æ•°æ®ï¼Œè·³è¿‡ç»˜åˆ¶ä¼°è®¡ä½ç½®");
        }

        // ç»˜åˆ¶çœŸå®ä½ç½®ï¼ˆä»…åœ¨æ˜¾ç¤ºçŠ¶æ€ä¸‹ï¼‰
        if (showTruePosition) {
          const truePos = getSonarTruePosition();

          // å¦‚æœçœŸå®ä½ç½®è¶…å‡ºå½“å‰æ•°æ®èŒƒå›´ï¼Œæ‰©å±•èŒƒå›´é‡æ–°è®¡ç®—åæ ‡è½¬æ¢
          let adjustedMinX = dataMinX,
            adjustedMaxX = dataMaxX,
            adjustedMinY = dataMinY,
            adjustedMaxY = dataMaxY;
          if (
            truePos.x < dataMinX ||
            truePos.x > dataMaxX ||
            truePos.y < dataMinY ||
            truePos.y > dataMaxY
          ) {
            adjustedMinX = Math.min(dataMinX, truePos.x - 0.5);
            adjustedMaxX = Math.max(dataMaxX, truePos.x + 0.5);
            adjustedMinY = Math.min(dataMinY, truePos.y - 0.5);
            adjustedMaxY = Math.max(dataMaxY, truePos.y + 0.5);

            const adjustedScaleX =
              (rect.width - 2 * padding) / (adjustedMaxX - adjustedMinX);
            const adjustedScaleY =
              (rect.height - 2 * padding) / (adjustedMaxY - adjustedMinY);

            const trueCanvasX =
              (truePos.x - adjustedMinX) * adjustedScaleX + padding;
            const trueCanvasY =
              rect.height -
              ((truePos.y - adjustedMinY) * adjustedScaleY + padding);

            console.log(
              `çœŸå®ä½ç½®(æ‰©å±•èŒƒå›´): åŸå§‹åæ ‡(${truePos.x}, ${truePos.y}) -> canvasåæ ‡(${trueCanvasX}, ${trueCanvasY})`
            );

            ctx.fillStyle = "#ffd700";
            ctx.strokeStyle = "#ffffff";
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(trueCanvasX, trueCanvasY, 7, 0, 2 * Math.PI);
            ctx.fill();
            ctx.stroke();

            // æ·»åŠ çœŸå®ä½ç½®æ ‡ç­¾
            ctx.fillStyle = "#ffffff";
            ctx.font = "12px Arial";
            ctx.textAlign = "left";
            ctx.fillText("çœŸå®ä½ç½®", trueCanvasX + 10, trueCanvasY - 5);
          } else {
            const trueCanvasX = toCanvasX(truePos.x);
            const trueCanvasY = toCanvasY(truePos.y);
            console.log(
              `çœŸå®ä½ç½®: åŸå§‹åæ ‡(${truePos.x}, ${truePos.y}) -> canvasåæ ‡(${trueCanvasX}, ${trueCanvasY})`
            );

            ctx.fillStyle = "#ffd700";
            ctx.strokeStyle = "#ffffff";
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(trueCanvasX, trueCanvasY, 7, 0, 2 * Math.PI);
            ctx.fill();
            ctx.stroke();

            // æ·»åŠ çœŸå®ä½ç½®æ ‡ç­¾
            ctx.fillStyle = "#ffffff";
            ctx.font = "12px Arial";
            ctx.textAlign = "left";
            ctx.fillText("çœŸå®ä½ç½®", trueCanvasX + 10, trueCanvasY - 5);
          }
        } else {
          console.log("çœŸå®ä½ç½®æœªæ˜¾ç¤ºï¼ŒshowTruePosition =", showTruePosition);
        }

        // æ·»åŠ å›¾ä¾‹
        addLegend(ctx, showTruePosition);

        // æ¢å¤å˜æ¢
        ctx.restore();
      }

      // æ›´æ–°æˆ‘çš„ä¸–ç•Œæç¤º
      function updateMinecraftTips() {
        const tipsElement = document.getElementById("minecraft-tips");
        const throwCount = eyeData.length;

        if (throwCount === 0) {
          tipsElement.innerHTML = "<p>å¼€å§‹æŠ•æ·æœ«å½±ä¹‹çœ¼æ¥å®šä½æœ«åœ°è¦å¡ï¼</p>";
        } else if (throwCount < 3) {
          tipsElement.innerHTML = `<p>å·²æŠ•æ· ${throwCount} æ¬¡ï¼Œè‡³å°‘éœ€è¦ 3 æ¬¡æ‰èƒ½è¿›è¡Œä¸‰è§’å®šä½ã€‚</p>`;
        } else if (throwCount < 8) {
          tipsElement.innerHTML = `<p>å·²æŠ•æ· ${throwCount} æ¬¡ï¼Œæ•°æ®è¶Šå¤šå®šä½è¶Šå‡†ç¡®ï¼å»ºè®®ç»§ç»­æŠ•æ·ã€‚</p>`;
        } else {
          tipsElement.innerHTML = `<p>å·²æŠ•æ· ${throwCount} æ¬¡ï¼Œæ•°æ®å……è¶³ï¼å¯ä»¥å¼€å§‹æŒ–æ˜å¯»æ‰¾è¦å¡ã€‚</p>`;
        }
      }

      // æ·»åŠ å›¾ä¾‹å‡½æ•°
      function addLegend(ctx, showTruePosition) {
        ctx.fillStyle = "#ffffff";
        ctx.font = "12px Arial";
        let legendY = 20;
        if (showTruePosition) {
          ctx.fillText("ğŸŸ¡ çœŸå®ä½ç½®", 10, legendY);
          legendY += 15;
        }
        ctx.fillText("ğŸ”µ ä¼°è®¡ä½ç½®", 10, legendY);
        legendY += 15;
        ctx.fillText("ğŸŸ¢ å£°çº³æ¢æµ‹", 10, legendY);
        legendY += 15;
        ctx.fillText("ğŸ”· ç½®ä¿¡åŒºåŸŸ", 10, legendY);
      }

      // é‡ç½®æœç´¢
      function resetSearch() {
        sonarData = [];
        showTruePosition = false; // é‡ç½®æ—¶éšè—çœŸå®ä½ç½®
        canDeployBuoy = true; // é‡æ–°å¯ç”¨æµ®æ ‡æŠ•æ”¾
        document.getElementById("estimated-position").textContent =
          "(0.0, 0.0)";
        document.getElementById("search-area").textContent = "-- kmÂ²";

        // éšè—åé¦ˆä¿¡æ¯åŒºåŸŸ
        const feedbackDiv = document.getElementById("prediction-feedback");
        if (feedbackDiv) {
          feedbackDiv.style.display = "none";
        }

        const canvas = document.getElementById("sonar-map");
        const ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // é‡æ–°ç»˜åˆ¶åŸºç¡€åœ°å›¾
        drawSonarMap(0, 0, 0, 0);

        // æ·»åŠ æŒ‰é’®ç‚¹å‡»åŠ¨ç”»
        const resetBtn = document.getElementById("reset-search-btn");
        if (resetBtn) {
          resetBtn.classList.add("button-click-effect");
          setTimeout(
            () => resetBtn.classList.remove("button-click-effect"),
            300
          );
        }

        // æ˜¾ç¤ºé‡ç½®æç¤º
        setTimeout(() => {
          ctx.fillStyle = "rgba(0, 150, 255, 0.8)";
          ctx.font = "16px Arial";
          ctx.fillText("æœç´¢å·²é‡ç½®ï¼Œè¯·é‡æ–°æŠ•æ”¾æµ®æ ‡", 20, 30);

          setTimeout(() => {
            drawSonarMap(0, 0, 0, 0);
          }, 2000);
        }, 100);
      }

      // æœ«å½±ä¹‹çœ¼å®éªŒ
      let bayesianPosterior = null;

      function throwEye() {
        // é˜²æŠ–ï¼šé˜²æ­¢ç”¨æˆ·å¿«é€Ÿè¿ç»­ç‚¹å‡»
        if (isThrowingEye) {
          console.log("ğŸš« é˜²æŠ–ï¼šå¿½ç•¥é‡å¤ç‚¹å‡»");
          return;
        }
        isThrowingEye = true;
        console.log("ğŸ¯ å¼€å§‹æŠ•æ·æœ«å½±ä¹‹çœ¼ï¼Œå½“å‰æŠ•æ·æ¬¡æ•°:", eyeData.length + 1);
        const startTime = performance.now();

        // æ·»åŠ æŒ‰é’®ç‚¹å‡»åŠ¨ç”»æ•ˆæœ
        const throwBtn = document.getElementById("throw-eye-btn");
        if (throwBtn) {
          throwBtn.classList.add("button-click-effect");
          setTimeout(
            () => throwBtn.classList.remove("button-click-effect"),
            300
          );
        }

        const eyeCount = parseInt(document.getElementById("eye-count").value);
        const confidenceLevel = parseFloat(
          document.getElementById("eye-confidence").value
        );
        const statisticalMethod =
          document.getElementById("statistical-method").value;
        const priorDistribution =
          document.getElementById("prior-distribution").value;

        // çœŸå®çš„æœ«å½±ä¹‹çœ¼æŠ•æ·æœºåˆ¶ï¼š16æ ¼åœ†åœˆå†…æ­£æ€åˆ†å¸ƒè§’åº¦
        const distance = Math.sqrt(
          Math.pow(strongholdTruePosition.x - playerPosition.x, 2) +
            Math.pow(strongholdTruePosition.z - playerPosition.z, 2)
        );

        // çœŸå®è§’åº¦ï¼ˆä»ç©å®¶åˆ°è¦å¡ï¼‰
        const trueAngle = Math.atan2(
          strongholdTruePosition.z - playerPosition.z,
          strongholdTruePosition.x - playerPosition.x
        );

        // è§’åº¦è¯¯å·®ï¼šç¬¦åˆæ­£æ€åˆ†å¸ƒï¼Œæ ‡å‡†å·®çº¦ä¸ºÏ€/36ï¼ˆ5åº¦ï¼‰
        const angleError = normalRandom(0, Math.PI / 36);
        const observedAngle = trueAngle + angleError;

        // æœ«å½±ä¹‹çœ¼è½åœ¨è·ç¦»ç©å®¶16æ ¼ï¼ˆåœ°å›¾åæ ‡320ï¼‰çš„åœ†åœˆä¸Š
        const eyeThrowRadius = 320;

        // è®¡ç®—æœ«å½±ä¹‹çœ¼åœ¨16æ ¼åœ†åœˆä¸Šçš„è½ç‚¹
        const eyeX =
          playerPosition.x + Math.cos(observedAngle) * eyeThrowRadius;
        const eyeZ =
          playerPosition.z + Math.sin(observedAngle) * eyeThrowRadius;

        // è®°å½•æŠ•æ·æ•°æ®ï¼ŒåŒ…å«é¢œè‰²ä¿¡æ¯ç”¨äºå¯è§†åŒ–
        const throwColor =
          eyeThrowColors[eyeThrowIndex % eyeThrowColors.length];
        eyeData.push({
          x: eyeX,
          z: eyeZ,
          angle: observedAngle,
          trueAngle: trueAngle,
          angleError: angleError,
          distance: distance,
          color: throwColor,
          timestamp: Date.now(),
          // ä¿å­˜æŠ•æ·æ—¶çš„ç©å®¶ä½ç½®å¿«ç…§ï¼Œç¡®ä¿è§’åº¦ç½®ä¿¡åŒºé—´ç‹¬ç«‹
          playerPosition: {
            x: playerPosition.x,
            z: playerPosition.z,
          },
        });

        eyeThrowIndex++;

        if (eyeData.length >= 3) {
          console.log("ğŸ¯ å¼€å§‹ç»Ÿè®¡è®¡ç®—ï¼Œæ–¹æ³•:", statisticalMethod);
          if (statisticalMethod === "bayesian") {
            calculateBayesianPosition(confidenceLevel, priorDistribution);
            console.log("ğŸ¯ è´å¶æ–¯è®¡ç®—è°ƒç”¨å®Œæˆ");
          } else {
            calculateStrongholdPosition(confidenceLevel);
            console.log("ğŸ¯ ç»å…¸ç»Ÿè®¡è®¡ç®—å®Œæˆ");
          }

          // è®¡ç®—å¹¶æ˜¾ç¤ºè§’åº¦ç½®ä¿¡åŒºé—´
          console.log("ğŸ¯ å¼€å§‹è®¡ç®—è§’åº¦ç½®ä¿¡åŒºé—´");
          const alpha = parseFloat(
            document.getElementById("alpha-level").value
          );
          const angleCI = calculateAngleConfidenceInterval(alpha);
          console.log("ğŸ¯ è§’åº¦ç½®ä¿¡åŒºé—´è®¡ç®—å®Œæˆ");
          if (angleCI && angleCI.length > 0) {
            // æ˜¾ç¤ºæœ€æ–°çš„ç½®ä¿¡åŒºé—´ï¼ˆæœ€åä¸€ä¸ªï¼‰
            const latestCI = angleCI[angleCI.length - 1];
            document.getElementById(
              "angle-confidence-interval"
            ).textContent = `[${latestCI.lowerBoundDegrees.toFixed(
              1
            )}Â°, ${latestCI.upperBoundDegrees.toFixed(1)}Â°] (${Math.round(
              (1 - alpha) * 100
            )}%) - ä½ç½®${angleCI.length}`;
            console.log(
              "ğŸ¯ è§’åº¦ç½®ä¿¡åŒºé—´DOMæ›´æ–°å®Œæˆï¼Œå…±",
              angleCI.length,
              "ä¸ªç½®ä¿¡åŒºé—´"
            );
          }
        }

        console.log("ğŸ¯ å¼€å§‹è°ƒç”¨åœ°å›¾ç»˜åˆ¶å‡½æ•°");
        drawMinecraftMap();
        console.log("ğŸ¯ åœ°å›¾ç»˜åˆ¶å‡½æ•°è°ƒç”¨å®Œæˆ");

        console.log("ğŸ¯ å¼€å§‹æ›´æ–°æç¤ºä¿¡æ¯");
        updateMinecraftTips();
        console.log("ğŸ¯ æç¤ºä¿¡æ¯æ›´æ–°å®Œæˆ");

        // ç®€åŒ–åŠ¨ç”»æ•ˆæœï¼Œå‡å°‘DOMæ“ä½œï¼ˆä»…å‰3æ¬¡æŠ•æ·æ˜¾ç¤ºåŠ¨ç”»ï¼‰
        if (eyeData.length <= 3) {
          const canvas = document.getElementById("minecraft-canvas");
          if (canvas) {
            canvas.classList.add("data-point-enter");
            setTimeout(() => canvas.classList.remove("data-point-enter"), 300);
          }
        }

        // ç®€åŒ–ç»“æœæ˜¾ç¤ºåŠ¨ç”»
        if (eyeData.length >= 3) {
          const resultsContainer = document.getElementById(
            "stronghold-position"
          );
          if (resultsContainer) {
            resultsContainer.parentElement.classList.add("result-slide-in");
            setTimeout(
              () =>
                resultsContainer.parentElement.classList.remove(
                  "result-slide-in"
                ),
              400
            );
          }
        }

        // é‡ç½®é˜²æŠ–æ ‡å¿—ï¼ˆå¢åŠ å»¶è¿Ÿç¡®ä¿è®¡ç®—å®Œæˆï¼‰
        setTimeout(
          () => {
            isThrowingEye = false;
            const totalEndTime = performance.now();
            console.log(
              "ğŸ¯ æŠ•æ·å®Œæˆï¼Œæ€»è€—æ—¶:",
              (totalEndTime - startTime).toFixed(2),
              "ms"
            );
            console.log("---");
          },
          eyeData.length >= 3 ? 500 : 200
        );
      }

      // è®¡ç®—è¦å¡ä½ç½®ï¼ˆç»å…¸ç»Ÿè®¡æ–¹æ³•ï¼‰
      function calculateStrongholdPosition(confidenceLevel) {
        const n = eyeData.length;
        const avgX = eyeData.reduce((sum, point) => sum + point.x, 0) / n;
        const avgZ = eyeData.reduce((sum, point) => sum + point.z, 0) / n;

        const stdX = Math.sqrt(
          eyeData.reduce((sum, point) => sum + Math.pow(point.x - avgX, 2), 0) /
            Math.max(1, n - 1)
        );
        const stdZ = Math.sqrt(
          eyeData.reduce((sum, point) => sum + Math.pow(point.z - avgZ, 2), 0) /
            Math.max(1, n - 1)
        );

        // ä½¿ç”¨ç²¾ç¡®çš„tåˆ†å¸ƒä¸´ç•Œå€¼è®¡ç®—
        const df = Math.max(1, n - 1);
        const alpha = 1 - confidenceLevel;
        const t = tDistributionInverse(1 - alpha / 2, df);

        const marginX = (t * stdX) / Math.sqrt(n);
        const marginZ = (t * stdZ) / Math.sqrt(n);

        document.getElementById(
          "stronghold-position"
        ).textContent = `(${Math.round(avgX)}, ${Math.round(avgZ)})`;
        document.getElementById("search-range").textContent = `Â±${Math.round(
          Math.max(marginX, marginZ)
        )} æ ¼`;
      }

      // è´å¶æ–¯ç»Ÿè®¡è®¡ç®—ï¼ˆä¼˜åŒ–ç‰ˆæœ¬ï¼‰
      function calculateBayesianPosition(confidenceLevel, priorType) {
        console.log("ğŸ“Š å¼€å§‹è´å¶æ–¯è®¡ç®—ï¼Œæ•°æ®ç‚¹æ•°é‡:", eyeData.length);
        const bayesianStartTime = performance.now();
        const n = eyeData.length;

        // è®¾ç½®å…ˆéªŒåˆ†å¸ƒå‚æ•°
        let priorMeanX = 0,
          priorMeanZ = 0,
          priorVarX = 10000,
          priorVarZ = 10000;

        if (priorType === "normal") {
          // åŸºäºæ¸¸æˆçŸ¥è¯†çš„æ­£æ€å…ˆéªŒ
          priorMeanX = 100;
          priorMeanZ = -100;
          priorVarX = 5000;
          priorVarZ = 5000;
        } else if (priorType === "informed") {
          // æœ‰ä¿¡æ¯å…ˆéªŒï¼šåŸºäºå·²çŸ¥è¦å¡ç”Ÿæˆè§„å¾‹
          priorMeanX = 150;
          priorMeanZ = -200;
          priorVarX = 2500;
          priorVarZ = 2500;
        }

        // è®¡ç®—æ ·æœ¬ç»Ÿè®¡é‡ï¼ˆä¼˜åŒ–ï¼šé¿å…é‡å¤è®¡ç®—ï¼‰
        let sumX = 0,
          sumZ = 0;
        for (let i = 0; i < n; i++) {
          sumX += eyeData[i].x;
          sumZ += eyeData[i].z;
        }
        const sampleMeanX = sumX / n;
        const sampleMeanZ = sumZ / n;

        // å‡è®¾å·²çŸ¥æ–¹å·®ï¼ˆç®€åŒ–å¤„ç†ï¼‰
        const likelihoodVarX = 1000;
        const likelihoodVarZ = 1000;

        // è´å¶æ–¯æ›´æ–°ï¼ˆæ­£æ€-æ­£æ€å…±è½­ï¼‰
        const posteriorVarX = 1 / (1 / priorVarX + n / likelihoodVarX);
        const posteriorVarZ = 1 / (1 / priorVarZ + n / likelihoodVarZ);

        const posteriorMeanX =
          posteriorVarX *
          (priorMeanX / priorVarX + (n * sampleMeanX) / likelihoodVarX);
        const posteriorMeanZ =
          posteriorVarZ *
          (priorMeanZ / priorVarZ + (n * sampleMeanZ) / likelihoodVarZ);

        // è®¡ç®—å¯ä¿¡åŒºé—´
        const z =
          confidenceLevel === 0.9
            ? 1.645
            : confidenceLevel === 0.95
            ? 1.96
            : 2.576;
        const marginX = z * Math.sqrt(posteriorVarX);
        const marginZ = z * Math.sqrt(posteriorVarZ);

        // å­˜å‚¨åéªŒåˆ†å¸ƒï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼Œä¸ç”¨äºå¤æ‚ç»˜åˆ¶ï¼‰
        bayesianPosterior = {
          meanX: posteriorMeanX,
          meanZ: posteriorMeanZ,
          varX: posteriorVarX,
          varZ: posteriorVarZ,
          marginX: marginX,
          marginZ: marginZ,
        };

        const bayesianEndTime = performance.now();
        console.log(
          "ğŸ“Š è´å¶æ–¯è®¡ç®—å®Œæˆï¼Œè€—æ—¶:",
          (bayesianEndTime - bayesianStartTime).toFixed(2),
          "ms"
        );

        console.log("ğŸ“Š å¼€å§‹æ›´æ–°DOMå…ƒç´ ");
        document.getElementById(
          "stronghold-position"
        ).textContent = `(${Math.round(posteriorMeanX)}, ${Math.round(
          posteriorMeanZ
        )})`;
        console.log("ğŸ“Š stronghold-position æ›´æ–°å®Œæˆ");

        document.getElementById("search-range").textContent = `Â±${Math.round(
          Math.max(marginX, marginZ)
        )} æ ¼ (${Math.round(confidenceLevel * 100)}% å¯ä¿¡åŒºé—´)`;
        console.log("ğŸ“Š search-range æ›´æ–°å®Œæˆ");
        console.log("ğŸ“Š è´å¶æ–¯å‡½æ•°æ‰§è¡Œå®Œæ¯•");
      }

      // è®¡ç®—ä¸¤ä¸ªç‚¹ä¹‹é—´ç›¸å¯¹äºxè½´æ­£æ–¹å‘çš„è§’åº¦ï¼ˆè€ƒè™‘Canvasç¼©æ”¾ï¼‰
      function calculateAngleBetweenPoints(fromPoint, toPoint) {
        const dx = toPoint.x - fromPoint.x;
        const dz = toPoint.z - fromPoint.z;

        // è·å–Canvaså°ºå¯¸ä»¥è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
        const canvas = document.getElementById("minecraft-map");
        const rect = canvas.getBoundingClientRect();

        // è€ƒè™‘xè½´å’Œzè½´å¯èƒ½ä¸åŒçš„ç¼©æ”¾æ¯”ä¾‹
        const xScale = rect.width / 4000; // toCanvasXçš„ç¼©æ”¾å› å­
        const zScale = rect.height / 4000; // toCanvasZçš„ç¼©æ”¾å› å­

        // è°ƒæ•´åæ ‡å·®å€¼ä»¥è¡¥å¿ç¼©æ”¾å·®å¼‚
        const adjustedDx = dx * xScale;
        const adjustedDz = dz * zScale;

        return Math.atan2(adjustedDz, adjustedDx);
      }

      // è®¡ç®—è§’åº¦çš„ç½®ä¿¡åŒºé—´ - æ”¯æŒå¤šä¸ªç‹¬ç«‹çš„ç½®ä¿¡åŒºé—´
      function calculateAngleConfidenceInterval(alpha = 0.05) {
        console.log("ğŸ“ å¼€å§‹è§’åº¦ç½®ä¿¡åŒºé—´è®¡ç®—ï¼Œæ•°æ®ç‚¹æ•°é‡:", eyeData.length);
        const angleStartTime = performance.now();
        if (eyeData.length < 3) return null;

        // æŒ‰ç©å®¶ä½ç½®åˆ†ç»„æŠ•æ·ç‚¹ï¼Œæ¯ä¸ªä½ç½®ç‹¬ç«‹è®¡ç®—ç½®ä¿¡åŒºé—´
        const positionGroups = new Map();
        eyeData.forEach((point, index) => {
          const posKey = `${point.playerPosition.x},${point.playerPosition.z}`;
          if (!positionGroups.has(posKey)) {
            positionGroups.set(posKey, {
              playerPos: point.playerPosition,
              points: [],
            });
          }
          positionGroups
            .get(posKey)
            .points.push({ ...point, originalIndex: index });
        });

        const confidenceIntervals = [];

        // ä¸ºæ¯ä¸ªç©å®¶ä½ç½®ç»„è®¡ç®—ç‹¬ç«‹çš„ç½®ä¿¡åŒºé—´
        positionGroups.forEach((group, posKey) => {
          const points = group.points;
          const playerPos = group.playerPos;
          const n = points.length;

          if (n < 3) {
            console.log(`ğŸ“ ä½ç½® ${posKey} çš„æŠ•æ·ç‚¹ä¸è¶³3ä¸ªï¼Œè·³è¿‡ç½®ä¿¡åŒºé—´è®¡ç®—`);
            return;
          }

          // é‡æ–°è®¡ç®—æ¯ä¸ªæŠ•æ·ç‚¹ç›¸å¯¹äºè¯¥ç»„ç©å®¶ä½ç½®çš„è§’åº¦
          const angles = points.map((point) => {
            return calculateAngleBetweenPoints(playerPos, point);
          });
          console.log(
            `ğŸ“ ä½ç½® ${posKey} è§’åº¦æ•°æ®é‡æ–°è®¡ç®—å®Œæˆï¼Œè§’åº¦æ•°ç»„:`,
            angles.map((a) => ((a * 180) / Math.PI).toFixed(2))
          );

          // è®¡ç®—è§’åº¦çš„å¹³å‡å€¼ï¼ˆè€ƒè™‘è§’åº¦çš„å‘¨æœŸæ€§ï¼‰
          console.log(`ğŸ“ ä½ç½® ${posKey} å¼€å§‹è®¡ç®—è§’åº¦å¹³å‡å€¼`);
          const sinSum = angles.reduce(
            (sum, angle) => sum + Math.sin(angle),
            0
          );
          const cosSum = angles.reduce(
            (sum, angle) => sum + Math.cos(angle),
            0
          );
          const meanAngle = Math.atan2(sinSum / n, cosSum / n);
          console.log(
            `ğŸ“ ä½ç½® ${posKey} è§’åº¦å¹³å‡å€¼è®¡ç®—å®Œæˆ:`,
            meanAngle,
            "åº¦æ•°:",
            ((meanAngle * 180) / Math.PI).toFixed(2)
          );

          // è®¡ç®—è§’åº¦çš„æ ‡å‡†å·®ï¼ˆå‡è®¾è§’åº¦è¯¯å·®æœä»æ­£æ€åˆ†å¸ƒï¼‰
          console.log(`ğŸ“ ä½ç½® ${posKey} å¼€å§‹è®¡ç®—è§’åº¦æ ‡å‡†å·®`);
          const angleDeviations = angles.map((angle) => {
            let diff = angle - meanAngle;
            // å¤„ç†è§’åº¦å·®çš„å‘¨æœŸæ€§
            while (diff > Math.PI) diff -= 2 * Math.PI;
            while (diff < -Math.PI) diff += 2 * Math.PI;
            return diff;
          });
          console.log(`ğŸ“ ä½ç½® ${posKey} è§’åº¦åå·®è®¡ç®—å®Œæˆ`);

          const angleVariance =
            angleDeviations.reduce((sum, dev) => sum + dev * dev, 0) / (n - 1);
          const angleStd = Math.sqrt(angleVariance);
          console.log(
            `ğŸ“ ä½ç½® ${posKey} è§’åº¦æ ‡å‡†å·®è®¡ç®—å®Œæˆ:`,
            angleStd,
            "åº¦æ•°:",
            ((angleStd * 180) / Math.PI).toFixed(2)
          );

          // ä½¿ç”¨tåˆ†å¸ƒè®¡ç®—ç½®ä¿¡åŒºé—´
          console.log(`ğŸ“ ä½ç½® ${posKey} å¼€å§‹tåˆ†å¸ƒè®¡ç®—`);
          const df = n - 1;
          console.log(
            `ğŸ“ ä½ç½® ${posKey} è‡ªç”±åº¦df:`,
            df,
            "ç½®ä¿¡æ°´å¹³å‚æ•°:",
            1 - alpha / 2
          );

          let t, marginError;
          try {
            t = tDistributionInverse(1 - alpha / 2, df);
            console.log(`ğŸ“ ä½ç½® ${posKey} tåˆ†å¸ƒè®¡ç®—å®Œæˆ, tå€¼:`, t);

            // æ£€æŸ¥tå€¼æ˜¯å¦æœ‰æ•ˆ
            if (!isFinite(t) || Math.abs(t) > 1000) {
              console.warn(`ğŸ“ ä½ç½® ${posKey} tå€¼å¼‚å¸¸ï¼Œä½¿ç”¨å¤‡ç”¨è®¡ç®—æ–¹æ³•`);
              // ä½¿ç”¨ç®€åŒ–çš„æ­£æ€åˆ†å¸ƒè¿‘ä¼¼
              t = 1.96; // 95%ç½®ä¿¡åŒºé—´çš„zå€¼
            }

            marginError = (t * angleStd) / Math.sqrt(n);
            console.log(`ğŸ“ ä½ç½® ${posKey} è¾¹é™…è¯¯å·®è®¡ç®—å®Œæˆ:`, marginError);

            // æ£€æŸ¥è¾¹é™…è¯¯å·®æ˜¯å¦æœ‰æ•ˆ
            if (!isFinite(marginError) || marginError > Math.PI) {
              console.warn(`ğŸ“ ä½ç½® ${posKey} è¾¹é™…è¯¯å·®å¼‚å¸¸ï¼Œä½¿ç”¨é»˜è®¤å€¼`);
              marginError = Math.PI / 6; // 30åº¦ä½œä¸ºé»˜è®¤å€¼
            }
          } catch (error) {
            console.error(`ğŸ“ ä½ç½® ${posKey} tåˆ†å¸ƒè®¡ç®—å‡ºé”™:`, error);
            t = 1.96;
            marginError = Math.PI / 6;
          }

          // è®¡ç®—ç½®ä¿¡åŒºé—´è¾¹ç•Œ
          let lowerBound = meanAngle - marginError;
          let upperBound = meanAngle + marginError;

          // å¤„ç†è§’åº¦è¾¹ç•Œçš„å‘¨æœŸæ€§
          while (lowerBound < -Math.PI) lowerBound += 2 * Math.PI;
          while (upperBound > Math.PI) upperBound -= 2 * Math.PI;

          // å°†è¯¥ä½ç½®çš„ç½®ä¿¡åŒºé—´æ·»åŠ åˆ°ç»“æœæ•°ç»„
          confidenceIntervals.push({
            playerPosition: playerPos,
            meanAngle: meanAngle,
            lowerBound: lowerBound,
            upperBound: upperBound,
            marginError: marginError,
            confidenceLevel: 1 - alpha,
            sampleSize: n,
            positionKey: posKey,
          });
        });

        const angleEndTime = performance.now();
        console.log(
          "ğŸ“ è§’åº¦ç½®ä¿¡åŒºé—´è®¡ç®—å®Œæˆï¼Œè€—æ—¶:",
          (angleEndTime - angleStartTime).toFixed(2),
          "ms",
          "å…±è®¡ç®—äº†",
          confidenceIntervals.length,
          "ä¸ªç‹¬ç«‹ç½®ä¿¡åŒºé—´"
        );

        // ä¸ºæ¯ä¸ªç½®ä¿¡åŒºé—´æ·»åŠ åº¦æ•°è½¬æ¢
        confidenceIntervals.forEach((interval) => {
          interval.meanAngleDegrees = (interval.meanAngle * 180) / Math.PI;
          interval.lowerBoundDegrees = (interval.lowerBound * 180) / Math.PI;
          interval.upperBoundDegrees = (interval.upperBound * 180) / Math.PI;
          interval.marginErrorDegrees = (interval.marginError * 180) / Math.PI;
        });

        return confidenceIntervals;
      }

      // ç»˜åˆ¶æˆ‘çš„ä¸–ç•Œåœ°å›¾
      function drawMinecraftMap() {
        console.log("ğŸ—ºï¸ å¼€å§‹ç»˜åˆ¶åœ°å›¾ï¼ŒæŠ•æ·æ•°æ®æ•°é‡:", eyeData.length);
        const mapStartTime = performance.now();
        const canvas = document.getElementById("minecraft-map");
        const ctx = canvas.getContext("2d");

        // è·å–è®¾å¤‡åƒç´ æ¯”ä»¥æå‡æ¸…æ™°åº¦
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();

        // è®¾ç½®canvaså®é™…åˆ†è¾¨ç‡ï¼ˆè€ƒè™‘è®¾å¤‡åƒç´ æ¯”ï¼‰
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;

        // è®¾ç½®canvasæ˜¾ç¤ºå°ºå¯¸
        canvas.style.width = rect.width + "px";
        canvas.style.height = rect.height + "px";

        // ç¼©æ”¾ç»˜å›¾ä¸Šä¸‹æ–‡ä»¥åŒ¹é…è®¾å¤‡åƒç´ æ¯”
        ctx.scale(dpr, dpr);

        // å¯ç”¨æŠ—é”¯é½¿
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = "high";

        ctx.clearRect(0, 0, rect.width, rect.height);

        const displayMode = document.getElementById("display-mode").value;
        const statisticalMethod =
          document.getElementById("statistical-method").value;

        // åº”ç”¨ç¼©æ”¾å’Œå¹³ç§»å˜æ¢
        ctx.save();
        ctx.translate(
          rect.width / 2 + minecraftMapOffsetX,
          rect.height / 2 + minecraftMapOffsetY
        );
        ctx.scale(minecraftMapZoom, minecraftMapZoom);
        ctx.translate(-rect.width / 2, -rect.height / 2);

        // åæ ‡è½¬æ¢ï¼ˆè€ƒè™‘ç¼©æ”¾å’Œå¹³ç§»ï¼‰- æ‰©å±•åˆ°4000æ ¼èŒƒå›´
        const toCanvasX = (x) => ((x + 2000) * rect.width) / 4000;
        const toCanvasZ = (z) => ((2000 - z) * rect.height) / 4000;

        // çƒ­åŠ›å›¾åŠŸèƒ½å·²ç§»é™¤

        // æš‚æ—¶ç¦ç”¨ç­‰é«˜çº¿ç»˜åˆ¶ä»¥è§£å†³æ€§èƒ½é—®é¢˜
        // ç­‰é«˜çº¿ç»˜åˆ¶ä¼šå¯¼è‡´å¤§é‡çš„gaussianPDFè®¡ç®—ï¼Œåœ¨æŸäº›è®¾å¤‡ä¸Šä¼šé€ æˆCPUå æ»¡
        // if (statisticalMethod === 'bayesian' && displayMode === 'contour' && bayesianPosterior && eyeData.length <= 5) {
        //   drawContourLines(ctx, canvas, toCanvasX, toCanvasZ, rect);
        // }

        // ç»˜åˆ¶ç½‘æ ¼ - æ‰©å±•ç½‘æ ¼èŒƒå›´ä»¥è¦†ç›–è¦å¡ç”ŸæˆåŒºåŸŸ
        ctx.strokeStyle =
          displayMode === "heatmap"
            ? "rgba(255, 255, 255, 0.3)"
            : "rgba(255, 255, 255, 0.1)";
        ctx.lineWidth = 1;
        // æ‰©å±•åˆ°Â±20000ä»¥ç¡®ä¿è¦†ç›–1800x1800æ¸¸æˆåæ ‡ï¼ˆ36000x36000åœ°å›¾åæ ‡ï¼‰çš„è¦å¡ç”ŸæˆåŒºåŸŸ
        for (let i = -20000; i <= 20000; i += 500) {
          ctx.beginPath();
          ctx.moveTo(toCanvasX(i), 0);
          ctx.lineTo(toCanvasX(i), rect.height);
          ctx.stroke();

          ctx.beginPath();
          ctx.moveTo(0, toCanvasZ(i));
          ctx.lineTo(rect.width, toCanvasZ(i));
          ctx.stroke();
        }

        // ç»˜åˆ¶æœ«å½±ä¹‹çœ¼æŠ•æ·ç‚¹å’Œæ–¹å‘çº¿ï¼ˆä¼˜åŒ–ç‰ˆæœ¬ï¼‰
        eyeData.forEach((point, index) => {
          const color =
            point.color || eyeThrowColors[index % eyeThrowColors.length];

          // ç»˜åˆ¶ä»æŠ•æ·æ—¶çš„ç©å®¶ä½ç½®åˆ°æœ«å½±ä¹‹çœ¼è½ç‚¹çš„æ–¹å‘çº¿
          ctx.strokeStyle = color;
          ctx.lineWidth = 2;
          ctx.setLineDash([5, 5]);
          ctx.beginPath();
          // ä½¿ç”¨æŠ•æ·æ—¶ä¿å­˜çš„ç©å®¶ä½ç½®ï¼Œç¡®ä¿è¿çº¿ç‹¬ç«‹
          const throwPlayerPos = point.playerPosition || playerPosition;
          ctx.moveTo(toCanvasX(throwPlayerPos.x), toCanvasZ(throwPlayerPos.z));
          ctx.lineTo(toCanvasX(point.x), toCanvasZ(point.z));
          ctx.stroke();
          ctx.setLineDash([]);

          // ç®€åŒ–æŠ•æ·èŒƒå›´åœ†åœˆç»˜åˆ¶ï¼ˆå‡å°‘è®¡ç®—ï¼‰
          if (eyeData.length <= 5) {
            const rangeRadius = Math.max(8, point.distance / 60);
            ctx.strokeStyle = color;
            ctx.lineWidth = 1;
            ctx.globalAlpha = 0.2;
            ctx.beginPath();
            ctx.arc(
              toCanvasX(point.x),
              toCanvasZ(point.z),
              rangeRadius,
              0,
              2 * Math.PI
            );
            ctx.stroke();
            ctx.globalAlpha = 1;
          }

          // ç»˜åˆ¶æœ«å½±ä¹‹çœ¼è½ç‚¹
          ctx.fillStyle = color;
          ctx.beginPath();
          ctx.arc(toCanvasX(point.x), toCanvasZ(point.z), 4, 0, 2 * Math.PI);
          ctx.fill();

          ctx.strokeStyle = "#ffffff";
          ctx.lineWidth = 1;
          ctx.stroke();

          // æ˜¾ç¤ºæŠ•æ·é¡ºåºï¼ˆç®€åŒ–æ–‡æœ¬ç»˜åˆ¶ï¼‰
          ctx.fillStyle = "#ffffff";
          ctx.font = "bold 10px Arial";
          ctx.fillText(
            (index + 1).toString(),
            toCanvasX(point.x) + 6,
            toCanvasZ(point.z) - 6
          );
        });

        // ç»˜åˆ¶ç©å®¶ä½ç½®
        ctx.fillStyle = "#00ff00";
        ctx.beginPath();
        ctx.arc(
          toCanvasX(playerPosition.x),
          toCanvasZ(playerPosition.z),
          5,
          0,
          2 * Math.PI
        );
        ctx.fill();

        ctx.strokeStyle = "#ffffff";
        ctx.lineWidth = 2;
        ctx.stroke();

        // ç©å®¶ä½ç½®æ ‡ç­¾
        ctx.fillStyle = "#ffffff";
        ctx.font = "bold 12px Arial";
        ctx.strokeStyle = "#000000";
        ctx.lineWidth = 3;
        ctx.strokeText(
          "ç©å®¶",
          toCanvasX(playerPosition.x) + 8,
          toCanvasZ(playerPosition.z) - 8
        );
        ctx.fillText(
          "ç©å®¶",
          toCanvasX(playerPosition.x) + 8,
          toCanvasZ(playerPosition.z) - 8
        );

        // ç»˜åˆ¶çœŸå®è¦å¡ä½ç½®ï¼ˆæ ¹æ®showTruePositionæ§åˆ¶æ˜¾ç¤ºï¼‰
        if (showTruePosition) {
          ctx.fillStyle = "#ffd700";
          ctx.beginPath();
          ctx.arc(
            toCanvasX(strongholdTruePosition.x),
            toCanvasZ(strongholdTruePosition.z),
            8,
            0,
            2 * Math.PI
          );
          ctx.fill();

          ctx.strokeStyle = "#ffffff";
          ctx.lineWidth = 2;
          ctx.stroke();

          // æ·»åŠ è¦å¡æ ‡ç­¾
          ctx.fillStyle = "#ffffff";
          ctx.font = "12px Arial";
          ctx.fillText(
            "è¦å¡",
            toCanvasX(strongholdTruePosition.x) + 10,
            toCanvasZ(strongholdTruePosition.z) - 10
          );
        }

        // ç»˜åˆ¶ç©å®¶ä½ç½®ï¼ˆåŸç‚¹ï¼‰
        ctx.fillStyle = "#00ff66";
        ctx.beginPath();
        ctx.arc(toCanvasX(0), toCanvasZ(0), 5, 0, 2 * Math.PI);
        ctx.fill();

        ctx.strokeStyle = "#ffffff";
        ctx.lineWidth = 2;
        ctx.stroke();

        // ç»˜åˆ¶ä¼°è®¡ä½ç½®ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
        if (eyeData.length >= 3) {
          drawEstimatedPosition(ctx, canvas, toCanvasX, toCanvasZ, displayMode);

          // ç»˜åˆ¶è§’åº¦ç½®ä¿¡åŒºé—´
          const alpha = parseFloat(
            document.getElementById("alpha-level").value
          );
          const angleCI = calculateAngleConfidenceInterval(alpha);
          if (angleCI) {
            drawAngleConfidenceInterval(
              ctx,
              canvas,
              toCanvasX,
              toCanvasZ,
              angleCI
            );
          }
        }

        // æ¢å¤å˜æ¢
        ctx.restore();

        // æ·»åŠ å›¾ä¾‹ï¼ˆåœ¨å˜æ¢æ¢å¤åç»˜åˆ¶ï¼Œä¿æŒå›ºå®šä½ç½®ï¼‰
        ctx.fillStyle = displayMode === "heatmap" ? "#ffffff" : "#ffffff";
        ctx.font = "12px Arial";
        ctx.fillText("ğŸŸ¢ ç©å®¶ä½ç½®", 10, 20);
        ctx.fillText("ğŸŸ¡ çœŸå®è¦å¡", 10, 35);
        ctx.fillText("ğŸŸ£ æœ«å½±ä¹‹çœ¼", 10, 50);
        if (eyeData.length >= 3) {
          ctx.fillText(
            statisticalMethod === "bayesian" ? "ğŸ”µ è´å¶æ–¯ä¼°è®¡" : "ğŸ”µ ç»å…¸ä¼°è®¡",
            10,
            65
          );
          ctx.fillText("ğŸŸ¢ è§’åº¦ç½®ä¿¡åŒºé—´", 10, 80);
        }

        // æ£€æŸ¥ç©å®¶æ˜¯å¦æ¥è¿‘è¦å¡ï¼ˆ16æ ¼å†…ï¼Œå¯¹åº”åœ°å›¾320å•ä½ï¼‰
        const distanceToStronghold = Math.sqrt(
          Math.pow(playerPosition.x - strongholdTruePosition.x, 2) +
            Math.pow(playerPosition.z - strongholdTruePosition.z, 2)
        );

        if (
          distanceToStronghold <= 320 &&
          eyeData.length >= 3 &&
          !showTruePosition
        ) {
          showTruePosition = true;
          showSuccessAnimation(distanceToStronghold);
        }

        const mapEndTime = performance.now();
        console.log(
          "ğŸ—ºï¸ åœ°å›¾ç»˜åˆ¶å®Œæˆï¼Œè€—æ—¶:",
          (mapEndTime - mapStartTime).toFixed(2),
          "ms"
        );
      }

      // ç»˜åˆ¶è§’åº¦ç½®ä¿¡åŒºé—´
      function drawAngleConfidenceInterval(
        ctx,
        canvas,
        toCanvasX,
        toCanvasZ,
        angleCI
      ) {
        // å¦‚æœangleCIæ˜¯æ•°ç»„ï¼Œåˆ™ç»˜åˆ¶å¤šä¸ªç‹¬ç«‹çš„ç½®ä¿¡åŒºé—´
        if (Array.isArray(angleCI)) {
          angleCI.forEach((interval, index) => {
            drawSingleAngleConfidenceInterval(
              ctx,
              canvas,
              toCanvasX,
              toCanvasZ,
              interval,
              index
            );
          });
          return;
        }

        // å…¼å®¹æ—§ç‰ˆæœ¬ï¼šå¦‚æœæ˜¯å•ä¸ªç½®ä¿¡åŒºé—´å¯¹è±¡ï¼Œä½¿ç”¨å½“å‰ç©å®¶ä½ç½®
        drawSingleAngleConfidenceInterval(
          ctx,
          canvas,
          toCanvasX,
          toCanvasZ,
          angleCI,
          0
        );
      }

      // ç»˜åˆ¶å•ä¸ªè§’åº¦ç½®ä¿¡åŒºé—´
      function drawSingleAngleConfidenceInterval(
        ctx,
        canvas,
        toCanvasX,
        toCanvasZ,
        angleCI,
        index = 0
      ) {
        // ä½¿ç”¨ç½®ä¿¡åŒºé—´ä¸­ä¿å­˜çš„ç©å®¶ä½ç½®ï¼Œè€Œä¸æ˜¯å½“å‰ç©å®¶ä½ç½®
        const playerPos = angleCI.playerPosition || playerPosition;
        const playerX = toCanvasX(playerPos.x);
        const playerZ = toCanvasZ(playerPos.z);

        // è®¡ç®—å°„çº¿å»¶ä¼¸åˆ°Canvasè¾¹ç•Œçš„æœ€å¤§é•¿åº¦
        // è€ƒè™‘åœ°å›¾ç¼©æ”¾å’Œå¹³ç§»ï¼Œç¡®ä¿å°„çº¿èƒ½å»¶ä¼¸åˆ°å˜æ¢åçš„å¯è§†åŒºåŸŸè¾¹ç•Œ
        const canvasRect = canvas.getBoundingClientRect();

        // è€ƒè™‘å½“å‰çš„åœ°å›¾å˜æ¢çŠ¶æ€
        const transformedWidth = canvasRect.width / mapZoom;
        const transformedHeight = canvasRect.height / mapZoom;

        // è®¡ç®—ä»ç©å®¶ä½ç½®åˆ°canvaså››ä¸ªè§’çš„æœ€å¤§è·ç¦»
        const corners = [
          { x: -mapOffsetX / mapZoom, z: -mapOffsetY / mapZoom },
          {
            x: (canvasRect.width - mapOffsetX) / mapZoom,
            z: -mapOffsetY / mapZoom,
          },
          {
            x: -mapOffsetX / mapZoom,
            z: (canvasRect.height - mapOffsetY) / mapZoom,
          },
          {
            x: (canvasRect.width - mapOffsetX) / mapZoom,
            z: (canvasRect.height - mapOffsetY) / mapZoom,
          },
        ];

        const maxDistance = Math.max(
          ...corners.map((corner) =>
            Math.sqrt((corner.x - playerX) ** 2 + (corner.z - playerZ) ** 2)
          )
        );

        const radius = Math.max(
          maxDistance * 2,
          Math.sqrt(transformedWidth ** 2 + transformedHeight ** 2)
        ); // ç¡®ä¿å°„çº¿è¶³å¤Ÿé•¿

        // ç›´æ¥ä½¿ç”¨è®¡ç®—å‡ºçš„è§’åº¦å€¼ï¼Œé€‚é…Canvasåæ ‡ç³»ç»Ÿ
        // ç”±äºtoCanvasZä½¿ç”¨(2000-z)ç¿»è½¬äº†Zè½´ï¼Œéœ€è¦å¯¹è§’åº¦è¿›è¡Œç›¸åº”è°ƒæ•´
        const meanAngle = -angleCI.meanAngle;
        const lowerBound = -angleCI.upperBound;
        const upperBound = -angleCI.lowerBound;

        console.log(
          `ğŸ¨ ç»˜åˆ¶è§’åº¦ç½®ä¿¡åŒºé—´ #${index} (ä½ç½®: ${playerPos.x}, ${playerPos.z}):`,
          {
            meanAngle: ((meanAngle * 180) / Math.PI).toFixed(2) + "Â°",
            lowerBound: ((lowerBound * 180) / Math.PI).toFixed(2) + "Â°",
            upperBound: ((upperBound * 180) / Math.PI).toFixed(2) + "Â°",
          }
        );

        // ä¸ºä¸åŒçš„ç½®ä¿¡åŒºé—´ä½¿ç”¨ä¸åŒçš„é¢œè‰²
        const colors = [
          { r: 0, g: 255, b: 100 }, // ç»¿è‰²
          { r: 255, g: 100, b: 100 }, // çº¢è‰²
          { r: 100, g: 100, b: 255 }, // è“è‰²
          { r: 255, g: 255, b: 100 }, // é»„è‰²
          { r: 255, g: 100, b: 255 }, // ç´«è‰²
          { r: 100, g: 255, b: 255 }, // é’è‰²
        ];
        const color = colors[index % colors.length];

        // åˆ›å»ºæ¸å˜æ•ˆæœ
        const gradient = ctx.createRadialGradient(
          playerX,
          playerZ,
          0,
          playerX,
          playerZ,
          radius
        );
        gradient.addColorStop(
          0,
          `rgba(${color.r}, ${color.g}, ${color.b}, 0.4)`
        );
        gradient.addColorStop(
          0.7,
          `rgba(${color.r}, ${color.g}, ${color.b}, 0.2)`
        );
        gradient.addColorStop(
          1,
          `rgba(${color.r}, ${color.g}, ${color.b}, 0.05)`
        );

        // ç»˜åˆ¶æ¸å˜æ‰‡å½¢
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.moveTo(playerX, playerZ);
        ctx.arc(playerX, playerZ, radius, lowerBound, upperBound, false);
        ctx.closePath();
        ctx.fill();

        // ç»˜åˆ¶ä¸­è½´çº¿ï¼ˆå¹³å‡è§’åº¦å°„çº¿ï¼‰
        const centerLineColor = `rgb(${color.r}, ${color.g}, ${color.b})`;
        ctx.strokeStyle = centerLineColor;
        ctx.lineWidth = 2; // å‡å°çº¿æ¡ç²—ç»†
        ctx.setLineDash([]);
        ctx.shadowColor = centerLineColor;
        ctx.shadowBlur = 6; // å‡å°å‘å…‰æ•ˆæœ
        ctx.beginPath();
        ctx.moveTo(playerX, playerZ);
        ctx.lineTo(
          playerX + Math.cos(meanAngle) * radius,
          playerZ + Math.sin(meanAngle) * radius
        );
        ctx.stroke();
        ctx.shadowBlur = 0;

        // ç»˜åˆ¶ç½®ä¿¡åŒºé—´è¾¹ç•Œå°„çº¿ï¼ˆæ¸å˜æ•ˆæœï¼‰
        const drawBoundaryRay = (angle, rayColor) => {
          const rayGradient = ctx.createLinearGradient(
            playerX,
            playerZ,
            playerX + Math.cos(angle) * radius,
            playerZ + Math.sin(angle) * radius
          );
          rayGradient.addColorStop(0, rayColor);
          rayGradient.addColorStop(1, rayColor.replace("1)", "0.3)"));

          ctx.strokeStyle = rayGradient;
          ctx.lineWidth = 1.5; // å‡å°è¾¹ç•Œçº¿ç²—ç»†
          ctx.setLineDash([6, 3]); // è°ƒæ•´è™šçº¿æ ·å¼
          ctx.shadowColor = rayColor;
          ctx.shadowBlur = 4; // å‡å°é˜´å½±æ•ˆæœ
          ctx.beginPath();
          ctx.moveTo(playerX, playerZ);
          ctx.lineTo(
            playerX + Math.cos(angle) * radius,
            playerZ + Math.sin(angle) * radius
          );
          ctx.stroke();
          ctx.shadowBlur = 0;
        };

        // ç»˜åˆ¶ä¸Šä¸‹è¾¹ç•Œå°„çº¿
        const boundaryColor = `rgba(${color.r}, ${color.g}, ${color.b}, 1)`;
        drawBoundaryRay(lowerBound, boundaryColor);
        drawBoundaryRay(upperBound, boundaryColor);

        // é‡ç½®çº¿æ¡æ ·å¼
        ctx.setLineDash([]);
      }

      // çƒ­åŠ›å›¾åŠŸèƒ½å·²ç§»é™¤

      // ç»˜åˆ¶ç­‰é«˜çº¿
      function drawContourLines(ctx, canvas, toCanvasX, toCanvasZ, rect) {
        // å‡å°‘ç­‰é«˜çº¿æ•°é‡ä»¥æé«˜æ€§èƒ½
        const levels = [0.0001, 0.0005, 0.001]; // æ¦‚ç‡å¯†åº¦ç­‰é«˜çº¿
        const colors = ["#FF6B6B", "#45B7D1", "#FFEAA7"];

        levels.forEach((level, index) => {
          ctx.strokeStyle = colors[index];
          ctx.lineWidth = 2;
          drawContour(ctx, canvas, level, toCanvasX, toCanvasZ, rect);
        });
      }

      // ç»˜åˆ¶å•æ¡ç­‰é«˜çº¿
      function drawContour(ctx, canvas, level, toCanvasX, toCanvasZ, rect) {
        // å¢åŠ æ­¥é•¿ä»¥æé«˜æ€§èƒ½
        const step = 40;
        ctx.beginPath();

        // ä½¿ç”¨æ˜¾ç¤ºå°ºå¯¸è€Œä¸æ˜¯å®é™…canvaså°ºå¯¸æ¥é¿å…æ€§èƒ½é—®é¢˜
        const displayWidth = rect.width;
        const displayHeight = rect.height;

        for (let i = 0; i < displayWidth - step; i += step) {
          for (let j = 0; j < displayHeight - step; j += step) {
            const x1 = (i / rect.width) * 4000 - 2000;
            const z1 = 2000 - (j / rect.height) * 4000;
            const x2 = ((i + step) / rect.width) * 4000 - 2000;
            const z2 = 2000 - ((j + step) / rect.height) * 4000;

            const p1 = gaussianPDF(
              x1,
              z1,
              bayesianPosterior.meanX,
              bayesianPosterior.meanZ,
              bayesianPosterior.varX,
              bayesianPosterior.varZ
            );
            const p2 = gaussianPDF(
              x2,
              z2,
              bayesianPosterior.meanX,
              bayesianPosterior.meanZ,
              bayesianPosterior.varX,
              bayesianPosterior.varZ
            );

            if ((p1 <= level && p2 >= level) || (p1 >= level && p2 <= level)) {
              ctx.moveTo(i, j);
              ctx.lineTo(i + step, j + step);
            }
          }
        }
        ctx.stroke();
      }

      // Box-Mullerå˜æ¢ç”Ÿæˆæ­£æ€åˆ†å¸ƒéšæœºæ•°
      let normalRandomSpare = null;

      function normalRandom(mean = 0, stdDev = 1) {
        if (normalRandomSpare !== null) {
          const spare = normalRandomSpare;
          normalRandomSpare = null;
          return spare * stdDev + mean;
        }

        let u1, u2;
        do {
          u1 = Math.random();
        } while (u1 === 0); // ç¡®ä¿u1ä¸ä¸º0

        u2 = Math.random();

        const z0 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
        const z1 = Math.sqrt(-2 * Math.log(u1)) * Math.sin(2 * Math.PI * u2);

        normalRandomSpare = z1;
        return z0 * stdDev + mean;
      }

      // ä¼½é©¬å‡½æ•°çš„è¿‘ä¼¼è®¡ç®—ï¼ˆLanczosé€¼è¿‘ï¼‰
      function gamma(z) {
        const g = 7;
        const C = [
          0.99999999999980993, 676.5203681218851, -1259.1392167224028,
          771.32342877765313, -176.61502916214059, 12.507343278686905,
          -0.13857109526572012, 9.9843695780195716e-6, 1.5056327351493116e-7,
        ];

        if (z < 0.5) {
          return Math.PI / (Math.sin(Math.PI * z) * gamma(1 - z));
        }

        z -= 1;
        let x = C[0];
        for (let i = 1; i < g + 2; i++) {
          x += C[i] / (z + i);
        }

        const t = z + g + 0.5;
        return Math.sqrt(2 * Math.PI) * Math.pow(t, z + 0.5) * Math.exp(-t) * x;
      }

      // ä¸å®Œå…¨è´å¡”å‡½æ•°
      function incompleteBeta(x, a, b) {
        if (x === 0) return 0;
        if (x === 1) return 1;

        // ä½¿ç”¨è¿åˆ†æ•°å±•å¼€
        const bt = Math.exp(
          logGamma(a + b) -
            logGamma(a) -
            logGamma(b) +
            a * Math.log(x) +
            b * Math.log(1 - x)
        );

        if (x < (a + 1) / (a + b + 2)) {
          return (bt * betaContinuedFraction(x, a, b)) / a;
        } else {
          return 1 - (bt * betaContinuedFraction(1 - x, b, a)) / b;
        }
      }

      // å¯¹æ•°ä¼½é©¬å‡½æ•°
      function logGamma(z) {
        return Math.log(gamma(z));
      }

      // è´å¡”å‡½æ•°çš„è¿åˆ†æ•°å±•å¼€
      function betaContinuedFraction(x, a, b) {
        const maxIterations = 100;
        const epsilon = 1e-15;

        const qab = a + b;
        const qap = a + 1;
        const qam = a - 1;
        let c = 1;
        let d = 1 - (qab * x) / qap;

        if (Math.abs(d) < 1e-30) d = 1e-30;
        d = 1 / d;
        let h = d;

        for (let m = 1; m <= maxIterations; m++) {
          const m2 = 2 * m;
          let aa = (m * (b - m) * x) / ((qam + m2) * (a + m2));
          d = 1 + aa * d;
          if (Math.abs(d) < 1e-30) d = 1e-30;
          c = 1 + aa / c;
          if (Math.abs(c) < 1e-30) c = 1e-30;
          d = 1 / d;
          h *= d * c;

          aa = (-(a + m) * (qab + m) * x) / ((a + m2) * (qap + m2));
          d = 1 + aa * d;
          if (Math.abs(d) < 1e-30) d = 1e-30;
          c = 1 + aa / c;
          if (Math.abs(c) < 1e-30) c = 1e-30;
          d = 1 / d;
          const del = d * c;
          h *= del;

          if (Math.abs(del - 1) < epsilon) break;
        }

        return h;
      }

      // tåˆ†å¸ƒé€†å‡½æ•°ï¼ˆæ•°å€¼é€¼è¿‘ï¼‰
      function tDistributionInverse(p, df) {
        if (p <= 0 || p >= 1) {
          throw new Error("æ¦‚ç‡å¿…é¡»åœ¨0å’Œ1ä¹‹é—´");
        }

        if (df <= 0) {
          throw new Error("è‡ªç”±åº¦å¿…é¡»å¤§äº0");
        }

        // å¯¹äºå¤§è‡ªç”±åº¦ï¼Œä½¿ç”¨æ­£æ€åˆ†å¸ƒé€¼è¿‘
        if (df > 1000) {
          return normalInverse(p);
        }

        // ä½¿ç”¨ç‰›é¡¿-æ‹‰å¤«é€Šæ–¹æ³•æ±‚è§£
        let x = normalInverse(p); // åˆå§‹çŒœæµ‹

        for (let i = 0; i < 10; i++) {
          const fx = tDistributionCDF(x, df) - p;
          const fpx = tDistributionPDF(x, df);

          if (Math.abs(fx) < 1e-10) break;

          x = x - fx / fpx;
        }

        return x;
      }

      // tåˆ†å¸ƒç´¯ç§¯åˆ†å¸ƒå‡½æ•°
      function tDistributionCDF(t, df) {
        const x = df / (df + t * t);
        return 0.5 + (t > 0 ? 0.5 : -0.5) * incompleteBeta(x, df / 2, 0.5);
      }

      // tåˆ†å¸ƒæ¦‚ç‡å¯†åº¦å‡½æ•°
      function tDistributionPDF(t, df) {
        const coeff =
          gamma((df + 1) / 2) / (Math.sqrt(df * Math.PI) * gamma(df / 2));
        return coeff * Math.pow(1 + (t * t) / df, -(df + 1) / 2);
      }

      // æ ‡å‡†æ­£æ€åˆ†å¸ƒé€†å‡½æ•°ï¼ˆBeasley-Springer-Moroç®—æ³•ï¼‰
      function normalInverse(p) {
        const a = [
          0, -3.969683028665376e1, 2.209460984245205e2, -2.759285104469687e2,
          1.38357751867269e2, -3.066479806614716e1, 2.506628277459239,
        ];
        const b = [
          0, -5.447609879822406e1, 1.615858368580409e2, -1.556989798598866e2,
          6.680131188771972e1, -1.328068155288572e1,
        ];
        const c = [
          0, -7.784894002430293e-3, -3.223964580411365e-1, -2.400758277161838,
          -2.549732539343734, 4.374664141464968, 2.938163982698783,
        ];
        const d = [
          0, 7.784695709041462e-3, 3.224671290700398e-1, 2.445134137142996,
          3.754408661907416,
        ];

        const pLow = 0.02425;
        const pHigh = 1 - pLow;

        if (p < pLow) {
          const q = Math.sqrt(-2 * Math.log(p));
          return (
            (((((c[1] * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) * q +
              c[6]) /
            ((((d[1] * q + d[2]) * q + d[3]) * q + d[4]) * q + 1)
          );
        } else if (p <= pHigh) {
          const q = p - 0.5;
          const r = q * q;
          return (
            ((((((a[1] * r + a[2]) * r + a[3]) * r + a[4]) * r + a[5]) * r +
              a[6]) *
              q) /
            (((((b[1] * r + b[2]) * r + b[3]) * r + b[4]) * r + b[5]) * r + 1)
          );
        } else {
          const q = Math.sqrt(-2 * Math.log(1 - p));
          return (
            -(
              ((((c[1] * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) * q +
              c[6]
            ) /
            ((((d[1] * q + d[2]) * q + d[3]) * q + d[4]) * q + 1)
          );
        }
      }

      // é«˜æ–¯æ¦‚ç‡å¯†åº¦å‡½æ•°
      function gaussianPDF(x, z, meanX, meanZ, varX, varZ) {
        const dx = x - meanX;
        const dz = z - meanZ;
        const coeff = 1 / (2 * Math.PI * Math.sqrt(varX * varZ));
        const exponent = -((dx * dx) / (2 * varX) + (dz * dz) / (2 * varZ));
        return coeff * Math.exp(exponent);
      }

      // ç»˜åˆ¶ä¼°è®¡ä½ç½®
      function drawEstimatedPosition(
        ctx,
        canvas,
        toCanvasX,
        toCanvasZ,
        displayMode
      ) {
        let estimatedX, estimatedZ, marginX, marginZ;

        if (bayesianPosterior) {
          estimatedX = bayesianPosterior.meanX;
          estimatedZ = bayesianPosterior.meanZ;
          marginX = bayesianPosterior.marginX;
          marginZ = bayesianPosterior.marginZ;
        } else {
          const n = eyeData.length;
          estimatedX = eyeData.reduce((sum, point) => sum + point.x, 0) / n;
          estimatedZ = eyeData.reduce((sum, point) => sum + point.z, 0) / n;
          // ç®€åŒ–çš„ç½®ä¿¡åŒºé—´è®¡ç®—
          marginX = marginZ = 50;
        }

        const canvasX = toCanvasX(estimatedX);
        const canvasZ = toCanvasZ(estimatedZ);

        // ç»˜åˆ¶ç½®ä¿¡åŒºé—´æ¤­åœ†
        ctx.strokeStyle =
          displayMode === "heatmap"
            ? "rgba(0,191,255,0.8)"
            : "rgba(0,191,255,0.6)";
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);

        const radiusX = (marginX / 800) * canvas.width;
        const radiusZ = (marginZ / 800) * canvas.height;

        ctx.beginPath();
        ctx.ellipse(canvasX, canvasZ, radiusX, radiusZ, 0, 0, 2 * Math.PI);
        ctx.stroke();

        ctx.setLineDash([]);

        // ç»˜åˆ¶ä¼°è®¡ä½ç½®ç‚¹
        ctx.fillStyle = displayMode === "heatmap" ? "#00BFFF" : "#0080FF";
        ctx.beginPath();
        ctx.arc(canvasX, canvasZ, 5, 0, 2 * Math.PI);
        ctx.fill();

        ctx.strokeStyle = "#ffffff";
        ctx.lineWidth = 2;
        ctx.stroke();
      }

      // æ›´æ–°æˆ‘çš„ä¸–ç•Œæç¤º
      function updateMinecraftTips() {
        const tipsDiv = document.getElementById("minecraft-tips");
        const n = eyeData.length;
        const statisticalMethod =
          document.getElementById("statistical-method").value;
        const methodText =
          statisticalMethod === "bayesian" ? "è´å¶æ–¯æ–¹æ³•" : "ç»å…¸ç»Ÿè®¡æ–¹æ³•";

        if (n === 0) {
          tipsDiv.innerHTML = "<p>å¼€å§‹æŠ•æ·æœ«å½±ä¹‹çœ¼æ¥å®šä½æœ«åœ°è¦å¡ï¼</p>";
        } else if (n < 3) {
          tipsDiv.innerHTML = `<p>å·²æŠ•æ· ${n} æ¬¡ï¼Œè‡³å°‘éœ€è¦ 3 æ¬¡æ‰èƒ½è¿›è¡Œç»Ÿè®¡åˆ†æã€‚</p>`;
        } else if (n < 12) {
          tipsDiv.innerHTML = `<p>å·²æŠ•æ· ${n} æ¬¡ï¼Œä½¿ç”¨${methodText}è¿›è¡Œåˆ†æã€‚æ ·æœ¬é‡è¿˜å¯ä»¥æ›´å¤§ä»¥æé«˜ç²¾åº¦ã€‚</p>`;
        } else {
          tipsDiv.innerHTML = `<p>å·²æŠ•æ· ${n} æ¬¡ï¼Œä½¿ç”¨${methodText}è¿›è¡Œåˆ†æã€‚æ ·æœ¬é‡å……è¶³ï¼Œå®šä½ç²¾åº¦è¾ƒé«˜ï¼</p>`;
        }

        if (statisticalMethod === "bayesian" && n >= 3) {
          const priorType = document.getElementById("prior-distribution").value;
          const priorText =
            priorType === "uniform"
              ? "æ— ä¿¡æ¯å…ˆéªŒ"
              : priorType === "normal"
              ? "æ­£æ€å…ˆéªŒ"
              : "æœ‰ä¿¡æ¯å…ˆéªŒ";
          tipsDiv.innerHTML += `<p>å½“å‰ä½¿ç”¨${priorText}åˆ†å¸ƒï¼Œå¯å°è¯•ä¸åŒå…ˆéªŒåˆ†å¸ƒè§‚å¯Ÿç»“æœå˜åŒ–ã€‚</p>`;
        }
      }

      // äº‹ä»¶ç›‘å¬å™¨
      document.addEventListener("DOMContentLoaded", function () {
        initParticles();

        // åˆå§‹åŒ–å£°çº³åœ°å›¾
        setTimeout(() => {
          drawSonarMap(0, 0, 0, 0);
        }, 100);

        // ç³–æœç›’å®éªŒ
        document
          .getElementById("sample-btn")
          .addEventListener("click", sampleCandies);
        document
          .getElementById("reveal-truth-btn")
          .addEventListener("click", revealTruth);
        document
          .getElementById("repeat-experiment-btn")
          .addEventListener("click", repeatExperiment);

        // ç†è§£åº¦è¯„åˆ†
        document.querySelectorAll(".understanding-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            const step = parseInt(this.closest(".theory-step").dataset.step);
            const level = parseInt(this.dataset.level);
            setUnderstanding(step, level);
          });
        });

        // AIå¸®åŠ©æŒ‰é’®
        document.querySelectorAll(".ai-help-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            const step = parseInt(this.dataset.step);
            showAIHelp(step);
          });
        });

        // å£°çº³å®éªŒ
        document
          .getElementById("deploy-single-btn")
          .addEventListener("click", deploySingleSonar);
        document
          .getElementById("deploy-batch-btn")
          .addEventListener("click", deployBatchSonar);
        document
          .getElementById("reveal-shell-btn")
          .addEventListener("click", revealShellPosition);
        document
          .getElementById("reset-search-btn")
          .addEventListener("click", resetSearch);

        // å…³é—­åé¦ˆä¿¡æ¯æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
        document
          .getElementById("close-feedback")
          .addEventListener("click", function () {
            const feedbackDiv = document.getElementById("prediction-feedback");
            if (feedbackDiv) {
              feedbackDiv.style.display = "none";
            }
          });

        // è°ƒè¯•æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
        document
          .getElementById("debug-btn")
          .addEventListener("click", function () {
            console.log("=== è°ƒè¯•ä¿¡æ¯ ===");
            console.log("å£°çº³æ•°æ®:", sonarData);
            console.log("æ˜¾ç¤ºçœŸå®ä½ç½®:", showTruePosition);
            console.log("åœ°å›¾ç¼©æ”¾:", mapZoom);
            console.log("åœ°å›¾åç§»:", { mapOffsetX, mapOffsetY });

            const canvas = document.getElementById("sonar-map");
            if (canvas) {
              const rect = canvas.getBoundingClientRect();
              console.log("Canvaså°ºå¯¸:", {
                width: canvas.width,
                height: canvas.height,
                displayWidth: rect.width,
                displayHeight: rect.height,
              });
            }

            if (sonarData.length > 0) {
              const avgX =
                sonarData.reduce((sum, p) => sum + p.x, 0) / sonarData.length;
              const avgY =
                sonarData.reduce((sum, p) => sum + p.y, 0) / sonarData.length;
              console.log("å¹³å‡ä½ç½®:", { avgX, avgY });
            }

            const truePos = getSonarTruePosition();
            console.log("çœŸå®ä½ç½®:", truePos);

            // å¼ºåˆ¶é‡ç»˜åœ°å›¾
            drawSonarMap();

            alert("è°ƒè¯•ä¿¡æ¯å·²è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œè¯·æŒ‰F12æŸ¥çœ‹Consoleæ ‡ç­¾é¡µ");
          });

        // æœ«å½±ä¹‹çœ¼å®éªŒ
        document
          .getElementById("throw-eye-btn")
          .addEventListener("click", throwEye);

        // æ˜¾ç¤º/éšè—è¦å¡ä½ç½®
        document
          .getElementById("toggle-stronghold-btn")
          .addEventListener("click", function () {
            showTruePosition = !showTruePosition;
            const btn = document.getElementById("toggle-stronghold-btn");
            if (showTruePosition) {
              btn.innerHTML =
                'éšè—è¦å¡ä½ç½® <i class="fa fa-eye-slash ml-2"></i>';
              btn.className =
                "px-6 py-2 bg-red-600 text-white font-bold rounded-md hover:bg-red-700 transition-all duration-300";
            } else {
              btn.innerHTML =
                'æ˜¾ç¤ºè¦å¡ä½ç½® <i class="fa fa-map-marker ml-2"></i>';
              btn.className =
                "px-6 py-2 bg-neon-orange text-dark-bg font-bold rounded-md hover:bg-neon-orange/80 transition-all duration-300";
            }
            drawMinecraftMap(); // é‡æ–°ç»˜åˆ¶åœ°å›¾
          });

        // é‡ç½®æ¸¸æˆ
        document
          .getElementById("reset-game-btn")
          .addEventListener("click", function () {
            if (confirm("ç¡®å®šè¦é‡ç½®æ¸¸æˆå—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰æŠ•æ·æ•°æ®ã€‚")) {
              // é‡ç½®æ‰€æœ‰æ•°æ®
              eyeData = [];
              eyeThrowIndex = 0;
              showTruePosition = false;
              isMovingPlayer = false;

              // é‡ç½®ç©å®¶ä½ç½®åˆ°åŸç‚¹
              playerPosition = { x: 0, z: 0 };

              // é‡ç½®UIå…ƒç´ 
              document.getElementById("eye-count").value = "3";
              document.getElementById("eye-confidence").value = "0.95";

              // é‡ç½®æŒ‰é’®çŠ¶æ€
              const moveBtn = document.getElementById("move-player-btn");
              moveBtn.textContent = "ç§»åŠ¨ç©å®¶ä½ç½®";
              moveBtn.className =
                "px-6 py-2 bg-neon-blue text-white font-bold rounded-md hover:bg-neon-blue/80 transition-all duration-300";

              // éšè—æˆåŠŸä¿¡æ¯
              const successInfo = document.getElementById("success-info");
              if (successInfo) {
                successInfo.style.display = "none";
              }

              // é‡æ–°ç”Ÿæˆè¦å¡ä½ç½®
              strongholdTruePosition = generateRandomStrongholdPosition();

              // é‡æ–°ç»˜åˆ¶åœ°å›¾
              drawMinecraftMap();

              console.log("ğŸ”„ æ¸¸æˆå·²é‡ç½®");
            }
          });

        // ç§»åŠ¨ç©å®¶ä½ç½®
        document
          .getElementById("move-player-btn")
          .addEventListener("click", function () {
            if (!isMovingPlayer) {
              isMovingPlayer = true;
              const btn = document.getElementById("move-player-btn");
              btn.textContent = "ç‚¹å‡»åœ°å›¾é€‰æ‹©æ–°ä½ç½®";
              btn.className =
                "px-6 py-2 bg-yellow-600 text-white font-bold rounded-md hover:bg-yellow-700 transition-all duration-300";
              // æ˜¾ç¤ºéé˜»å¡æç¤º
              showToast("è¯·åœ¨åœ°å›¾ä¸Šç‚¹å‡»é€‰æ‹©ç©å®¶çš„æ–°ä½ç½®", "info");
            } else {
              // å–æ¶ˆç§»åŠ¨æ¨¡å¼
              isMovingPlayer = false;
              const btn = document.getElementById("move-player-btn");
              btn.textContent = "ç§»åŠ¨ç©å®¶ä½ç½®";
              btn.className =
                "px-6 py-2 bg-neon-blue text-white font-bold rounded-md hover:bg-neon-blue/80 transition-all duration-300";
            }
          });

        // ç»Ÿè®¡æ–¹æ³•åˆ‡æ¢
        document
          .getElementById("statistical-method")
          .addEventListener("change", function () {
            const bayesianControls =
              document.getElementById("bayesian-controls");
            if (this.value === "bayesian") {
              bayesianControls.style.display = "block";
            } else {
              bayesianControls.style.display = "none";
            }
            // é‡æ–°è®¡ç®—å’Œç»˜åˆ¶
            if (eyeData.length >= 3) {
              if (this.value === "bayesian") {
                const confidenceLevel = parseFloat(
                  document.getElementById("eye-confidence").value
                );
                const priorDistribution =
                  document.getElementById("prior-distribution").value;
                calculateBayesianPosition(confidenceLevel, priorDistribution);
              } else {
                const confidenceLevel = parseFloat(
                  document.getElementById("eye-confidence").value
                );
                calculateStrongholdPosition(confidenceLevel);
              }
              drawMinecraftMap();
              updateMinecraftTips();
            }
          });

        // å…ˆéªŒåˆ†å¸ƒå’Œæ˜¾ç¤ºæ¨¡å¼å˜åŒ–
        document
          .getElementById("prior-distribution")
          .addEventListener("change", function () {
            if (
              document.getElementById("statistical-method").value ===
                "bayesian" &&
              eyeData.length >= 3
            ) {
              const confidenceLevel = parseFloat(
                document.getElementById("eye-confidence").value
              );
              calculateBayesianPosition(confidenceLevel, this.value);
              drawMinecraftMap();
              updateMinecraftTips();
            }
          });

        // Alphaå€¼å˜åŒ–ç›‘å¬å™¨
        document
          .getElementById("alpha-level")
          .addEventListener("change", function () {
            if (eyeData.length >= 3) {
              const alpha = parseFloat(this.value);
              const angleCI = calculateAngleConfidenceInterval(alpha);
              if (angleCI && angleCI.length > 0) {
                // æ˜¾ç¤ºæœ€æ–°çš„ç½®ä¿¡åŒºé—´ï¼ˆæœ€åä¸€ä¸ªï¼‰
                const latestCI = angleCI[angleCI.length - 1];
                document.getElementById(
                  "angle-confidence-interval"
                ).textContent = `[${latestCI.lowerBoundDegrees.toFixed(
                  1
                )}Â°, ${latestCI.upperBoundDegrees.toFixed(1)}Â°] (${Math.round(
                  (1 - alpha) * 100
                )}%) - ä½ç½®${angleCI.length}`;
              }
              drawMinecraftMap();
            }
          });

        // Minecraftåœ°å›¾ç¼©æ”¾å’Œæ‹–æ‹½äº‹ä»¶
        const minecraftCanvas = document.getElementById("minecraft-map");

        // ç¼©æ”¾æŒ‰é’®äº‹ä»¶
        document
          .getElementById("zoom-in")
          .addEventListener("click", function () {
            minecraftMapZoom = Math.min(minecraftMapZoom * 1.2, 5);
            drawMinecraftMap();
          });

        document
          .getElementById("zoom-out")
          .addEventListener("click", function () {
            minecraftMapZoom = Math.max(minecraftMapZoom / 1.2, 0.2);
            drawMinecraftMap();
          });

        document
          .getElementById("reset-view")
          .addEventListener("click", function () {
            minecraftMapZoom = 1;
            minecraftMapOffsetX = 0;
            minecraftMapOffsetY = 0;
            drawMinecraftMap();
          });

        // é¼ æ ‡æ‹–æ‹½äº‹ä»¶
        minecraftCanvas.addEventListener("mousedown", function (e) {
          minecraftIsDragging = true;
          minecraftLastMouseX = e.clientX;
          minecraftLastMouseY = e.clientY;
          minecraftCanvas.style.cursor = "grabbing";
        });

        minecraftCanvas.addEventListener("mousemove", function (e) {
          const rect = minecraftCanvas.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;

          // æ›´æ–°åæ ‡æ˜¾ç¤ºï¼Œè€ƒè™‘åœ°å›¾åç§»å’Œç¼©æ”¾ï¼Œå¹¶è½¬æ¢ä¸ºæˆ‘çš„ä¸–ç•Œåæ ‡ï¼ˆé™¤ä»¥20ï¼‰
          const canvasX =
            (x - minecraftMapOffsetX - rect.width / 2) / minecraftMapZoom +
            rect.width / 2;
          const canvasY =
            (y - minecraftMapOffsetY - rect.height / 2) / minecraftMapZoom +
            rect.height / 2;
          const mapX = Math.round((canvasX / rect.width) * 4000 - 2000);
          const mapZ = Math.round(2000 - (canvasY / rect.height) * 4000);
          const worldX = Math.round(mapX / 20);
          const worldZ = Math.round(mapZ / 20);
          document.getElementById(
            "coordinate-display"
          ).innerHTML = `æ¸¸æˆåæ ‡: (${worldX}æ ¼, ${worldZ}æ ¼)<br>åœ°å›¾åæ ‡: [${mapX}, ${mapZ}]`;

          if (minecraftIsDragging) {
            const deltaX = e.clientX - minecraftLastMouseX;
            const deltaY = e.clientY - minecraftLastMouseY;
            minecraftMapOffsetX += deltaX;
            minecraftMapOffsetY += deltaY;
            minecraftLastMouseX = e.clientX;
            minecraftLastMouseY = e.clientY;
            drawMinecraftMap();
          }
        });

        minecraftCanvas.addEventListener("mouseup", function () {
          minecraftIsDragging = false;
          minecraftCanvas.style.cursor = "crosshair";
        });

        // åœ°å›¾ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ - å¤„ç†ç©å®¶ä½ç½®ç§»åŠ¨
        minecraftCanvas.addEventListener("click", function (e) {
          if (isMovingPlayer && !minecraftIsDragging) {
            const rect = minecraftCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // è®¡ç®—ç‚¹å‡»ä½ç½®çš„åœ°å›¾åæ ‡
            const canvasX =
              (x - minecraftMapOffsetX - rect.width / 2) / minecraftMapZoom +
              rect.width / 2;
            const canvasY =
              (y - minecraftMapOffsetY - rect.height / 2) / minecraftMapZoom +
              rect.height / 2;
            const mapX = Math.round((canvasX / rect.width) * 4000 - 2000);
            const mapZ = Math.round(2000 - (canvasY / rect.height) * 4000);

            // æ›´æ–°ç©å®¶ä½ç½®
            playerPosition.x = mapX;
            playerPosition.z = mapZ;

            // é€€å‡ºç§»åŠ¨æ¨¡å¼
            isMovingPlayer = false;
            document.getElementById("move-player-btn").textContent =
              "ç§»åŠ¨ç©å®¶ä½ç½®";
            document.getElementById("move-player-btn").className =
              "px-6 py-2 bg-neon-blue text-white font-bold rounded-md hover:bg-neon-blue/80 transition-all duration-300";

            // é‡æ–°ç»˜åˆ¶åœ°å›¾
            drawMinecraftMap();

            // æ˜¾ç¤ºç§»åŠ¨æˆåŠŸæç¤º
            const worldX = Math.round(mapX / 20);
            const worldZ = Math.round(mapZ / 20);
            showToast(
              `ç©å®¶å·²ç§»åŠ¨åˆ°æ–°ä½ç½®ï¼šæ¸¸æˆåæ ‡ (${worldX}æ ¼, ${worldZ}æ ¼)`,
              "success"
            );
          }
        });

        minecraftCanvas.addEventListener("mouseleave", function () {
          minecraftIsDragging = false;
          minecraftCanvas.style.cursor = "crosshair";
        });

        // é¼ æ ‡æ»šè½®ç¼©æ”¾
        minecraftCanvas.addEventListener("wheel", function (e) {
          e.preventDefault();
          const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
          minecraftMapZoom = Math.max(
            0.2,
            Math.min(5, minecraftMapZoom * zoomFactor)
          );
          drawMinecraftMap();
        });

        // å£°çº³åœ°å›¾ç¼©æ”¾å’Œæ‹–æ‹½äº‹ä»¶
        const sonarCanvas = document.getElementById("sonar-map");

        // å£°çº³åœ°å›¾ç¼©æ”¾æŒ‰é’®äº‹ä»¶
        document
          .getElementById("sonar-zoom-in")
          .addEventListener("click", function () {
            mapZoom = Math.min(mapZoom * 1.2, 5);
            if (sonarData.length > 0) {
              const avgX =
                sonarData.reduce((sum, p) => sum + p.x, 0) / sonarData.length;
              const avgY =
                sonarData.reduce((sum, p) => sum + p.y, 0) / sonarData.length;
              const marginX =
                1.96 *
                Math.sqrt(
                  sonarData.reduce(
                    (sum, p) => sum + Math.pow(p.x - avgX, 2),
                    0
                  ) / sonarData.length
                );
              const marginY =
                1.96 *
                Math.sqrt(
                  sonarData.reduce(
                    (sum, p) => sum + Math.pow(p.y - avgY, 2),
                    0
                  ) / sonarData.length
                );
              drawSonarMap(avgX, avgY, marginX, marginY);
            } else {
              drawSonarMap(0, 0, 0, 0);
            }
          });

        document
          .getElementById("sonar-zoom-out")
          .addEventListener("click", function () {
            mapZoom = Math.max(mapZoom / 1.2, 0.2);
            if (sonarData.length > 0) {
              const avgX =
                sonarData.reduce((sum, p) => sum + p.x, 0) / sonarData.length;
              const avgY =
                sonarData.reduce((sum, p) => sum + p.y, 0) / sonarData.length;
              const marginX =
                1.96 *
                Math.sqrt(
                  sonarData.reduce(
                    (sum, p) => sum + Math.pow(p.x - avgX, 2),
                    0
                  ) / sonarData.length
                );
              const marginY =
                1.96 *
                Math.sqrt(
                  sonarData.reduce(
                    (sum, p) => sum + Math.pow(p.y - avgY, 2),
                    0
                  ) / sonarData.length
                );
              drawSonarMap(avgX, avgY, marginX, marginY);
            } else {
              drawSonarMap(0, 0, 0, 0);
            }
          });

        document
          .getElementById("sonar-reset-view")
          .addEventListener("click", function () {
            mapZoom = 1;
            mapOffsetX = 0;
            mapOffsetY = 0;
            if (sonarData.length > 0) {
              const avgX =
                sonarData.reduce((sum, p) => sum + p.x, 0) / sonarData.length;
              const avgY =
                sonarData.reduce((sum, p) => sum + p.y, 0) / sonarData.length;
              const marginX =
                1.96 *
                Math.sqrt(
                  sonarData.reduce(
                    (sum, p) => sum + Math.pow(p.x - avgX, 2),
                    0
                  ) / sonarData.length
                );
              const marginY =
                1.96 *
                Math.sqrt(
                  sonarData.reduce(
                    (sum, p) => sum + Math.pow(p.y - avgY, 2),
                    0
                  ) / sonarData.length
                );
              drawSonarMap(avgX, avgY, marginX, marginY);
            } else {
              drawSonarMap(0, 0, 0, 0);
            }
          });

        // å£°çº³åœ°å›¾æ‹–æ‹½åŠŸèƒ½å·²ç¦ç”¨ï¼ˆå›ºå®šæ˜¾ç¤ºèŒƒå›´ï¼‰
        // ä¿ç•™åæ ‡æ˜¾ç¤ºåŠŸèƒ½
        sonarCanvas.addEventListener("mousemove", function (e) {
          const rect = sonarCanvas.getBoundingClientRect();
          const mouseX = e.clientX - rect.left;
          const mouseY = e.clientY - rect.top;

          // æ›´æ–°åæ ‡æ˜¾ç¤ºï¼ˆåŸºäºå›ºå®šèŒƒå›´-3åˆ°3ï¼‰
          const worldX = (mouseX / rect.width) * 6 - 3;
          const worldY = 3 - (mouseY / rect.height) * 6;
          document.getElementById(
            "sonar-coordinate-display"
          ).textContent = `åæ ‡: (${worldX.toFixed(1)}, ${worldY.toFixed(
            1
          )}) km`;
        });

        // å…¶ä»–é¼ æ ‡äº‹ä»¶å·²ç¦ç”¨
        // sonarCanvas.addEventListener("mousedown", function (e) {
        //   // æ‹–æ‹½åŠŸèƒ½å·²ç¦ç”¨
        // });
        // sonarCanvas.addEventListener("mouseup", function () {
        //   // æ‹–æ‹½åŠŸèƒ½å·²ç¦ç”¨
        // });
        // sonarCanvas.addEventListener("mouseleave", function () {
        //   // æ‹–æ‹½åŠŸèƒ½å·²ç¦ç”¨
        // });

        // å£°çº³åœ°å›¾æ»šè½®ç¼©æ”¾äº‹ä»¶å·²ç¦ç”¨ï¼ˆå›ºå®šæ˜¾ç¤ºèŒƒå›´ï¼‰
        // sonarCanvas.addEventListener("wheel", function (e) {
        //   // ç¼©æ”¾åŠŸèƒ½å·²ç¦ç”¨ä»¥ä¿æŒå›ºå®šæ˜¾ç¤ºèŒƒå›´
        // });

        document
          .getElementById("display-mode")
          .addEventListener("change", function () {
            drawMinecraftMap();
          });
      });

      // éé˜»å¡æç¤ºå‡½æ•°
      function showToast(message, type = "info", duration = 3000) {
        // åˆ›å»ºæç¤ºå…ƒç´ 
        const toast = document.createElement("div");
        toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300 translate-x-full opacity-0`;

        // æ ¹æ®ç±»å‹è®¾ç½®æ ·å¼
        const styles = {
          info: "bg-blue-600 text-white",
          success: "bg-green-600 text-white",
          warning: "bg-yellow-600 text-white",
          error: "bg-red-600 text-white",
        };

        toast.className += ` ${styles[type] || styles.info}`;
        toast.textContent = message;

        // æ·»åŠ åˆ°é¡µé¢
        document.body.appendChild(toast);

        // æ˜¾ç¤ºåŠ¨ç”»
        setTimeout(() => {
          toast.classList.remove("translate-x-full", "opacity-0");
        }, 10);

        // è‡ªåŠ¨éšè—
        setTimeout(() => {
          toast.classList.add("translate-x-full", "opacity-0");
          setTimeout(() => {
            if (toast.parentNode) {
              toast.parentNode.removeChild(toast);
            }
          }, 300);
        }, duration);
      }

      // æˆåŠŸåŠ¨ç”»å‡½æ•°
      function showSuccessAnimation(distance) {
        console.log(
          "ğŸ‰ ç©å®¶æ¥è¿‘è¦å¡ï¼Œè§¦å‘æˆåŠŸåŠ¨ç”»ï¼è·ç¦»:",
          (distance / 20).toFixed(1),
          "æ ¼"
        );

        // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
        const successInfo = document.getElementById("success-info");
        successInfo.style.display = "block";

        // è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
        const uniquePositions = new Set();
        let totalAngleError = 0;

        eyeData.forEach((point) => {
          const posKey = `${point.playerPosition.x},${point.playerPosition.z}`;
          uniquePositions.add(posKey);
          totalAngleError += Math.abs(point.angleError);
        });

        const avgError = totalAngleError / eyeData.length;
        const accuracy = Math.max(0, 100 - (distance / 320) * 100);

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼ˆè½¬æ¢ä¸ºæ¸¸æˆæ ¼æ•°ï¼‰
        const distanceInBlocks = distance / 20;
        document.getElementById("final-distance").textContent =
          distanceInBlocks.toFixed(1);
        document.getElementById("total-throws").textContent = eyeData.length;
        document.getElementById("total-positions").textContent =
          uniquePositions.size;
        document.getElementById("avg-error").textContent = (
          (avgError * 180) /
          Math.PI
        ).toFixed(1);
        document.getElementById("final-accuracy").textContent =
          accuracy.toFixed(1);

        // æ·»åŠ é—ªçƒåŠ¨ç”»
        successInfo.style.animation = "pulse 2s ease-in-out infinite";

        // æ·»åŠ CSSåŠ¨ç”»æ ·å¼ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
        if (!document.getElementById("success-animation-style")) {
          const style = document.createElement("style");
          style.id = "success-animation-style";
          style.textContent = `
              @keyframes pulse {
                0%, 100% { transform: scale(1); opacity: 1; }
                50% { transform: scale(1.05); opacity: 0.9; }
              }
              @keyframes bounce {
                0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
                40% { transform: translateY(-10px); }
                60% { transform: translateY(-5px); }
              }
            `;
          document.head.appendChild(style);
        }

        // æ’­æ”¾æˆåŠŸéŸ³æ•ˆï¼ˆå¦‚æœæµè§ˆå™¨æ”¯æŒï¼‰
        try {
          const audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
          oscillator.frequency.setValueAtTime(
            659.25,
            audioContext.currentTime + 0.1
          ); // E5
          oscillator.frequency.setValueAtTime(
            783.99,
            audioContext.currentTime + 0.2
          ); // G5

          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + 0.5
          );

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.5);
        } catch (e) {
          console.log("éŸ³æ•ˆæ’­æ”¾å¤±è´¥ï¼ˆæ­£å¸¸ç°è±¡ï¼‰:", e.message);
        }
      }
    </script>

    <!-- é¡µè„š -->
    <footer class="bg-dark-card py-12 border-t border-gray-800">
      <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
          <div>
            <div class="flex items-center space-x-2 mb-6">
              <div
                class="w-10 h-10 rounded-full bg-gradient-to-r from-neon-blue to-neon-purple flex items-center justify-center"
              >
                <i class="fa fa-calculator text-white text-xl"></i>
              </div>
              <h2 class="text-xl font-future font-bold text-white">
                <span class="text-neon-blue">æ¦‚ç‡</span
                ><span class="text-white">ç»´åº¦</span>
              </h2>
            </div>
            <p class="text-gray-400 mb-6">
              æ¢ç´¢æ¦‚ç‡ä¸æ•°ç†ç»Ÿè®¡çš„å¥‡å¦™ä¸–ç•Œï¼Œæ­ç¤ºæ•°æ®èƒŒåçš„è§„å¾‹ã€‚
            </p>
            <div class="flex space-x-4">
              <a
                href="https://www.douyin.com/"
                target="_blank"
                rel="noopener noreferrer"
                class="social-icon w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-gray-400 hover:bg-gradient-to-r hover:from-red-500 hover:to-pink-500 hover:text-white transition-all duration-300 transform hover:scale-110 hover:rotate-12"
                title="æŠ–éŸ³ - è®°å½•ç¾å¥½ç”Ÿæ´»"
              >
                <img
                  src="../static/img/tiktok.svg"
                  alt="æŠ–éŸ³"
                  class="w-5 h-5 transition-transform duration-300"
                />
              </a>
              <a
                href="https://www.bilibili.com/"
                target="_blank"
                rel="noopener noreferrer"
                class="social-icon w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-gray-400 hover:bg-gradient-to-r hover:from-pink-400 hover:to-pink-600 hover:text-white transition-all duration-300 transform hover:scale-110 hover:-rotate-12"
                title="å“”å“©å“”å“© - ä½ æ„Ÿå…´è¶£çš„è§†é¢‘éƒ½åœ¨Bç«™"
              >
                <img
                  src="../static/img/bilibili.svg"
                  alt="å“”å“©å“”å“©"
                  class="w-5 h-5 transition-transform duration-300"
                />
              </a>
              <a
                href="https://weixin.qq.com/"
                target="_blank"
                rel="noopener noreferrer"
                class="social-icon w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-gray-400 hover:bg-gradient-to-r hover:from-green-400 hover:to-green-600 hover:text-white transition-all duration-300 transform hover:scale-110 hover:rotate-12"
                title="å¾®ä¿¡ - æ˜¯ä¸€ä¸ªç”Ÿæ´»æ–¹å¼"
              >
                <img
                  src="../static/img/wechat.svg"
                  alt="å¾®ä¿¡"
                  class="w-5 h-5 transition-transform duration-300"
                />
              </a>
              <a
                href="https://weibo.com/"
                target="_blank"
                rel="noopener noreferrer"
                class="social-icon w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-gray-400 hover:bg-gradient-to-r hover:from-orange-400 hover:to-red-500 hover:text-white transition-all duration-300 transform hover:scale-110 hover:-rotate-12"
                title="å¾®åš - éšæ—¶éšåœ°å‘ç°æ–°é²œäº‹"
              >
                <img
                  src="../static/img/weibo.svg"
                  alt="å¾®åš"
                  class="w-5 h-5 transition-transform duration-300"
                />
              </a>
            </div>
          </div>

          <div>
            <h3 class="text-white font-future font-semibold mb-6">å¿«é€Ÿé“¾æ¥</h3>
            <ul class="space-y-3">
              <li>
                <a
                  href="index.html#concepts"
                  class="text-gray-400 hover:text-neon-blue transition-colors"
                  >æ ¸å¿ƒæ¦‚å¿µ</a
                >
              </li>
              <li>
                <a
                  href="index.html#simulations"
                  class="text-gray-400 hover:text-neon-blue transition-colors"
                  >æ¦‚ç‡æ¨¡æ‹Ÿ</a
                >
              </li>
              <li>
                <a
                  href="index.html#visualizations"
                  class="text-gray-400 hover:text-neon-blue transition-colors"
                  >æ•°æ®å¯è§†åŒ–</a
                >
              </li>
              <li>
                <a
                  href="index.html#applications"
                  class="text-gray-400 hover:text-neon-blue transition-colors"
                  >åº”ç”¨åœºæ™¯</a
                >
              </li>
            </ul>
          </div>

          <div>
            <h3 class="text-white font-future font-semibold mb-6">å­¦ä¹ èµ„æº</h3>
            <ul class="space-y-3">
              <li>
                <a
                  href="#"
                  class="text-gray-400 hover:text-neon-blue transition-colors"
                  >æ•™ç¨‹ä¸æŒ‡å—</a
                >
              </li>
              <li>
                <a
                  href="#"
                  class="text-gray-400 hover:text-neon-blue transition-colors"
                  >åœ¨çº¿è¯¾ç¨‹</a
                >
              </li>
              <li>
                <a
                  href="#"
                  class="text-gray-400 hover:text-neon-blue transition-colors"
                  >ä¹¦ç±æ¨è</a
                >
              </li>
              <li>
                <a
                  href="#"
                  class="text-gray-400 hover:text-neon-blue transition-colors"
                  >ç ”ç©¶è®ºæ–‡</a
                >
              </li>
            </ul>
          </div>

          <div>
            <h3 class="text-white font-future font-semibold mb-6">è”ç³»æˆ‘ä»¬</h3>
            <ul class="space-y-3">
              <li class="flex items-start">
                <i class="fa fa-envelope text-neon-blue mt-1 mr-3"></i>
                <span class="text-gray-400">WangHouxiong9558@outlook.com</span>
              </li>
              <li class="flex items-start">
                <i class="fa fa-map-marker text-neon-blue mt-1 mr-3"></i>
                <span class="text-gray-400"
                  >æ±Ÿè¥¿çœå—æ˜Œå¸‚é«˜æ–°æŠ€æœ¯å¼€å‘åŒºå¤©ç¥¥å¤§é“289å·</span
                >
              </li>
              <li class="flex items-start">
                <i class="fa fa-phone text-neon-blue mt-1 mr-3"></i>
                <span class="text-gray-400">+86 173 5709 8869</span>
              </li>
            </ul>
          </div>
        </div>

        <div
          class="pt-8 border-t border-gray-800 flex flex-col md:flex-row justify-between items-center"
        >
          <p class="text-gray-500 text-sm mb-4 md:mb-0">
            Â© 2025 æ¦‚ç‡ç»´åº¦. ä¿ç•™æ‰€æœ‰æƒåˆ©.
          </p>
          <div class="flex space-x-6">
            <a href="#" class="text-gray-500 hover:text-gray-300 text-sm"
              >éšç§æ”¿ç­–</a
            >
            <a href="#" class="text-gray-500 hover:text-gray-300 text-sm"
              >æœåŠ¡æ¡æ¬¾</a
            >
            <a href="#" class="text-gray-500 hover:text-gray-300 text-sm"
              >Cookieæ”¿ç­–</a
            >
          </div>
        </div>
        
        <!-- å¤‡æ¡ˆä¿¡æ¯ -->
        <div class="pt-4 text-center">
          <p class="text-gray-500 text-sm">
            <a 
              href="http://beian.miit.gov.cn/" 
              target="_blank" 
              rel="noopener noreferrer"
              class="text-gray-500 hover:text-gray-300 transition-colors underline cursor-pointer inline-block py-1 px-2"
              style="z-index: 999; position: relative;"
            >
              èµ£ICPå¤‡2025074925å·
            </a>
          </p>
          <p class="text-gray-600 text-xs mt-1">
            å®¡æ ¸é€šè¿‡æ—¥æœŸï¼š2025-10-27
          </p>
        </div>
      </div>
    </footer>
  </body>
</html>
